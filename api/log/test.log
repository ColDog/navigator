  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "config" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (5.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180924034801)[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-25 01:59:25.497822"], ["updated_at", "2018-09-25 01:59:25.497822"]]
  [1m[35m (4.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "config" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (6.7ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180924140732)[0m
  [1m[35m (6.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180924034801);

[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-25 01:59:51.388383"], ["updated_at", "2018-09-25 01:59:51.388383"]]
  [1m[35m (4.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 01:59:51.438783', '2018-09-25 01:59:51.438783', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 01:59:51.438783', '2018-09-25 01:59:51.438783', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 01:59:51.441371', '2018-09-25 01:59:51.441371', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 01:59:51.441371', '2018-09-25 01:59:51.441371', 298486374)[0m
  [1m[35m (4.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:00:26.413597', '2018-09-25 02:00:26.413597', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:00:26.413597', '2018-09-25 02:00:26.413597', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:00:26.416169', '2018-09-25 02:00:26.416169', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:00:26.416169', '2018-09-25 02:00:26.416169', 298486374)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:03:08.575480', '2018-09-25 02:03:08.575480', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:03:08.575480', '2018-09-25 02:03:08.575480', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:03:08.578737', '2018-09-25 02:03:08.578737', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:03:08.578737', '2018-09-25 02:03:08.578737', 298486374)[0m
  [1m[35m (5.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:03:33.763284', '2018-09-25 02:03:33.763284', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:03:33.763284', '2018-09-25 02:03:33.763284', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:03:33.765860', '2018-09-25 02:03:33.765860', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:03:33.765860', '2018-09-25 02:03:33.765860', 298486374)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:params:\n  :name: test\n  :stages:\n  - :name: review\n    :environment: staging\n    :review: true\n    :auto: true\n"], ["created_at", "2018-09-25 02:03:33.781189"], ["updated_at", "2018-09-25 02:03:33.781189"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:03:59.800454', '2018-09-25 02:03:59.800454', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:03:59.800454', '2018-09-25 02:03:59.800454', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:03:59.803255', '2018-09-25 02:03:59.803255', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:03:59.803255', '2018-09-25 02:03:59.803255', 298486374)[0m
  [1m[35m (4.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:params:\n  :name: test\n  :stages:\n  - :name: review\n    :environment: staging\n    :review: true\n    :auto: true\n"], ["created_at", "2018-09-25 02:03:59.820697"], ["updated_at", "2018-09-25 02:03:59.820697"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:04:39.576544', '2018-09-25 02:04:39.576544', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:04:39.576544', '2018-09-25 02:04:39.576544', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:04:39.579098', '2018-09-25 02:04:39.579098', 980190962)[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:04:39.579098', '2018-09-25 02:04:39.579098', 298486374)[0m
  [1m[35m (3.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:params:\n  :name: test\n  :stages:\n  - :name: review\n    :environment: staging\n    :review: true\n    :auto: true\n"], ["created_at", "2018-09-25 02:04:39.594961"], ["updated_at", "2018-09-25 02:04:39.594961"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:04:55.273608', '2018-09-25 02:04:55.273608', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:04:55.273608', '2018-09-25 02:04:55.273608', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:04:55.276319', '2018-09-25 02:04:55.276319', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:04:55.276319', '2018-09-25 02:04:55.276319', 298486374)[0m
  [1m[35m (5.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:params:\n  :name: test\n  :stages:\n  - :name: review\n    :environment: staging\n    :review: true\n    :auto: true\n"], ["created_at", "2018-09-25 02:04:55.294386"], ["updated_at", "2018-09-25 02:04:55.294386"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:05:32.891043', '2018-09-25 02:05:32.891043', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:05:32.891043', '2018-09-25 02:05:32.891043', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:05:32.893547', '2018-09-25 02:05:32.893547', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:05:32.893547', '2018-09-25 02:05:32.893547', 298486374)[0m
  [1m[35m (4.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:params:\n  :name: test\n  :stages:\n  - :name: review\n    :environment: staging\n    :review: true\n    :auto: true\n"], ["created_at", "2018-09-25 02:05:32.910315"], ["updated_at", "2018-09-25 02:05:32.910315"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.3ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:05:51.238749', '2018-09-25 02:05:51.238749', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:05:51.238749', '2018-09-25 02:05:51.238749', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:05:51.241399', '2018-09-25 02:05:51.241399', 980190962)[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:05:51.241399', '2018-09-25 02:05:51.241399', 298486374)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:params:\n  :name: test\n  :stages:\n  - :name: review\n    :environment: staging\n    :review: true\n    :auto: true\n"], ["created_at", "2018-09-25 02:05:51.258500"], ["updated_at", "2018-09-25 02:05:51.258500"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:06:56.908747', '2018-09-25 02:06:56.908747', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:06:56.908747', '2018-09-25 02:06:56.908747', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:06:56.911038', '2018-09-25 02:06:56.911038', 980190962)[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:06:56.911038', '2018-09-25 02:06:56.911038', 298486374)[0m
  [1m[35m (5.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:07:18.391403', '2018-09-25 02:07:18.391403', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:07:18.391403', '2018-09-25 02:07:18.391403', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:07:18.393951', '2018-09-25 02:07:18.393951', 980190962)[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:07:18.393951', '2018-09-25 02:07:18.393951', 298486374)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:07:18.409809"], ["updated_at", "2018-09-25 02:07:18.409809"]]
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "test"], ["created_at", "2018-09-25 02:07:18.417036"], ["updated_at", "2018-09-25 02:07:18.417036"]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (6.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180924140732)[0m
  [1m[35m (2.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180924034801);

[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-25 02:08:13.995317"], ["updated_at", "2018-09-25 02:08:13.995317"]]
  [1m[35m (5.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "events"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:08:14.047454', '2018-09-25 02:08:14.047454', 980190962)[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at", "id") VALUES ('MyString', 'MyText', '2018-09-25 02:08:14.047454', '2018-09-25 02:08:14.047454', 298486374)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:08:14.049298', '2018-09-25 02:08:14.049298', 980190962)[0m
  [1m[36mFixture Insert (0.0ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at", "id") VALUES ('MyString', '2018-09-25 02:08:14.049298', '2018-09-25 02:08:14.049298', 298486374)[0m
  [1m[35m (3.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:08:14.064322"], ["updated_at", "2018-09-25 02:08:14.064322"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "test"], ["created_at", "2018-09-25 02:08:14.071597"], ["updated_at", "2018-09-25 02:08:14.071597"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: review\n  environment: staging\n  review: true\n  auto: true\n"], ["updated_at", "2018-09-25 02:08:14.072889"], ["id", 980190963]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:09:37.670085"], ["updated_at", "2018-09-25 02:09:37.670085"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT "apps".* FROM "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:09:50.796460"], ["updated_at", "2018-09-25 02:09:50.796460"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "test"], ["created_at", "2018-09-25 02:09:50.800085"], ["updated_at", "2018-09-25 02:09:50.800085"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: review\n  environment: staging\n  review: true\n  auto: true\n"], ["updated_at", "2018-09-25 02:09:50.801239"], ["id", 980190963]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (6.2ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (5.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180924140732)[0m
  [1m[35m (3.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180924034801);

[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-25 02:10:09.812797"], ["updated_at", "2018-09-25 02:10:09.812797"]]
  [1m[35m (5.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT "apps".* FROM "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:10:09.879929"], ["updated_at", "2018-09-25 02:10:09.879929"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "test"], ["created_at", "2018-09-25 02:10:09.886533"], ["updated_at", "2018-09-25 02:10:09.886533"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: review\n  environment: staging\n  review: true\n  auto: true\n"], ["updated_at", "2018-09-25 02:10:09.888066"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT "apps".* FROM "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:10:12.437256"], ["updated_at", "2018-09-25 02:10:12.437256"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "test"], ["created_at", "2018-09-25 02:10:12.444269"], ["updated_at", "2018-09-25 02:10:12.444269"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: review\n  environment: staging\n  review: true\n  auto: true\n"], ["updated_at", "2018-09-25 02:10:12.445747"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:10:17.957711"], ["updated_at", "2018-09-25 02:10:17.957711"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT "apps".* FROM "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:10:28.072099"], ["updated_at", "2018-09-25 02:10:28.072099"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "test"], ["created_at", "2018-09-25 02:10:28.078961"], ["updated_at", "2018-09-25 02:10:28.078961"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: review\n  environment: staging\n  review: true\n  auto: true\n"], ["updated_at", "2018-09-25 02:10:28.080170"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:10:39.260232"], ["updated_at", "2018-09-25 02:10:39.260232"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:10:49.774700"], ["updated_at", "2018-09-25 02:10:49.774700"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT "apps".* FROM "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:11:16.627418"], ["updated_at", "2018-09-25 02:11:16.627418"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:12:27.365781"], ["updated_at", "2018-09-25 02:12:27.365781"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "test"], ["created_at", "2018-09-25 02:12:27.372656"], ["updated_at", "2018-09-25 02:12:27.372656"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: review\n  environment: staging\n  review: true\n  auto: true\n"], ["updated_at", "2018-09-25 02:12:27.373774"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:12:53.387635"], ["updated_at", "2018-09-25 02:12:53.387635"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "test"], ["created_at", "2018-09-25 02:12:53.396525"], ["updated_at", "2018-09-25 02:12:53.396525"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: review\n  environment: staging\n  review: true\n  auto: true\n"], ["updated_at", "2018-09-25 02:12:53.398091"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------
AppTest: test_create_an_app
---------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "AppSetEvent"], ["params", "---\n:name: test\n:stages:\n- :name: review\n  :environment: staging\n  :review: true\n  :auto: true\n"], ["created_at", "2018-09-25 02:17:03.041263"], ["updated_at", "2018-09-25 02:17:03.041263"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "test"], ["created_at", "2018-09-25 02:17:03.049286"], ["updated_at", "2018-09-25 02:17:03.049286"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: review\n  environment: staging\n  review: true\n  auto: true\n"], ["updated_at", "2018-09-25 02:17:03.050787"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 52b11d30-ec66-4071-8239-11f4918261a3\n"], ["created_at", "2018-09-25 15:09:01.054557"], ["updated_at", "2018-09-25 15:09:01.054557"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 52], ["name", "test"], ["created_at", "2018-09-25 15:09:01.060263"], ["updated_at", "2018-09-25 15:09:01.060263"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: f702595d-1ca8-4e5a-b45c-280469130843\n"], ["created_at", "2018-09-25 15:10:43.464301"], ["updated_at", "2018-09-25 15:10:43.464301"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 0], ["name", "test"], ["created_at", "2018-09-25 15:10:43.469708"], ["updated_at", "2018-09-25 15:10:43.469708"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 62a4201a-7cc5-434d-b038-f71ec55b2aa8\n"], ["created_at", "2018-09-25 15:10:55.525136"], ["updated_at", "2018-09-25 15:10:55.525136"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 62], ["name", "test"], ["created_at", "2018-09-25 15:10:55.531636"], ["updated_at", "2018-09-25 15:10:55.531636"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 79086e70-0dd9-4e4f-81d5-42baf159502b\n"], ["created_at", "2018-09-25 15:11:04.574461"], ["updated_at", "2018-09-25 15:11:04.574461"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 79086], ["name", "test"], ["created_at", "2018-09-25 15:11:04.580369"], ["updated_at", "2018-09-25 15:11:04.580369"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 1cfeab95-4411-46d5-a754-f1c284588109\n"], ["created_at", "2018-09-25 15:11:12.142507"], ["updated_at", "2018-09-25 15:11:12.142507"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 1], ["name", "test"], ["created_at", "2018-09-25 15:11:12.148807"], ["updated_at", "2018-09-25 15:11:12.148807"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: cceb9e2e-0054-48dc-9ddf-3d9c24750de4\n"], ["created_at", "2018-09-25 15:12:47.501362"], ["updated_at", "2018-09-25 15:12:47.501362"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-25 15:12:47.506998"], ["updated_at", "2018-09-25 15:12:47.506998"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-25 15:12:47.515573"], ["updated_at", "2018-09-25 15:12:47.515573"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-25 15:14:44.282444', '2018-09-25 15:14:44.282444')[0m
  [1m[35m (4.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 1f8d40e9-5eff-49ea-a8b8-035592224989\n"], ["created_at", "2018-09-25 15:14:44.300481"], ["updated_at", "2018-09-25 15:14:44.300481"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 1], ["name", "test"], ["created_at", "2018-09-25 15:14:44.302818"], ["updated_at", "2018-09-25 15:14:44.302818"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-25 15:14:44.306696"], ["updated_at", "2018-09-25 15:14:44.306696"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 0]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-25 15:14:44.317686"], ["updated_at", "2018-09-25 15:14:44.317686"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-25 15:14:44.319845"], ["id", 0]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-25 15:15:07.497976', '2018-09-25 15:15:07.497976')[0m
  [1m[35m (3.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: df42a1de-d71e-4f8f-ab29-f8eb5ed75f94\n"], ["created_at", "2018-09-25 15:15:07.515358"], ["updated_at", "2018-09-25 15:15:07.515358"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 0], ["name", "test"], ["created_at", "2018-09-25 15:15:07.517591"], ["updated_at", "2018-09-25 15:15:07.517591"]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-25 15:15:37.130958', '2018-09-25 15:15:37.130958')[0m
  [1m[35m (2.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: fa817015-3987-4613-bf62-7a46503e7882\n"], ["created_at", "2018-09-25 15:15:37.143121"], ["updated_at", "2018-09-25 15:15:37.143121"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 0], ["name", "test"], ["created_at", "2018-09-25 15:15:37.147352"], ["updated_at", "2018-09-25 15:15:37.147352"]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-25 15:15:54.091746', '2018-09-25 15:15:54.091746')[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 8099515d-cc53-472d-b37e-4943109a576f\n"], ["created_at", "2018-09-25 15:15:54.116768"], ["updated_at", "2018-09-25 15:15:54.116768"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 8099515], ["name", "test"], ["created_at", "2018-09-25 15:15:54.118926"], ["updated_at", "2018-09-25 15:15:54.118926"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-25 15:16:03.502210', '2018-09-25 15:16:03.502210')[0m
  [1m[35m (3.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 3877e446-edb0-438a-98b0-511ec26ed05e\n"], ["created_at", "2018-09-25 15:16:03.530932"], ["updated_at", "2018-09-25 15:16:03.530932"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", 3877], ["name", "test"], ["created_at", "2018-09-25 15:16:03.533219"], ["updated_at", "2018-09-25 15:16:03.533219"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "apps" ("id" varchar, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (5.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180924140732)[0m
  [1m[35m (3.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180924034801);

[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-25 15:16:33.695734"], ["updated_at", "2018-09-25 15:16:33.695734"]]
  [1m[35m (5.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-25 15:16:33.744583', '2018-09-25 15:16:33.744583')[0m
  [1m[35m (2.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 7c93f120-f1e8-47fb-9b49-cca45a0461ef\n"], ["created_at", "2018-09-25 15:16:33.756297"], ["updated_at", "2018-09-25 15:16:33.756297"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "7c93f120-f1e8-47fb-9b49-cca45a0461ef"], ["name", "test"], ["created_at", "2018-09-25 15:16:33.761187"], ["updated_at", "2018-09-25 15:16:33.761187"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-25 15:17:10.511168', '2018-09-25 15:17:10.511168')[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 34d29fc3-1ddf-4a17-bdbd-a20bab7629ae\n"], ["created_at", "2018-09-25 15:17:10.523650"], ["updated_at", "2018-09-25 15:17:10.523650"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "34d29fc3-1ddf-4a17-bdbd-a20bab7629ae"], ["name", "test"], ["created_at", "2018-09-25 15:17:10.528734"], ["updated_at", "2018-09-25 15:17:10.528734"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-25 15:17:10.534688"], ["updated_at", "2018-09-25 15:17:10.534688"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-25 15:17:10.545516"], ["updated_at", "2018-09-25 15:17:10.545516"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-25 15:17:10.548038"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-25 15:17:38.665804', '2018-09-25 15:17:38.665804')[0m
  [1m[35m (3.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 7d83d0b4-b5b7-40b8-a561-7fe243a63b48\n"], ["created_at", "2018-09-25 15:17:38.677823"], ["updated_at", "2018-09-25 15:17:38.677823"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "7d83d0b4-b5b7-40b8-a561-7fe243a63b48"], ["name", "test"], ["created_at", "2018-09-25 15:17:38.682671"], ["updated_at", "2018-09-25 15:17:38.682671"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-25 15:17:38.686867"], ["updated_at", "2018-09-25 15:17:38.686867"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-25 15:17:38.693037"], ["updated_at", "2018-09-25 15:17:38.693037"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-25 15:17:38.702609"], ["updated_at", "2018-09-25 15:17:38.702609"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-25 15:17:38.704964"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "apps" ("id" varchar, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (3.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180924140732)[0m
  [1m[35m (3.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180924034801);

[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-26 13:31:19.065957"], ["updated_at", "2018-09-26 13:31:19.065957"]]
  [1m[35m (2.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "apps" ("id" varchar, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "builds" ("id" varchar, "app_id" integer, "stage" varchar, "version" varchar, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (7.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180926131846)[0m
  [1m[35m (2.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180924140732),
(20180924034801);

[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-26 13:31:45.281498"], ["updated_at", "2018-09-26 13:31:45.281498"]]
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:31:45.365352', '2018-09-26 13:31:45.365352')[0m
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:31:45.390904"], ["updated_at", "2018-09-26 13:31:45.390904"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:31:45.394716"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:31:45.400686"], ["updated_at", "2018-09-26 13:31:45.400686"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 1c585ebe-a63f-4fa8-9c84-dfbe642e2af3\n"], ["created_at", "2018-09-26 13:31:45.406077"], ["updated_at", "2018-09-26 13:31:45.406077"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "1c585ebe-a63f-4fa8-9c84-dfbe642e2af3"], ["name", "test"], ["created_at", "2018-09-26 13:31:45.408401"], ["updated_at", "2018-09-26 13:31:45.408401"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:31:45.409918"], ["updated_at", "2018-09-26 13:31:45.409918"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:31:45.411776"], ["updated_at", "2018-09-26 13:31:45.411776"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 8cb9af03-31e5-4224-8b42-05350b0b3097\n"], ["created_at", "2018-09-26 13:31:45.419115"], ["updated_at", "2018-09-26 13:31:45.419115"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:32:24.676149', '2018-09-26 13:32:24.676149')[0m
  [1m[35m (3.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: efddb494-c3b3-46a1-8656-ffa4bdf4c5f1\n"], ["created_at", "2018-09-26 13:32:24.688046"], ["updated_at", "2018-09-26 13:32:24.688046"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "efddb494-c3b3-46a1-8656-ffa4bdf4c5f1"], ["name", "test"], ["created_at", "2018-09-26 13:32:24.693115"], ["updated_at", "2018-09-26 13:32:24.693115"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:32:24.697440"], ["updated_at", "2018-09-26 13:32:24.697440"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:32:24.701467"], ["updated_at", "2018-09-26 13:32:24.701467"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:32:24.704831"], ["updated_at", "2018-09-26 13:32:24.704831"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:32:24.715197"], ["updated_at", "2018-09-26 13:32:24.715197"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:32:24.717644"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 92362a45-6cb2-4241-b6c1-ab5b73786f22\n"], ["created_at", "2018-09-26 13:32:24.725231"], ["updated_at", "2018-09-26 13:32:24.725231"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:32:48.381218', '2018-09-26 13:32:48.381218')[0m
  [1m[35m (3.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 76d86da7-ec6a-4642-bd07-8bbfb8dd09f6\n"], ["created_at", "2018-09-26 13:32:48.393331"], ["updated_at", "2018-09-26 13:32:48.393331"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "76d86da7-ec6a-4642-bd07-8bbfb8dd09f6"], ["name", "test"], ["created_at", "2018-09-26 13:32:48.399068"], ["updated_at", "2018-09-26 13:32:48.399068"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:32:48.407239"], ["updated_at", "2018-09-26 13:32:48.407239"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:32:48.419351"], ["updated_at", "2018-09-26 13:32:48.419351"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:32:48.421766"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:32:48.424756"], ["updated_at", "2018-09-26 13:32:48.424756"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:32:48.427014"], ["updated_at", "2018-09-26 13:32:48.427014"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 102f7b1a-9871-428d-bddb-892412907f21\n"], ["created_at", "2018-09-26 13:32:48.434235"], ["updated_at", "2018-09-26 13:32:48.434235"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" ORDER BY "builds"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:33:09.236698', '2018-09-26 13:33:09.236698')[0m
  [1m[35m (4.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 5f95e4c9-cf50-4929-8d3a-a84e6c6d5d49\n"], ["created_at", "2018-09-26 13:33:09.249774"], ["updated_at", "2018-09-26 13:33:09.249774"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "5f95e4c9-cf50-4929-8d3a-a84e6c6d5d49"], ["name", "test"], ["created_at", "2018-09-26 13:33:09.255671"], ["updated_at", "2018-09-26 13:33:09.255671"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:33:09.266006"], ["updated_at", "2018-09-26 13:33:09.266006"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:33:09.269488"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:33:09.274140"], ["updated_at", "2018-09-26 13:33:09.274140"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:33:09.276821"], ["updated_at", "2018-09-26 13:33:09.276821"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:33:09.279912"], ["updated_at", "2018-09-26 13:33:09.279912"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: f02ecf41-ab18-4219-95bb-70830a43b02d\n"], ["created_at", "2018-09-26 13:33:09.288397"], ["updated_at", "2018-09-26 13:33:09.288397"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.3ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:33:47.544009', '2018-09-26 13:33:47.544009')[0m
  [1m[35m (3.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 3d360736-7e8f-434e-98f3-69e44e312823\n"], ["created_at", "2018-09-26 13:33:47.559017"], ["updated_at", "2018-09-26 13:33:47.559017"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:33:47.573649"], ["updated_at", "2018-09-26 13:33:47.573649"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:33:47.577294"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: b99218fe-3fbb-4d0c-bdbc-2168ed27b47e\n"], ["created_at", "2018-09-26 13:33:47.582720"], ["updated_at", "2018-09-26 13:33:47.582720"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "b99218fe-3fbb-4d0c-bdbc-2168ed27b47e"], ["name", "test"], ["created_at", "2018-09-26 13:33:47.584605"], ["updated_at", "2018-09-26 13:33:47.584605"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:33:47.587853"], ["updated_at", "2018-09-26 13:33:47.587853"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:33:47.589738"], ["updated_at", "2018-09-26 13:33:47.589738"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:33:47.592532"], ["updated_at", "2018-09-26 13:33:47.592532"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:33:56.591208', '2018-09-26 13:33:56.591208')[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 4daaa88e-89e5-4b47-9f7e-b9e87007b055\n"], ["created_at", "2018-09-26 13:33:56.606118"], ["updated_at", "2018-09-26 13:33:56.606118"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 135fee90-8cf3-48cc-9d0c-2859d0455e5d\n"], ["created_at", "2018-09-26 13:33:56.615692"], ["updated_at", "2018-09-26 13:33:56.615692"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "135fee90-8cf3-48cc-9d0c-2859d0455e5d"], ["name", "test"], ["created_at", "2018-09-26 13:33:56.620672"], ["updated_at", "2018-09-26 13:33:56.620672"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:33:56.624004"], ["updated_at", "2018-09-26 13:33:56.624004"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:33:56.628473"], ["updated_at", "2018-09-26 13:33:56.628473"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:33:56.632399"], ["updated_at", "2018-09-26 13:33:56.632399"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:33:56.643596"], ["updated_at", "2018-09-26 13:33:56.643596"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:33:56.647176"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:34:17.784362', '2018-09-26 13:34:17.784362')[0m
  [1m[35m (3.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 1fb81456-6bd7-45d8-8ac0-baf1a073ae6f\n"], ["created_at", "2018-09-26 13:34:17.800203"], ["updated_at", "2018-09-26 13:34:17.800203"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:34:17.818651"], ["updated_at", "2018-09-26 13:34:17.818651"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:34:17.822600"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 934bca96-2e19-47ed-9a28-9fa70348bfeb\n"], ["created_at", "2018-09-26 13:34:17.827148"], ["updated_at", "2018-09-26 13:34:17.827148"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "934bca96-2e19-47ed-9a28-9fa70348bfeb"], ["name", "test"], ["created_at", "2018-09-26 13:34:17.829275"], ["updated_at", "2018-09-26 13:34:17.829275"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:34:17.832657"], ["updated_at", "2018-09-26 13:34:17.832657"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:34:17.835662"], ["updated_at", "2018-09-26 13:34:17.835662"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:34:17.838396"], ["updated_at", "2018-09-26 13:34:17.838396"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:34:24.938583', '2018-09-26 13:34:24.938583')[0m
  [1m[35m (3.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:34:24.956323"], ["updated_at", "2018-09-26 13:34:24.956323"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: fca7a987-c323-4944-a810-a3185f00f182\n"], ["created_at", "2018-09-26 13:34:24.965516"], ["updated_at", "2018-09-26 13:34:24.965516"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "fca7a987-c323-4944-a810-a3185f00f182"], ["name", "test"], ["created_at", "2018-09-26 13:34:24.968065"], ["updated_at", "2018-09-26 13:34:24.968065"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:34:24.970242"], ["updated_at", "2018-09-26 13:34:24.970242"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:34:24.973624"], ["updated_at", "2018-09-26 13:34:24.973624"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:34:24.983287"], ["updated_at", "2018-09-26 13:34:24.983287"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:34:24.986725"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: d6f1b4c7-5489-4e06-8d1d-71049517e2df\n"], ["created_at", "2018-09-26 13:34:24.996287"], ["updated_at", "2018-09-26 13:34:24.996287"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:34:31.468167', '2018-09-26 13:34:31.468167')[0m
  [1m[35m (3.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 13af6b94-cee2-4cc7-ad3a-a71234b66510\n"], ["created_at", "2018-09-26 13:34:31.482736"], ["updated_at", "2018-09-26 13:34:31.482736"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 4e69ba21-bb66-4c65-ae9a-e10801201365\n"], ["created_at", "2018-09-26 13:34:31.493176"], ["updated_at", "2018-09-26 13:34:31.493176"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "4e69ba21-bb66-4c65-ae9a-e10801201365"], ["name", "test"], ["created_at", "2018-09-26 13:34:31.498443"], ["updated_at", "2018-09-26 13:34:31.498443"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:34:31.505363"], ["updated_at", "2018-09-26 13:34:31.505363"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:34:31.517721"], ["updated_at", "2018-09-26 13:34:31.517721"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:34:31.520805"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:34:31.525079"], ["updated_at", "2018-09-26 13:34:31.525079"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:34:31.527965"], ["updated_at", "2018-09-26 13:34:31.527965"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:35:17.437170', '2018-09-26 13:35:17.437170')[0m
  [1m[35m (3.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: ea63369f-4cd0-4daf-80ed-1d7bba902a21\n"], ["created_at", "2018-09-26 13:35:17.446993"], ["updated_at", "2018-09-26 13:35:17.446993"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-26 13:35:17.452324"], ["updated_at", "2018-09-26 13:35:17.452324"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: adb7519d-61e9-4776-9f65-e2582a3c4d59\n"], ["created_at", "2018-09-26 13:35:17.456080"], ["updated_at", "2018-09-26 13:35:17.456080"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "adb7519d-61e9-4776-9f65-e2582a3c4d59"], ["name", "test"], ["created_at", "2018-09-26 13:35:17.461307"], ["updated_at", "2018-09-26 13:35:17.461307"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:35:17.463692"], ["updated_at", "2018-09-26 13:35:17.463692"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:35:17.467867"], ["updated_at", "2018-09-26 13:35:17.467867"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:35:17.470439"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:35:17.473216"], ["updated_at", "2018-09-26 13:35:17.473216"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:35:17.475670"], ["updated_at", "2018-09-26 13:35:17.475670"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:35:38.577924', '2018-09-26 13:35:38.577924')[0m
  [1m[35m (7.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 491bd706-ef25-4a3f-a701-33ec40a19c7a\n"], ["created_at", "2018-09-26 13:35:38.594571"], ["updated_at", "2018-09-26 13:35:38.594571"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-26 13:35:38.600915"], ["updated_at", "2018-09-26 13:35:38.600915"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 966fcfec-8778-4e99-89d8-8f2664dfc297\n"], ["created_at", "2018-09-26 13:35:38.604475"], ["updated_at", "2018-09-26 13:35:38.604475"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "966fcfec-8778-4e99-89d8-8f2664dfc297"], ["name", "test"], ["created_at", "2018-09-26 13:35:38.610626"], ["updated_at", "2018-09-26 13:35:38.610626"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:35:38.614387"], ["updated_at", "2018-09-26 13:35:38.614387"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:35:38.618056"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:35:38.621361"], ["updated_at", "2018-09-26 13:35:38.621361"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:35:38.623708"], ["updated_at", "2018-09-26 13:35:38.623708"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:35:38.627509"], ["updated_at", "2018-09-26 13:35:38.627509"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.3ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:35:59.393184', '2018-09-26 13:35:59.393184')[0m
  [1m[35m (3.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: test\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: a56708db-59f1-4c89-9f70-16ab71d4f24b\n"], ["created_at", "2018-09-26 13:35:59.405017"], ["updated_at", "2018-09-26 13:35:59.405017"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-26 13:35:59.410212"], ["updated_at", "2018-09-26 13:35:59.410212"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:35:59.417113"], ["updated_at", "2018-09-26 13:35:59.417113"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:35:59.419936"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 9a06413e-d1f0-44d1-ba3b-4cae4c4629dd\n"], ["created_at", "2018-09-26 13:35:59.422993"], ["updated_at", "2018-09-26 13:35:59.422993"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "9a06413e-d1f0-44d1-ba3b-4cae4c4629dd"], ["name", "test"], ["created_at", "2018-09-26 13:35:59.425528"], ["updated_at", "2018-09-26 13:35:59.425528"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:35:59.427326"], ["updated_at", "2018-09-26 13:35:59.427326"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:35:59.429311"], ["updated_at", "2018-09-26 13:35:59.429311"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:35:59.431611"], ["updated_at", "2018-09-26 13:35:59.431611"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:36:20.072623', '2018-09-26 13:36:20.072623')[0m
  [1m[35m (3.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 3b17fe66-d176-457a-950e-ff2da4507106\n"], ["created_at", "2018-09-26 13:36:20.084451"], ["updated_at", "2018-09-26 13:36:20.084451"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["id", "3b17fe66-d176-457a-950e-ff2da4507106"], ["app_id", 0], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-26 13:36:20.096655"], ["updated_at", "2018-09-26 13:36:20.096655"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 65c6ea16-c156-4cd1-8601-bfe0f61e354b) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [65c6ea16-c156-4cd1-8601-bfe0f61e354b] Performing BuildAutoReleaseJob (Job ID: 65c6ea16-c156-4cd1-8601-bfe0f61e354b) from Async(default) with arguments: 1
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:36:20.103824"], ["updated_at", "2018-09-26 13:36:20.103824"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [65c6ea16-c156-4cd1-8601-bfe0f61e354b]   [1m[36mEvent Load (0.6ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [65c6ea16-c156-4cd1-8601-bfe0f61e354b]   [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [65c6ea16-c156-4cd1-8601-bfe0f61e354b] Performed BuildAutoReleaseJob (Job ID: 65c6ea16-c156-4cd1-8601-bfe0f61e354b) from Async(default) in 8.71ms
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:36:20.108622"], ["updated_at", "2018-09-26 13:36:20.108622"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:36:20.111532"], ["updated_at", "2018-09-26 13:36:20.111532"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:36:20.116983"], ["updated_at", "2018-09-26 13:36:20.116983"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:36:20.120005"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 48bf7cd3-f0c4-40d1-9e6a-79a5f410a2e7\n"], ["created_at", "2018-09-26 13:36:20.123293"], ["updated_at", "2018-09-26 13:36:20.123293"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "48bf7cd3-f0c4-40d1-9e6a-79a5f410a2e7"], ["name", "test"], ["created_at", "2018-09-26 13:36:20.125448"], ["updated_at", "2018-09-26 13:36:20.125448"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:36:41.018291', '2018-09-26 13:36:41.018291')[0m
  [1m[35m (4.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:36:41.030151"], ["updated_at", "2018-09-26 13:36:41.030151"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:36:41.035516"], ["updated_at", "2018-09-26 13:36:41.035516"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:36:41.041137"], ["updated_at", "2018-09-26 13:36:41.041137"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:36:41.045143"], ["updated_at", "2018-09-26 13:36:41.045143"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:36:41.047632"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 8866e4a7-3521-4e42-9f46-f5a030aca2e4\n"], ["created_at", "2018-09-26 13:36:41.050457"], ["updated_at", "2018-09-26 13:36:41.050457"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "8866e4a7-3521-4e42-9f46-f5a030aca2e4"], ["name", "test"], ["created_at", "2018-09-26 13:36:41.052606"], ["updated_at", "2018-09-26 13:36:41.052606"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 4188e8e5-90cb-4cda-b1fb-857a03c28ec7\n"], ["created_at", "2018-09-26 13:36:41.054418"], ["updated_at", "2018-09-26 13:36:41.054418"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["id", "4188e8e5-90cb-4cda-b1fb-857a03c28ec7"], ["app_id", 0], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-26 13:36:41.063179"], ["updated_at", "2018-09-26 13:36:41.063179"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 9c4613f5-e634-40fb-bbac-31bbc5c37b6f) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [9c4613f5-e634-40fb-bbac-31bbc5c37b6f] Performing BuildAutoReleaseJob (Job ID: 9c4613f5-e634-40fb-bbac-31bbc5c37b6f) from Async(default) with arguments: 1
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [9c4613f5-e634-40fb-bbac-31bbc5c37b6f]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [9c4613f5-e634-40fb-bbac-31bbc5c37b6f] Performed BuildAutoReleaseJob (Job ID: 9c4613f5-e634-40fb-bbac-31bbc5c37b6f) from Async(default) in 4.12ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:37:09.176134', '2018-09-26 13:37:09.176134')[0m
  [1m[35m (3.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 73369663-031d-4a72-bc62-2c8f12b088ba\n"], ["created_at", "2018-09-26 13:37:09.186093"], ["updated_at", "2018-09-26 13:37:09.186093"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["id", "73369663-031d-4a72-bc62-2c8f12b088ba"], ["app_id", 0], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-26 13:37:09.198585"], ["updated_at", "2018-09-26 13:37:09.198585"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: d714f222-f036-4542-a6c0-2cb655577d01) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [d714f222-f036-4542-a6c0-2cb655577d01] Performing BuildAutoReleaseJob (Job ID: d714f222-f036-4542-a6c0-2cb655577d01) from Async(default) with arguments: 1
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
[ActiveJob] [BuildAutoReleaseJob] [d714f222-f036-4542-a6c0-2cb655577d01]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
AppCommandsTest: test_delete_a_(non_existent)_app
[ActiveJob] [BuildAutoReleaseJob] [d714f222-f036-4542-a6c0-2cb655577d01] Performed BuildAutoReleaseJob (Job ID: d714f222-f036-4542-a6c0-2cb655577d01) from Async(default) in 5.05ms
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:37:09.207679"], ["updated_at", "2018-09-26 13:37:09.207679"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:37:09.209944"], ["updated_at", "2018-09-26 13:37:09.209944"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:37:09.212829"], ["updated_at", "2018-09-26 13:37:09.212829"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:37:09.217565"], ["updated_at", "2018-09-26 13:37:09.217565"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:37:09.220076"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: ac1054b5-210e-4296-8124-6864b03633da\n"], ["created_at", "2018-09-26 13:37:09.223076"], ["updated_at", "2018-09-26 13:37:09.223076"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "ac1054b5-210e-4296-8124-6864b03633da"], ["name", "test"], ["created_at", "2018-09-26 13:37:09.225031"], ["updated_at", "2018-09-26 13:37:09.225031"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "apps" ("id" varchar, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "builds" ("id" varchar, "app_id" integer, "stage" varchar, "version" varchar, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (3.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180926131846)[0m
  [1m[35m (7.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180924140732),
(20180924034801);

[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-26 13:55:06.713164"], ["updated_at", "2018-09-26 13:55:06.713164"]]
  [1m[35m (4.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "apps" ("id" varchar, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "builds" ("id" varchar, "app_id" integer, "stage" varchar, "version" varchar, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "releases"[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "releases" ("id" varchar, "build_id" integer, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE  INDEX "index_releases_on_build_id" ON "releases" ("build_id")[0m
  [1m[35m (7.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (2.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180926135035)[0m
  [1m[35m (3.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180926131846),
(20180924140732),
(20180924034801);

[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-26 13:55:13.931650"], ["updated_at", "2018-09-26 13:55:13.931650"]]
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:55:31.893992', '2018-09-26 13:55:31.893992')[0m
  [1m[35m (3.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:55:31.907605"], ["updated_at", "2018-09-26 13:55:31.907605"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 6410cd66-843e-420d-a1b9-25350a7c6c8e\n"], ["created_at", "2018-09-26 13:55:31.913389"], ["updated_at", "2018-09-26 13:55:31.913389"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "6410cd66-843e-420d-a1b9-25350a7c6c8e"], ["name", "test"], ["created_at", "2018-09-26 13:55:31.915995"], ["updated_at", "2018-09-26 13:55:31.915995"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:55:31.917868"], ["updated_at", "2018-09-26 13:55:31.917868"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:55:31.919816"], ["updated_at", "2018-09-26 13:55:31.919816"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:55:31.922354"], ["updated_at", "2018-09-26 13:55:31.922354"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:55:31.924656"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: d7f3560c-8937-4ed9-9ded-d30fc518dfc8\n"], ["created_at", "2018-09-26 13:55:31.928121"], ["updated_at", "2018-09-26 13:55:31.928121"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["id", "d7f3560c-8937-4ed9-9ded-d30fc518dfc8"], ["app_id", 0], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-26 13:55:31.936300"], ["updated_at", "2018-09-26 13:55:31.936300"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 35d37ed1-555f-4ede-a241-8a28f79ff478) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [35d37ed1-555f-4ede-a241-8a28f79ff478] Performing BuildAutoReleaseJob (Job ID: 35d37ed1-555f-4ede-a241-8a28f79ff478) from Async(default) with arguments: 1
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
[ActiveJob] [BuildAutoReleaseJob] [35d37ed1-555f-4ede-a241-8a28f79ff478]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [35d37ed1-555f-4ede-a241-8a28f79ff478] Performed BuildAutoReleaseJob (Job ID: 35d37ed1-555f-4ede-a241-8a28f79ff478) from Async(default) in 5.23ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 13:55:45.332846', '2018-09-26 13:55:45.332846')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "stage", "version", "values", "created_at", "updated_at") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d23a', 'one', 'v1', '--- {}', '2018-09-26 13:55:45.334504', '2018-09-26 13:55:45.334504')[0m
  [1m[35m (3.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 7b912e77-e3c2-4e1a-b93e-318a586fa6ff\n"], ["created_at", "2018-09-26 13:55:45.344028"], ["updated_at", "2018-09-26 13:55:45.344028"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["id", "7b912e77-e3c2-4e1a-b93e-318a586fa6ff"], ["name", "test"], ["created_at", "2018-09-26 13:55:45.349832"], ["updated_at", "2018-09-26 13:55:45.349832"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 13:55:45.352016"], ["updated_at", "2018-09-26 13:55:45.352016"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App with 'id'=asdf\n"], ["created_at", "2018-09-26 13:55:45.355762"], ["updated_at", "2018-09-26 13:55:45.355762"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 13:55:45.358646"], ["updated_at", "2018-09-26 13:55:45.358646"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 13:55:45.362425"], ["updated_at", "2018-09-26 13:55:45.362425"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 13:55:45.364948"], ["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: e8cf1b48-d776-494d-8ad8-24d5a053b6b6\n"], ["created_at", "2018-09-26 13:55:45.368092"], ["updated_at", "2018-09-26 13:55:45.368092"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["id", "e8cf1b48-d776-494d-8ad8-24d5a053b6b6"], ["app_id", 0], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-26 13:55:45.375297"], ["updated_at", "2018-09-26 13:55:45.375297"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 5c26beb5-694f-4f4a-b2b0-5c350e777d67) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [5c26beb5-694f-4f4a-b2b0-5c350e777d67] Performing BuildAutoReleaseJob (Job ID: 5c26beb5-694f-4f4a-b2b0-5c350e777d67) from Async(default) with arguments: 1
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d23a"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["name", "Releases::CreatedEvent"], ["params", "---\n:build_id: ba5155ed-2e21-4733-9ba0-87051cf4d23a\n:id: 75f1e288-bfc2-4823-9613-0623cbe7de29\n"], ["created_at", "2018-09-26 13:55:45.383519"], ["updated_at", "2018-09-26 13:55:45.383519"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [5c26beb5-694f-4f4a-b2b0-5c350e777d67]   [1m[36mEvent Load (0.7ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.3ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d23a"], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [5c26beb5-694f-4f4a-b2b0-5c350e777d67]   [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [5c26beb5-694f-4f4a-b2b0-5c350e777d67] Performed BuildAutoReleaseJob (Job ID: 5c26beb5-694f-4f4a-b2b0-5c350e777d67) from Async(default) in 17.7ms
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("id", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["id", "75f1e288-bfc2-4823-9613-0623cbe7de29"], ["build_id", 0], ["status", "INITIAL"], ["created_at", "2018-09-26 13:55:45.396407"], ["updated_at", "2018-09-26 13:55:45.396407"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: baeb84c1-cd63-4f58-8bfe-a4494f1ab320) to Async(default) with arguments: 1
[ActiveJob] [ReleaseJob] [baeb84c1-cd63-4f58-8bfe-a4494f1ab320] Performing ReleaseJob (Job ID: baeb84c1-cd63-4f58-8bfe-a4494f1ab320) from Async(default) with arguments: 1
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 0], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [baeb84c1-cd63-4f58-8bfe-a4494f1ab320]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [baeb84c1-cd63-4f58-8bfe-a4494f1ab320]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", "ba5155ed-2e21-4733-9ba0-87051cf4d23a"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [baeb84c1-cd63-4f58-8bfe-a4494f1ab320] Performed ReleaseJob (Job ID: baeb84c1-cd63-4f58-8bfe-a4494f1ab320) from Async(default) in 1.46ms
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "apps" ("id" varchar NOT NULL PRIMARY KEY, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='sqlite_autoindex_apps_1' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='sqlite_autoindex_apps_1' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (8.0ms)[0m  [1m[35mCREATE TABLE "apps" ("id" varchar NOT NULL PRIMARY KEY, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='sqlite_autoindex_apps_1' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='sqlite_autoindex_apps_1' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (6.5ms)[0m  [1m[35mCREATE TABLE "apps" ("id" varchar NOT NULL PRIMARY KEY, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='sqlite_autoindex_apps_1' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='sqlite_autoindex_apps_1' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "apps" ("id" varchar NOT NULL PRIMARY KEY, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='sqlite_autoindex_apps_1' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='sqlite_autoindex_apps_1' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (6.1ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "builds" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "app_id" integer, "stage" varchar, "version" varchar, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.6ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "releases"[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "releases" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "build_id" integer, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE  INDEX "index_releases_on_build_id" ON "releases" ("build_id")[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (4.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180926135035)[0m
  [1m[35m (4.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180926131846),
(20180924140732),
(20180924034801);

[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-26 14:34:41.998691"], ["updated_at", "2018-09-26 14:34:41.998691"]]
  [1m[35m (2.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-26 14:34:42.035985', '2018-09-26 14:34:42.035985')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-26 14:34:42.040500', '2018-09-26 14:34:42.040500')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-26 14:34:42.042869', '2018-09-26 14:34:42.042869')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-26 14:34:42.045327', '2018-09-26 14:34:42.045327')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-26 14:34:42.047924', '2018-09-26 14:34:42.047924')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "name", "created_at", "updated_at") VALUES (0, 'one', '2018-09-26 14:34:42.050873', '2018-09-26 14:34:42.050873')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 14:35:42.095526', '2018-09-26 14:35:42.095526', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "stage", "version", "values", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d23a', 'one', 'v1', '--- {}', '2018-09-26 14:35:42.097569', '2018-09-26 14:35:42.097569', 980190962)[0m
  [1m[35m (4.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d4e84b1-861a-4a84-8e19-65e10cb2539f"], ["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 9578eda3-c909-4578-a566-f82db62981d2\n"], ["created_at", "2018-09-26 14:35:42.116599"], ["updated_at", "2018-09-26 14:35:42.116599"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["uid", "9578eda3-c909-4578-a566-f82db62981d2"], ["app_id", 980190962], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-26 14:35:42.125075"], ["updated_at", "2018-09-26 14:35:42.125075"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 7e8d20d5-e98b-4395-ab59-a5f128ee93cf) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [7e8d20d5-e98b-4395-ab59-a5f128ee93cf] Performing BuildAutoReleaseJob (Job ID: 7e8d20d5-e98b-4395-ab59-a5f128ee93cf) from Async(default) with arguments: 1
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5ff6c762-9f84-421e-9517-43ddae28c8c6"], ["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: b83e417d-19f1-4b5f-9134-bc9c8f7da4b6\n"], ["created_at", "2018-09-26 14:35:42.134164"], ["updated_at", "2018-09-26 14:35:42.134164"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [7e8d20d5-e98b-4395-ab59-a5f128ee93cf]   [1m[36mEvent Load (2.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "b83e417d-19f1-4b5f-9134-bc9c8f7da4b6"], ["name", "test"], ["created_at", "2018-09-26 14:35:42.136644"], ["updated_at", "2018-09-26 14:35:42.136644"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [7e8d20d5-e98b-4395-ab59-a5f128ee93cf]   [1m[36mApp Load (1.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [7e8d20d5-e98b-4395-ab59-a5f128ee93cf] Error performing BuildAutoReleaseJob (Job ID: 7e8d20d5-e98b-4395-ab59-a5f128ee93cf) from Async(default) in 10.14ms: NoMethodError (undefined method `find' for nil:NilClass):
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/build_auto_release_job.rb:11:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f168c958-abc1-4dfb-9b0d-c11518568ed7"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 14:35:42.141090"], ["updated_at", "2018-09-26 14:35:42.141090"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "373cab61-8605-4350-bdb4-7d8334c133b3"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-26 14:35:42.143624"], ["updated_at", "2018-09-26 14:35:42.143624"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 14:36:03.015222', '2018-09-26 14:36:03.015222', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "stage", "version", "values", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d23a', 'one', 'v1', '--- {}', '2018-09-26 14:36:03.017039', '2018-09-26 14:36:03.017039', 980190962)[0m
  [1m[35m (3.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af993789-6eb2-4391-932a-5c87a4f2251b"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 14:36:03.035132"], ["updated_at", "2018-09-26 14:36:03.035132"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "21aa95e2-472b-4a4e-a409-12ffc04a93ff"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-26 14:36:03.038925"], ["updated_at", "2018-09-26 14:36:03.038925"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5de89cfa-8ba0-4dbb-af8e-e96b891e74fd"], ["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 77762734-d0ea-4bbd-8384-9c7fab07f623\n"], ["created_at", "2018-09-26 14:36:03.042271"], ["updated_at", "2018-09-26 14:36:03.042271"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "77762734-d0ea-4bbd-8384-9c7fab07f623"], ["name", "test"], ["created_at", "2018-09-26 14:36:03.048600"], ["updated_at", "2018-09-26 14:36:03.048600"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "52b6f8fe-e6d0-43fa-82ce-362a9d205a17"], ["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 0dc6f209-b1b5-435d-ac19-42cba14db21d\n"], ["created_at", "2018-09-26 14:36:03.055887"], ["updated_at", "2018-09-26 14:36:03.055887"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["uid", "0dc6f209-b1b5-435d-ac19-42cba14db21d"], ["app_id", 980190962], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-26 14:36:03.060986"], ["updated_at", "2018-09-26 14:36:03.060986"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 8861b3a7-25fa-4228-a404-d8fba5194f61) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [8861b3a7-25fa-4228-a404-d8fba5194f61] Performing BuildAutoReleaseJob (Job ID: 8861b3a7-25fa-4228-a404-d8fba5194f61) from Async(default) with arguments: 1
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [8861b3a7-25fa-4228-a404-d8fba5194f61] Performed BuildAutoReleaseJob (Job ID: 8861b3a7-25fa-4228-a404-d8fba5194f61) from Async(default) in 5.26ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 14:36:27.762377', '2018-09-26 14:36:27.762377', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "stage", "version", "values", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d23a', 'one', 'v1', '--- {}', '2018-09-26 14:36:27.764823', '2018-09-26 14:36:27.764823', 980190962)[0m
  [1m[35m (4.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "680e2e1f-70cf-4512-b8d3-9ee0878328af"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_id: ba5155ed-2e21-4733-9ba0-87051cf4d23a\n:id: 5c8a05c9-0ca7-4ebb-b241-de60d2ab34eb\n"], ["created_at", "2018-09-26 14:36:27.781565"], ["updated_at", "2018-09-26 14:36:27.781565"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d23a"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5c8a05c9-0ca7-4ebb-b241-de60d2ab34eb"], ["build_id", 980190962], ["status", "INITIAL"], ["created_at", "2018-09-26 14:36:27.791953"], ["updated_at", "2018-09-26 14:36:27.791953"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: f578b525-81db-4ef4-9318-7eb2d7f79197) to Async(default) with arguments: 1
[ActiveJob] [ReleaseJob] [f578b525-81db-4ef4-9318-7eb2d7f79197] Performing ReleaseJob (Job ID: f578b525-81db-4ef4-9318-7eb2d7f79197) from Async(default) with arguments: 1
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "99259ced-963f-4b1e-a388-a491d9ddc570"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 14:36:27.797894"], ["updated_at", "2018-09-26 14:36:27.797894"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [f578b525-81db-4ef4-9318-7eb2d7f79197]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3be3391d-e3a8-48c5-8572-721658690b8a"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-26 14:36:27.803869"], ["updated_at", "2018-09-26 14:36:27.803869"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [f578b525-81db-4ef4-9318-7eb2d7f79197]   [1m[36mBuild Load (1.5ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", nil], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [f578b525-81db-4ef4-9318-7eb2d7f79197] Performed ReleaseJob (Job ID: f578b525-81db-4ef4-9318-7eb2d7f79197) from Async(default) in 10.89ms
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "02644946-9854-426f-a4b2-900ff992c134"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 14:36:27.810290"], ["updated_at", "2018-09-26 14:36:27.810290"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 980190962]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "15c445c0-26ec-4a6c-8249-6af4b7617732"], ["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 14:36:27.819140"], ["updated_at", "2018-09-26 14:36:27.819140"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 14:36:27.821443"], ["id", 980190962]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c0635815-afa5-4d62-9d33-305791ea77c8"], ["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 398e51f9-79c5-4734-9632-185b390a698a\n"], ["created_at", "2018-09-26 14:36:27.824188"], ["updated_at", "2018-09-26 14:36:27.824188"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "398e51f9-79c5-4734-9632-185b390a698a"], ["name", "test"], ["created_at", "2018-09-26 14:36:27.826351"], ["updated_at", "2018-09-26 14:36:27.826351"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "feabd2ef-5782-425f-8aa4-fd1694254448"], ["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 434bed2b-2a3e-4cbe-9978-1f47f4597af8\n"], ["created_at", "2018-09-26 14:36:27.828273"], ["updated_at", "2018-09-26 14:36:27.828273"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["uid", "434bed2b-2a3e-4cbe-9978-1f47f4597af8"], ["app_id", 980190962], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-26 14:36:27.831836"], ["updated_at", "2018-09-26 14:36:27.831836"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: b92b3734-ff0d-4ee2-bf35-79a36463fcfb) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [b92b3734-ff0d-4ee2-bf35-79a36463fcfb] Performing BuildAutoReleaseJob (Job ID: b92b3734-ff0d-4ee2-bf35-79a36463fcfb) from Async(default) with arguments: 1
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [b92b3734-ff0d-4ee2-bf35-79a36463fcfb]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 0], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [b92b3734-ff0d-4ee2-bf35-79a36463fcfb]   [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [b92b3734-ff0d-4ee2-bf35-79a36463fcfb] Error performing BuildAutoReleaseJob (Job ID: b92b3734-ff0d-4ee2-bf35-79a36463fcfb) from Async(default) in 2.89ms: NoMethodError (undefined method `find' for nil:NilClass):
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/build_auto_release_job.rb:11:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-26 14:36:41.927391', '2018-09-26 14:36:41.927391', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "stage", "version", "values", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d23a', 'one', 'v1', '--- {}', '2018-09-26 14:36:41.929630', '2018-09-26 14:36:41.929630', 980190962)[0m
  [1m[35m (5.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "503d71b3-4c78-41dd-8f1a-0ec899a0324b"], ["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: 76ba879d-3a6d-455a-ad64-e35efb2a5e30\n"], ["created_at", "2018-09-26 14:36:41.941948"], ["updated_at", "2018-09-26 14:36:41.941948"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["uid", "76ba879d-3a6d-455a-ad64-e35efb2a5e30"], ["app_id", 980190962], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-26 14:36:41.954492"], ["updated_at", "2018-09-26 14:36:41.954492"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 1b2c042d-19a4-41dc-92b9-23aa097e78cd) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [1b2c042d-19a4-41dc-92b9-23aa097e78cd] Performing BuildAutoReleaseJob (Job ID: 1b2c042d-19a4-41dc-92b9-23aa097e78cd) from Async(default) with arguments: 1
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
[ActiveJob] [BuildAutoReleaseJob] [1b2c042d-19a4-41dc-92b9-23aa097e78cd]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [1b2c042d-19a4-41dc-92b9-23aa097e78cd] Performed BuildAutoReleaseJob (Job ID: 1b2c042d-19a4-41dc-92b9-23aa097e78cd) from Async(default) in 7.77ms
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a7a6445f-a921-464a-afdf-d05db91d77b5"], ["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 9e1e112e-8670-4804-bbd9-d49e807fd898\n"], ["created_at", "2018-09-26 14:36:41.965823"], ["updated_at", "2018-09-26 14:36:41.965823"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "9e1e112e-8670-4804-bbd9-d49e807fd898"], ["name", "test"], ["created_at", "2018-09-26 14:36:41.968310"], ["updated_at", "2018-09-26 14:36:41.968310"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1e27fd8a-6399-4415-9b3e-1b26c7a6186d"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-26 14:36:41.970218"], ["updated_at", "2018-09-26 14:36:41.970218"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ed15d74c-aa83-4e43-8886-79202f113eac"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-26 14:36:41.972485"], ["updated_at", "2018-09-26 14:36:41.972485"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "09f3eb88-17ed-46a0-919c-ed8530efb1ac"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-26 14:36:41.974889"], ["updated_at", "2018-09-26 14:36:41.974889"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 980190962]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f4325c97-9aa2-4c3f-ac94-388ec73e0aac"], ["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :environment: test\n"], ["created_at", "2018-09-26 14:36:41.978773"], ["updated_at", "2018-09-26 14:36:41.978773"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  environment: test\n"], ["updated_at", "2018-09-26 14:36:41.981907"], ["id", 980190962]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "99847cdb-c849-4be3-9cf1-50ebe0ae7cae"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_id: ba5155ed-2e21-4733-9ba0-87051cf4d23a\n:id: 97942240-e94b-448b-a559-4a5387e317cb\n"], ["created_at", "2018-09-26 14:36:41.990001"], ["updated_at", "2018-09-26 14:36:41.990001"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d23a"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "97942240-e94b-448b-a559-4a5387e317cb"], ["build_id", 980190962], ["status", "INITIAL"], ["created_at", "2018-09-26 14:36:41.998047"], ["updated_at", "2018-09-26 14:36:41.998047"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: d119de21-a52c-4bfe-8572-61857025ab8c) to Async(default) with arguments: 1
[ActiveJob] [ReleaseJob] [d119de21-a52c-4bfe-8572-61857025ab8c] Performing ReleaseJob (Job ID: d119de21-a52c-4bfe-8572-61857025ab8c) from Async(default) with arguments: 1
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [d119de21-a52c-4bfe-8572-61857025ab8c]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [d119de21-a52c-4bfe-8572-61857025ab8c]   [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [d119de21-a52c-4bfe-8572-61857025ab8c] Performed ReleaseJob (Job ID: d119de21-a52c-4bfe-8572-61857025ab8c) from Async(default) in 2.15ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "builds" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "app_id" integer, "stage" varchar, "version" varchar, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "releases"[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE TABLE "releases" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "build_id" integer, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (7.5ms)[0m  [1m[35mCREATE  INDEX "index_releases_on_build_id" ON "releases" ("build_id")[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (5.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180926135035)[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180926131846),
(20180924140732),
(20180924034801);

[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-27 04:57:22.053211"], ["updated_at", "2018-09-27 04:57:22.053211"]]
  [1m[35m (5.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar NOT NULL, "stages" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "builds" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "app_id" integer, "stage" varchar, "version" varchar, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "deploys"[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "deploys" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "release_id" integer, "uid" varchar NOT NULL, "stage" varchar, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_release_id" ON "deploys" ("release_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "releases"[0m
  [1m[35m (10.1ms)[0m  [1m[35mCREATE TABLE "releases" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "build_id" integer, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (6.2ms)[0m  [1m[35mCREATE  INDEX "index_releases_on_build_id" ON "releases" ("build_id")[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (5.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180927031312)[0m
  [1m[35m (5.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180926131846),
(20180926135035),
(20180924140732),
(20180924034801);

[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-27 04:57:30.465908"], ["updated_at", "2018-09-27 04:57:30.465908"]]
  [1m[35m (7.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-27 04:57:30.523807', '2018-09-27 04:57:30.523807', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "stage", "version", "values", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d23a', 'one', 'v1', '--- {}', '2018-09-27 04:57:30.526272', '2018-09-27 04:57:30.526272', 980190962)[0m
  [1m[35m (4.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "526fc03b-da56-4a09-9a23-0ee2db4c82ab"], ["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: ae177acd-7f6d-4692-86c6-d0baaeb2570a\n"], ["created_at", "2018-09-27 04:57:30.537643"], ["updated_at", "2018-09-27 04:57:30.537643"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["uid", "ae177acd-7f6d-4692-86c6-d0baaeb2570a"], ["app_id", 980190962], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-27 04:57:30.549453"], ["updated_at", "2018-09-27 04:57:30.549453"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 06534de7-ce7f-4ae2-9af5-4bdd05399aac) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [06534de7-ce7f-4ae2-9af5-4bdd05399aac] Performing BuildAutoReleaseJob (Job ID: 06534de7-ce7f-4ae2-9af5-4bdd05399aac) from Async(default) with arguments: 1
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bcf2c6ee-2ed7-49f8-a2dc-33e251a892c9"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-27 04:57:30.558609"], ["updated_at", "2018-09-27 04:57:30.558609"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [06534de7-ce7f-4ae2-9af5-4bdd05399aac]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "742015dd-3dd8-4b85-84e9-b5b5829c76b2"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-27 04:57:30.564374"], ["updated_at", "2018-09-27 04:57:30.564374"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [06534de7-ce7f-4ae2-9af5-4bdd05399aac]   [1m[36mApp Load (1.5ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [06534de7-ce7f-4ae2-9af5-4bdd05399aac] Performed BuildAutoReleaseJob (Job ID: 06534de7-ce7f-4ae2-9af5-4bdd05399aac) from Async(default) in 13.03ms
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c25b8760-6710-491d-8d5b-236346585d70"], ["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 39edec45-dc8e-4a3e-89e0-cd82a617b48c\n"], ["created_at", "2018-09-27 04:57:30.567027"], ["updated_at", "2018-09-27 04:57:30.567027"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "39edec45-dc8e-4a3e-89e0-cd82a617b48c"], ["name", "test"], ["created_at", "2018-09-27 04:57:30.569452"], ["updated_at", "2018-09-27 04:57:30.569452"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b36db2e6-db47-41f6-a9f6-2efdb20258f1"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-27 04:57:30.577208"], ["updated_at", "2018-09-27 04:57:30.577208"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 980190962]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "597c3bb8-4024-4010-8f78-a02aadc0a4c2"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_id: ba5155ed-2e21-4733-9ba0-87051cf4d23a\n:id: c8865da0-d6f7-4996-a915-91e7fdfafd8a\n"], ["created_at", "2018-09-27 04:57:30.582039"], ["updated_at", "2018-09-27 04:57:30.582039"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d23a"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c8865da0-d6f7-4996-a915-91e7fdfafd8a"], ["build_id", 980190962], ["status", "INITIAL"], ["created_at", "2018-09-27 04:57:30.589630"], ["updated_at", "2018-09-27 04:57:30.589630"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: f650670f-65e7-4e3a-94f1-94ed377a8296) to Async(default) with arguments: 1
[ActiveJob] [ReleaseJob] [f650670f-65e7-4e3a-94f1-94ed377a8296] Performing ReleaseJob (Job ID: f650670f-65e7-4e3a-94f1-94ed377a8296) from Async(default) with arguments: 1
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [f650670f-65e7-4e3a-94f1-94ed377a8296]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [f650670f-65e7-4e3a-94f1-94ed377a8296]   [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [f650670f-65e7-4e3a-94f1-94ed377a8296] Performed ReleaseJob (Job ID: f650670f-65e7-4e3a-94f1-94ed377a8296) from Async(default) in 2.75ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-27 04:57:55.887664', '2018-09-27 04:57:55.887664', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "stage", "version", "values", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d23a', 'one', 'v1', '--- {}', '2018-09-27 04:57:55.889521', '2018-09-27 04:57:55.889521', 980190962)[0m
  [1m[35m (3.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d2a03d4a-78a9-460c-ad03-91658f276ec5"], ["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: ce5c2595-f76f-4ff1-a61d-59d712eae1d4\n"], ["created_at", "2018-09-27 04:57:55.901419"], ["updated_at", "2018-09-27 04:57:55.901419"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["uid", "ce5c2595-f76f-4ff1-a61d-59d712eae1d4"], ["app_id", 980190962], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-27 04:57:55.914114"], ["updated_at", "2018-09-27 04:57:55.914114"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 6ae16269-9932-4457-8c25-a5c5f725bc92) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [6ae16269-9932-4457-8c25-a5c5f725bc92] Performing BuildAutoReleaseJob (Job ID: 6ae16269-9932-4457-8c25-a5c5f725bc92) from Async(default) with arguments: 1
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d4328045-43af-4bbc-9685-c8c73248de6e"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_id: ba5155ed-2e21-4733-9ba0-87051cf4d23a\n:id: a92bcffa-6e23-42a2-b223-c6fecb4b7c1a\n"], ["created_at", "2018-09-27 04:57:55.922304"], ["updated_at", "2018-09-27 04:57:55.922304"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d23a"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a92bcffa-6e23-42a2-b223-c6fecb4b7c1a"], ["build_id", 980190962], ["status", "INITIAL"], ["created_at", "2018-09-27 04:57:55.934685"], ["updated_at", "2018-09-27 04:57:55.934685"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 39576cde-5d0c-4432-aa0b-93504d252431) to Async(default) with arguments: 1
[ActiveJob] [ReleaseJob] [39576cde-5d0c-4432-aa0b-93504d252431] Performing ReleaseJob (Job ID: 39576cde-5d0c-4432-aa0b-93504d252431) from Async(default) with arguments: 1
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 980190962], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [6ae16269-9932-4457-8c25-a5c5f725bc92]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [39576cde-5d0c-4432-aa0b-93504d252431]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [6ae16269-9932-4457-8c25-a5c5f725bc92]   [1m[36mApp Load (1.4ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [39576cde-5d0c-4432-aa0b-93504d252431]   [1m[36mBuild Load (0.4ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 0], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [6ae16269-9932-4457-8c25-a5c5f725bc92] Performed BuildAutoReleaseJob (Job ID: 6ae16269-9932-4457-8c25-a5c5f725bc92) from Async(default) in 24.3ms
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [39576cde-5d0c-4432-aa0b-93504d252431] Performed ReleaseJob (Job ID: 39576cde-5d0c-4432-aa0b-93504d252431) from Async(default) in 3.79ms
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "08dbd243-8058-4e75-9cd2-811ccb3b1469"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-27 04:57:55.943944"], ["updated_at", "2018-09-27 04:57:55.943944"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "75d51a6e-a453-4924-b29f-7176d2c41196"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-27 04:57:55.946582"], ["updated_at", "2018-09-27 04:57:55.946582"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "67f172e1-8546-4ed7-836e-cabf39bce8a1"], ["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: 3d43ba1b-d61a-4086-93d5-31d5febc2f84\n"], ["created_at", "2018-09-27 04:57:55.948702"], ["updated_at", "2018-09-27 04:57:55.948702"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "3d43ba1b-d61a-4086-93d5-31d5febc2f84"], ["name", "test"], ["created_at", "2018-09-27 04:57:55.950905"], ["updated_at", "2018-09-27 04:57:55.950905"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "621e1a48-1045-4928-b7f8-afb6702f2159"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-27 04:57:55.953138"], ["updated_at", "2018-09-27 04:57:55.953138"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 980190962]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-27 04:58:21.147442', '2018-09-27 04:58:21.147442', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "stage", "version", "values", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d23a', 'one', 'v1', '--- {}', '2018-09-27 04:58:21.149996', '2018-09-27 04:58:21.149996', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "85ec1ea9-8193-4de8-94f5-2e35bfc102ec"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_id: ba5155ed-2e21-4733-9ba0-87051cf4d23a\n:id: f48b4771-c097-4850-8e00-29cf4b9f6af6\n"], ["created_at", "2018-09-27 04:58:21.166278"], ["updated_at", "2018-09-27 04:58:21.166278"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d23a"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f48b4771-c097-4850-8e00-29cf4b9f6af6"], ["build_id", 980190962], ["status", "INITIAL"], ["created_at", "2018-09-27 04:58:21.176368"], ["updated_at", "2018-09-27 04:58:21.176368"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 69e663bb-6642-4269-9416-2cca3314dac6) to Async(default) with arguments: 1
[ActiveJob] [ReleaseJob] [69e663bb-6642-4269-9416-2cca3314dac6] Performing ReleaseJob (Job ID: 69e663bb-6642-4269-9416-2cca3314dac6) from Async(default) with arguments: 1
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4e7888e8-62a0-4075-8722-37464ce6ea17"], ["name", "Apps::CreatedEvent"], ["params", "---\n:name: test\n:id: dab93d7d-de81-4c09-8bb3-fc8d89e65d65\n"], ["created_at", "2018-09-27 04:58:21.182819"], ["updated_at", "2018-09-27 04:58:21.182819"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "dab93d7d-de81-4c09-8bb3-fc8d89e65d65"], ["name", "test"], ["created_at", "2018-09-27 04:58:21.190132"], ["updated_at", "2018-09-27 04:58:21.190132"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [69e663bb-6642-4269-9416-2cca3314dac6]   [1m[36mEvent Load (0.5ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [69e663bb-6642-4269-9416-2cca3314dac6]   [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", nil], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [69e663bb-6642-4269-9416-2cca3314dac6] Performed ReleaseJob (Job ID: 69e663bb-6642-4269-9416-2cca3314dac6) from Async(default) in 18.68ms
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dd0a4b8b-25ef-40ce-ba72-8ab9615c7906"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: asdf\n"], ["created_at", "2018-09-27 04:58:21.198846"], ["updated_at", "2018-09-27 04:58:21.198846"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f74f1adc-08a3-4dcd-bb2c-0ba200ac8cd8"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-27 04:58:21.202152"], ["updated_at", "2018-09-27 04:58:21.202152"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ca157cc1-6f01-4ff6-bbfe-efbb2e4731f4"], ["name", "Apps::DeletedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-27 04:58:21.205868"], ["updated_at", "2018-09-27 04:58:21.205868"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 980190962]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4583692e-75e1-4c3a-93ef-674354754118"], ["name", "Apps::UpdatedEvent"], ["params", "---\n:id: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stages:\n- :name: test\n  :clusters: []\n"], ["created_at", "2018-09-27 04:58:21.210470"], ["updated_at", "2018-09-27 04:58:21.210470"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "stages" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["stages", "---\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: test\n  clusters: []\n"], ["updated_at", "2018-09-27 04:58:21.213657"], ["id", 980190962]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "88b7a213-4acb-423f-a570-fd49a6b9e99c"], ["name", "Builds::CreatedEvent"], ["params", "---\n:name: one\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n:stage: review\n:id: f2000e18-6414-4060-bcd9-632f4f1367ca\n"], ["created_at", "2018-09-27 04:58:21.217445"], ["updated_at", "2018-09-27 04:58:21.217445"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("uid", "app_id", "stage", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["uid", "f2000e18-6414-4060-bcd9-632f4f1367ca"], ["app_id", 980190962], ["stage", "review"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-27 04:58:21.221694"], ["updated_at", "2018-09-27 04:58:21.221694"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 4dff23ae-d3fe-4b8f-88d4-24564a62a202) to Async(default) with arguments: 1
[ActiveJob] [BuildAutoReleaseJob] [4dff23ae-d3fe-4b8f-88d4-24564a62a202] Performing BuildAutoReleaseJob (Job ID: 4dff23ae-d3fe-4b8f-88d4-24564a62a202) from Async(default) with arguments: 1
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [4dff23ae-d3fe-4b8f-88d4-24564a62a202]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 980190962], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [4dff23ae-d3fe-4b8f-88d4-24564a62a202]   [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "one"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [4dff23ae-d3fe-4b8f-88d4-24564a62a202] Error performing BuildAutoReleaseJob (Job ID: 4dff23ae-d3fe-4b8f-88d4-24564a62a202) from Async(default) in 2.51ms: NoMethodError (undefined method `find' for nil:NilClass):
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/build_auto_release_job.rb:11:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (7.2ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "builds" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "version" varchar NOT NULL, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_builds_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_builds_on_app_id' AND type='index'
[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_stage_id" ON "builds" ("stage_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "clusters"[0m
  [1m[35m (7.1ms)[0m  [1m[35mCREATE TABLE "clusters" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_app_id" ON "clusters" ("app_id")[0m
  [1m[35m (0.4ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_clusters_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_clusters_on_app_id' AND type='index'
[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_stage_id" ON "clusters" ("stage_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "deploys"[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE TABLE "deploys" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "release_id" integer, "cluster_id" integer, "uid" varchar NOT NULL, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_cluster_id" ON "deploys" ("cluster_id")[0m
  [1m[35m (0.3ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_release_id" ON "deploys" ("release_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "releases"[0m
  [1m[35m (7.5ms)[0m  [1m[35mCREATE TABLE "releases" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "build_id" integer, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE  INDEX "index_releases_on_build_id" ON "releases" ("build_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "stages"[0m
  [1m[35m (6.3ms)[0m  [1m[35mCREATE TABLE "stages" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "review" boolean DEFAULT 'f' NOT NULL, "auto" boolean DEFAULT 'f' NOT NULL, "promotion" boolean DEFAULT 'f' NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE  INDEX "index_stages_on_app_id" ON "stages" ("app_id")[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (4.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180927031312)[0m
  [1m[35m (4.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180926131846),
(20180924034803),
(20180926135035),
(20180924034802),
(20180924140732),
(20180924034801);

[0m
  [1m[35m (10.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-28 04:17:14.076105"], ["updated_at", "2018-09-28 04:17:14.076105"]]
  [1m[35m (4.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:17:14.127968', '2018-09-28 04:17:14.127968', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:17:14.132645', '2018-09-28 04:17:14.132645', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:17:14.136054', '2018-09-28 04:17:14.136054', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:17:14.139287', '2018-09-28 04:17:14.139287', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:17:14.142363', '2018-09-28 04:17:14.142363', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "builds" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "version" varchar NOT NULL, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_builds_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_builds_on_app_id' AND type='index'
[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_stage_id" ON "builds" ("stage_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "clusters"[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "clusters" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_app_id" ON "clusters" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_clusters_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_clusters_on_app_id' AND type='index'
[0m
  [1m[35m (6.4ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_stage_id" ON "clusters" ("stage_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "deploys"[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "deploys" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "release_id" integer, "cluster_id" integer, "uid" varchar NOT NULL, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_cluster_id" ON "deploys" ("cluster_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_release_id" ON "deploys" ("release_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (6.2ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "releases"[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE TABLE "releases" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "build_id" integer, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.4ms)[0m  [1m[35mCREATE  INDEX "index_releases_on_build_id" ON "releases" ("build_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "stages"[0m
  [1m[35m (11.2ms)[0m  [1m[35mCREATE TABLE "stages" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "review" boolean DEFAULT 'f' NOT NULL, "auto" boolean DEFAULT 'f' NOT NULL, "promotion" boolean DEFAULT 'f' NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE  INDEX "index_stages_on_app_id" ON "stages" ("app_id")[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (5.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180927031312)[0m
  [1m[35m (5.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180926131846),
(20180924034803),
(20180926135035),
(20180924034802),
(20180924140732),
(20180924034801);

[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-28 04:18:09.512196"], ["updated_at", "2018-09-28 04:18:09.512196"]]
  [1m[35m (4.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:18:09.565674', '2018-09-28 04:18:09.565674', 980190962)[0m
  [1m[35m (6.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:19:06.062510', '2018-09-28 04:19:06.062510', 980190962)[0m
  [1m[35m (7.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:19:54.421353', '2018-09-28 04:19:54.421353', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "27bee309-626f-44d1-aa24-3e2703e1d40e"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:19:54.437070"], ["updated_at", "2018-09-28 04:19:54.437070"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b2b7aed9-e2f5-4394-907b-e58d43bac189"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:19:54.449157"], ["updated_at", "2018-09-28 04:19:54.449157"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f1534dc0-b1bc-4e45-bf0f-da0e11f8029e"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: de569438-53e6-4c7c-91a9-2228f24db4e1\n"], ["created_at", "2018-09-28 04:19:54.453586"], ["updated_at", "2018-09-28 04:19:54.453586"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e6377904-7dd9-4ee3-a379-0dbc7dbcaeb3"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:19:54.456310"], ["updated_at", "2018-09-28 04:19:54.456310"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (4.6ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "builds" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "version" varchar NOT NULL, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_builds_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_builds_on_app_id' AND type='index'
[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_stage_id" ON "builds" ("stage_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "clusters"[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE TABLE "clusters" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_app_id" ON "clusters" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_clusters_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_clusters_on_app_id' AND type='index'
[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_stage_id" ON "clusters" ("stage_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "deploys"[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "deploys" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "release_id" integer, "cluster_id" integer, "uid" varchar NOT NULL, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_cluster_id" ON "deploys" ("cluster_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
[0m
  [1m[35m (4.6ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_release_id" ON "deploys" ("release_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (7.9ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "releases"[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "releases" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "build_id" integer, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE  INDEX "index_releases_on_build_id" ON "releases" ("build_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "stages"[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE TABLE "stages" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "review" boolean DEFAULT 'f' NOT NULL, "auto" boolean DEFAULT 'f' NOT NULL, "promotion" boolean DEFAULT 'f' NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE  INDEX "index_stages_on_app_id" ON "stages" ("app_id")[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (4.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180927031312)[0m
  [1m[35m (4.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180926131846),
(20180924034803),
(20180926135035),
(20180924034802),
(20180924140732),
(20180924034801);

[0m
  [1m[35m (8.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-28 04:21:04.421664"], ["updated_at", "2018-09-28 04:21:04.421664"]]
  [1m[35m (5.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:21:04.479765', '2018-09-28 04:21:04.479765', 980190962)[0m
  [1m[35m (2.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8e572602-38a4-49f3-a9a4-31d9eda7c2cf"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:21:04.491202"], ["updated_at", "2018-09-28 04:21:04.491202"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "54b29c28-8731-4e62-b467-01e88eaf3969"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 6ece5e38-95b5-463e-aa9c-f695e0ec1d15\n"], ["created_at", "2018-09-28 04:21:04.497045"], ["updated_at", "2018-09-28 04:21:04.497045"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "065576f4-be79-47d0-9a38-7410e48a7174"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:21:04.511939"], ["updated_at", "2018-09-28 04:21:04.511939"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5f151cc2-a584-4c14-b61e-fc65a98d3924"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:21:04.517506"], ["updated_at", "2018-09-28 04:21:04.517506"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:21:24.065885', '2018-09-28 04:21:24.065885', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9771edff-9258-4e1d-bba5-f4b0642d1eb3"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:21:24.077146"], ["updated_at", "2018-09-28 04:21:24.077146"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "059d86b6-d826-4106-ac3d-96609357b718"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:21:24.081994"], ["updated_at", "2018-09-28 04:21:24.081994"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4c5383e9-554c-4939-976d-aee7136c7494"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:21:24.094762"], ["updated_at", "2018-09-28 04:21:24.094762"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 980190962]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e98dd9f6-01dd-4bb4-a8c8-110f697d3236"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:21:24.098874"], ["updated_at", "2018-09-28 04:21:24.098874"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ecdc7e94-c8ce-445c-b68e-120edcb9cd74"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: acde010d-7527-4e13-8430-93fe71fdee40\n"], ["created_at", "2018-09-28 04:21:24.101179"], ["updated_at", "2018-09-28 04:21:24.101179"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:22:05.262362', '2018-09-28 04:22:05.262362', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a702edc1-8835-4154-86b1-6916373dff1f"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 91a05859-00c5-41ea-a264-ade6cc03095b\n"], ["created_at", "2018-09-28 04:22:05.274158"], ["updated_at", "2018-09-28 04:22:05.274158"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3c568b32-7b0e-41cc-bea0-aab23569a1d7"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:22:05.286660"], ["updated_at", "2018-09-28 04:22:05.286660"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 980190962]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "03246f9e-73d1-4c84-ab6f-851d992256d6"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:22:05.292847"], ["updated_at", "2018-09-28 04:22:05.292847"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "45e95b7a-21ea-4035-858a-e89feab67bde"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:22:05.297163"], ["updated_at", "2018-09-28 04:22:05.297163"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2e905e32-d413-47af-b243-a12c1218aad1"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:22:05.299366"], ["updated_at", "2018-09-28 04:22:05.299366"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.3ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:27:15.398577', '2018-09-28 04:27:15.398577', 980190962)[0m
  [1m[35m (7.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "df4e5b36-c51d-4eac-9861-b0104c6aa9ee"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:27:15.419062"], ["updated_at", "2018-09-28 04:27:15.419062"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bd14d399-a315-4b60-a7a7-d75fbcfa2b91"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:27:15.424711"], ["updated_at", "2018-09-28 04:27:15.424711"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3effc399-ee54-4f8a-b2be-8eacff911632"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:27:15.436029"], ["updated_at", "2018-09-28 04:27:15.436029"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 980190962]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8dc2585b-eb52-4f5d-be1f-136a53796a18"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 5ee22a38-f82c-4433-a3cb-bf58095c7e80\n"], ["created_at", "2018-09-28 04:27:15.439956"], ["updated_at", "2018-09-28 04:27:15.439956"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aa98f065-bca8-40a2-bdb6-6de39b5479ca"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:27:15.443631"], ["updated_at", "2018-09-28 04:27:15.443631"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bb560e40-6bcb-4c71-bfc7-422ab2522038"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 50e3efd0-c231-417e-877e-6b878a20e1a5\n"], ["created_at", "2018-09-28 04:27:15.446258"], ["updated_at", "2018-09-28 04:27:15.446258"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:30:17.805142', '2018-09-28 04:30:17.805142')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:30:17.807277', '2018-09-28 04:30:17.807277', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f9d92793-97d8-4f90-a953-1218d25cd819"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:30:17.817662"], ["updated_at", "2018-09-28 04:30:17.817662"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "45f8ee1a-3c6d-47e0-b14a-67f874c7bf0a"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:30:17.822783"], ["updated_at", "2018-09-28 04:30:17.822783"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "01de9a2d-2348-40d0-9f41-64302b077a59"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: ec77897f-181d-47fa-be60-22b2dfb56115\n"], ["created_at", "2018-09-28 04:30:17.825242"], ["updated_at", "2018-09-28 04:30:17.825242"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "38d8f9f5-43d5-4c45-b6de-df5af6a25974"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:30:17.835226"], ["updated_at", "2018-09-28 04:30:17.835226"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4f420211-da05-4c2b-baad-7435b5918cf8"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 5586660d-2f67-48f9-9697-fdddad2b1322\n"], ["created_at", "2018-09-28 04:30:17.840016"], ["updated_at", "2018-09-28 04:30:17.840016"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "36a0ea8d-0dd2-4642-8a49-a41df516292a"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:30:17.843723"], ["updated_at", "2018-09-28 04:30:17.843723"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:31:06.251247', '2018-09-28 04:31:06.251247')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:31:06.253689', '2018-09-28 04:31:06.253689', 980190962)[0m
  [1m[35m (4.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "90d27997-8c48-467e-b52a-bbc44279e72e"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:31:06.274616"], ["updated_at", "2018-09-28 04:31:06.274616"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0b0eea44-1b58-4c35-a451-5a1d76bef8d9"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:31:06.282408"], ["updated_at", "2018-09-28 04:31:06.282408"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9835132a-a036-4e4a-a4d3-af9228f4b185"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: e4b14e4c-5c11-43bd-b559-b7ee85058a9a\n"], ["created_at", "2018-09-28 04:31:06.287343"], ["updated_at", "2018-09-28 04:31:06.287343"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c0075d07-685c-4d96-8054-3820c5876568"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: bbff8ebf-32ce-43d1-8dd3-ae15f7d3ca58\n"], ["created_at", "2018-09-28 04:31:06.290754"], ["updated_at", "2018-09-28 04:31:06.290754"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fb721a58-0c6c-4557-b4d2-e6c162a7926f"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:31:06.293657"], ["updated_at", "2018-09-28 04:31:06.293657"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "004f21bd-5b29-4d4a-862e-65f4aee470fb"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:31:06.296145"], ["updated_at", "2018-09-28 04:31:06.296145"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "757d14d3-bd93-4d2e-bb39-00c406cccb7c"], ["name", "::Cancelled"], ["params", "---\n:error: 'Validation failed: Name can''t be blank'\n"], ["created_at", "2018-09-28 04:31:06.311953"], ["updated_at", "2018-09-28 04:31:06.311953"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:31:16.081158', '2018-09-28 04:31:16.081158')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:31:16.083854', '2018-09-28 04:31:16.083854', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d17db95-2e16-4e5b-b629-f15a3143fba8"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:31:16.105354"], ["updated_at", "2018-09-28 04:31:16.105354"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "94b34027-0ffa-4f55-8ee0-596dc91499c2"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:31:16.109646"], ["updated_at", "2018-09-28 04:31:16.109646"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8e55710c-b040-458a-adfe-d0368a7db292"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:31:16.114129"], ["updated_at", "2018-09-28 04:31:16.114129"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d225e7e4-c80a-4813-aaa3-cf85e1becb9d"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 7ff5ac1f-25a1-47f2-a004-27b5eea95f0e\n"], ["created_at", "2018-09-28 04:31:16.118031"], ["updated_at", "2018-09-28 04:31:16.118031"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "44d6cd83-f0a9-4068-bf5b-a7323c7a4a91"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:31:16.123275"], ["updated_at", "2018-09-28 04:31:16.123275"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "eb903a95-1d1d-48f5-9b0e-da3ce328a89c"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:31:16.135169"], ["updated_at", "2018-09-28 04:31:16.135169"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c52debc7-aa35-4152-9b1e-691e37f4e784"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 19538e04-9eaa-46f3-845f-dd174053fc74\n"], ["created_at", "2018-09-28 04:31:16.138917"], ["updated_at", "2018-09-28 04:31:16.138917"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:34:36.401619', '2018-09-28 04:34:36.401619')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:34:36.404408', '2018-09-28 04:34:36.404408')[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "06fe1bfc-10a6-401c-b43b-2cd717fda80b"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:34:36.415829"], ["updated_at", "2018-09-28 04:34:36.415829"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bdb572bb-ec20-4d87-bf5e-fb0559003437"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:34:36.421977"], ["updated_at", "2018-09-28 04:34:36.421977"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "43a8808c-7cc5-409a-93ce-24726d0d6d6c"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:34:36.440331"], ["updated_at", "2018-09-28 04:34:36.440331"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "583c5e7a-9a18-447c-8e98-89e4b1707ae2"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:34:36.447443"], ["updated_at", "2018-09-28 04:34:36.447443"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "105b7629-4b34-43f3-b9e6-49ff240cfa51"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: ff82f895-7d9a-4263-a9e1-ea2ea5f6ad0d\n"], ["created_at", "2018-09-28 04:34:36.450968"], ["updated_at", "2018-09-28 04:34:36.450968"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d01e8685-e80c-44ea-b8a6-342370dc8f69"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 3ba1de01-acf3-4af3-ab8e-34ae8590d80f\n"], ["created_at", "2018-09-28 04:34:36.454357"], ["updated_at", "2018-09-28 04:34:36.454357"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d67d3eea-f8e1-47d8-ab3c-8a5d78af4b49"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:34:36.459993"], ["updated_at", "2018-09-28 04:34:36.459993"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:34:59.399749', '2018-09-28 04:34:59.399749')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:34:59.403158', '2018-09-28 04:34:59.403158')[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b14332ad-9dd9-4ef9-8c53-14d0e66403af"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:34:59.425190"], ["updated_at", "2018-09-28 04:34:59.425190"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fe6646e1-7d39-4852-80e2-e4bf6bdd2b9d"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:34:59.441078"], ["updated_at", "2018-09-28 04:34:59.441078"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7ac2d5a6-2910-4b69-a67a-dd70915a6c41"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:34:59.445570"], ["updated_at", "2018-09-28 04:34:59.445570"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3fe9dcfe-e2cd-4930-99ab-c82ab12e91b9"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:34:59.448310"], ["updated_at", "2018-09-28 04:34:59.448310"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bb34f7a2-711d-4f11-a28c-6e06e3d4f98c"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:34:59.451154"], ["updated_at", "2018-09-28 04:34:59.451154"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1d889ea5-b4a2-4e10-9ca5-2c9337a181e6"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 812f759a-1b20-40a5-83da-f6c8c806f052\n"], ["created_at", "2018-09-28 04:34:59.455213"], ["updated_at", "2018-09-28 04:34:59.455213"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ef2b8a24-6e1d-4d3a-9eda-fe8659f1afad"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: f6731da5-1a6a-4ffa-ac99-e5533ed0570c\n"], ["created_at", "2018-09-28 04:34:59.459587"], ["updated_at", "2018-09-28 04:34:59.459587"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9cfb9a4b-afe8-4cbb-827f-f54dd008805a"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: d29592c5-8832-49c1-834a-144a8e3dc155\n"], ["created_at", "2018-09-28 04:34:59.462426"], ["updated_at", "2018-09-28 04:34:59.462426"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:35:25.762343', '2018-09-28 04:35:25.762343')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:35:25.764902', '2018-09-28 04:35:25.764902')[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e07ae821-812e-482f-99d3-f33a47e5a816"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:35:25.791837"], ["updated_at", "2018-09-28 04:35:25.791837"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7f7c8fbb-137d-4648-a677-1d924dae8b56"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:35:25.796057"], ["updated_at", "2018-09-28 04:35:25.796057"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aafc9e81-7e61-4993-8d1d-5c9fdda9196f"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: a813b451-c068-40ba-a2b2-81ea94ed74e5\n"], ["created_at", "2018-09-28 04:35:25.800740"], ["updated_at", "2018-09-28 04:35:25.800740"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e658024f-a9ad-402a-8de3-d45961c86445"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 106aed92-8516-4e6d-b284-0d7584e46da8\n"], ["created_at", "2018-09-28 04:35:25.804735"], ["updated_at", "2018-09-28 04:35:25.804735"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "042e34b1-3e93-4d91-b948-ae50e4d953e6"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 29f3cc25-be68-4976-bd23-090bca67adac\n"], ["created_at", "2018-09-28 04:35:25.808856"], ["updated_at", "2018-09-28 04:35:25.808856"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1ac11c11-e2cf-4e0e-ba92-4f58fc2663c3"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:35:25.812932"], ["updated_at", "2018-09-28 04:35:25.812932"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "23aade0e-dc31-4be7-8610-fbc406a179f9"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:35:25.819228"], ["updated_at", "2018-09-28 04:35:25.819228"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b8d2bd65-8886-4071-ad98-edd7fb9c94c8"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:35:25.821785"], ["updated_at", "2018-09-28 04:35:25.821785"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f9a6f185-8eec-4751-b7c3-96f5f7843f79"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: c51ee556-0858-4057-931c-f746f41776b5\n"], ["created_at", "2018-09-28 04:35:25.824165"], ["updated_at", "2018-09-28 04:35:25.824165"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.3ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:38:06.762972', '2018-09-28 04:38:06.762972')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:38:06.766265', '2018-09-28 04:38:06.766265')[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "65dd284a-10a8-480d-85c3-8a7c92dc4f45"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: d3031fc8-1f47-4a67-a402-61d0890f5d5a\n"], ["created_at", "2018-09-28 04:38:06.777850"], ["updated_at", "2018-09-28 04:38:06.777850"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "555d6b66-fa24-45c6-8f87-803f80e749ed"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:38:06.792022"], ["updated_at", "2018-09-28 04:38:06.792022"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a4008e37-c187-46d7-98ed-e0ec15e0fcd9"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: aea60811-cc8f-4f65-8866-00417ba5daa6\n"], ["created_at", "2018-09-28 04:38:06.805638"], ["updated_at", "2018-09-28 04:38:06.805638"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b8a3a9fe-b410-415b-abe9-47dfc93c8749"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:38:06.809878"], ["updated_at", "2018-09-28 04:38:06.809878"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d39044d7-5680-42a0-ab95-82abeef46351"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:38:06.813515"], ["updated_at", "2018-09-28 04:38:06.813515"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b1f428bf-17e3-442d-8ea1-2bdc8e8ae403"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 90abfe32-30ab-481e-a6f0-4138d5417ae1\n"], ["created_at", "2018-09-28 04:38:06.817100"], ["updated_at", "2018-09-28 04:38:06.817100"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1e8eb976-45f1-4e8e-985e-38bd307b2980"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:38:06.820611"], ["updated_at", "2018-09-28 04:38:06.820611"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e1d2027b-3a7e-4dea-802c-0cdccf868a02"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:38:06.824339"], ["updated_at", "2018-09-28 04:38:06.824339"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4495ffbc-aa55-4ef3-a839-a2e82c151cda"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 1fea7d7c-2e32-4359-b4ef-f6ea42995f9f\n"], ["created_at", "2018-09-28 04:38:06.828087"], ["updated_at", "2018-09-28 04:38:06.828087"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:38:33.852941', '2018-09-28 04:38:33.852941')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:38:33.855571', '2018-09-28 04:38:33.855571')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:38:33.857863', '2018-09-28 04:38:33.857863', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ebfa9fd7-bf3a-4e76-bb6c-c95e7723d44b"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 259f836c-1b26-4e70-ab4e-59eb58bc0651\n"], ["created_at", "2018-09-28 04:38:33.879847"], ["updated_at", "2018-09-28 04:38:33.879847"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6511b61a-c9fd-4d35-8c55-7d86d2c0d331"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:38:33.889151"], ["updated_at", "2018-09-28 04:38:33.889151"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3e534336-c6fa-477c-a593-701f22b9eb7b"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:38:33.893524"], ["updated_at", "2018-09-28 04:38:33.893524"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "741a19c1-8073-4011-a740-e6ee87aef0bf"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:38:33.896396"], ["updated_at", "2018-09-28 04:38:33.896396"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "92cb5b77-5a3c-4dbb-b3d4-1ba6faa7bdcf"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:38:33.900330"], ["updated_at", "2018-09-28 04:38:33.900330"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c4b1b6aa-7532-4f94-b73a-4b1dae8d6c97"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 33a92307-8707-44b4-b019-4831ac46eb20\n"], ["created_at", "2018-09-28 04:38:33.903644"], ["updated_at", "2018-09-28 04:38:33.903644"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "840bb203-794e-4084-8bad-5ae38ad2e30d"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: d0a5a954-f68d-4a55-b7b5-f5e294af8ffe\n"], ["created_at", "2018-09-28 04:38:33.907840"], ["updated_at", "2018-09-28 04:38:33.907840"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1e91604d-7bc5-4882-bce0-3cca884bb732"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: c9f9e0c2-59bd-4a58-91f8-7f9fd93126ac\n"], ["created_at", "2018-09-28 04:38:33.912111"], ["updated_at", "2018-09-28 04:38:33.912111"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2b10772d-ee54-4c00-be73-068ee9931a84"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:38:33.915789"], ["updated_at", "2018-09-28 04:38:33.915789"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:40:23.449548', '2018-09-28 04:40:23.449548')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:40:23.452275', '2018-09-28 04:40:23.452275')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:40:23.454563', '2018-09-28 04:40:23.454563', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6bc624d7-145f-446d-b2c5-d568426d0bd3"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: efaef993-2a03-46a4-baf3-bafe77b24e69\n"], ["created_at", "2018-09-28 04:40:23.493567"], ["updated_at", "2018-09-28 04:40:23.493567"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9e3ba4f7-a442-4781-9a7b-bb6a2e573e68"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: a098cc88-fded-46c7-a772-a1c3d9189b44\n"], ["created_at", "2018-09-28 04:40:23.498578"], ["updated_at", "2018-09-28 04:40:23.498578"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a4c46b00-4588-4a28-a59f-5fd93af8884e"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:40:23.502836"], ["updated_at", "2018-09-28 04:40:23.502836"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9749eeb3-4a88-4aa9-aca2-d0cdb316a309"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 938226ef-50f9-4fc4-be70-72ec299c63c8\n"], ["created_at", "2018-09-28 04:40:23.509241"], ["updated_at", "2018-09-28 04:40:23.509241"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "51fa18b5-049e-4d08-9e6e-ab779716f6c2"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:40:23.513395"], ["updated_at", "2018-09-28 04:40:23.513395"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "40259df0-23ee-4ba3-b067-b08721e1b308"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:40:23.515949"], ["updated_at", "2018-09-28 04:40:23.515949"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2155a2d1-ec71-4547-88eb-62dbe92fd436"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:40:23.519329"], ["updated_at", "2018-09-28 04:40:23.519329"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2744537f-d0ea-4ab3-8f29-1dc62410d82a"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:40:23.523476"], ["updated_at", "2018-09-28 04:40:23.523476"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6106c1f5-a927-434b-add8-8b0a298a6bc4"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: c61a065c-6223-47c3-be2f-6014702ae2d4\n"], ["created_at", "2018-09-28 04:40:23.527213"], ["updated_at", "2018-09-28 04:40:23.527213"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:40:35.254995', '2018-09-28 04:40:35.254995')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:40:35.257913', '2018-09-28 04:40:35.257913')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:40:35.260624', '2018-09-28 04:40:35.260624', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:40:35.262786', '2018-09-28 04:40:35.262786')[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8593837a-849c-4cf9-88fd-7dc886abb096"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:40:35.275976"], ["updated_at", "2018-09-28 04:40:35.275976"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "42966737-965f-4ab6-a791-b73e9f29cf51"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:40:35.286924"], ["updated_at", "2018-09-28 04:40:35.286924"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3a8062a2-b645-463c-8ceb-69b0dd73329f"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: b098cdb3-ae12-4a54-9891-f8a9b0a67f73\n"], ["created_at", "2018-09-28 04:40:35.295352"], ["updated_at", "2018-09-28 04:40:35.295352"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f08f88de-7d6c-4e51-a0be-bf378e3c3885"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:40:35.299506"], ["updated_at", "2018-09-28 04:40:35.299506"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "de57c3c4-b919-439e-9fc6-8c6e9a351fc5"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 3af36002-0fd4-4586-bf81-70a12f1d95eb\n"], ["created_at", "2018-09-28 04:40:35.310049"], ["updated_at", "2018-09-28 04:40:35.310049"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "63a2769b-3630-4f1b-84af-4dc6cacf5e56"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:40:35.315837"], ["updated_at", "2018-09-28 04:40:35.315837"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1bdd3b8f-4d92-4013-ae90-1ccb2896e278"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: fca787c6-e51a-4572-b5ee-1f8edfb873e2\n"], ["created_at", "2018-09-28 04:40:35.319827"], ["updated_at", "2018-09-28 04:40:35.319827"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "82a89e3b-74fd-4124-9cdd-39d951520ce1"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 6c8561b8-97de-4900-a187-b30115de1e3d\n"], ["created_at", "2018-09-28 04:40:35.322667"], ["updated_at", "2018-09-28 04:40:35.322667"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a4fd2819-5c41-4404-bd80-de1e5550ffd5"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:40:35.326865"], ["updated_at", "2018-09-28 04:40:35.326865"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5f68e77a-2cc5-42f1-9f67-b580cc0e81d7"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: fb486527-e9fa-4805-bdb1-be67147d410f\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:40:35.339147"], ["updated_at", "2018-09-28 04:40:35.339147"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "builds" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "version" varchar NOT NULL, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (8.3ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_builds_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_builds_on_app_id' AND type='index'
[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_stage_id" ON "builds" ("stage_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "clusters"[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE TABLE "clusters" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_app_id" ON "clusters" ("app_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_clusters_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_clusters_on_app_id' AND type='index'
[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_stage_id" ON "clusters" ("stage_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "deploys"[0m
  [1m[35m (5.4ms)[0m  [1m[35mCREATE TABLE "deploys" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "release_id" integer, "cluster_id" integer, "uid" varchar NOT NULL, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_cluster_id" ON "deploys" ("cluster_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_release_id" ON "deploys" ("release_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (9.0ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (6.8ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "releases"[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "releases" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "build_id" integer, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE  INDEX "index_releases_on_build_id" ON "releases" ("build_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "stages"[0m
  [1m[35m (6.6ms)[0m  [1m[35mCREATE TABLE "stages" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "review" boolean DEFAULT 'f' NOT NULL, "auto" boolean DEFAULT 'f' NOT NULL, "promotion" boolean DEFAULT 'f' NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE  INDEX "index_stages_on_app_id" ON "stages" ("app_id")[0m
  [1m[35m (7.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (4.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180927031312)[0m
  [1m[35m (3.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180926131846),
(20180924034803),
(20180926135035),
(20180924034802),
(20180924140732),
(20180924034801);

[0m
  [1m[35m (5.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-09-28 04:41:10.175376"], ["updated_at", "2018-09-28 04:41:10.175376"]]
  [1m[35m (3.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:41:10.228102', '2018-09-28 04:41:10.228102')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:41:10.230526', '2018-09-28 04:41:10.230526')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:41:10.232479', '2018-09-28 04:41:10.232479', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:41:10.234374', '2018-09-28 04:41:10.234374')[0m
  [1m[35m (3.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "18e53bbd-15e9-4f4f-bb14-679f6d4dda66"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 9f2998bb-bd86-4f95-8c8f-f3f918f354f9\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:41:10.267073"], ["updated_at", "2018-09-28 04:41:10.267073"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c681237d-9aff-45fa-adb9-1844263d8bc4"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:41:10.275708"], ["updated_at", "2018-09-28 04:41:10.275708"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "495c93e0-9f1d-4894-bf85-3bba8ecf56b0"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:41:10.278164"], ["updated_at", "2018-09-28 04:41:10.278164"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8451d5c6-ea03-425a-a048-4fbb17f2b7ad"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 76fc6664-eaa7-438d-b8f8-bae890925b97\n"], ["created_at", "2018-09-28 04:41:10.281818"], ["updated_at", "2018-09-28 04:41:10.281818"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ee6f2a0a-8aec-4c30-816b-de5b9d39e4ff"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 18ddac03-b8cf-4e08-a7c4-6be977d75525\n"], ["created_at", "2018-09-28 04:41:10.285594"], ["updated_at", "2018-09-28 04:41:10.285594"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "71cd5781-2fbb-4fc9-aec9-0ed7a277c600"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 8ad13bb4-3545-4fc0-a1e1-44d7fbd6671b\n"], ["created_at", "2018-09-28 04:41:10.289480"], ["updated_at", "2018-09-28 04:41:10.289480"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ddf11bf1-8f12-4f91-bdde-034bce854def"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:41:10.294020"], ["updated_at", "2018-09-28 04:41:10.294020"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "58f28da0-dfb1-4d51-bb2d-0994cb93adfb"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: d24bd706-03be-4b3e-9b3e-197f085cd3e8\n"], ["created_at", "2018-09-28 04:41:10.299716"], ["updated_at", "2018-09-28 04:41:10.299716"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "16c945fd-4c63-4ac7-b63d-e9377f5d24a3"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:41:10.305151"], ["updated_at", "2018-09-28 04:41:10.305151"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aa8f1281-7ef5-4d25-89e1-9ffc2fb5a55f"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:41:10.309128"], ["updated_at", "2018-09-28 04:41:10.309128"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:42:04.878102', '2018-09-28 04:42:04.878102')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:42:04.880972', '2018-09-28 04:42:04.880972')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:42:04.883234', '2018-09-28 04:42:04.883234', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:42:04.885064', '2018-09-28 04:42:04.885064')[0m
  [1m[35m (64.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.3ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0d042a82-a78c-4fef-8e2f-478b1ee24964"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 4f052157-9c1d-4984-8c72-ae759bcf4d1a\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:42:05.000543"], ["updated_at", "2018-09-28 04:42:05.000543"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "4f052157-9c1d-4984-8c72-ae759bcf4d1a"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:42:05.008561"], ["updated_at", "2018-09-28 04:42:05.008561"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "29192c7a-53c8-4a9a-8b75-338b069cac5e"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 9ce602f3-12cb-4224-b699-f35ae269672e\n"], ["created_at", "2018-09-28 04:42:05.014296"], ["updated_at", "2018-09-28 04:42:05.014296"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "58689185-3017-4af4-8ba7-790b80f08571"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:42:05.019170"], ["updated_at", "2018-09-28 04:42:05.019170"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "16af92a5-3fde-4371-9a07-8f9c36340aea"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:42:05.022718"], ["updated_at", "2018-09-28 04:42:05.022718"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e21485cf-f86d-4693-baee-c27c781c3e5f"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 12b07245-b1de-45f4-bde9-735a773d11a6\n"], ["created_at", "2018-09-28 04:42:05.028409"], ["updated_at", "2018-09-28 04:42:05.028409"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d00f2399-531d-4166-a829-503bb66c1699"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: f30b8e12-200e-408d-b2db-552f5aceda3c\n"], ["created_at", "2018-09-28 04:42:05.033290"], ["updated_at", "2018-09-28 04:42:05.033290"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "22f4f770-5ca3-45c0-8d74-36786c7cc634"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:42:05.036839"], ["updated_at", "2018-09-28 04:42:05.036839"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2eda015f-e649-44f9-95df-f7b20e940e65"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:42:05.039668"], ["updated_at", "2018-09-28 04:42:05.039668"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d5079e4-1603-492d-8227-06fd09f30bc5"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:42:05.043762"], ["updated_at", "2018-09-28 04:42:05.043762"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "95d018f2-f8fd-4ad6-9913-e9bfc90ce38d"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: cd7bcb3e-b136-421f-b245-11e0f9cdb785\n"], ["created_at", "2018-09-28 04:42:05.047617"], ["updated_at", "2018-09-28 04:42:05.047617"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:44:25.834121', '2018-09-28 04:44:25.834121')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:44:25.837078', '2018-09-28 04:44:25.837078')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:44:25.838949', '2018-09-28 04:44:25.838949', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:44:25.840695', '2018-09-28 04:44:25.840695')[0m
  [1m[35m (4.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2f31b206-c684-45dc-b3f0-a82f6f7fcb4e"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 3b546467-f409-4d7c-abea-1ef0c0a901ce\n"], ["created_at", "2018-09-28 04:44:25.852621"], ["updated_at", "2018-09-28 04:44:25.852621"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b49e7ea4-ae25-4549-9bdb-7d8de85dea1a"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:44:25.865889"], ["updated_at", "2018-09-28 04:44:25.865889"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e1822996-bdad-47ce-b9a8-dda8be2c5dba"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: b8a7f7db-2ee4-4976-87ee-e7cc40588376\n"], ["created_at", "2018-09-28 04:44:25.875917"], ["updated_at", "2018-09-28 04:44:25.875917"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d04ec0ef-5a11-46f1-a7f9-2d38911044cc"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 4e17e60e-5485-40da-a6bd-d8ad095a52d1\n"], ["created_at", "2018-09-28 04:44:25.880507"], ["updated_at", "2018-09-28 04:44:25.880507"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a26ac013-63f7-44a8-aa9f-e1253a5d6b48"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:44:25.884869"], ["updated_at", "2018-09-28 04:44:25.884869"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "14decc36-4a75-48e4-b7f4-0e905c10f9fa"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:44:25.888686"], ["updated_at", "2018-09-28 04:44:25.888686"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d06434f2-44d3-4e4d-80e2-26dcd636a97a"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:44:25.893023"], ["updated_at", "2018-09-28 04:44:25.893023"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "68167b06-0f05-4063-8b15-1a007343a831"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 0e6f94fe-e0c8-4f2a-b66e-6d771dda9c55\n"], ["created_at", "2018-09-28 04:44:25.896457"], ["updated_at", "2018-09-28 04:44:25.896457"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "79a49187-2e50-43fb-bc1a-cd150188eeb7"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:44:25.900463"], ["updated_at", "2018-09-28 04:44:25.900463"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "60c22232-3718-4553-9175-ee8049823c18"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: e6a21755-7c9b-49d3-a796-623d756a175c\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:44:25.912765"], ["updated_at", "2018-09-28 04:44:25.912765"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "e6a21755-7c9b-49d3-a796-623d756a175c"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:44:25.918035"], ["updated_at", "2018-09-28 04:44:25.918035"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 79cd688e-d2ec-44e1-b9af-26c8050e82d4) to Async(default) with arguments: "60c22232-3718-4553-9175-ee8049823c18"
[ActiveJob] [BuildAutoReleaseJob] [79cd688e-d2ec-44e1-b9af-26c8050e82d4] Performing BuildAutoReleaseJob (Job ID: 79cd688e-d2ec-44e1-b9af-26c8050e82d4) from Async(default) with arguments: "60c22232-3718-4553-9175-ee8049823c18"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_uid" = ? LIMIT ?[0m  [["app_uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [79cd688e-d2ec-44e1-b9af-26c8050e82d4]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "60c22232-3718-4553-9175-ee8049823c18"], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [79cd688e-d2ec-44e1-b9af-26c8050e82d4] Performed BuildAutoReleaseJob (Job ID: 79cd688e-d2ec-44e1-b9af-26c8050e82d4) from Async(default) in 6.15ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:44:52.927679', '2018-09-28 04:44:52.927679')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:44:52.930430', '2018-09-28 04:44:52.930430')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:44:52.932507', '2018-09-28 04:44:52.932507', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:44:52.934282', '2018-09-28 04:44:52.934282')[0m
  [1m[35m (4.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "98fd6445-df9c-45f2-8bc2-ef935b8de963"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 51455574-60db-48e3-95db-6c97089551e9\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:44:52.965183"], ["updated_at", "2018-09-28 04:44:52.965183"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "51455574-60db-48e3-95db-6c97089551e9"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:44:52.971799"], ["updated_at", "2018-09-28 04:44:52.971799"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 1c97ff3d-c118-487d-b3a6-6145c4f40be7) to Async(default) with arguments: "98fd6445-df9c-45f2-8bc2-ef935b8de963"
[ActiveJob] [BuildAutoReleaseJob] [1c97ff3d-c118-487d-b3a6-6145c4f40be7] Performing BuildAutoReleaseJob (Job ID: 1c97ff3d-c118-487d-b3a6-6145c4f40be7) from Async(default) with arguments: "98fd6445-df9c-45f2-8bc2-ef935b8de963"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
[ActiveJob] [BuildAutoReleaseJob] [1c97ff3d-c118-487d-b3a6-6145c4f40be7]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "98fd6445-df9c-45f2-8bc2-ef935b8de963"], ["LIMIT", 1]]
-----------------------------------
[ActiveJob] [BuildAutoReleaseJob] [1c97ff3d-c118-487d-b3a6-6145c4f40be7] Performed BuildAutoReleaseJob (Job ID: 1c97ff3d-c118-487d-b3a6-6145c4f40be7) from Async(default) in 5.9ms
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f6b8b717-249a-4bb2-bc09-757a7687efc6"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:44:52.983516"], ["updated_at", "2018-09-28 04:44:52.983516"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e9679f49-f94f-462c-bc34-9cb96c3b88b5"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:44:52.990290"], ["updated_at", "2018-09-28 04:44:52.990290"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "da5b9f94-2713-44a5-b7f4-4fdfef2531df"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 7dd53e57-bf34-4a80-8439-9e6c041236f5\n"], ["created_at", "2018-09-28 04:44:52.994435"], ["updated_at", "2018-09-28 04:44:52.994435"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b7364f7a-a38e-4980-8246-022bf5fbd88f"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 669ce770-25a4-41e6-b789-a1a4b0dcc06a\n"], ["created_at", "2018-09-28 04:44:53.000095"], ["updated_at", "2018-09-28 04:44:53.000095"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d3da50c4-f73a-42b4-b756-3ca4aa4b6d71"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:44:53.005320"], ["updated_at", "2018-09-28 04:44:53.005320"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6b625a0a-2789-4a86-ac55-3fb210a0ca0a"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 168503dd-0e19-4184-b56c-487673856864\n"], ["created_at", "2018-09-28 04:44:53.010036"], ["updated_at", "2018-09-28 04:44:53.010036"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2f1250c1-2e10-4465-b3e4-8f689c6c05fc"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:44:53.014013"], ["updated_at", "2018-09-28 04:44:53.014013"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c08e1dab-7228-4c77-a17e-2ca5e29f1828"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:44:53.016677"], ["updated_at", "2018-09-28 04:44:53.016677"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fddf9135-9d97-42c4-bcf9-41192fb94b35"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: c4216004-e75d-4121-a62d-e102f30cdb62\n"], ["created_at", "2018-09-28 04:44:53.020204"], ["updated_at", "2018-09-28 04:44:53.020204"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:46:07.971432', '2018-09-28 04:46:07.971432')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:46:07.973706', '2018-09-28 04:46:07.973706')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:46:07.976265', '2018-09-28 04:46:07.976265', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:46:07.978070', '2018-09-28 04:46:07.978070')[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a73f6067-8750-4e18-bf52-d5525f0ae120"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 5adbdf0f-18ae-4c85-8c2a-cd602d6765b2\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:46:08.009985"], ["updated_at", "2018-09-28 04:46:08.009985"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "5adbdf0f-18ae-4c85-8c2a-cd602d6765b2"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:46:08.017804"], ["updated_at", "2018-09-28 04:46:08.017804"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 6c1da54f-deae-4013-937f-8c01f056d081) to Async(default) with arguments: "a73f6067-8750-4e18-bf52-d5525f0ae120"
[ActiveJob] [BuildAutoReleaseJob] [6c1da54f-deae-4013-937f-8c01f056d081] Performing BuildAutoReleaseJob (Job ID: 6c1da54f-deae-4013-937f-8c01f056d081) from Async(default) with arguments: "a73f6067-8750-4e18-bf52-d5525f0ae120"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a6d3daad-1686-4161-b896-2335cd4793f1"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: df3016c3-8a56-4a0a-8e63-8562ead1dd9f\n"], ["created_at", "2018-09-28 04:46:08.027916"], ["updated_at", "2018-09-28 04:46:08.027916"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [6c1da54f-deae-4013-937f-8c01f056d081]   [1m[36mEvent Load (2.4ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "a73f6067-8750-4e18-bf52-d5525f0ae120"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [6c1da54f-deae-4013-937f-8c01f056d081] Performed BuildAutoReleaseJob (Job ID: 6c1da54f-deae-4013-937f-8c01f056d081) from Async(default) in 9.02ms
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e6e0e857-a7be-4c2d-97ce-78eab58de3b8"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 3d9b4e17-b09a-462b-9b21-1ac26e8c8f08\n"], ["created_at", "2018-09-28 04:46:08.032345"], ["updated_at", "2018-09-28 04:46:08.032345"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c43d456b-c733-48fb-bf3b-18ce61978920"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:46:08.036899"], ["updated_at", "2018-09-28 04:46:08.036899"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "66b58f15-4c24-4a5c-b004-85b152732358"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:46:08.040384"], ["updated_at", "2018-09-28 04:46:08.040384"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "99dc9ed6-91fa-4894-9123-2f59c0243bbf"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: f47db76b-03b2-4405-b17c-98667327c15c\n"], ["created_at", "2018-09-28 04:46:08.043900"], ["updated_at", "2018-09-28 04:46:08.043900"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6643d280-5ca8-49fc-9381-f2fb3d3641bb"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 971b461c-f4ae-430d-8b78-12ec97fe585d\n"], ["created_at", "2018-09-28 04:46:08.048361"], ["updated_at", "2018-09-28 04:46:08.048361"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "66880849-eefb-4b6c-a584-17ca4976ba9e"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:46:08.052179"], ["updated_at", "2018-09-28 04:46:08.052179"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "189b9de1-2ce2-44cd-866c-146b1ce57428"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:46:08.054721"], ["updated_at", "2018-09-28 04:46:08.054721"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2025fd01-7c76-4bb7-a734-04176b99851d"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:46:08.057823"], ["updated_at", "2018-09-28 04:46:08.057823"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:47:11.468267', '2018-09-28 04:47:11.468267')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:47:11.470747', '2018-09-28 04:47:11.470747')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:47:11.472927', '2018-09-28 04:47:11.472927', 980190962)[0m
  [1m[36mFixture Delete (0.3ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:47:11.474904', '2018-09-28 04:47:11.474904')[0m
  [1m[35m (4.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9ec4ed89-3173-4c31-a1df-5321d677bb3b"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 1a6601dd-5965-4453-be52-9834f1d963be\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:47:11.508535"], ["updated_at", "2018-09-28 04:47:11.508535"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "1a6601dd-5965-4453-be52-9834f1d963be"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:47:11.515928"], ["updated_at", "2018-09-28 04:47:11.515928"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: a485bf44-9747-4062-9172-d09c63d9ec31) to Async(default) with arguments: "9ec4ed89-3173-4c31-a1df-5321d677bb3b"
[ActiveJob] [BuildAutoReleaseJob] [a485bf44-9747-4062-9172-d09c63d9ec31] Performing BuildAutoReleaseJob (Job ID: a485bf44-9747-4062-9172-d09c63d9ec31) from Async(default) with arguments: "9ec4ed89-3173-4c31-a1df-5321d677bb3b"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fff0d951-098e-4e65-81d9-93566d279eec"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 72e56a48-b6c7-4815-8fd5-fdbea4ff456d\n"], ["created_at", "2018-09-28 04:47:11.526526"], ["updated_at", "2018-09-28 04:47:11.526526"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [a485bf44-9747-4062-9172-d09c63d9ec31]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "9ec4ed89-3173-4c31-a1df-5321d677bb3b"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [a485bf44-9747-4062-9172-d09c63d9ec31] Performed BuildAutoReleaseJob (Job ID: a485bf44-9747-4062-9172-d09c63d9ec31) from Async(default) in 12.64ms
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "04443bbf-fb96-4d73-94c7-113149caf16b"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 4861fbd4-70a3-467f-a1d9-0671b7b8ab39\n"], ["created_at", "2018-09-28 04:47:11.533584"], ["updated_at", "2018-09-28 04:47:11.533584"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6ab668e8-f135-4570-93ab-e7535027f6d9"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:47:11.537684"], ["updated_at", "2018-09-28 04:47:11.537684"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "17cd3781-129d-4593-8447-b65257ef1312"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:47:11.540050"], ["updated_at", "2018-09-28 04:47:11.540050"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b1705c5f-3bd2-4418-9b36-679b84dc9f6e"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:47:11.543335"], ["updated_at", "2018-09-28 04:47:11.543335"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3b426969-02c1-41f0-ba74-3e9753088084"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 1d9688fd-1919-4bc7-8503-12a5d9b94bc4\n"], ["created_at", "2018-09-28 04:47:11.549360"], ["updated_at", "2018-09-28 04:47:11.549360"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "516b2a3f-d5d7-4223-b45a-836494de48db"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 72b2a31e-b156-45c4-ae35-92d41b398db3\n"], ["created_at", "2018-09-28 04:47:11.553700"], ["updated_at", "2018-09-28 04:47:11.553700"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "23275e27-4526-4847-a109-3f89e252eb3f"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:47:11.559549"], ["updated_at", "2018-09-28 04:47:11.559549"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "79a7d1dc-2f7f-4029-ac90-dbb9f6777a0d"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:47:11.563475"], ["updated_at", "2018-09-28 04:47:11.563475"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:47:11.568977', '2018-09-28 04:47:11.568977')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:47:11.570663', '2018-09-28 04:47:11.570663')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:47:11.572005', '2018-09-28 04:47:11.572005', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:47:11.573288', '2018-09-28 04:47:11.573288')[0m
  [1m[35m (3.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d82d7849-6248-4966-a56f-5cd828643b2c"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: aa55d46e-f70b-4fae-b012-ff6a533e00b9\n"], ["created_at", "2018-09-28 04:47:11.580110"], ["updated_at", "2018-09-28 04:47:11.580110"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:47:42.025614', '2018-09-28 04:47:42.025614')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:47:42.027818', '2018-09-28 04:47:42.027818')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:47:42.029417', '2018-09-28 04:47:42.029417', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:47:42.030894', '2018-09-28 04:47:42.030894')[0m
  [1m[35m (7.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "caf556a5-52f5-475d-8a1f-de879d2837d8"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:47:42.048230"], ["updated_at", "2018-09-28 04:47:42.048230"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "342642e4-d62e-41db-969e-c06a732403b0"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:47:42.052400"], ["updated_at", "2018-09-28 04:47:42.052400"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dd72db85-1e02-4408-9a26-c28b954af92f"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:47:42.062374"], ["updated_at", "2018-09-28 04:47:42.062374"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dbd2ad72-a9f8-44f8-892a-dc32477a870f"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:47:42.072038"], ["updated_at", "2018-09-28 04:47:42.072038"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f3500e89-7a25-4a22-b89d-39b20a56a33e"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: b8a7db02-fff4-4de3-95b3-6f8ea30ff7cb\n"], ["created_at", "2018-09-28 04:47:42.075881"], ["updated_at", "2018-09-28 04:47:42.075881"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fa4f879c-4c3d-4068-b3d2-9947385a9ee8"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 26bbf439-53c1-472a-90b0-179da13f369d\n"], ["created_at", "2018-09-28 04:47:42.079401"], ["updated_at", "2018-09-28 04:47:42.079401"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "022d25c0-d642-4baa-a3ff-c13495fc6038"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 7117ba86-31de-4029-bf8a-8ced625e1883\n"], ["created_at", "2018-09-28 04:47:42.083373"], ["updated_at", "2018-09-28 04:47:42.083373"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8d2ea97c-34fb-475f-82c3-57fcdd8e5db8"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:47:42.086597"], ["updated_at", "2018-09-28 04:47:42.086597"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a246ff19-5fc9-41ca-8909-66369eaac637"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: d9ac30b1-5017-4c87-9d81-907c95ae3e08\n"], ["created_at", "2018-09-28 04:47:42.088803"], ["updated_at", "2018-09-28 04:47:42.088803"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "eb970edf-466c-4190-a202-0a12f8898e10"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: a27b0e21-43d5-4bd4-89f4-139509f7c9e8\n"], ["created_at", "2018-09-28 04:47:42.097001"], ["updated_at", "2018-09-28 04:47:42.097001"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "35365dda-1c26-49d2-9430-73a85e848050"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 37d5fcba-5fd1-4d46-9067-973278aa2e34\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:47:42.104911"], ["updated_at", "2018-09-28 04:47:42.104911"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "37d5fcba-5fd1-4d46-9067-973278aa2e34"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:47:42.111207"], ["updated_at", "2018-09-28 04:47:42.111207"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 11786043-fcf4-4991-8d56-1b74b6cf8ee9) to Async(default) with arguments: "35365dda-1c26-49d2-9430-73a85e848050"
[ActiveJob] [BuildAutoReleaseJob] [11786043-fcf4-4991-8d56-1b74b6cf8ee9] Performing BuildAutoReleaseJob (Job ID: 11786043-fcf4-4991-8d56-1b74b6cf8ee9) from Async(default) with arguments: "35365dda-1c26-49d2-9430-73a85e848050"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [11786043-fcf4-4991-8d56-1b74b6cf8ee9] Performed BuildAutoReleaseJob (Job ID: 11786043-fcf4-4991-8d56-1b74b6cf8ee9) from Async(default) in 4.8ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:48:01.936577', '2018-09-28 04:48:01.936577')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:48:01.938991', '2018-09-28 04:48:01.938991')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:48:01.940567', '2018-09-28 04:48:01.940567', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:48:01.941979', '2018-09-28 04:48:01.941979')[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ca89da5b-d0aa-4302-8057-a1fb2383c3a9"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:48:01.965332"], ["updated_at", "2018-09-28 04:48:01.965332"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aaa7e690-9057-46ec-ab3b-d8ec7538da14"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: c7d5e376-8e91-455d-8c53-54db5585fd72\n"], ["created_at", "2018-09-28 04:48:01.968743"], ["updated_at", "2018-09-28 04:48:01.968743"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "47e17216-18c6-4e08-a721-579a9cbd7e5a"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 2eabfffe-104a-42c4-9d89-e4cb368ed548\n"], ["created_at", "2018-09-28 04:48:01.971793"], ["updated_at", "2018-09-28 04:48:01.971793"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9815316c-b8b0-43ea-8306-b1fbf23c7d86"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:48:01.975136"], ["updated_at", "2018-09-28 04:48:01.975136"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5c5866d5-1dcc-4521-b9dd-cfee69c4abd8"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:48:01.978266"], ["updated_at", "2018-09-28 04:48:01.978266"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b460dfc5-f537-471b-b6aa-9242477d5352"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:48:01.980920"], ["updated_at", "2018-09-28 04:48:01.980920"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "38287717-3e81-4668-abca-72c3d3e692e2"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: d7cb1668-4a15-41e8-8574-7e0edcc0ca6d\n"], ["created_at", "2018-09-28 04:48:01.983757"], ["updated_at", "2018-09-28 04:48:01.983757"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f8c65ae7-5107-4f90-8499-f928e0234af9"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: cd935724-5374-44c5-a289-f2a19bdec5a2\n"], ["created_at", "2018-09-28 04:48:01.986582"], ["updated_at", "2018-09-28 04:48:01.986582"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8c559310-8050-4dfa-a83b-674a36399196"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:48:01.989541"], ["updated_at", "2018-09-28 04:48:01.989541"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "540e293e-781f-4772-867b-567990ce6603"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: 09262a04-320e-4172-9c30-45dd544013cb\n"], ["created_at", "2018-09-28 04:48:01.998414"], ["updated_at", "2018-09-28 04:48:01.998414"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "09262a04-320e-4172-9c30-45dd544013cb"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:48:02.006246"], ["updated_at", "2018-09-28 04:48:02.006246"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 313571bc-dea2-4e15-b147-d89668973e4c) to Async(default) with arguments: "540e293e-781f-4772-867b-567990ce6603"
[ActiveJob] [ReleaseJob] [313571bc-dea2-4e15-b147-d89668973e4c] Performing ReleaseJob (Job ID: 313571bc-dea2-4e15-b147-d89668973e4c) from Async(default) with arguments: "540e293e-781f-4772-867b-567990ce6603"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [313571bc-dea2-4e15-b147-d89668973e4c]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "540e293e-781f-4772-867b-567990ce6603"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [313571bc-dea2-4e15-b147-d89668973e4c] Error performing ReleaseJob (Job ID: 313571bc-dea2-4e15-b147-d89668973e4c) from Async(default) in 6.79ms: ApplicationEvent::ValidationError (release_uid: must be filled,error: must be a string):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:28:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:34:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:29:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:39:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3b5afaaa-738b-47b3-b782-9d717e62f577"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 4beae14b-bcbf-4fc2-bb42-088ef5dbda2f\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:48:02.017674"], ["updated_at", "2018-09-28 04:48:02.017674"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "4beae14b-bcbf-4fc2-bb42-088ef5dbda2f"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:48:02.022315"], ["updated_at", "2018-09-28 04:48:02.022315"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 0a33231f-747f-444b-8d0c-71b01b17dea4) to Async(default) with arguments: "3b5afaaa-738b-47b3-b782-9d717e62f577"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [0a33231f-747f-444b-8d0c-71b01b17dea4] Performing BuildAutoReleaseJob (Job ID: 0a33231f-747f-444b-8d0c-71b01b17dea4) from Async(default) with arguments: "3b5afaaa-738b-47b3-b782-9d717e62f577"
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [0a33231f-747f-444b-8d0c-71b01b17dea4]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "3b5afaaa-738b-47b3-b782-9d717e62f577"], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [0a33231f-747f-444b-8d0c-71b01b17dea4] Performed BuildAutoReleaseJob (Job ID: 0a33231f-747f-444b-8d0c-71b01b17dea4) from Async(default) in 0.54ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:48:10.489376', '2018-09-28 04:48:10.489376')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:48:10.491377', '2018-09-28 04:48:10.491377')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:48:10.493095', '2018-09-28 04:48:10.493095', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:48:10.494581', '2018-09-28 04:48:10.494581')[0m
  [1m[35m (4.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2d4895d8-461d-4918-a8d3-19038cd6e000"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 708b2ac0-0d39-402f-9e2d-3885c442038a\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:48:10.525612"], ["updated_at", "2018-09-28 04:48:10.525612"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "708b2ac0-0d39-402f-9e2d-3885c442038a"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:48:10.531452"], ["updated_at", "2018-09-28 04:48:10.531452"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: c10620d7-2f38-4465-a396-64df5db55f8e) to Async(default) with arguments: "2d4895d8-461d-4918-a8d3-19038cd6e000"
[ActiveJob] [BuildAutoReleaseJob] [c10620d7-2f38-4465-a396-64df5db55f8e] Performing BuildAutoReleaseJob (Job ID: c10620d7-2f38-4465-a396-64df5db55f8e) from Async(default) with arguments: "2d4895d8-461d-4918-a8d3-19038cd6e000"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8c8307b5-228e-418a-8031-d6db4cf49952"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: f0a1ab52-c7f2-4f81-b7d7-cedee5ca9c81\n"], ["created_at", "2018-09-28 04:48:10.539826"], ["updated_at", "2018-09-28 04:48:10.539826"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [c10620d7-2f38-4465-a396-64df5db55f8e]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "2d4895d8-461d-4918-a8d3-19038cd6e000"], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [c10620d7-2f38-4465-a396-64df5db55f8e] Performed BuildAutoReleaseJob (Job ID: c10620d7-2f38-4465-a396-64df5db55f8e) from Async(default) in 9.4ms
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9450356b-9a50-44e7-abe5-d6bad44f7794"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:48:10.545614"], ["updated_at", "2018-09-28 04:48:10.545614"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fa1e96a1-451f-4b39-9d90-604286be9f33"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:48:10.549707"], ["updated_at", "2018-09-28 04:48:10.549707"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "38de372a-7ef5-4efa-84e2-3c87dbef89ae"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: c3f372c3-24cb-4b7e-97a4-8997f10340f7\n"], ["created_at", "2018-09-28 04:48:10.554323"], ["updated_at", "2018-09-28 04:48:10.554323"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a65981c4-e817-4693-b643-7bdcf7770bc9"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: be77299a-7668-4cfa-99dc-6b96f7b13600\n"], ["created_at", "2018-09-28 04:48:10.557239"], ["updated_at", "2018-09-28 04:48:10.557239"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5987e653-f2a9-401a-96fc-4c234f9ab586"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:48:10.560328"], ["updated_at", "2018-09-28 04:48:10.560328"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0ad43518-bde1-4f46-93bb-8bf9d17a9dc8"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:48:10.562768"], ["updated_at", "2018-09-28 04:48:10.562768"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "148201bb-c96a-444e-9e56-872cf66e8c6a"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:48:10.566425"], ["updated_at", "2018-09-28 04:48:10.566425"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "76f07d91-f7b1-43a4-bdea-d94e57386ebd"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 2dab1c55-bd8f-437c-81f6-75b971ebd2d4\n"], ["created_at", "2018-09-28 04:48:10.569735"], ["updated_at", "2018-09-28 04:48:10.569735"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c114b0f3-93bf-41d6-be93-4fcf94777c3b"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: 71217fbe-aea2-48b8-b718-0caba3a70ee6\n"], ["created_at", "2018-09-28 04:48:10.574133"], ["updated_at", "2018-09-28 04:48:10.574133"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "71217fbe-aea2-48b8-b718-0caba3a70ee6"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:48:10.582761"], ["updated_at", "2018-09-28 04:48:10.582761"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: cac7c367-c116-4601-bd3c-a1d0ef747f6a) to Async(default) with arguments: "c114b0f3-93bf-41d6-be93-4fcf94777c3b"
[ActiveJob] [ReleaseJob] [cac7c367-c116-4601-bd3c-a1d0ef747f6a] Performing ReleaseJob (Job ID: cac7c367-c116-4601-bd3c-a1d0ef747f6a) from Async(default) with arguments: "c114b0f3-93bf-41d6-be93-4fcf94777c3b"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cac7c367-c116-4601-bd3c-a1d0ef747f6a]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "c114b0f3-93bf-41d6-be93-4fcf94777c3b"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [cac7c367-c116-4601-bd3c-a1d0ef747f6a] Error performing ReleaseJob (Job ID: cac7c367-c116-4601-bd3c-a1d0ef747f6a) from Async(default) in 5.75ms: NoMethodError (undefined method `release_uid' for #<Event:0x00000003d45a50>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:13:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:48:12.792629', '2018-09-28 04:48:12.792629')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:48:12.794882', '2018-09-28 04:48:12.794882')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:48:12.796847', '2018-09-28 04:48:12.796847', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:48:12.798320', '2018-09-28 04:48:12.798320')[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4f5fea54-2252-49a9-9727-4f23a4ac50e2"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: 1091927b-f246-412f-a43d-c5fc17a48010\n"], ["created_at", "2018-09-28 04:48:12.820222"], ["updated_at", "2018-09-28 04:48:12.820222"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1091927b-f246-412f-a43d-c5fc17a48010"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:48:12.828671"], ["updated_at", "2018-09-28 04:48:12.828671"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: d97bfe60-174a-4e76-9a59-c05832ab1693) to Async(default) with arguments: "4f5fea54-2252-49a9-9727-4f23a4ac50e2"
[ActiveJob] [ReleaseJob] [d97bfe60-174a-4e76-9a59-c05832ab1693] Performing ReleaseJob (Job ID: d97bfe60-174a-4e76-9a59-c05832ab1693) from Async(default) with arguments: "4f5fea54-2252-49a9-9727-4f23a4ac50e2"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
[ActiveJob] [ReleaseJob] [d97bfe60-174a-4e76-9a59-c05832ab1693]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "4f5fea54-2252-49a9-9727-4f23a4ac50e2"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [d97bfe60-174a-4e76-9a59-c05832ab1693] Error performing ReleaseJob (Job ID: d97bfe60-174a-4e76-9a59-c05832ab1693) from Async(default) in 7.23ms: ApplicationEvent::ValidationError (release_uid: must be filled,error: must be a string):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:28:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:34:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:29:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:39:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "409b515f-51da-4df3-a168-779f1b70f086"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 55ac7e96-2733-4ad8-af08-286c69c11978\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:48:12.848011"], ["updated_at", "2018-09-28 04:48:12.848011"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "55ac7e96-2733-4ad8-af08-286c69c11978"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:48:12.853284"], ["updated_at", "2018-09-28 04:48:12.853284"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 8187361c-6954-4d99-9406-2f113bf50605) to Async(default) with arguments: "409b515f-51da-4df3-a168-779f1b70f086"
[ActiveJob] [BuildAutoReleaseJob] [8187361c-6954-4d99-9406-2f113bf50605] Performing BuildAutoReleaseJob (Job ID: 8187361c-6954-4d99-9406-2f113bf50605) from Async(default) with arguments: "409b515f-51da-4df3-a168-779f1b70f086"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [8187361c-6954-4d99-9406-2f113bf50605]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "409b515f-51da-4df3-a168-779f1b70f086"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [8187361c-6954-4d99-9406-2f113bf50605] Error performing BuildAutoReleaseJob (Job ID: 8187361c-6954-4d99-9406-2f113bf50605) from Async(default) in 6.49ms: NoMethodError (undefined method `app_uid' for #<Event:0x000000052b46c0>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/build_auto_release_job.rb:8:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0c12b3ab-8a1c-44fb-865e-7418b7d2c3ad"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 558270b2-2a91-4937-91c8-92114d3336b4\n"], ["created_at", "2018-09-28 04:48:12.865303"], ["updated_at", "2018-09-28 04:48:12.865303"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "72914392-7a67-4f8f-b6d5-3daac546fc9c"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: f5608411-5cbe-444f-963a-8184fe3df843\n"], ["created_at", "2018-09-28 04:48:12.868925"], ["updated_at", "2018-09-28 04:48:12.868925"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0cb97f99-db1a-46ef-a065-9c3ceaa8c09a"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:48:12.872859"], ["updated_at", "2018-09-28 04:48:12.872859"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9b77c755-5217-47e7-bc23-e6a470a51285"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:48:12.876441"], ["updated_at", "2018-09-28 04:48:12.876441"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "10c527c8-5ca0-4dfd-b856-aeb68978d54d"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:48:12.879647"], ["updated_at", "2018-09-28 04:48:12.879647"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8e9c90b6-8faa-482d-bb66-0e7294cb5536"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:48:12.882471"], ["updated_at", "2018-09-28 04:48:12.882471"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dc29e10b-106d-4942-8f49-bd6e01daa567"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:48:12.885487"], ["updated_at", "2018-09-28 04:48:12.885487"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c80f2ac2-6361-4f3a-b842-a908e4b05852"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: cad7c110-f448-4eb1-b1fb-1fb3a88eb21e\n"], ["created_at", "2018-09-28 04:48:12.890809"], ["updated_at", "2018-09-28 04:48:12.890809"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c2bbfd39-40ac-4e9d-9c9b-fe199999abca"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 59feb24e-c546-46af-875a-8777e7c7f457\n"], ["created_at", "2018-09-28 04:48:12.894687"], ["updated_at", "2018-09-28 04:48:12.894687"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:48:14.615786', '2018-09-28 04:48:14.615786')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:48:14.617502', '2018-09-28 04:48:14.617502')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:48:14.619094', '2018-09-28 04:48:14.619094', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:48:14.620607', '2018-09-28 04:48:14.620607')[0m
  [1m[35m (6.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dacc129e-fb51-4357-8466-61c4957ec8db"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: d71663ec-885c-4865-bc33-0b4d486b3a4f\n"], ["created_at", "2018-09-28 04:48:14.645782"], ["updated_at", "2018-09-28 04:48:14.645782"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d71663ec-885c-4865-bc33-0b4d486b3a4f"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:48:14.654127"], ["updated_at", "2018-09-28 04:48:14.654127"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 76f7064e-63e2-4097-9258-9586bf3b367f) to Async(default) with arguments: "dacc129e-fb51-4357-8466-61c4957ec8db"
[ActiveJob] [ReleaseJob] [76f7064e-63e2-4097-9258-9586bf3b367f] Performing ReleaseJob (Job ID: 76f7064e-63e2-4097-9258-9586bf3b367f) from Async(default) with arguments: "dacc129e-fb51-4357-8466-61c4957ec8db"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [76f7064e-63e2-4097-9258-9586bf3b367f]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "dacc129e-fb51-4357-8466-61c4957ec8db"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [76f7064e-63e2-4097-9258-9586bf3b367f] Error performing ReleaseJob (Job ID: 76f7064e-63e2-4097-9258-9586bf3b367f) from Async(default) in 10.95ms: ApplicationEvent::ValidationError (release_uid: must be filled,error: must be a string):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:28:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:34:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:29:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:39:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7090a08b-81fb-4845-8810-417f2ae97525"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: f8c2b971-48ce-4bb5-97b3-b33344848f2b\n"], ["created_at", "2018-09-28 04:48:14.668363"], ["updated_at", "2018-09-28 04:48:14.668363"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5f063996-d95f-4192-81b2-e6cf44ec2f7a"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: af946033-7317-43f3-b7fe-85507b6ace34\n"], ["created_at", "2018-09-28 04:48:14.672467"], ["updated_at", "2018-09-28 04:48:14.672467"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7ad289ce-28a0-4d49-b46b-15b64764d7f0"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:48:14.675647"], ["updated_at", "2018-09-28 04:48:14.675647"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "889be8c7-7155-4e6c-957d-76a35146b895"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:48:14.678801"], ["updated_at", "2018-09-28 04:48:14.678801"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ce7308db-4131-4634-a5bc-f2aaa6d503aa"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:48:14.686465"], ["updated_at", "2018-09-28 04:48:14.686465"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5045621b-e351-4e69-ab82-e9f1c255a85a"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:48:14.691702"], ["updated_at", "2018-09-28 04:48:14.691702"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e28b5e08-a0a0-4bcb-b655-7ea236016897"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 9aed95e0-caeb-4284-8fb6-c9c4a5c3be73\n"], ["created_at", "2018-09-28 04:48:14.694047"], ["updated_at", "2018-09-28 04:48:14.694047"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ddc9544a-34bf-4443-8bb2-d5da33c31f36"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:48:14.697486"], ["updated_at", "2018-09-28 04:48:14.697486"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1d79ddb9-2877-434f-a965-44ee98e2ac2c"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 2a52c70e-aec3-4705-a8eb-5ac82365bb2e\n"], ["created_at", "2018-09-28 04:48:14.700423"], ["updated_at", "2018-09-28 04:48:14.700423"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "00f1d96e-83a4-4dcd-8a08-30392dd0d173"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: d3746357-a0b7-4f02-a60a-e88c72acc53a\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:48:14.704845"], ["updated_at", "2018-09-28 04:48:14.704845"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "d3746357-a0b7-4f02-a60a-e88c72acc53a"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:48:14.709344"], ["updated_at", "2018-09-28 04:48:14.709344"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 017470ff-5c62-419c-bd56-2181633c1185) to Async(default) with arguments: "00f1d96e-83a4-4dcd-8a08-30392dd0d173"
[ActiveJob] [BuildAutoReleaseJob] [017470ff-5c62-419c-bd56-2181633c1185] Performing BuildAutoReleaseJob (Job ID: 017470ff-5c62-419c-bd56-2181633c1185) from Async(default) with arguments: "00f1d96e-83a4-4dcd-8a08-30392dd0d173"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [017470ff-5c62-419c-bd56-2181633c1185]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "00f1d96e-83a4-4dcd-8a08-30392dd0d173"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [017470ff-5c62-419c-bd56-2181633c1185] Error performing BuildAutoReleaseJob (Job ID: 017470ff-5c62-419c-bd56-2181633c1185) from Async(default) in 4.24ms: NoMethodError (undefined method `app_uid' for #<Event:0x00000004c77668>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/build_auto_release_job.rb:8:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:51:39.570614', '2018-09-28 04:51:39.570614')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:51:39.572870', '2018-09-28 04:51:39.572870')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:51:39.574753', '2018-09-28 04:51:39.574753', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:51:39.576436', '2018-09-28 04:51:39.576436')[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0d1f091b-0778-457c-9c51-2362a4bd3246"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 90e575ee-dcc1-45d3-9e88-50f43806e74b\n"], ["created_at", "2018-09-28 04:51:39.600493"], ["updated_at", "2018-09-28 04:51:39.600493"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e3fa66c5-9dbd-40bc-ba01-a13094572327"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:51:39.607716"], ["updated_at", "2018-09-28 04:51:39.607716"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "66395e07-b078-443a-8a25-41e6bf1caa3d"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 8da38ec6-824a-46fc-b39d-ba21566e9238\n"], ["created_at", "2018-09-28 04:51:39.610659"], ["updated_at", "2018-09-28 04:51:39.610659"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a7a23442-e823-4cc5-a575-11fc1deac241"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:51:39.613674"], ["updated_at", "2018-09-28 04:51:39.613674"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7a7722e2-74e5-4bb7-a1c8-f4d2ec90d241"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:51:39.618855"], ["updated_at", "2018-09-28 04:51:39.618855"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "370d60ee-89cf-40f6-b310-4d74f4373fe5"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:51:39.620863"], ["updated_at", "2018-09-28 04:51:39.620863"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "35ec26f1-f038-4587-84a3-10a16046b767"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 6be575d4-eec3-4332-b773-37009e19d512\n"], ["created_at", "2018-09-28 04:51:39.623183"], ["updated_at", "2018-09-28 04:51:39.623183"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "33021c9e-baf4-487d-a19f-182b1b63c965"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:51:39.626886"], ["updated_at", "2018-09-28 04:51:39.626886"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "19edf99c-0b44-41c9-88fb-384aaa1310fe"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: f69f29f4-08f1-40c2-83eb-f140cc9b41e2\n"], ["created_at", "2018-09-28 04:51:39.629620"], ["updated_at", "2018-09-28 04:51:39.629620"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ccfb450e-f497-4a3a-979c-279becf9f2ad"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: 7fe1c405-7c39-49eb-b25e-ee470158aad6\n"], ["created_at", "2018-09-28 04:51:39.650556"], ["updated_at", "2018-09-28 04:51:39.650556"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7fe1c405-7c39-49eb-b25e-ee470158aad6"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:51:39.658974"], ["updated_at", "2018-09-28 04:51:39.658974"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 70fd96e7-449b-4799-81ea-bc95fd69cad8) to Async(default) with arguments: "ccfb450e-f497-4a3a-979c-279becf9f2ad"
[ActiveJob] [ReleaseJob] [70fd96e7-449b-4799-81ea-bc95fd69cad8] Performing ReleaseJob (Job ID: 70fd96e7-449b-4799-81ea-bc95fd69cad8) from Async(default) with arguments: "ccfb450e-f497-4a3a-979c-279becf9f2ad"
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [70fd96e7-449b-4799-81ea-bc95fd69cad8]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "ccfb450e-f497-4a3a-979c-279becf9f2ad"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [70fd96e7-449b-4799-81ea-bc95fd69cad8] Error performing ReleaseJob (Job ID: 70fd96e7-449b-4799-81ea-bc95fd69cad8) from Async(default) in 9.01ms: ApplicationEvent::ValidationError (release_uid: must be filled,error: must be a string):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:28:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:34:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:29:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:39:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "83d39693-a4f1-4eea-9a8b-77ad04a1c9c8"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 9ec8f78e-35f7-49b4-b2c3-96e7ac71cafd\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:51:39.671701"], ["updated_at", "2018-09-28 04:51:39.671701"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "9ec8f78e-35f7-49b4-b2c3-96e7ac71cafd"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:51:39.676527"], ["updated_at", "2018-09-28 04:51:39.676527"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 38234784-573c-4136-91bc-4d57d9be4ea5) to Async(default) with arguments: "83d39693-a4f1-4eea-9a8b-77ad04a1c9c8"
[ActiveJob] [BuildAutoReleaseJob] [38234784-573c-4136-91bc-4d57d9be4ea5] Performing BuildAutoReleaseJob (Job ID: 38234784-573c-4136-91bc-4d57d9be4ea5) from Async(default) with arguments: "83d39693-a4f1-4eea-9a8b-77ad04a1c9c8"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [38234784-573c-4136-91bc-4d57d9be4ea5]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "83d39693-a4f1-4eea-9a8b-77ad04a1c9c8"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [38234784-573c-4136-91bc-4d57d9be4ea5] Error performing BuildAutoReleaseJob (Job ID: 38234784-573c-4136-91bc-4d57d9be4ea5) from Async(default) in 4.86ms: NoMethodError (undefined method `app_uid' for #<Event:0x00000003d72000>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/build_auto_release_job.rb:8:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:52:15.567049', '2018-09-28 04:52:15.567049')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:52:15.569184', '2018-09-28 04:52:15.569184')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:52:15.571020', '2018-09-28 04:52:15.571020', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:52:15.572446', '2018-09-28 04:52:15.572446')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-09-28 04:52:15.573920', '2018-09-28 04:52:15.573920', 980190962)[0m
  [1m[35m (7.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0e1f66e5-3fa9-415c-9966-ad8c451e73e1"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: e24ecc6f-8e7c-4237-959b-13bfde80df7b\n"], ["created_at", "2018-09-28 04:52:15.591903"], ["updated_at", "2018-09-28 04:52:15.591903"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "539bafa4-85ac-44cd-aba6-8a62547345a5"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:52:15.599500"], ["updated_at", "2018-09-28 04:52:15.599500"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d6bfea34-f7ac-4259-8db2-53aa8b37c0a9"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:52:15.603303"], ["updated_at", "2018-09-28 04:52:15.603303"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8461f6fd-bf07-4600-a3a9-6d3d41d62f00"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:52:15.613142"], ["updated_at", "2018-09-28 04:52:15.613142"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "989ea8c7-674c-4c28-8e36-a92126cb7cc4"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: ee73badf-b8ee-4738-a68b-54b69b679330\n"], ["created_at", "2018-09-28 04:52:15.617817"], ["updated_at", "2018-09-28 04:52:15.617817"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d0c1f06d-3b5e-46bf-bd7b-3c6a98a6fda8"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 68c45435-dae4-44c0-bed9-901a0f78c96f\n"], ["created_at", "2018-09-28 04:52:15.622160"], ["updated_at", "2018-09-28 04:52:15.622160"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5b744a7c-6ad3-41ce-b1ec-030527f7847d"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: e9c4b4c6-a0de-486d-855a-8677204f551a\n"], ["created_at", "2018-09-28 04:52:15.626267"], ["updated_at", "2018-09-28 04:52:15.626267"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "35fe48fc-1300-4538-81e9-95a6ecdc9965"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:52:15.629042"], ["updated_at", "2018-09-28 04:52:15.629042"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7bfeb16b-1c42-424b-aa31-b4abe192566b"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:52:15.631542"], ["updated_at", "2018-09-28 04:52:15.631542"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dfa3685e-18ec-4ec3-a57d-2b952ddc2994"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 6d4f660b-e980-41b5-8539-301c6d952f99\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:52:15.641999"], ["updated_at", "2018-09-28 04:52:15.641999"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "6d4f660b-e980-41b5-8539-301c6d952f99"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:52:15.647099"], ["updated_at", "2018-09-28 04:52:15.647099"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 433046a1-9763-4c70-ab70-b4f4c7293803) to Async(default) with arguments: "dfa3685e-18ec-4ec3-a57d-2b952ddc2994"
[ActiveJob] [BuildAutoReleaseJob] [433046a1-9763-4c70-ab70-b4f4c7293803] Performing BuildAutoReleaseJob (Job ID: 433046a1-9763-4c70-ab70-b4f4c7293803) from Async(default) with arguments: "dfa3685e-18ec-4ec3-a57d-2b952ddc2994"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [433046a1-9763-4c70-ab70-b4f4c7293803]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "dfa3685e-18ec-4ec3-a57d-2b952ddc2994"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [433046a1-9763-4c70-ab70-b4f4c7293803] Performed BuildAutoReleaseJob (Job ID: 433046a1-9763-4c70-ab70-b4f4c7293803) from Async(default) in 6.34ms
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b79721d9-25d3-47bd-ada1-1f2fa21b63c1"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: 8941ea35-2aa6-4db0-8e20-d5a7978198a7\n"], ["created_at", "2018-09-28 04:52:15.656873"], ["updated_at", "2018-09-28 04:52:15.656873"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8941ea35-2aa6-4db0-8e20-d5a7978198a7"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:52:15.663558"], ["updated_at", "2018-09-28 04:52:15.663558"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [f5323c6d-be4c-41f6-b8b1-a485ce86737a] Performing ReleaseJob (Job ID: f5323c6d-be4c-41f6-b8b1-a485ce86737a) from Async(default) with arguments: "b79721d9-25d3-47bd-ada1-1f2fa21b63c1"
[ActiveJob] [ReleaseJob] [f5323c6d-be4c-41f6-b8b1-a485ce86737a]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "b79721d9-25d3-47bd-ada1-1f2fa21b63c1"], ["LIMIT", 1]]
[ActiveJob] Enqueued ReleaseJob (Job ID: f5323c6d-be4c-41f6-b8b1-a485ce86737a) to Async(default) with arguments: "b79721d9-25d3-47bd-ada1-1f2fa21b63c1"
[ActiveJob] [ReleaseJob] [f5323c6d-be4c-41f6-b8b1-a485ce86737a] Error performing ReleaseJob (Job ID: f5323c6d-be4c-41f6-b8b1-a485ce86737a) from Async(default) in 5.59ms: NoMethodError (undefined method `release_uid' for #<Event:0x00000004ce41c8>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:13:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "22f5bfdf-ab6a-4da3-939b-cc3e3e970589"], ["name", "Releases::DeployEvent"], ["params", "---\n:release_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:cluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:deploy_uid: 36c68689-aa12-4f26-9e30-b93097b543ad\n"], ["created_at", "2018-09-28 04:52:15.679298"], ["updated_at", "2018-09-28 04:52:15.679298"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:53:03.081344', '2018-09-28 04:53:03.081344')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:53:03.083469', '2018-09-28 04:53:03.083469')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:53:03.085334', '2018-09-28 04:53:03.085334', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:53:03.087070', '2018-09-28 04:53:03.087070')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-09-28 04:53:03.088556', '2018-09-28 04:53:03.088556', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "08558de7-70da-41ad-a3a5-59544d3e7790"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: a5417485-f421-455f-80be-515599f47e57\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:53:03.116648"], ["updated_at", "2018-09-28 04:53:03.116648"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a5417485-f421-455f-80be-515599f47e57"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:53:03.123023"], ["updated_at", "2018-09-28 04:53:03.123023"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 128ad7d5-30c5-437e-b55b-58d699eb22b7) to Async(default) with arguments: "08558de7-70da-41ad-a3a5-59544d3e7790"
[ActiveJob] [BuildAutoReleaseJob] [128ad7d5-30c5-437e-b55b-58d699eb22b7] Performing BuildAutoReleaseJob (Job ID: 128ad7d5-30c5-437e-b55b-58d699eb22b7) from Async(default) with arguments: "08558de7-70da-41ad-a3a5-59544d3e7790"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "926025c8-3ef5-473f-851f-2189063b33bd"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:53:03.132233"], ["updated_at", "2018-09-28 04:53:03.132233"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [128ad7d5-30c5-437e-b55b-58d699eb22b7]   [1m[36mEvent Load (0.9ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "08558de7-70da-41ad-a3a5-59544d3e7790"], ["LIMIT", 1]]
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [128ad7d5-30c5-437e-b55b-58d699eb22b7] Performed BuildAutoReleaseJob (Job ID: 128ad7d5-30c5-437e-b55b-58d699eb22b7) from Async(default) in 9.12ms
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "777a3bca-131f-4a2c-b319-2648c164f3d6"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: c1814260-cfbc-4f41-97e0-f7f418b06500\n"], ["created_at", "2018-09-28 04:53:03.138321"], ["updated_at", "2018-09-28 04:53:03.138321"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c4a920c9-5469-4e71-bd7f-a91d552bd1e9"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: ff4e715f-bf3e-414f-9bd9-c726cb653fa9\n"], ["created_at", "2018-09-28 04:53:03.141946"], ["updated_at", "2018-09-28 04:53:03.141946"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "57fb6902-b40a-44c8-b7a5-b5cb3da2b630"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:53:03.145205"], ["updated_at", "2018-09-28 04:53:03.145205"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8a01b561-af9c-4249-8c39-2c62e2419045"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:53:03.147958"], ["updated_at", "2018-09-28 04:53:03.147958"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0a836616-c35f-4e7c-a070-9ad0dcfac946"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 9cfb78cf-c678-4b2c-be51-f0333ba948d0\n"], ["created_at", "2018-09-28 04:53:03.151159"], ["updated_at", "2018-09-28 04:53:03.151159"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8d53884a-8eb9-42a4-9c9e-526d7009f32c"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 33d115c6-69c4-4220-842d-d14fe3c8fd5d\n"], ["created_at", "2018-09-28 04:53:03.154148"], ["updated_at", "2018-09-28 04:53:03.154148"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ef57f5b9-a0d0-47e2-9f9e-eba4a3217199"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:53:03.156853"], ["updated_at", "2018-09-28 04:53:03.156853"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fa368f69-dfed-41f9-9dfb-334875746856"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:53:03.159042"], ["updated_at", "2018-09-28 04:53:03.159042"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9e005fa2-813d-4d43-a914-7bc9108784d7"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: 170a398d-5d33-425b-abb3-65d0488a124e\n"], ["created_at", "2018-09-28 04:53:03.162677"], ["updated_at", "2018-09-28 04:53:03.162677"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "170a398d-5d33-425b-abb3-65d0488a124e"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:53:03.169006"], ["updated_at", "2018-09-28 04:53:03.169006"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 42e9b92d-944c-4c20-ad18-3be9a66e9a8d) to Async(default) with arguments: "9e005fa2-813d-4d43-a914-7bc9108784d7"
[ActiveJob] [ReleaseJob] [42e9b92d-944c-4c20-ad18-3be9a66e9a8d] Performing ReleaseJob (Job ID: 42e9b92d-944c-4c20-ad18-3be9a66e9a8d) from Async(default) with arguments: "9e005fa2-813d-4d43-a914-7bc9108784d7"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [42e9b92d-944c-4c20-ad18-3be9a66e9a8d]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "9e005fa2-813d-4d43-a914-7bc9108784d7"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [42e9b92d-944c-4c20-ad18-3be9a66e9a8d] Error performing ReleaseJob (Job ID: 42e9b92d-944c-4c20-ad18-3be9a66e9a8d) from Async(default) in 5.86ms: NoMethodError (undefined method `release_uid' for #<Event:0x00000004ac57e8>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:13:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5f3d0e4b-4b26-493b-bd3b-ebe89f41df6d"], ["name", "Releases::DeployEvent"], ["params", "---\n:release_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:cluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:deploy_uid: 7ab23096-7b4a-4080-912d-67574ef5f85c\n"], ["created_at", "2018-09-28 04:53:03.184826"], ["updated_at", "2018-09-28 04:53:03.184826"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:53:29.278719', '2018-09-28 04:53:29.278719')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:53:29.280906', '2018-09-28 04:53:29.280906')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:53:29.282719', '2018-09-28 04:53:29.282719', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:53:29.284089', '2018-09-28 04:53:29.284089')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-09-28 04:53:29.285489', '2018-09-28 04:53:29.285489', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8ea6bab1-6a09-48fc-9507-c9720498984c"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 1e72ed27-de79-4f2c-90b2-a366ec8a3ead\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:53:29.312842"], ["updated_at", "2018-09-28 04:53:29.312842"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "1e72ed27-de79-4f2c-90b2-a366ec8a3ead"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:53:29.318772"], ["updated_at", "2018-09-28 04:53:29.318772"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 634b9330-ec43-4187-b93f-7ad34f510286) to Async(default) with arguments: "8ea6bab1-6a09-48fc-9507-c9720498984c"
[ActiveJob] [BuildAutoReleaseJob] [634b9330-ec43-4187-b93f-7ad34f510286] Performing BuildAutoReleaseJob (Job ID: 634b9330-ec43-4187-b93f-7ad34f510286) from Async(default) with arguments: "8ea6bab1-6a09-48fc-9507-c9720498984c"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "151d04ed-0645-49fb-8d04-e64668910442"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:53:29.326928"], ["updated_at", "2018-09-28 04:53:29.326928"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [BuildAutoReleaseJob] [634b9330-ec43-4187-b93f-7ad34f510286]   [1m[36mEvent Load (0.4ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "8ea6bab1-6a09-48fc-9507-c9720498984c"], ["LIMIT", 1]]
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [634b9330-ec43-4187-b93f-7ad34f510286] Performed BuildAutoReleaseJob (Job ID: 634b9330-ec43-4187-b93f-7ad34f510286) from Async(default) in 8.24ms
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "439512ed-f1e9-4826-bd0a-7e92486c53d9"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:53:29.331071"], ["updated_at", "2018-09-28 04:53:29.331071"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "77cdb5ac-6d5e-43e4-bbe2-61819d90d06d"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:53:29.334230"], ["updated_at", "2018-09-28 04:53:29.334230"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "111a945e-75d0-4bfb-8503-d037c61f0362"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:53:29.338988"], ["updated_at", "2018-09-28 04:53:29.338988"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a7ec2e49-45aa-4f63-b7b9-190dd9c4d251"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 7ff45bcb-84cf-4be5-9e73-84f4df1ce90d\n"], ["created_at", "2018-09-28 04:53:29.341856"], ["updated_at", "2018-09-28 04:53:29.341856"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b7520c47-dbe9-410c-aefa-542083b0cfe9"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 97f84103-473c-4870-bd35-76c24cdcdf8c\n"], ["created_at", "2018-09-28 04:53:29.345034"], ["updated_at", "2018-09-28 04:53:29.345034"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a53a7584-a403-4678-bb9d-688e6c6fea8d"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:53:29.349285"], ["updated_at", "2018-09-28 04:53:29.349285"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dbe8389f-97f0-47e3-8a25-3612e723c9ff"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 2009c78f-cb0a-4ad5-ba77-3334491151c4\n"], ["created_at", "2018-09-28 04:53:29.352403"], ["updated_at", "2018-09-28 04:53:29.352403"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cf38effd-3e6b-428e-9b72-664e348da1bb"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 2a7c43f9-44fa-419b-9dbf-dedc1f74415a\n"], ["created_at", "2018-09-28 04:53:29.355419"], ["updated_at", "2018-09-28 04:53:29.355419"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f736413f-dc69-46d2-a034-023c59b2024b"], ["name", "Releases::DeployEvent"], ["params", "---\n:release_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:cluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:deploy_uid: a7843d34-83bf-4135-820d-fc48729cd5ad\n"], ["created_at", "2018-09-28 04:53:29.367751"], ["updated_at", "2018-09-28 04:53:29.367751"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "56e10e7c-a031-4a93-a332-3edbd6ac5839"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: c1eea5fc-5284-4ff8-8d56-df1eb071757f\n"], ["created_at", "2018-09-28 04:53:29.378853"], ["updated_at", "2018-09-28 04:53:29.378853"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c1eea5fc-5284-4ff8-8d56-df1eb071757f"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:53:29.382268"], ["updated_at", "2018-09-28 04:53:29.382268"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 76d1897e-b64f-4d33-9e0e-f20a32e48385) to Async(default) with arguments: "56e10e7c-a031-4a93-a332-3edbd6ac5839"
[ActiveJob] [ReleaseJob] [76d1897e-b64f-4d33-9e0e-f20a32e48385] Performing ReleaseJob (Job ID: 76d1897e-b64f-4d33-9e0e-f20a32e48385) from Async(default) with arguments: "56e10e7c-a031-4a93-a332-3edbd6ac5839"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [76d1897e-b64f-4d33-9e0e-f20a32e48385]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "56e10e7c-a031-4a93-a332-3edbd6ac5839"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [76d1897e-b64f-4d33-9e0e-f20a32e48385] Error performing ReleaseJob (Job ID: 76d1897e-b64f-4d33-9e0e-f20a32e48385) from Async(default) in 5.8ms: NoMethodError (undefined method `release_uid' for #<Event:0x00000004d66c40>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:13:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:53:53.392765', '2018-09-28 04:53:53.392765')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:53:53.395431', '2018-09-28 04:53:53.395431')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:53:53.397082', '2018-09-28 04:53:53.397082', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:53:53.398532', '2018-09-28 04:53:53.398532')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-09-28 04:53:53.400035', '2018-09-28 04:53:53.400035', 980190962)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9cc72d21-f1b4-4d47-874e-b4283388c6c2"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: d4de36b7-4e97-403d-8776-0e3c9a9d25cf\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:53:53.428528"], ["updated_at", "2018-09-28 04:53:53.428528"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "d4de36b7-4e97-403d-8776-0e3c9a9d25cf"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:53:53.434646"], ["updated_at", "2018-09-28 04:53:53.434646"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: aa473384-445a-463a-94b6-c75993dec68c) to Async(default) with arguments: "9cc72d21-f1b4-4d47-874e-b4283388c6c2"
[ActiveJob] [BuildAutoReleaseJob] [aa473384-445a-463a-94b6-c75993dec68c] Performing BuildAutoReleaseJob (Job ID: aa473384-445a-463a-94b6-c75993dec68c) from Async(default) with arguments: "9cc72d21-f1b4-4d47-874e-b4283388c6c2"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
[ActiveJob] [BuildAutoReleaseJob] [aa473384-445a-463a-94b6-c75993dec68c]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "9cc72d21-f1b4-4d47-874e-b4283388c6c2"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [aa473384-445a-463a-94b6-c75993dec68c] Performed BuildAutoReleaseJob (Job ID: aa473384-445a-463a-94b6-c75993dec68c) from Async(default) in 6.07ms
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "67fc122f-809e-493d-887e-df1c0689c44a"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: e7a4c5bf-6ecc-491b-b97e-f0a0126a4a05\n"], ["created_at", "2018-09-28 04:53:53.445000"], ["updated_at", "2018-09-28 04:53:53.445000"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e7a4c5bf-6ecc-491b-b97e-f0a0126a4a05"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:53:53.451213"], ["updated_at", "2018-09-28 04:53:53.451213"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 2d8a67ca-19ca-4b2f-83e3-2eff88ba5129) to Async(default) with arguments: "67fc122f-809e-493d-887e-df1c0689c44a"
[ActiveJob] [ReleaseJob] [2d8a67ca-19ca-4b2f-83e3-2eff88ba5129] Performing ReleaseJob (Job ID: 2d8a67ca-19ca-4b2f-83e3-2eff88ba5129) from Async(default) with arguments: "67fc122f-809e-493d-887e-df1c0689c44a"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [2d8a67ca-19ca-4b2f-83e3-2eff88ba5129]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "67fc122f-809e-493d-887e-df1c0689c44a"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [2d8a67ca-19ca-4b2f-83e3-2eff88ba5129] Error performing ReleaseJob (Job ID: 2d8a67ca-19ca-4b2f-83e3-2eff88ba5129) from Async(default) in 5.64ms: NoMethodError (undefined method `release_uid' for #<Event:0x00000004046060>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:13:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b3a2168e-8043-4790-bc0a-984099022c1f"], ["name", "Releases::DeployEvent"], ["params", "---\n:release_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:cluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:deploy_uid: 35c29921-1730-45c4-ab93-86bbb0885f16\n"], ["created_at", "2018-09-28 04:53:53.466325"], ["updated_at", "2018-09-28 04:53:53.466325"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "35c29921-1730-45c4-ab93-86bbb0885f16"], ["status", "PENDING"], ["created_at", "2018-09-28 04:53:53.475081"], ["updated_at", "2018-09-28 04:53:53.475081"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "91a2c8af-9697-4c2d-bbd2-58b98eb944df"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: b5ad0cc9-b28d-4649-8043-a17d9a478dd3\n"], ["created_at", "2018-09-28 04:53:53.478055"], ["updated_at", "2018-09-28 04:53:53.478055"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dd0aeb1f-ab3f-4414-b6a8-63da8e82aee0"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 39627a01-09d4-45d5-a4ba-8f9034d4bf0b\n"], ["created_at", "2018-09-28 04:53:53.481595"], ["updated_at", "2018-09-28 04:53:53.481595"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9b9d782a-f171-49bb-b02e-0770ce9020b5"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 4488b7fa-0d4f-4996-b62a-2ccd94513473\n"], ["created_at", "2018-09-28 04:53:53.484790"], ["updated_at", "2018-09-28 04:53:53.484790"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "16565d40-0846-4f47-80e4-f07ddf4f0d17"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:53:53.488518"], ["updated_at", "2018-09-28 04:53:53.488518"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "261351a8-5591-478a-a906-3f69e62e0d7f"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: d572ab01-580f-4804-a702-b2b907a29fa2\n"], ["created_at", "2018-09-28 04:53:53.490676"], ["updated_at", "2018-09-28 04:53:53.490676"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ba91d506-26c1-4a8a-9180-29ea5a9c99fe"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:53:53.493418"], ["updated_at", "2018-09-28 04:53:53.493418"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1ae6fbf7-d331-4e65-abae-858714746d61"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:53:53.497165"], ["updated_at", "2018-09-28 04:53:53.497165"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "85c3c75f-e9f2-4f83-979c-23a4e3479052"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:53:53.499796"], ["updated_at", "2018-09-28 04:53:53.499796"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "530b18b7-c590-499a-a82d-acb360ee0d7d"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:53:53.502209"], ["updated_at", "2018-09-28 04:53:53.502209"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:53:58.685476', '2018-09-28 04:53:58.685476')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:53:58.687535', '2018-09-28 04:53:58.687535')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:53:58.689037', '2018-09-28 04:53:58.689037', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:53:58.690403', '2018-09-28 04:53:58.690403')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-09-28 04:53:58.691922', '2018-09-28 04:53:58.691922', 980190962)[0m
  [1m[35m (3.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "827b8db4-d78e-41c4-b784-964f1bd9301b"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:53:58.710436"], ["updated_at", "2018-09-28 04:53:58.710436"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "590b619d-d859-42bd-9087-8d30ecf544b4"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: f9c26133-0d74-4663-a69a-c012b1a55615\n"], ["created_at", "2018-09-28 04:53:58.719011"], ["updated_at", "2018-09-28 04:53:58.719011"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ca421493-c3c2-406e-858a-4ea83e731c01"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 18edc895-9a3e-475e-ab08-53cc28af89d8\n"], ["created_at", "2018-09-28 04:53:58.723316"], ["updated_at", "2018-09-28 04:53:58.723316"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c8789926-30b3-4a2b-a6e9-fe64a04723f3"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:53:58.725986"], ["updated_at", "2018-09-28 04:53:58.725986"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "df1322bc-331a-483c-b660-0651474aebd6"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:53:58.728999"], ["updated_at", "2018-09-28 04:53:58.728999"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f0896c17-23aa-4818-bca9-7383cc0d2b86"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:53:58.732154"], ["updated_at", "2018-09-28 04:53:58.732154"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4eef47da-2e90-470d-a6d3-8889612f83fb"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:53:58.734884"], ["updated_at", "2018-09-28 04:53:58.734884"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7da0d626-58c8-419f-b2f9-a0de6b0fcf7c"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 47a8fa4d-c5ba-4b2b-949e-09f17b2bcc3c\n"], ["created_at", "2018-09-28 04:53:58.738756"], ["updated_at", "2018-09-28 04:53:58.738756"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ae11cdc1-006f-49bf-b11c-0ce9f668ebbc"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: 6fd1dc0b-3846-4fe6-bc2e-8c31469928e6\n"], ["created_at", "2018-09-28 04:53:58.742013"], ["updated_at", "2018-09-28 04:53:58.742013"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4c1751e8-a00f-4663-b0f9-c9aff67d8c6a"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: 882e890e-f5b8-44ea-bf99-c9aac44b9604\n"], ["created_at", "2018-09-28 04:53:58.749677"], ["updated_at", "2018-09-28 04:53:58.749677"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "882e890e-f5b8-44ea-bf99-c9aac44b9604"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:53:58.756453"], ["updated_at", "2018-09-28 04:53:58.756453"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: ddd6b643-866d-40db-8f74-97c7e6a090c3) to Async(default) with arguments: "4c1751e8-a00f-4663-b0f9-c9aff67d8c6a"
[ActiveJob] [ReleaseJob] [ddd6b643-866d-40db-8f74-97c7e6a090c3] Performing ReleaseJob (Job ID: ddd6b643-866d-40db-8f74-97c7e6a090c3) from Async(default) with arguments: "4c1751e8-a00f-4663-b0f9-c9aff67d8c6a"
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "042ec66b-a6d5-4454-8af1-4bcd0a9f2f3e"], ["name", "Releases::DeployEvent"], ["params", "---\n:release_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:cluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:deploy_uid: 2dfec21a-11a6-4dfd-b05f-28e326c816ad\n"], ["created_at", "2018-09-28 04:53:58.768131"], ["updated_at", "2018-09-28 04:53:58.768131"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ddd6b643-866d-40db-8f74-97c7e6a090c3]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "4c1751e8-a00f-4663-b0f9-c9aff67d8c6a"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ddd6b643-866d-40db-8f74-97c7e6a090c3] Error performing ReleaseJob (Job ID: ddd6b643-866d-40db-8f74-97c7e6a090c3) from Async(default) in 21.22ms: ApplicationEvent::ValidationError (release_uid: must be filled,error: must be a string):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:28:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:34:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:29:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:39:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "2dfec21a-11a6-4dfd-b05f-28e326c816ad"], ["status", "PENDING"], ["created_at", "2018-09-28 04:53:58.781168"], ["updated_at", "2018-09-28 04:53:58.781168"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4a9905e9-afb9-4649-b035-4906aa0ab556"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: c6a5f82f-06b3-45cc-a1db-83895d1e03ce\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:53:58.785611"], ["updated_at", "2018-09-28 04:53:58.785611"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "c6a5f82f-06b3-45cc-a1db-83895d1e03ce"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:53:58.789662"], ["updated_at", "2018-09-28 04:53:58.789662"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 753eb14f-c42d-4072-a620-ab6ff3767c03) to Async(default) with arguments: "4a9905e9-afb9-4649-b035-4906aa0ab556"
[ActiveJob] [BuildAutoReleaseJob] [753eb14f-c42d-4072-a620-ab6ff3767c03] Performing BuildAutoReleaseJob (Job ID: 753eb14f-c42d-4072-a620-ab6ff3767c03) from Async(default) with arguments: "4a9905e9-afb9-4649-b035-4906aa0ab556"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [753eb14f-c42d-4072-a620-ab6ff3767c03]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "4a9905e9-afb9-4649-b035-4906aa0ab556"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [753eb14f-c42d-4072-a620-ab6ff3767c03] Error performing BuildAutoReleaseJob (Job ID: 753eb14f-c42d-4072-a620-ab6ff3767c03) from Async(default) in 4.6ms: NoMethodError (undefined method `app_uid' for #<Event:0x000000055a0b40>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/build_auto_release_job.rb:8:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:54:01.412335', '2018-09-28 04:54:01.412335')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:54:01.414419', '2018-09-28 04:54:01.414419')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:54:01.416083', '2018-09-28 04:54:01.416083', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:54:01.417567', '2018-09-28 04:54:01.417567')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-09-28 04:54:01.419001', '2018-09-28 04:54:01.419001', 980190962)[0m
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3b3003c1-1ae0-427d-a3ad-7261f7b00d80"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: fe8eec70-526b-42cd-9917-099ebb7b63d4\n"], ["created_at", "2018-09-28 04:54:01.433948"], ["updated_at", "2018-09-28 04:54:01.433948"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5d15d26d-f0d4-408b-bb25-75f7c3b3d2d3"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 133d55c9-520c-4966-8027-7bf2c43fa3df\n"], ["created_at", "2018-09-28 04:54:01.443441"], ["updated_at", "2018-09-28 04:54:01.443441"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fe58fe00-84e9-4be9-ac1f-1adf7c348fcb"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: f0cbcaaf-3998-4507-95ce-4cf26b0b1c6c\n"], ["created_at", "2018-09-28 04:54:01.446826"], ["updated_at", "2018-09-28 04:54:01.446826"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "481e42ac-119c-4324-a49a-6a0e1e83f6a6"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 638aaa31-c46e-4bd5-bfa5-6e8ff7b50a7d\n"], ["created_at", "2018-09-28 04:54:01.452425"], ["updated_at", "2018-09-28 04:54:01.452425"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5502fad5-3929-448b-a535-5860c6f16914"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:54:01.455185"], ["updated_at", "2018-09-28 04:54:01.455185"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b8461710-35a5-48dd-8b9e-ab93aba6b945"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:54:01.458293"], ["updated_at", "2018-09-28 04:54:01.458293"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e396e7fc-1225-424f-aa22-dadcf4f19936"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:54:01.461418"], ["updated_at", "2018-09-28 04:54:01.461418"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ba7fadbe-4f91-4f2d-b088-7f59c2d61541"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:54:01.466007"], ["updated_at", "2018-09-28 04:54:01.466007"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f40a238f-0af9-44e3-9e7d-ceed6193b7f5"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:54:01.469383"], ["updated_at", "2018-09-28 04:54:01.469383"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d1b27a28-9c2a-4b51-9b41-93eb716ef8e7"], ["name", "Releases::DeployEvent"], ["params", "---\n:release_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:cluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:deploy_uid: 98cce157-237b-4154-b976-cd36ab6dfe5a\n"], ["created_at", "2018-09-28 04:54:01.480495"], ["updated_at", "2018-09-28 04:54:01.480495"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "98cce157-237b-4154-b976-cd36ab6dfe5a"], ["status", "PENDING"], ["created_at", "2018-09-28 04:54:01.490192"], ["updated_at", "2018-09-28 04:54:01.490192"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c316eb76-b48e-4a54-bc41-9f09a5132dd4"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: 7e9338e9-67af-4065-982f-f9cb4fe207d6\n"], ["created_at", "2018-09-28 04:54:01.497616"], ["updated_at", "2018-09-28 04:54:01.497616"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7e9338e9-67af-4065-982f-f9cb4fe207d6"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:54:01.501205"], ["updated_at", "2018-09-28 04:54:01.501205"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 86aba85e-d545-40af-8fcd-248fd61f4471) to Async(default) with arguments: "c316eb76-b48e-4a54-bc41-9f09a5132dd4"
[ActiveJob] [ReleaseJob] [86aba85e-d545-40af-8fcd-248fd61f4471] Performing ReleaseJob (Job ID: 86aba85e-d545-40af-8fcd-248fd61f4471) from Async(default) with arguments: "c316eb76-b48e-4a54-bc41-9f09a5132dd4"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aa5a948b-45b3-488d-b171-258e521523ef"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: ecc17f6d-bc94-4448-bb1c-99f3764221c0\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:54:01.510008"], ["updated_at", "2018-09-28 04:54:01.510008"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [86aba85e-d545-40af-8fcd-248fd61f4471]   [1m[36mEvent Load (0.9ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "c316eb76-b48e-4a54-bc41-9f09a5132dd4"], ["LIMIT", 1]]
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [86aba85e-d545-40af-8fcd-248fd61f4471] Error performing ReleaseJob (Job ID: 86aba85e-d545-40af-8fcd-248fd61f4471) from Async(default) in 10.18ms: ApplicationEvent::ValidationError (release_uid: must be filled,error: must be a string):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:28:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:34:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:29:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:39:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "ecc17f6d-bc94-4448-bb1c-99f3764221c0"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:54:01.516677"], ["updated_at", "2018-09-28 04:54:01.516677"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 5faeba68-7470-435b-a37b-5d3d54ac29b8) to Async(default) with arguments: "aa5a948b-45b3-488d-b171-258e521523ef"
[ActiveJob] [BuildAutoReleaseJob] [5faeba68-7470-435b-a37b-5d3d54ac29b8] Performing BuildAutoReleaseJob (Job ID: 5faeba68-7470-435b-a37b-5d3d54ac29b8) from Async(default) with arguments: "aa5a948b-45b3-488d-b171-258e521523ef"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [5faeba68-7470-435b-a37b-5d3d54ac29b8]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "aa5a948b-45b3-488d-b171-258e521523ef"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [BuildAutoReleaseJob] [5faeba68-7470-435b-a37b-5d3d54ac29b8] Error performing BuildAutoReleaseJob (Job ID: 5faeba68-7470-435b-a37b-5d3d54ac29b8) from Async(default) in 5.13ms: NoMethodError (undefined method `app_uid' for #<Event:0x00000004dabac0>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/build_auto_release_job.rb:8:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-09-28 04:54:13.788801', '2018-09-28 04:54:13.788801')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-09-28 04:54:13.790941', '2018-09-28 04:54:13.790941')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-09-28 04:54:13.792462', '2018-09-28 04:54:13.792462', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-09-28 04:54:13.794014', '2018-09-28 04:54:13.794014')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-09-28 04:54:13.795384', '2018-09-28 04:54:13.795384', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5c76ff84-2fed-4db6-9215-bb17f69262db"], ["name", "Builds::CreatedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:build_uid: 161dfe12-4fe9-4ae9-9c98-0bb833007ce5\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:version: v1\n:values:\n  :image:\n    :repository: nginx\n    :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:54:13.824143"], ["updated_at", "2018-09-28 04:54:13.824143"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "161dfe12-4fe9-4ae9-9c98-0bb833007ce5"], ["version", "v1"], ["values", "---\n:image:\n  :repository: nginx\n  :tag: asdfasdf\n"], ["created_at", "2018-09-28 04:54:13.830328"], ["updated_at", "2018-09-28 04:54:13.830328"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued BuildAutoReleaseJob (Job ID: 43622c18-714a-4022-a688-80667f8bc403) to Async(default) with arguments: "5c76ff84-2fed-4db6-9215-bb17f69262db"
[ActiveJob] [BuildAutoReleaseJob] [43622c18-714a-4022-a688-80667f8bc403] Performing BuildAutoReleaseJob (Job ID: 43622c18-714a-4022-a688-80667f8bc403) from Async(default) with arguments: "5c76ff84-2fed-4db6-9215-bb17f69262db"
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [43622c18-714a-4022-a688-80667f8bc403]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "5c76ff84-2fed-4db6-9215-bb17f69262db"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [BuildAutoReleaseJob] [43622c18-714a-4022-a688-80667f8bc403] Performed BuildAutoReleaseJob (Job ID: 43622c18-714a-4022-a688-80667f8bc403) from Async(default) in 9.67ms
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f1431e24-4384-43cc-bf12-b0270f09c566"], ["name", "Releases::DeployEvent"], ["params", "---\n:release_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:cluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\n:deploy_uid: 12aaeaae-0ac5-4e9a-bd7f-902c704d2698\n"], ["created_at", "2018-09-28 04:54:13.848170"], ["updated_at", "2018-09-28 04:54:13.848170"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "12aaeaae-0ac5-4e9a-bd7f-902c704d2698"], ["status", "PENDING"], ["created_at", "2018-09-28 04:54:13.857420"], ["updated_at", "2018-09-28 04:54:13.857420"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5dc1de8b-1c02-463e-adcb-c00331451730"], ["name", "Releases::CreatedEvent"], ["params", "---\n:build_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\n:release_uid: 4d5a2d29-33a6-43f0-812a-67d4a7aadc32\n"], ["created_at", "2018-09-28 04:54:13.860485"], ["updated_at", "2018-09-28 04:54:13.860485"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d5a2d29-33a6-43f0-812a-67d4a7aadc32"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-09-28 04:54:13.864433"], ["updated_at", "2018-09-28 04:54:13.864433"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ReleaseJob (Job ID: 1662d6dd-1214-4f62-9aff-417aa3e6c553) to Async(default) with arguments: "5dc1de8b-1c02-463e-adcb-c00331451730"
[ActiveJob] [ReleaseJob] [1662d6dd-1214-4f62-9aff-417aa3e6c553] Performing ReleaseJob (Job ID: 1662d6dd-1214-4f62-9aff-417aa3e6c553) from Async(default) with arguments: "5dc1de8b-1c02-463e-adcb-c00331451730"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [1662d6dd-1214-4f62-9aff-417aa3e6c553]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "5dc1de8b-1c02-463e-adcb-c00331451730"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [1662d6dd-1214-4f62-9aff-417aa3e6c553] Error performing ReleaseJob (Job ID: 1662d6dd-1214-4f62-9aff-417aa3e6c553) from Async(default) in 5.38ms: NoMethodError (undefined method `release_uid' for #<Event:0x00000004083e38>):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activemodel-5.1.6/lib/active_model/attribute_methods.rb:432:in `method_missing'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:13:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8adde27b-a614-4f88-b8c9-8329e6dcd248"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test2\n"], ["created_at", "2018-09-28 04:54:13.874204"], ["updated_at", "2018-09-28 04:54:13.874204"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6f6f7212-b321-47a4-9928-262adb6e8835"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 1d124779-c076-4737-b0a4-045801d77ce9\n"], ["created_at", "2018-09-28 04:54:13.878251"], ["updated_at", "2018-09-28 04:54:13.878251"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dd4cf092-bc39-411d-a778-ced49836d7bf"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: asdf\n"], ["created_at", "2018-09-28 04:54:13.880825"], ["updated_at", "2018-09-28 04:54:13.880825"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d161c95b-9edf-4c95-ab1f-84bf78dccc61"], ["name", "Apps::DeletedEvent::Cancelled"], ["params", "---\n:error: Couldn't find App\n"], ["created_at", "2018-09-28 04:54:13.882759"], ["updated_at", "2018-09-28 04:54:13.882759"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "08bc23a7-8536-4805-a776-56d1531b9979"], ["name", "test2"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n"], ["created_at", "2018-09-28 04:54:13.885889"], ["updated_at", "2018-09-28 04:54:13.885889"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "529fd678-2f7f-4182-b325-349ffe3d6809"], ["name", "test"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n:name: test\n:stage_uid: 1707974c-f396-461b-8d78-9b0495e851b2\n"], ["created_at", "2018-09-28 04:54:13.888944"], ["updated_at", "2018-09-28 04:54:13.888944"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1c5ddee2-43c6-4e15-8e5a-6111aa561ae5"], ["name", "Apps::DeletedEvent"], ["params", "---\n:app_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-09-28 04:54:13.892054"], ["updated_at", "2018-09-28 04:54:13.892054"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "283035d0-9ce8-4bb8-8b95-3f5819680adf"], ["name", "test"], ["params", "---\n:name: test\n:app_uid: d1155767-bc74-425a-ab03-7aa2fbe057f1\n"], ["created_at", "2018-09-28 04:54:13.895529"], ["updated_at", "2018-09-28 04:54:13.895529"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d4fd792a-0bcf-47e4-9b16-e25cdfb486d7"], ["name", "test2"], ["params", "---\n:stage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\n:name: test2\n:cluster_uid: 45315127-0a5e-46f5-bce4-e679a7d5e7e5\n"], ["created_at", "2018-09-28 04:54:13.899156"], ["updated_at", "2018-09-28 04:54:13.899156"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "apps"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "apps" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "builds"[0m
  [1m[35m (5.6ms)[0m  [1m[35mCREATE TABLE "builds" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "version" varchar NOT NULL, "values" text, "number" integer NOT NULL, "promoted" boolean DEFAULT 'f' NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_app_id" ON "builds" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_builds_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_builds_on_app_id' AND type='index'
[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE  INDEX "index_builds_on_stage_id" ON "builds" ("stage_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "clusters"[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "clusters" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "stage_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "values" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_app_id" ON "clusters" ("app_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_clusters_on_app_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_clusters_on_app_id' AND type='index'
[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE  INDEX "index_clusters_on_stage_id" ON "clusters" ("stage_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "deploys"[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "deploys" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "release_id" integer, "cluster_id" integer, "uid" varchar NOT NULL, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_cluster_id" ON "deploys" ("cluster_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_deploys_on_cluster_id' AND type='index'
[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE  INDEX "index_deploys_on_release_id" ON "deploys" ("release_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "events"[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "events" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "name" varchar, "params" text, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.6ms)[0m  [1m[35mCREATE  INDEX "index_events_on_name" ON "events" ("name")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "releases"[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "releases" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uid" varchar NOT NULL, "build_id" integer, "status" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE  INDEX "index_releases_on_build_id" ON "releases" ("build_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "stages"[0m
  [1m[35m (7.0ms)[0m  [1m[35mCREATE TABLE "stages" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "app_id" integer, "uid" varchar NOT NULL, "name" varchar NOT NULL, "review" boolean DEFAULT 'f' NOT NULL, "auto" boolean DEFAULT 'f' NOT NULL, "promotion" boolean DEFAULT 'f' NOT NULL, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE  INDEX "index_stages_on_app_id" ON "stages" ("app_id")[0m
  [1m[35m (6.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (8.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20180927031312)[0m
  [1m[35m (4.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20180926131846),
(20180924034803),
(20180926135035),
(20180924034802),
(20180924140732),
(20180924034801);

[0m
  [1m[35m (7.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2018-10-18 02:27:43.928509"], ["updated_at", "2018-10-18 02:27:43.928509"]]
  [1m[35m (3.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:43.972980', '2018-10-18 02:27:43.972980')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:43.974789', '2018-10-18 02:27:43.974789')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:43.976278', '2018-10-18 02:27:43.976278', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:43.977704', '2018-10-18 02:27:43.977704')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:43.982443', '2018-10-18 02:27:43.982443')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:43.983822', '2018-10-18 02:27:43.983822')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:43.985024', '2018-10-18 02:27:43.985024', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:43.986135', '2018-10-18 02:27:43.986135')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:43.989833', '2018-10-18 02:27:43.989833')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:43.990960', '2018-10-18 02:27:43.990960')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:43.992009', '2018-10-18 02:27:43.992009', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:43.992867', '2018-10-18 02:27:43.992867')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:43.996267', '2018-10-18 02:27:43.996267')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:43.997134', '2018-10-18 02:27:43.997134')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:43.997906', '2018-10-18 02:27:43.997906', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:43.998819', '2018-10-18 02:27:43.998819')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:44.003330', '2018-10-18 02:27:44.003330')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:44.004335', '2018-10-18 02:27:44.004335')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:44.005143', '2018-10-18 02:27:44.005143', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:44.005864', '2018-10-18 02:27:44.005864')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:44.009102', '2018-10-18 02:27:44.009102')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:44.009917', '2018-10-18 02:27:44.009917')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:44.010740', '2018-10-18 02:27:44.010740', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:44.011493', '2018-10-18 02:27:44.011493')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:44.014864', '2018-10-18 02:27:44.014864')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:44.015762', '2018-10-18 02:27:44.015762')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:44.016876', '2018-10-18 02:27:44.016876', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:44.018018', '2018-10-18 02:27:44.018018')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:44.021890', '2018-10-18 02:27:44.021890')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:44.022926', '2018-10-18 02:27:44.022926')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:44.023790', '2018-10-18 02:27:44.023790', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:44.024871', '2018-10-18 02:27:44.024871')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:44.029441', '2018-10-18 02:27:44.029441')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:44.031040', '2018-10-18 02:27:44.031040')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:44.031980', '2018-10-18 02:27:44.031980', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:44.032640', '2018-10-18 02:27:44.032640')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:44.036159', '2018-10-18 02:27:44.036159')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:44.037056', '2018-10-18 02:27:44.037056')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:44.037828', '2018-10-18 02:27:44.037828', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:44.038511', '2018-10-18 02:27:44.038511')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:44.041909', '2018-10-18 02:27:44.041909')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:44.042820', '2018-10-18 02:27:44.042820')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:44.043536', '2018-10-18 02:27:44.043536', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:44.044274', '2018-10-18 02:27:44.044274')[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:44.047989', '2018-10-18 02:27:44.047989')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:44.048892', '2018-10-18 02:27:44.048892')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:44.049656', '2018-10-18 02:27:44.049656', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 'v1', '--- {}', '2018-10-18 02:27:44.050370', '2018-10-18 02:27:44.050370')[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.3ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:27:59.263646', '2018-10-18 02:27:59.263646')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:27:59.265688', '2018-10-18 02:27:59.265688')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:27:59.267309', '2018-10-18 02:27:59.267309', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:27:59.268730', '2018-10-18 02:27:59.268730')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:27:59.270196', '2018-10-18 02:27:59.270196', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "39fdf85e-2439-4b35-b3f9-ae83614c9c2c"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 0615e2a1-3582-4c95-ac25-f3faf038458e\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:27:59.296686"], ["updated_at", "2018-10-18 02:27:59.296686"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "0615e2a1-3582-4c95-ac25-f3faf038458e"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:27:59.305931"], ["updated_at", "2018-10-18 02:27:59.305931"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7bbd9c90-34c1-4844-81fe-5f4ca0712862"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 0ae36b7c-6fd1-4293-96b9-7f9ac31356ee\n"], ["created_at", "2018-10-18 02:27:59.320016"], ["updated_at", "2018-10-18 02:27:59.320016"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "0ae36b7c-6fd1-4293-96b9-7f9ac31356ee"], ["status", "PENDING"], ["created_at", "2018-10-18 02:27:59.328896"], ["updated_at", "2018-10-18 02:27:59.328896"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "68f58d8a-ff0d-4a52-9f7e-b8c57cf06c67"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 9692b9bb-ed75-4e6c-b4a2-52c862adfac4\n"], ["created_at", "2018-10-18 02:27:59.332456"], ["updated_at", "2018-10-18 02:27:59.332456"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9692b9bb-ed75-4e6c-b4a2-52c862adfac4"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:27:59.335735"], ["updated_at", "2018-10-18 02:27:59.335735"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 2e861149-4c1b-482e-8437-ee877bc27acb) to Async(default) with arguments: "68f58d8a-ff0d-4a52-9f7e-b8c57cf06c67"
[ActiveJob] [ReleaseJob] [2e861149-4c1b-482e-8437-ee877bc27acb] Performing ReleaseJob (Job ID: 2e861149-4c1b-482e-8437-ee877bc27acb) from Async(default) with arguments: "68f58d8a-ff0d-4a52-9f7e-b8c57cf06c67"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
[ActiveJob] [ReleaseJob] [2e861149-4c1b-482e-8437-ee877bc27acb]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "68f58d8a-ff0d-4a52-9f7e-b8c57cf06c67"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [2e861149-4c1b-482e-8437-ee877bc27acb] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [2e861149-4c1b-482e-8437-ee877bc27acb] Error performing ReleaseJob (Job ID: 2e861149-4c1b-482e-8437-ee877bc27acb) from Async(default) in 7.52ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "611e579b-a32c-4c9b-9d7f-5f93751067b2"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:27:59.345746"], ["updated_at", "2018-10-18 02:27:59.345746"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:27:59.350009"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6df380a0-ab1c-40c3-a8cc-f50a06497b8b"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: b1fc9fb5-6984-4a53-99a2-0cf13c56b111\n"], ["created_at", "2018-10-18 02:27:59.353916"], ["updated_at", "2018-10-18 02:27:59.353916"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "b1fc9fb5-6984-4a53-99a2-0cf13c56b111"], ["name", "test"], ["created_at", "2018-10-18 02:27:59.356284"], ["updated_at", "2018-10-18 02:27:59.356284"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "db7ad2f9-f219-45fc-a85b-c91baf3c7e50"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 6c2fe750-384c-47e6-b95d-bff304045457\n"], ["created_at", "2018-10-18 02:27:59.359249"], ["updated_at", "2018-10-18 02:27:59.359249"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "6c2fe750-384c-47e6-b95d-bff304045457"], ["name", "test"], ["created_at", "2018-10-18 02:27:59.362228"], ["updated_at", "2018-10-18 02:27:59.362228"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8ea2f91d-95f0-4ead-9909-c94f8b79eaf6"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:27:59.364714"], ["updated_at", "2018-10-18 02:27:59.364714"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:27:59.367144"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cd2789ee-7cf5-4439-b47a-c035c82293f5"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:27:59.370461"], ["updated_at", "2018-10-18 02:27:59.370461"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "92abfc0a-8f45-4231-b65b-8b9c341d15c1"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:27:59.374870"], ["updated_at", "2018-10-18 02:27:59.374870"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:28:21.442753', '2018-10-18 02:28:21.442753')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:28:21.445055', '2018-10-18 02:28:21.445055')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:28:21.446721', '2018-10-18 02:28:21.446721', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:28:21.448077', '2018-10-18 02:28:21.448077')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:28:21.449624', '2018-10-18 02:28:21.449624', 980190962)[0m
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dce9ace2-f098-4f24-b3d9-0aa04cdb09fe"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 446c365e-a5ba-42ac-a675-b18876719fb5\n"], ["created_at", "2018-10-18 02:28:21.469171"], ["updated_at", "2018-10-18 02:28:21.469171"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "446c365e-a5ba-42ac-a675-b18876719fb5"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:28:21.477540"], ["updated_at", "2018-10-18 02:28:21.477540"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: c96f3945-17ca-4239-8d81-ad956a312c8f) to Async(default) with arguments: "dce9ace2-f098-4f24-b3d9-0aa04cdb09fe"
[ActiveJob] [ReleaseJob] [c96f3945-17ca-4239-8d81-ad956a312c8f] Performing ReleaseJob (Job ID: c96f3945-17ca-4239-8d81-ad956a312c8f) from Async(default) with arguments: "dce9ace2-f098-4f24-b3d9-0aa04cdb09fe"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [c96f3945-17ca-4239-8d81-ad956a312c8f]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "dce9ace2-f098-4f24-b3d9-0aa04cdb09fe"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [c96f3945-17ca-4239-8d81-ad956a312c8f] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1a24cf0b-7051-40eb-a728-cca36da4e924"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 9e564d2d-2c5b-43cf-b3c0-a6c70c6846fe\n"], ["created_at", "2018-10-18 02:28:21.491822"], ["updated_at", "2018-10-18 02:28:21.491822"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [c96f3945-17ca-4239-8d81-ad956a312c8f] Error performing ReleaseJob (Job ID: c96f3945-17ca-4239-8d81-ad956a312c8f) from Async(default) in 16.79ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "9e564d2d-2c5b-43cf-b3c0-a6c70c6846fe"], ["status", "PENDING"], ["created_at", "2018-10-18 02:28:21.501936"], ["updated_at", "2018-10-18 02:28:21.501936"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:28:21 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.0ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6b9e2461-2c0b-49c2-a969-ff0a44e93f54"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 0972d20f-d503-4758-826c-f1e0ca3df1f8\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:28:21.531301"], ["updated_at", "2018-10-18 02:28:21.531301"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "0972d20f-d503-4758-826c-f1e0ca3df1f8"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:28:21.537988"], ["updated_at", "2018-10-18 02:28:21.537988"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "33bf1074-b160-4070-afaa-86837ffefb48"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 64136e60-f481-4bce-9b66-9b56e110ae74\n"], ["created_at", "2018-10-18 02:28:21.544233"], ["updated_at", "2018-10-18 02:28:21.544233"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "64136e60-f481-4bce-9b66-9b56e110ae74"], ["name", "test"], ["created_at", "2018-10-18 02:28:21.547266"], ["updated_at", "2018-10-18 02:28:21.547266"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "48f16043-70a2-46d0-a5f4-a114c33ba406"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: b85c60c9-9d24-48c1-b9da-fe3d9d523260\n"], ["created_at", "2018-10-18 02:28:21.550920"], ["updated_at", "2018-10-18 02:28:21.550920"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "b85c60c9-9d24-48c1-b9da-fe3d9d523260"], ["name", "test"], ["created_at", "2018-10-18 02:28:21.552859"], ["updated_at", "2018-10-18 02:28:21.552859"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8d563290-43ca-4b12-907d-274a687a243d"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:28:21.555643"], ["updated_at", "2018-10-18 02:28:21.555643"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:28:21.564461"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "520aac5d-9f80-4f61-9451-5a902c525e06"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:28:21.567882"], ["updated_at", "2018-10-18 02:28:21.567882"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:28:21.569886"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5f4e72e3-f016-44eb-af37-c4f3c727abfa"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:28:21.571692"], ["updated_at", "2018-10-18 02:28:21.571692"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a1f8803c-2f6e-4c15-8c69-2dbee8fa8a1f"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:28:21.575304"], ["updated_at", "2018-10-18 02:28:21.575304"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:28:33.275122', '2018-10-18 02:28:33.275122')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:28:33.276857', '2018-10-18 02:28:33.276857')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:28:33.278404', '2018-10-18 02:28:33.278404', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:28:33.279842', '2018-10-18 02:28:33.279842')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:28:33.281418', '2018-10-18 02:28:33.281418', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c91098b8-573d-448d-8807-658c56030904"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 8bd301a9-bb79-414d-b389-2c76a1b537a1\n"], ["created_at", "2018-10-18 02:28:33.299011"], ["updated_at", "2018-10-18 02:28:33.299011"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8bd301a9-bb79-414d-b389-2c76a1b537a1"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:28:33.306920"], ["updated_at", "2018-10-18 02:28:33.306920"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: ea9af7d1-eb8e-4c10-adb4-86957f0c1a2c) to Async(default) with arguments: "c91098b8-573d-448d-8807-658c56030904"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ea9af7d1-eb8e-4c10-adb4-86957f0c1a2c] Performing ReleaseJob (Job ID: ea9af7d1-eb8e-4c10-adb4-86957f0c1a2c) from Async(default) with arguments: "c91098b8-573d-448d-8807-658c56030904"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ea9af7d1-eb8e-4c10-adb4-86957f0c1a2c]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "c91098b8-573d-448d-8807-658c56030904"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ea9af7d1-eb8e-4c10-adb4-86957f0c1a2c] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ea9af7d1-eb8e-4c10-adb4-86957f0c1a2c] Error performing ReleaseJob (Job ID: ea9af7d1-eb8e-4c10-adb4-86957f0c1a2c) from Async(default) in 11.73ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "13e5ddf2-ff3d-4800-8b95-0852de1e6856"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 366c0331-8c7f-40ec-9f7b-17b2eed48e8e\n"], ["created_at", "2018-10-18 02:28:33.322327"], ["updated_at", "2018-10-18 02:28:33.322327"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "366c0331-8c7f-40ec-9f7b-17b2eed48e8e"], ["status", "PENDING"], ["created_at", "2018-10-18 02:28:33.330594"], ["updated_at", "2018-10-18 02:28:33.330594"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:28:33 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.0ms)
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cce239ff-ad13-4a0f-b404-0c5134a9574e"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 1ea3dbad-394c-48d1-894e-b3218759f332\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:28:33.359030"], ["updated_at", "2018-10-18 02:28:33.359030"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "1ea3dbad-394c-48d1-894e-b3218759f332"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:28:33.365368"], ["updated_at", "2018-10-18 02:28:33.365368"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "46a05a48-1540-4e72-b1b5-9aabc3f5ee44"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:28:33.370361"], ["updated_at", "2018-10-18 02:28:33.370361"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6ab0da52-eb31-4eee-a63a-089985664e84"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: da1cbf15-d94c-4364-8210-2a0f9add6a80\n"], ["created_at", "2018-10-18 02:28:33.375889"], ["updated_at", "2018-10-18 02:28:33.375889"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "da1cbf15-d94c-4364-8210-2a0f9add6a80"], ["name", "test"], ["created_at", "2018-10-18 02:28:33.378924"], ["updated_at", "2018-10-18 02:28:33.378924"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1646ec6c-d825-4953-837f-4d36c9616e5e"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:28:33.381352"], ["updated_at", "2018-10-18 02:28:33.381352"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d2268eb1-426d-4f13-960a-b397d0439c5e"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:28:33.389065"], ["updated_at", "2018-10-18 02:28:33.389065"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:28:33.397880"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "da417ed0-8bd0-4273-b245-c93b17ba2b34"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:28:33.401018"], ["updated_at", "2018-10-18 02:28:33.401018"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:28:33.403378"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ad816257-11b8-4c9b-8d54-41f5e0390df6"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 6f4fe2b9-925d-4244-96cf-edb3c474ab7e\n"], ["created_at", "2018-10-18 02:28:33.408240"], ["updated_at", "2018-10-18 02:28:33.408240"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "6f4fe2b9-925d-4244-96cf-edb3c474ab7e"], ["name", "test"], ["created_at", "2018-10-18 02:28:33.411250"], ["updated_at", "2018-10-18 02:28:33.411250"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:29:00.719932', '2018-10-18 02:29:00.719932')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:29:00.722248', '2018-10-18 02:29:00.722248')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:29:00.723804', '2018-10-18 02:29:00.723804', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:29:00.725133', '2018-10-18 02:29:00.725133')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:29:00.726594', '2018-10-18 02:29:00.726594', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:29:00 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "735454b8-3329-4ab0-a024-bec0e8803033"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: edab1d84-1230-4ce0-9c65-f89ef2dbe792\n"], ["created_at", "2018-10-18 02:29:00.751575"], ["updated_at", "2018-10-18 02:29:00.751575"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "edab1d84-1230-4ce0-9c65-f89ef2dbe792"], ["name", "test"], ["created_at", "2018-10-18 02:29:00.756683"], ["updated_at", "2018-10-18 02:29:00.756683"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"edab1d84-1230-4ce0-9c65-f89ef2dbe792"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3e0ea7fe-7eb9-420c-aa73-91535167a4eb"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: eb836be1-e49e-48a8-94a2-25ba8f9518df\napp_uid: edab1d84-1230-4ce0-9c65-f89ef2dbe792\n"], ["created_at", "2018-10-18 02:29:00.759763"], ["updated_at", "2018-10-18 02:29:00.759763"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "edab1d84-1230-4ce0-9c65-f89ef2dbe792"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "eb836be1-e49e-48a8-94a2-25ba8f9518df"], ["name", "review"], ["created_at", "2018-10-18 02:29:00.766740"], ["updated_at", "2018-10-18 02:29:00.766740"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "eb836be1-e49e-48a8-94a2-25ba8f9518df"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"eb836be1-e49e-48a8-94a2-25ba8f9518df", "app_uid"=>"edab1d84-1230-4ce0-9c65-f89ef2dbe792"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "392aa92c-a69c-49ec-9ae4-92ea039af44d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: df306221-bba7-4443-8e5d-954b06599ae9\nstage_uid: eb836be1-e49e-48a8-94a2-25ba8f9518df\napp_uid: edab1d84-1230-4ce0-9c65-f89ef2dbe792\n"], ["created_at", "2018-10-18 02:29:00.772107"], ["updated_at", "2018-10-18 02:29:00.772107"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "edab1d84-1230-4ce0-9c65-f89ef2dbe792"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "eb836be1-e49e-48a8-94a2-25ba8f9518df"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "df306221-bba7-4443-8e5d-954b06599ae9"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:29:00.779521"], ["updated_at", "2018-10-18 02:29:00.779521"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"edab1d84-1230-4ce0-9c65-f89ef2dbe792"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "88430b95-8b06-42be-b1bf-e3aaf78cb049"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 12f38eea-f244-4141-b52f-12501cd21a31\napp_uid: edab1d84-1230-4ce0-9c65-f89ef2dbe792\n"], ["created_at", "2018-10-18 02:29:00.783968"], ["updated_at", "2018-10-18 02:29:00.783968"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "edab1d84-1230-4ce0-9c65-f89ef2dbe792"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "12f38eea-f244-4141-b52f-12501cd21a31"], ["name", "staging"], ["created_at", "2018-10-18 02:29:00.786680"], ["updated_at", "2018-10-18 02:29:00.786680"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "12f38eea-f244-4141-b52f-12501cd21a31"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"12f38eea-f244-4141-b52f-12501cd21a31", "app_uid"=>"edab1d84-1230-4ce0-9c65-f89ef2dbe792"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "72b211d9-de5e-4a84-9dd3-aa0534310dfb"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 4cefb819-1f66-4900-a4a1-b7e1b4ffc63f\nstage_uid: 12f38eea-f244-4141-b52f-12501cd21a31\napp_uid: edab1d84-1230-4ce0-9c65-f89ef2dbe792\n"], ["created_at", "2018-10-18 02:29:00.789555"], ["updated_at", "2018-10-18 02:29:00.789555"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "edab1d84-1230-4ce0-9c65-f89ef2dbe792"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "12f38eea-f244-4141-b52f-12501cd21a31"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "4cefb819-1f66-4900-a4a1-b7e1b4ffc63f"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:29:00.792818"], ["updated_at", "2018-10-18 02:29:00.792818"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 57ms (ActiveRecord: 4.6ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4afa14c0-ec5c-4fd5-be95-f7a8f1422a39"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 73f5438a-2085-48a9-bfa4-8ddb58181aa2\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:29:00.810643"], ["updated_at", "2018-10-18 02:29:00.810643"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "73f5438a-2085-48a9-bfa4-8ddb58181aa2"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:29:00.816165"], ["updated_at", "2018-10-18 02:29:00.816165"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "404e0a5b-ad7a-43b1-b106-fa9f05a350cb"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: c0eef547-75e3-4b62-ae16-5eaa0e3ef287\n"], ["created_at", "2018-10-18 02:29:00.820152"], ["updated_at", "2018-10-18 02:29:00.820152"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c0eef547-75e3-4b62-ae16-5eaa0e3ef287"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:29:00.827609"], ["updated_at", "2018-10-18 02:29:00.827609"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 1fbf5e21-52f7-468a-ba2f-91c96eeb7712) to Async(default) with arguments: "404e0a5b-ad7a-43b1-b106-fa9f05a350cb"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [1fbf5e21-52f7-468a-ba2f-91c96eeb7712] Performing ReleaseJob (Job ID: 1fbf5e21-52f7-468a-ba2f-91c96eeb7712) from Async(default) with arguments: "404e0a5b-ad7a-43b1-b106-fa9f05a350cb"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [1fbf5e21-52f7-468a-ba2f-91c96eeb7712]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "404e0a5b-ad7a-43b1-b106-fa9f05a350cb"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [1fbf5e21-52f7-468a-ba2f-91c96eeb7712] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "261c6ffd-68f5-4466-b267-f1549cf61ccf"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 8179b3d9-0a92-497d-9c50-efb5b12ca1af\n"], ["created_at", "2018-10-18 02:29:00.838479"], ["updated_at", "2018-10-18 02:29:00.838479"]]
[ActiveJob] [ReleaseJob] [1fbf5e21-52f7-468a-ba2f-91c96eeb7712] Error performing ReleaseJob (Job ID: 1fbf5e21-52f7-468a-ba2f-91c96eeb7712) from Async(default) in 8.66ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (4.7ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "8179b3d9-0a92-497d-9c50-efb5b12ca1af"], ["status", "PENDING"], ["created_at", "2018-10-18 02:29:00.852179"], ["updated_at", "2018-10-18 02:29:00.852179"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1b826d83-4e06-4094-a399-04bf7b25c888"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: c1c881b2-20a1-413e-8cc4-6be17d4d01ad\n"], ["created_at", "2018-10-18 02:29:00.855364"], ["updated_at", "2018-10-18 02:29:00.855364"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "c1c881b2-20a1-413e-8cc4-6be17d4d01ad"], ["name", "test"], ["created_at", "2018-10-18 02:29:00.857832"], ["updated_at", "2018-10-18 02:29:00.857832"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "03e53e84-da39-43cd-838a-2aa36cdbea9a"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:29:00.860265"], ["updated_at", "2018-10-18 02:29:00.860265"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:29:00.862710"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9d84c2fe-e071-40ce-8866-40b59d64ddee"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 176e1546-7694-49ae-a007-c116bbf75460\n"], ["created_at", "2018-10-18 02:29:00.866299"], ["updated_at", "2018-10-18 02:29:00.866299"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "176e1546-7694-49ae-a007-c116bbf75460"], ["name", "test"], ["created_at", "2018-10-18 02:29:00.869034"], ["updated_at", "2018-10-18 02:29:00.869034"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f13f9698-728d-41a1-8789-5a22b3579773"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:29:00.871691"], ["updated_at", "2018-10-18 02:29:00.871691"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2bee07fb-4146-4920-98f1-30d392bd6b8a"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:29:00.876597"], ["updated_at", "2018-10-18 02:29:00.876597"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b34312f0-224b-4529-b1f1-15d4f3531981"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:29:00.887976"], ["updated_at", "2018-10-18 02:29:00.887976"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:29:00.892277"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:29:46.759793', '2018-10-18 02:29:46.759793')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:29:46.762778', '2018-10-18 02:29:46.762778')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:29:46.764654', '2018-10-18 02:29:46.764654', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:29:46.766864', '2018-10-18 02:29:46.766864')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:29:46.769039', '2018-10-18 02:29:46.769039', 980190962)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:29:46 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "17b993ae-0553-4808-be69-cf29865128f1"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 4547dcde-e298-4741-85ca-38809089e3c9\n"], ["created_at", "2018-10-18 02:29:46.792709"], ["updated_at", "2018-10-18 02:29:46.792709"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "4547dcde-e298-4741-85ca-38809089e3c9"], ["name", "test"], ["created_at", "2018-10-18 02:29:46.797926"], ["updated_at", "2018-10-18 02:29:46.797926"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"4547dcde-e298-4741-85ca-38809089e3c9"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e68086fc-c903-471f-8c4c-53db55c64289"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 9ee8977b-7dbd-4484-ab8f-8f395c56eb65\napp_uid: 4547dcde-e298-4741-85ca-38809089e3c9\n"], ["created_at", "2018-10-18 02:29:46.800259"], ["updated_at", "2018-10-18 02:29:46.800259"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4547dcde-e298-4741-85ca-38809089e3c9"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9ee8977b-7dbd-4484-ab8f-8f395c56eb65"], ["name", "review"], ["created_at", "2018-10-18 02:29:46.807679"], ["updated_at", "2018-10-18 02:29:46.807679"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9ee8977b-7dbd-4484-ab8f-8f395c56eb65"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"9ee8977b-7dbd-4484-ab8f-8f395c56eb65", "app_uid"=>"4547dcde-e298-4741-85ca-38809089e3c9"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a639763d-74be-42c6-a0b7-302c6ba30c44"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: aaeb5d9b-b337-487c-b747-938ce50bb66c\nstage_uid: 9ee8977b-7dbd-4484-ab8f-8f395c56eb65\napp_uid: 4547dcde-e298-4741-85ca-38809089e3c9\n"], ["created_at", "2018-10-18 02:29:46.811632"], ["updated_at", "2018-10-18 02:29:46.811632"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4547dcde-e298-4741-85ca-38809089e3c9"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9ee8977b-7dbd-4484-ab8f-8f395c56eb65"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "aaeb5d9b-b337-487c-b747-938ce50bb66c"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:29:46.818680"], ["updated_at", "2018-10-18 02:29:46.818680"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"4547dcde-e298-4741-85ca-38809089e3c9"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7dc2f775-882b-4567-850f-58f3b283d853"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 2abf5b22-b5ed-431e-9c25-e6e407b3fe50\napp_uid: 4547dcde-e298-4741-85ca-38809089e3c9\n"], ["created_at", "2018-10-18 02:29:46.823252"], ["updated_at", "2018-10-18 02:29:46.823252"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4547dcde-e298-4741-85ca-38809089e3c9"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "2abf5b22-b5ed-431e-9c25-e6e407b3fe50"], ["name", "staging"], ["created_at", "2018-10-18 02:29:46.825758"], ["updated_at", "2018-10-18 02:29:46.825758"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2abf5b22-b5ed-431e-9c25-e6e407b3fe50"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"2abf5b22-b5ed-431e-9c25-e6e407b3fe50", "app_uid"=>"4547dcde-e298-4741-85ca-38809089e3c9"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cd59c954-398c-471b-95c1-fc782acdd371"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: ca058216-e894-4853-8f70-4bfff17d6e68\nstage_uid: 2abf5b22-b5ed-431e-9c25-e6e407b3fe50\napp_uid: 4547dcde-e298-4741-85ca-38809089e3c9\n"], ["created_at", "2018-10-18 02:29:46.828212"], ["updated_at", "2018-10-18 02:29:46.828212"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4547dcde-e298-4741-85ca-38809089e3c9"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2abf5b22-b5ed-431e-9c25-e6e407b3fe50"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "ca058216-e894-4853-8f70-4bfff17d6e68"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:29:46.830923"], ["updated_at", "2018-10-18 02:29:46.830923"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 53ms (ActiveRecord: 3.9ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "19c88d41-c89a-4fe4-a024-a95c52d696eb"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: a884ebf0-6d85-4ffe-a1c5-59039a427f3b\n"], ["created_at", "2018-10-18 02:29:46.844800"], ["updated_at", "2018-10-18 02:29:46.844800"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a884ebf0-6d85-4ffe-a1c5-59039a427f3b"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:29:46.851356"], ["updated_at", "2018-10-18 02:29:46.851356"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: b795e17f-e5f3-4bcc-a0e4-97cd7b2e5805) to Async(default) with arguments: "19c88d41-c89a-4fe4-a024-a95c52d696eb"
[ActiveJob] [ReleaseJob] [b795e17f-e5f3-4bcc-a0e4-97cd7b2e5805] Performing ReleaseJob (Job ID: b795e17f-e5f3-4bcc-a0e4-97cd7b2e5805) from Async(default) with arguments: "19c88d41-c89a-4fe4-a024-a95c52d696eb"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
[ActiveJob] [ReleaseJob] [b795e17f-e5f3-4bcc-a0e4-97cd7b2e5805]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "19c88d41-c89a-4fe4-a024-a95c52d696eb"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [b795e17f-e5f3-4bcc-a0e4-97cd7b2e5805] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [b795e17f-e5f3-4bcc-a0e4-97cd7b2e5805] Error performing ReleaseJob (Job ID: b795e17f-e5f3-4bcc-a0e4-97cd7b2e5805) from Async(default) in 7.81ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b47e5f8d-a3c8-403b-9415-4531f55d2c3f"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: b640f518-3344-4bc5-91df-90ff9617aba6\n"], ["created_at", "2018-10-18 02:29:46.862483"], ["updated_at", "2018-10-18 02:29:46.862483"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "b640f518-3344-4bc5-91df-90ff9617aba6"], ["status", "PENDING"], ["created_at", "2018-10-18 02:29:46.874747"], ["updated_at", "2018-10-18 02:29:46.874747"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b3f8cd8c-3323-4963-ab21-fed23758e231"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 7849f6c3-3c9e-4f3f-a91c-0d50fc01599d\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:29:46.879274"], ["updated_at", "2018-10-18 02:29:46.879274"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "7849f6c3-3c9e-4f3f-a91c-0d50fc01599d"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:29:46.884900"], ["updated_at", "2018-10-18 02:29:46.884900"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "14fb9230-f07e-46db-b508-88227f160de8"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:29:46.889554"], ["updated_at", "2018-10-18 02:29:46.889554"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:29:46.892676"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3f799da2-a388-40a1-9978-54f5d6edd46c"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 8b1871d8-b6e4-4927-8076-0d41d89c7c92\n"], ["created_at", "2018-10-18 02:29:46.895419"], ["updated_at", "2018-10-18 02:29:46.895419"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "8b1871d8-b6e4-4927-8076-0d41d89c7c92"], ["name", "test"], ["created_at", "2018-10-18 02:29:46.898127"], ["updated_at", "2018-10-18 02:29:46.898127"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a232d8e2-7b3d-40f6-b48f-d562560f7415"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:29:46.900848"], ["updated_at", "2018-10-18 02:29:46.900848"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e7f98a5d-dc33-45ed-9d01-ed59039cba9b"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:29:46.905879"], ["updated_at", "2018-10-18 02:29:46.905879"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:29:46.908343"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "721d1295-e433-4535-8bc4-0abc53230053"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:29:46.914656"], ["updated_at", "2018-10-18 02:29:46.914656"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "24237e59-7f31-441d-8d8e-4471e1150f03"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: fb2bf335-6db1-4239-a37c-82c0d59b6208\n"], ["created_at", "2018-10-18 02:29:46.920073"], ["updated_at", "2018-10-18 02:29:46.920073"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "fb2bf335-6db1-4239-a37c-82c0d59b6208"], ["name", "test"], ["created_at", "2018-10-18 02:29:46.923147"], ["updated_at", "2018-10-18 02:29:46.923147"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:30:58.433927', '2018-10-18 02:30:58.433927')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:30:58.436098', '2018-10-18 02:30:58.436098')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:30:58.437641', '2018-10-18 02:30:58.437641', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:30:58.438999', '2018-10-18 02:30:58.438999')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:30:58.440356', '2018-10-18 02:30:58.440356', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ed969e0d-035e-4511-b3dc-45934413ca10"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:30:58.450355"], ["updated_at", "2018-10-18 02:30:58.450355"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "87f0b1dd-2f82-4cc7-845e-638f4e8b2953"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:30:58.465379"], ["updated_at", "2018-10-18 02:30:58.465379"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:30:58.470734"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ba8f758f-20c4-42b5-85d4-ca25b1882f60"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:30:58.474680"], ["updated_at", "2018-10-18 02:30:58.474680"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:30:58.476800"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7a86c68c-6416-464d-b5a5-023e5918a8bb"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: c4d2c065-51eb-436d-a9bf-2c734a3d1891\n"], ["created_at", "2018-10-18 02:30:58.479351"], ["updated_at", "2018-10-18 02:30:58.479351"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "c4d2c065-51eb-436d-a9bf-2c734a3d1891"], ["name", "test"], ["created_at", "2018-10-18 02:30:58.481786"], ["updated_at", "2018-10-18 02:30:58.481786"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "718d2c86-6ee1-4a58-b8aa-26d75187454e"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: d161b74d-516f-4825-ad20-56b591cbbe2f\n"], ["created_at", "2018-10-18 02:30:58.487177"], ["updated_at", "2018-10-18 02:30:58.487177"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "d161b74d-516f-4825-ad20-56b591cbbe2f"], ["name", "test2"], ["created_at", "2018-10-18 02:30:58.494338"], ["updated_at", "2018-10-18 02:30:58.494338"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aeaf1903-3ee7-4fbb-98f3-0b54d840888e"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: dafeef9e-1ccf-4568-a949-22f72b74caef\n"], ["created_at", "2018-10-18 02:30:58.496716"], ["updated_at", "2018-10-18 02:30:58.496716"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "dafeef9e-1ccf-4568-a949-22f72b74caef"], ["name", "test"], ["created_at", "2018-10-18 02:30:58.498965"], ["updated_at", "2018-10-18 02:30:58.498965"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9394ec45-a539-4007-a14d-9b6fd4410cbd"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:30:58.501211"], ["updated_at", "2018-10-18 02:30:58.501211"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:30:58 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "402e736d-72fe-4104-82e6-d3acce9eb3f8"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 7fc676d8-6c24-402a-98c6-d1ce06d5c4c5\n"], ["created_at", "2018-10-18 02:30:58.518391"], ["updated_at", "2018-10-18 02:30:58.518391"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "7fc676d8-6c24-402a-98c6-d1ce06d5c4c5"], ["name", "test"], ["created_at", "2018-10-18 02:30:58.521286"], ["updated_at", "2018-10-18 02:30:58.521286"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"7fc676d8-6c24-402a-98c6-d1ce06d5c4c5"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d318aae2-8e8f-44ac-aa9d-d7f3c5ace3ed"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: e2b3968c-b2c5-4c7b-9890-5cc25399f7c0\napp_uid: 7fc676d8-6c24-402a-98c6-d1ce06d5c4c5\n"], ["created_at", "2018-10-18 02:30:58.524363"], ["updated_at", "2018-10-18 02:30:58.524363"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7fc676d8-6c24-402a-98c6-d1ce06d5c4c5"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "e2b3968c-b2c5-4c7b-9890-5cc25399f7c0"], ["name", "review"], ["created_at", "2018-10-18 02:30:58.526871"], ["updated_at", "2018-10-18 02:30:58.526871"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e2b3968c-b2c5-4c7b-9890-5cc25399f7c0"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"e2b3968c-b2c5-4c7b-9890-5cc25399f7c0", "app_uid"=>"7fc676d8-6c24-402a-98c6-d1ce06d5c4c5"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c5033ebb-9c88-4679-9e81-098c03ef5e9d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 7091d97e-80f1-44fb-aef9-1a90b59ace82\nstage_uid: e2b3968c-b2c5-4c7b-9890-5cc25399f7c0\napp_uid: 7fc676d8-6c24-402a-98c6-d1ce06d5c4c5\n"], ["created_at", "2018-10-18 02:30:58.529879"], ["updated_at", "2018-10-18 02:30:58.529879"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7fc676d8-6c24-402a-98c6-d1ce06d5c4c5"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e2b3968c-b2c5-4c7b-9890-5cc25399f7c0"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "7091d97e-80f1-44fb-aef9-1a90b59ace82"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:30:58.533229"], ["updated_at", "2018-10-18 02:30:58.533229"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"7fc676d8-6c24-402a-98c6-d1ce06d5c4c5"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aa5d2c1c-d894-471c-a9a1-5c2f60422cbd"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 9253c601-1468-4d53-8d39-6cb468b7c135\napp_uid: 7fc676d8-6c24-402a-98c6-d1ce06d5c4c5\n"], ["created_at", "2018-10-18 02:30:58.537784"], ["updated_at", "2018-10-18 02:30:58.537784"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7fc676d8-6c24-402a-98c6-d1ce06d5c4c5"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9253c601-1468-4d53-8d39-6cb468b7c135"], ["name", "staging"], ["created_at", "2018-10-18 02:30:58.540734"], ["updated_at", "2018-10-18 02:30:58.540734"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9253c601-1468-4d53-8d39-6cb468b7c135"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"9253c601-1468-4d53-8d39-6cb468b7c135", "app_uid"=>"7fc676d8-6c24-402a-98c6-d1ce06d5c4c5"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b29672ba-c4a4-4c58-9bae-0690e0b8a498"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: c4920a73-fed8-4533-8372-d009009693d5\nstage_uid: 9253c601-1468-4d53-8d39-6cb468b7c135\napp_uid: 7fc676d8-6c24-402a-98c6-d1ce06d5c4c5\n"], ["created_at", "2018-10-18 02:30:58.543833"], ["updated_at", "2018-10-18 02:30:58.543833"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7fc676d8-6c24-402a-98c6-d1ce06d5c4c5"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9253c601-1468-4d53-8d39-6cb468b7c135"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "c4920a73-fed8-4533-8372-d009009693d5"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:30:58.546705"], ["updated_at", "2018-10-18 02:30:58.546705"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 39ms (ActiveRecord: 4.0ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "58770e52-d45e-4942-8447-2860aea15961"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 13361f38-afdb-4e4a-a03a-1a3b4fff5891\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:30:58.561393"], ["updated_at", "2018-10-18 02:30:58.561393"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "13361f38-afdb-4e4a-a03a-1a3b4fff5891"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:30:58.571498"], ["updated_at", "2018-10-18 02:30:58.571498"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "72ae2a77-78f4-4cef-b92b-cf78708a1565"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 964b3dd5-687d-4e53-af6c-cd881e42f77c\n"], ["created_at", "2018-10-18 02:30:58.575996"], ["updated_at", "2018-10-18 02:30:58.575996"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "964b3dd5-687d-4e53-af6c-cd881e42f77c"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:30:58.582903"], ["updated_at", "2018-10-18 02:30:58.582903"]]
[ActiveJob] [ReleaseJob] [81dcbec7-c1b5-4de3-ab82-3465504bb1f2] Performing ReleaseJob (Job ID: 81dcbec7-c1b5-4de3-ab82-3465504bb1f2) from Async(default) with arguments: "72ae2a77-78f4-4cef-b92b-cf78708a1565"
[ActiveJob] Enqueued ReleaseJob (Job ID: 81dcbec7-c1b5-4de3-ab82-3465504bb1f2) to Async(default) with arguments: "72ae2a77-78f4-4cef-b92b-cf78708a1565"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [81dcbec7-c1b5-4de3-ab82-3465504bb1f2]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "72ae2a77-78f4-4cef-b92b-cf78708a1565"], ["LIMIT", 1]]
------------------------------------------
[ActiveJob] [ReleaseJob] [81dcbec7-c1b5-4de3-ab82-3465504bb1f2] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [81dcbec7-c1b5-4de3-ab82-3465504bb1f2] Error performing ReleaseJob (Job ID: 81dcbec7-c1b5-4de3-ab82-3465504bb1f2) from Async(default) in 6.21ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1f5bd8a3-186c-4a8d-9121-565f219522bb"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: e6f27254-816e-405c-868e-198127f007f1\n"], ["created_at", "2018-10-18 02:30:58.592701"], ["updated_at", "2018-10-18 02:30:58.592701"]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "e6f27254-816e-405c-868e-198127f007f1"], ["status", "PENDING"], ["created_at", "2018-10-18 02:30:58.604076"], ["updated_at", "2018-10-18 02:30:58.604076"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:31:15.926334', '2018-10-18 02:31:15.926334')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:31:15.928947', '2018-10-18 02:31:15.928947')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:31:15.930726', '2018-10-18 02:31:15.930726', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:31:15.932144', '2018-10-18 02:31:15.932144')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:31:15.933739', '2018-10-18 02:31:15.933739', 980190962)[0m
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:31:15 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5a3b2e39-26a6-4ce0-b869-8c5d75e9fad0"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 771c833b-9366-40e9-9190-7109cc2de6d9\n"], ["created_at", "2018-10-18 02:31:15.960187"], ["updated_at", "2018-10-18 02:31:15.960187"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "771c833b-9366-40e9-9190-7109cc2de6d9"], ["name", "test"], ["created_at", "2018-10-18 02:31:15.965429"], ["updated_at", "2018-10-18 02:31:15.965429"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"771c833b-9366-40e9-9190-7109cc2de6d9"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c9c3b81c-991e-4eda-a727-83b6cb393c3d"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 4c3f92a7-7302-4d03-88af-9e46e7263db7\napp_uid: 771c833b-9366-40e9-9190-7109cc2de6d9\n"], ["created_at", "2018-10-18 02:31:15.968253"], ["updated_at", "2018-10-18 02:31:15.968253"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "771c833b-9366-40e9-9190-7109cc2de6d9"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "4c3f92a7-7302-4d03-88af-9e46e7263db7"], ["name", "review"], ["created_at", "2018-10-18 02:31:15.975593"], ["updated_at", "2018-10-18 02:31:15.975593"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "4c3f92a7-7302-4d03-88af-9e46e7263db7"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"4c3f92a7-7302-4d03-88af-9e46e7263db7", "app_uid"=>"771c833b-9366-40e9-9190-7109cc2de6d9"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8a238b8c-e9e2-4b33-92fe-b0586ee18ecf"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 89fd374f-9898-4953-8ad5-4d436a773311\nstage_uid: 4c3f92a7-7302-4d03-88af-9e46e7263db7\napp_uid: 771c833b-9366-40e9-9190-7109cc2de6d9\n"], ["created_at", "2018-10-18 02:31:15.979088"], ["updated_at", "2018-10-18 02:31:15.979088"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "771c833b-9366-40e9-9190-7109cc2de6d9"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "4c3f92a7-7302-4d03-88af-9e46e7263db7"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "89fd374f-9898-4953-8ad5-4d436a773311"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:31:15.986206"], ["updated_at", "2018-10-18 02:31:15.986206"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"771c833b-9366-40e9-9190-7109cc2de6d9"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fbcbc593-c19c-4452-afbf-35a96e8f466f"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: d5abdc84-fcd1-433c-b324-d65bd9f799b9\napp_uid: 771c833b-9366-40e9-9190-7109cc2de6d9\n"], ["created_at", "2018-10-18 02:31:15.990669"], ["updated_at", "2018-10-18 02:31:15.990669"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "771c833b-9366-40e9-9190-7109cc2de6d9"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "d5abdc84-fcd1-433c-b324-d65bd9f799b9"], ["name", "staging"], ["created_at", "2018-10-18 02:31:15.993128"], ["updated_at", "2018-10-18 02:31:15.993128"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d5abdc84-fcd1-433c-b324-d65bd9f799b9"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"d5abdc84-fcd1-433c-b324-d65bd9f799b9", "app_uid"=>"771c833b-9366-40e9-9190-7109cc2de6d9"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "25750185-925a-4dd3-8c99-54658173a818"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 6fccbe22-69e3-4480-9ccf-69b9b11b4ff2\nstage_uid: d5abdc84-fcd1-433c-b324-d65bd9f799b9\napp_uid: 771c833b-9366-40e9-9190-7109cc2de6d9\n"], ["created_at", "2018-10-18 02:31:15.996199"], ["updated_at", "2018-10-18 02:31:15.996199"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "771c833b-9366-40e9-9190-7109cc2de6d9"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d5abdc84-fcd1-433c-b324-d65bd9f799b9"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "6fccbe22-69e3-4480-9ccf-69b9b11b4ff2"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:31:15.999291"], ["updated_at", "2018-10-18 02:31:15.999291"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 55ms (ActiveRecord: 4.0ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c12abf19-b12b-4629-b5fe-786bc8685848"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 0f700a1b-d035-4bf2-97b5-89133867da06\n"], ["created_at", "2018-10-18 02:31:16.012723"], ["updated_at", "2018-10-18 02:31:16.012723"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0f700a1b-d035-4bf2-97b5-89133867da06"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:31:16.019090"], ["updated_at", "2018-10-18 02:31:16.019090"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 2f4d0d06-0f31-4bb7-b8fd-4f5362a4a337) to Async(default) with arguments: "c12abf19-b12b-4629-b5fe-786bc8685848"
[ActiveJob] [ReleaseJob] [2f4d0d06-0f31-4bb7-b8fd-4f5362a4a337] Performing ReleaseJob (Job ID: 2f4d0d06-0f31-4bb7-b8fd-4f5362a4a337) from Async(default) with arguments: "c12abf19-b12b-4629-b5fe-786bc8685848"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.3ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [2f4d0d06-0f31-4bb7-b8fd-4f5362a4a337]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "c12abf19-b12b-4629-b5fe-786bc8685848"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [2f4d0d06-0f31-4bb7-b8fd-4f5362a4a337] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a1294d49-6d5e-4422-8806-1d5ad89f684f"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: f1ecca0e-89bb-4c96-a84f-05a4d358a330\n"], ["created_at", "2018-10-18 02:31:16.029109"], ["updated_at", "2018-10-18 02:31:16.029109"]]
[ActiveJob] [ReleaseJob] [2f4d0d06-0f31-4bb7-b8fd-4f5362a4a337] Error performing ReleaseJob (Job ID: 2f4d0d06-0f31-4bb7-b8fd-4f5362a4a337) from Async(default) in 9.97ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "f1ecca0e-89bb-4c96-a84f-05a4d358a330"], ["status", "PENDING"], ["created_at", "2018-10-18 02:31:16.042500"], ["updated_at", "2018-10-18 02:31:16.042500"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e1f9d107-492f-4f74-ba36-deb10a97d427"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 2bba238c-834d-4d31-a875-bd1a556ec165\n"], ["created_at", "2018-10-18 02:31:16.045208"], ["updated_at", "2018-10-18 02:31:16.045208"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "2bba238c-834d-4d31-a875-bd1a556ec165"], ["name", "test"], ["created_at", "2018-10-18 02:31:16.048558"], ["updated_at", "2018-10-18 02:31:16.048558"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "99fdea34-19c7-42ee-bedb-012939382e8f"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 48968c68-af50-45ff-8a03-834d9570f7f1\n"], ["created_at", "2018-10-18 02:31:16.052049"], ["updated_at", "2018-10-18 02:31:16.052049"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "48968c68-af50-45ff-8a03-834d9570f7f1"], ["name", "test2"], ["created_at", "2018-10-18 02:31:16.055244"], ["updated_at", "2018-10-18 02:31:16.055244"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1d6ae51a-86ec-4d94-9eaa-e3fba2777c20"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:31:16.058090"], ["updated_at", "2018-10-18 02:31:16.058090"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:31:16.061400"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "63276f5f-8d25-4373-9bcb-8ca99465e5c8"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:31:16.065342"], ["updated_at", "2018-10-18 02:31:16.065342"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c43ecde7-fe1d-4126-9ae6-eb92d09a656c"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:31:16.069090"], ["updated_at", "2018-10-18 02:31:16.069090"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:31:16.071151"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b4ad11ca-03b4-4050-880c-85f2d765b866"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 9337acec-d509-4aa4-a0ca-80e9941aca3a\n"], ["created_at", "2018-10-18 02:31:16.073909"], ["updated_at", "2018-10-18 02:31:16.073909"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "9337acec-d509-4aa4-a0ca-80e9941aca3a"], ["name", "test2"], ["created_at", "2018-10-18 02:31:16.076831"], ["updated_at", "2018-10-18 02:31:16.076831"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "38853955-0840-45c2-a68b-cf37678c6a52"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:31:16.078563"], ["updated_at", "2018-10-18 02:31:16.078563"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1e6cf0df-6f06-4f8c-bdac-f51190c27b72"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 54b8d1eb-2440-4de4-ad45-003cd1ef85d8\n"], ["created_at", "2018-10-18 02:31:16.082599"], ["updated_at", "2018-10-18 02:31:16.082599"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "54b8d1eb-2440-4de4-ad45-003cd1ef85d8"], ["name", "test"], ["created_at", "2018-10-18 02:31:16.086288"], ["updated_at", "2018-10-18 02:31:16.086288"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f73f69a0-d0d1-4db2-beb6-bd7ca6675eb7"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 81fc792d-f593-4539-956b-428f97e34afa\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:31:16.089774"], ["updated_at", "2018-10-18 02:31:16.089774"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "81fc792d-f593-4539-956b-428f97e34afa"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:31:16.094941"], ["updated_at", "2018-10-18 02:31:16.094941"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:31:59.378222', '2018-10-18 02:31:59.378222')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:31:59.380137', '2018-10-18 02:31:59.380137')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:31:59.381723', '2018-10-18 02:31:59.381723', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:31:59.383347', '2018-10-18 02:31:59.383347')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:31:59.384819', '2018-10-18 02:31:59.384819', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c29272e1-7be8-44a5-a3ab-12331a7c2e5d"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 674d9a1d-0c9e-4907-a431-7eff6a701d13\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:31:59.410024"], ["updated_at", "2018-10-18 02:31:59.410024"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "674d9a1d-0c9e-4907-a431-7eff6a701d13"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:31:59.417123"], ["updated_at", "2018-10-18 02:31:59.417123"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:31:59 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "183241a9-125a-4be7-b160-f51a4e59d240"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: a16d9146-2aa6-4c17-a8f1-c996c7371a2c\n"], ["created_at", "2018-10-18 02:31:59.433765"], ["updated_at", "2018-10-18 02:31:59.433765"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "a16d9146-2aa6-4c17-a8f1-c996c7371a2c"], ["name", "test"], ["created_at", "2018-10-18 02:31:59.435701"], ["updated_at", "2018-10-18 02:31:59.435701"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"a16d9146-2aa6-4c17-a8f1-c996c7371a2c"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "774cb4e5-3af9-488e-b44a-677a491b5971"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 13326083-8466-4dd8-b4d7-27116aff2b3a\napp_uid: a16d9146-2aa6-4c17-a8f1-c996c7371a2c\n"], ["created_at", "2018-10-18 02:31:59.437930"], ["updated_at", "2018-10-18 02:31:59.437930"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "a16d9146-2aa6-4c17-a8f1-c996c7371a2c"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "13326083-8466-4dd8-b4d7-27116aff2b3a"], ["name", "review"], ["created_at", "2018-10-18 02:31:59.440783"], ["updated_at", "2018-10-18 02:31:59.440783"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "13326083-8466-4dd8-b4d7-27116aff2b3a"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"13326083-8466-4dd8-b4d7-27116aff2b3a", "app_uid"=>"a16d9146-2aa6-4c17-a8f1-c996c7371a2c"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b11af4d7-88f6-41f9-963a-59e747df4925"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: b7766a3a-522c-4b38-8361-4ead306f179a\nstage_uid: 13326083-8466-4dd8-b4d7-27116aff2b3a\napp_uid: a16d9146-2aa6-4c17-a8f1-c996c7371a2c\n"], ["created_at", "2018-10-18 02:31:59.443789"], ["updated_at", "2018-10-18 02:31:59.443789"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "a16d9146-2aa6-4c17-a8f1-c996c7371a2c"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "13326083-8466-4dd8-b4d7-27116aff2b3a"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "b7766a3a-522c-4b38-8361-4ead306f179a"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:31:59.450870"], ["updated_at", "2018-10-18 02:31:59.450870"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"a16d9146-2aa6-4c17-a8f1-c996c7371a2c"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ef4f4c96-0c83-4206-99b9-7bdf87fc340e"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 7c36e51c-2dec-492c-a7ed-81a2fcb49bf3\napp_uid: a16d9146-2aa6-4c17-a8f1-c996c7371a2c\n"], ["created_at", "2018-10-18 02:31:59.455156"], ["updated_at", "2018-10-18 02:31:59.455156"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "a16d9146-2aa6-4c17-a8f1-c996c7371a2c"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "7c36e51c-2dec-492c-a7ed-81a2fcb49bf3"], ["name", "staging"], ["created_at", "2018-10-18 02:31:59.457838"], ["updated_at", "2018-10-18 02:31:59.457838"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "7c36e51c-2dec-492c-a7ed-81a2fcb49bf3"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"7c36e51c-2dec-492c-a7ed-81a2fcb49bf3", "app_uid"=>"a16d9146-2aa6-4c17-a8f1-c996c7371a2c"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ccea1731-ed72-4562-96d4-0fc457443701"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 1a673aa8-1b03-4e5d-b675-7344cddd3561\nstage_uid: 7c36e51c-2dec-492c-a7ed-81a2fcb49bf3\napp_uid: a16d9146-2aa6-4c17-a8f1-c996c7371a2c\n"], ["created_at", "2018-10-18 02:31:59.460882"], ["updated_at", "2018-10-18 02:31:59.460882"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "a16d9146-2aa6-4c17-a8f1-c996c7371a2c"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "7c36e51c-2dec-492c-a7ed-81a2fcb49bf3"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "1a673aa8-1b03-4e5d-b675-7344cddd3561"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:31:59.464346"], ["updated_at", "2018-10-18 02:31:59.464346"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 41ms (ActiveRecord: 3.4ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f0d3600f-45be-4e9d-b804-8817b0341e6e"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 6e2b3569-0db9-437e-a272-f7046e4d3d1f\n"], ["created_at", "2018-10-18 02:31:59.471176"], ["updated_at", "2018-10-18 02:31:59.471176"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "6e2b3569-0db9-437e-a272-f7046e4d3d1f"], ["name", "test"], ["created_at", "2018-10-18 02:31:59.474234"], ["updated_at", "2018-10-18 02:31:59.474234"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "73e796eb-4e6e-45c8-8034-8b5562c634cd"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:31:59.476774"], ["updated_at", "2018-10-18 02:31:59.476774"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:31:59.479335"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d08bb5cf-f459-4f55-ab5e-4a3cc0ce4b5f"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 59274ccd-8765-4e03-b039-243b6c11c3dd\n"], ["created_at", "2018-10-18 02:31:59.483123"], ["updated_at", "2018-10-18 02:31:59.483123"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "59274ccd-8765-4e03-b039-243b6c11c3dd"], ["name", "test2"], ["created_at", "2018-10-18 02:31:59.486437"], ["updated_at", "2018-10-18 02:31:59.486437"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d711c6f9-5260-4a36-bf5f-90ea037bb310"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:31:59.489265"], ["updated_at", "2018-10-18 02:31:59.489265"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "18d89d47-775c-4bd6-a5c5-b8e10d1f051f"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:31:59.495197"], ["updated_at", "2018-10-18 02:31:59.495197"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:31:59.498748"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a7c47c48-9052-4e1f-8db5-a7a4ff7c1039"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 022a36f2-7992-4734-86b0-891464b647a6\n"], ["created_at", "2018-10-18 02:31:59.501789"], ["updated_at", "2018-10-18 02:31:59.501789"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "022a36f2-7992-4734-86b0-891464b647a6"], ["name", "test2"], ["created_at", "2018-10-18 02:31:59.504934"], ["updated_at", "2018-10-18 02:31:59.504934"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dbc7e87a-edaf-4de8-8920-950f381b9990"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 8b509206-baab-4943-bc58-79f44f067f76\n"], ["created_at", "2018-10-18 02:31:59.512245"], ["updated_at", "2018-10-18 02:31:59.512245"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "8b509206-baab-4943-bc58-79f44f067f76"], ["name", "test"], ["created_at", "2018-10-18 02:31:59.515242"], ["updated_at", "2018-10-18 02:31:59.515242"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "14177cb5-75ac-496c-800d-3c0fd0c06d1a"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: f0984494-82ed-4511-b2f7-c2916fb31694\n"], ["created_at", "2018-10-18 02:31:59.518511"], ["updated_at", "2018-10-18 02:31:59.518511"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f0984494-82ed-4511-b2f7-c2916fb31694"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:31:59.524488"], ["updated_at", "2018-10-18 02:31:59.524488"]]
[ActiveJob] [ReleaseJob] [140f6c62-5460-438b-bfc5-c68084385567] Performing ReleaseJob (Job ID: 140f6c62-5460-438b-bfc5-c68084385567) from Async(default) with arguments: "14177cb5-75ac-496c-800d-3c0fd0c06d1a"
[ActiveJob] Enqueued ReleaseJob (Job ID: 140f6c62-5460-438b-bfc5-c68084385567) to Async(default) with arguments: "14177cb5-75ac-496c-800d-3c0fd0c06d1a"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [140f6c62-5460-438b-bfc5-c68084385567]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "14177cb5-75ac-496c-800d-3c0fd0c06d1a"], ["LIMIT", 1]]
------------------------------------------
[ActiveJob] [ReleaseJob] [140f6c62-5460-438b-bfc5-c68084385567] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [140f6c62-5460-438b-bfc5-c68084385567] Error performing ReleaseJob (Job ID: 140f6c62-5460-438b-bfc5-c68084385567) from Async(default) in 6.88ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d510fde7-6c42-4dff-adc3-c4e42cdc0b0d"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: aa5efa86-c055-4dbd-8b3f-def4b6a77f55\n"], ["created_at", "2018-10-18 02:31:59.535551"], ["updated_at", "2018-10-18 02:31:59.535551"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "aa5efa86-c055-4dbd-8b3f-def4b6a77f55"], ["status", "PENDING"], ["created_at", "2018-10-18 02:31:59.543822"], ["updated_at", "2018-10-18 02:31:59.543822"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:32:20.809277', '2018-10-18 02:32:20.809277')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:32:20.811137', '2018-10-18 02:32:20.811137')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:32:20.812694', '2018-10-18 02:32:20.812694', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:32:20.814094', '2018-10-18 02:32:20.814094')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:32:20.815548', '2018-10-18 02:32:20.815548', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5550fb1f-0659-4609-8ca4-adc2865f98b6"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: b08bd398-de40-45b9-bb2d-997139ad108a\n"], ["created_at", "2018-10-18 02:32:20.831882"], ["updated_at", "2018-10-18 02:32:20.831882"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "b08bd398-de40-45b9-bb2d-997139ad108a"], ["name", "test"], ["created_at", "2018-10-18 02:32:20.841750"], ["updated_at", "2018-10-18 02:32:20.841750"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4a2980ee-ce19-41dc-81b9-f768a7843d99"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:32:20.845296"], ["updated_at", "2018-10-18 02:32:20.845296"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c5402c9a-a996-435b-88c6-859f5d5984e4"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 5fe3a02d-1dd6-48a8-9796-4942aa4c7df7\n"], ["created_at", "2018-10-18 02:32:20.851806"], ["updated_at", "2018-10-18 02:32:20.851806"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "5fe3a02d-1dd6-48a8-9796-4942aa4c7df7"], ["name", "test2"], ["created_at", "2018-10-18 02:32:20.860402"], ["updated_at", "2018-10-18 02:32:20.860402"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7103b044-f458-4c64-b68c-429e401f7067"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:32:20.864313"], ["updated_at", "2018-10-18 02:32:20.864313"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a3c413b4-e757-48d5-a42b-464522ac2910"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:32:20.870390"], ["updated_at", "2018-10-18 02:32:20.870390"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:32:20.874499"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1a47fe1f-6f9f-4a84-ae27-51e0350be9b6"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: dc43bfc7-aec1-484f-ae70-8a9ec3f93dc2\n"], ["created_at", "2018-10-18 02:32:20.879922"], ["updated_at", "2018-10-18 02:32:20.879922"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "dc43bfc7-aec1-484f-ae70-8a9ec3f93dc2"], ["name", "test2"], ["created_at", "2018-10-18 02:32:20.883172"], ["updated_at", "2018-10-18 02:32:20.883172"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "371b133f-c8af-4b21-8073-863907fe8d5c"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:32:20.886579"], ["updated_at", "2018-10-18 02:32:20.886579"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:32:20.888722"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1c372e78-4e65-46ea-8ef7-990b7e6de38f"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: cb163b1a-7345-4a80-94ee-ea35d2db3f1b\n"], ["created_at", "2018-10-18 02:32:20.890669"], ["updated_at", "2018-10-18 02:32:20.890669"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "cb163b1a-7345-4a80-94ee-ea35d2db3f1b"], ["name", "test"], ["created_at", "2018-10-18 02:32:20.892689"], ["updated_at", "2018-10-18 02:32:20.892689"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "721f3b5f-4963-4bb0-8b53-e7ae041b196d"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 3ed266e2-fb36-4588-bee6-417e4db06f34\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:32:20.902932"], ["updated_at", "2018-10-18 02:32:20.902932"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "3ed266e2-fb36-4588-bee6-417e4db06f34"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:32:20.908485"], ["updated_at", "2018-10-18 02:32:20.908485"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:32:20 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "14730aa3-060e-42fb-80f4-d8b4aa7f20cb"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 7a257a85-f26f-47ce-9f5b-e113fffe3e45\n"], ["created_at", "2018-10-18 02:32:20.924684"], ["updated_at", "2018-10-18 02:32:20.924684"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "7a257a85-f26f-47ce-9f5b-e113fffe3e45"], ["name", "test"], ["created_at", "2018-10-18 02:32:20.927571"], ["updated_at", "2018-10-18 02:32:20.927571"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"7a257a85-f26f-47ce-9f5b-e113fffe3e45"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "590fa146-0879-4f13-9cae-0a2e43f404f9"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: d8f53cb0-5160-4fb2-abea-0aec5f63ceb1\napp_uid: 7a257a85-f26f-47ce-9f5b-e113fffe3e45\n"], ["created_at", "2018-10-18 02:32:20.929793"], ["updated_at", "2018-10-18 02:32:20.929793"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7a257a85-f26f-47ce-9f5b-e113fffe3e45"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "d8f53cb0-5160-4fb2-abea-0aec5f63ceb1"], ["name", "review"], ["created_at", "2018-10-18 02:32:20.932063"], ["updated_at", "2018-10-18 02:32:20.932063"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d8f53cb0-5160-4fb2-abea-0aec5f63ceb1"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"d8f53cb0-5160-4fb2-abea-0aec5f63ceb1", "app_uid"=>"7a257a85-f26f-47ce-9f5b-e113fffe3e45"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1723f5df-15b9-4b67-b0ba-cb1c5594ac13"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 11779b2e-db0f-4c99-a11a-4eff74afc503\nstage_uid: d8f53cb0-5160-4fb2-abea-0aec5f63ceb1\napp_uid: 7a257a85-f26f-47ce-9f5b-e113fffe3e45\n"], ["created_at", "2018-10-18 02:32:20.934970"], ["updated_at", "2018-10-18 02:32:20.934970"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7a257a85-f26f-47ce-9f5b-e113fffe3e45"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d8f53cb0-5160-4fb2-abea-0aec5f63ceb1"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "11779b2e-db0f-4c99-a11a-4eff74afc503"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:32:20.938099"], ["updated_at", "2018-10-18 02:32:20.938099"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"7a257a85-f26f-47ce-9f5b-e113fffe3e45"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9236f718-7730-402d-abb2-4429d1ba8702"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: bb5bc617-ee26-4017-9f42-260d65ccdc27\napp_uid: 7a257a85-f26f-47ce-9f5b-e113fffe3e45\n"], ["created_at", "2018-10-18 02:32:20.941800"], ["updated_at", "2018-10-18 02:32:20.941800"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7a257a85-f26f-47ce-9f5b-e113fffe3e45"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "bb5bc617-ee26-4017-9f42-260d65ccdc27"], ["name", "staging"], ["created_at", "2018-10-18 02:32:20.944092"], ["updated_at", "2018-10-18 02:32:20.944092"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "bb5bc617-ee26-4017-9f42-260d65ccdc27"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"bb5bc617-ee26-4017-9f42-260d65ccdc27", "app_uid"=>"7a257a85-f26f-47ce-9f5b-e113fffe3e45"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6d364d52-bfa1-4395-9b10-7ca93c0e4b8f"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 7d209976-7fe5-4f31-8d39-a61dc07a6b32\nstage_uid: bb5bc617-ee26-4017-9f42-260d65ccdc27\napp_uid: 7a257a85-f26f-47ce-9f5b-e113fffe3e45\n"], ["created_at", "2018-10-18 02:32:20.947257"], ["updated_at", "2018-10-18 02:32:20.947257"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7a257a85-f26f-47ce-9f5b-e113fffe3e45"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "bb5bc617-ee26-4017-9f42-260d65ccdc27"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "7d209976-7fe5-4f31-8d39-a61dc07a6b32"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:32:20.954804"], ["updated_at", "2018-10-18 02:32:20.954804"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 42ms (ActiveRecord: 3.4ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4f562bf6-f100-415a-8d1a-d4f6091b4d03"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 7cf080c5-6808-47a0-9963-478cd0ae485d\n"], ["created_at", "2018-10-18 02:32:20.962682"], ["updated_at", "2018-10-18 02:32:20.962682"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7cf080c5-6808-47a0-9963-478cd0ae485d"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:32:20.969767"], ["updated_at", "2018-10-18 02:32:20.969767"]]
[ActiveJob] [ReleaseJob] [6a53cbd0-e94a-4c57-9a11-fbfd2e88db50] Performing ReleaseJob (Job ID: 6a53cbd0-e94a-4c57-9a11-fbfd2e88db50) from Async(default) with arguments: "4f562bf6-f100-415a-8d1a-d4f6091b4d03"
[ActiveJob] Enqueued ReleaseJob (Job ID: 6a53cbd0-e94a-4c57-9a11-fbfd2e88db50) to Async(default) with arguments: "4f562bf6-f100-415a-8d1a-d4f6091b4d03"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [6a53cbd0-e94a-4c57-9a11-fbfd2e88db50]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "4f562bf6-f100-415a-8d1a-d4f6091b4d03"], ["LIMIT", 1]]
------------------------------------------
[ActiveJob] [ReleaseJob] [6a53cbd0-e94a-4c57-9a11-fbfd2e88db50] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [6a53cbd0-e94a-4c57-9a11-fbfd2e88db50] Error performing ReleaseJob (Job ID: 6a53cbd0-e94a-4c57-9a11-fbfd2e88db50) from Async(default) in 6.86ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "19d7c696-10f6-4d1e-ae80-0d78736be3e0"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 42a771bb-df5a-415b-844d-352f8b373189\n"], ["created_at", "2018-10-18 02:32:20.980977"], ["updated_at", "2018-10-18 02:32:20.980977"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "42a771bb-df5a-415b-844d-352f8b373189"], ["status", "PENDING"], ["created_at", "2018-10-18 02:32:20.989182"], ["updated_at", "2018-10-18 02:32:20.989182"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:32:41.024697', '2018-10-18 02:32:41.024697')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:32:41.026791', '2018-10-18 02:32:41.026791')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:32:41.028351', '2018-10-18 02:32:41.028351', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:32:41.029739', '2018-10-18 02:32:41.029739')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:32:41.031216', '2018-10-18 02:32:41.031216', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "966d6396-bb47-4bbf-8d73-39088b9fb75e"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 6565ded2-a076-4d19-b5aa-4227409e66ee\n"], ["created_at", "2018-10-18 02:32:41.051710"], ["updated_at", "2018-10-18 02:32:41.051710"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "6565ded2-a076-4d19-b5aa-4227409e66ee"], ["status", "PENDING"], ["created_at", "2018-10-18 02:32:41.061440"], ["updated_at", "2018-10-18 02:32:41.061440"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "03728024-add5-49ec-ae03-6555f0a0d3c6"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 497479b8-ee07-404d-b0c5-abcb0dec23de\n"], ["created_at", "2018-10-18 02:32:41.070528"], ["updated_at", "2018-10-18 02:32:41.070528"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "497479b8-ee07-404d-b0c5-abcb0dec23de"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:32:41.074523"], ["updated_at", "2018-10-18 02:32:41.074523"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 6ebc5843-a3f2-4cd3-b817-06a9ba8bfcef) to Async(default) with arguments: "03728024-add5-49ec-ae03-6555f0a0d3c6"
[ActiveJob] [ReleaseJob] [6ebc5843-a3f2-4cd3-b817-06a9ba8bfcef] Performing ReleaseJob (Job ID: 6ebc5843-a3f2-4cd3-b817-06a9ba8bfcef) from Async(default) with arguments: "03728024-add5-49ec-ae03-6555f0a0d3c6"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:32:41 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
[ActiveJob] [ReleaseJob] [6ebc5843-a3f2-4cd3-b817-06a9ba8bfcef]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "03728024-add5-49ec-ae03-6555f0a0d3c6"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [6ebc5843-a3f2-4cd3-b817-06a9ba8bfcef] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [6ebc5843-a3f2-4cd3-b817-06a9ba8bfcef] Error performing ReleaseJob (Job ID: 6ebc5843-a3f2-4cd3-b817-06a9ba8bfcef) from Async(default) in 19.07ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "25e29dbd-330c-4312-9a6a-81aff4892ba6"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5\n"], ["created_at", "2018-10-18 02:32:41.095985"], ["updated_at", "2018-10-18 02:32:41.095985"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5"], ["name", "test"], ["created_at", "2018-10-18 02:32:41.101645"], ["updated_at", "2018-10-18 02:32:41.101645"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "817091eb-afec-4f16-8bcc-e684cda068a3"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 2c37ef6b-3750-4150-b501-675a08105187\napp_uid: 10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5\n"], ["created_at", "2018-10-18 02:32:41.104372"], ["updated_at", "2018-10-18 02:32:41.104372"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "2c37ef6b-3750-4150-b501-675a08105187"], ["name", "review"], ["created_at", "2018-10-18 02:32:41.112450"], ["updated_at", "2018-10-18 02:32:41.112450"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2c37ef6b-3750-4150-b501-675a08105187"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"2c37ef6b-3750-4150-b501-675a08105187", "app_uid"=>"10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7415d465-eb4a-49c0-8b46-f49ccbb7adfd"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 513b1038-8acc-49c7-8d22-3720aad4e8f9\nstage_uid: 2c37ef6b-3750-4150-b501-675a08105187\napp_uid: 10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5\n"], ["created_at", "2018-10-18 02:32:41.116642"], ["updated_at", "2018-10-18 02:32:41.116642"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2c37ef6b-3750-4150-b501-675a08105187"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "513b1038-8acc-49c7-8d22-3720aad4e8f9"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:32:41.120204"], ["updated_at", "2018-10-18 02:32:41.120204"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "04d8f917-3d39-4c72-9dda-2f95a5079ec3"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: ddb08b4d-c9de-4606-9f6b-eacc6099e05f\napp_uid: 10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5\n"], ["created_at", "2018-10-18 02:32:41.124272"], ["updated_at", "2018-10-18 02:32:41.124272"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "ddb08b4d-c9de-4606-9f6b-eacc6099e05f"], ["name", "staging"], ["created_at", "2018-10-18 02:32:41.126915"], ["updated_at", "2018-10-18 02:32:41.126915"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ddb08b4d-c9de-4606-9f6b-eacc6099e05f"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"ddb08b4d-c9de-4606-9f6b-eacc6099e05f", "app_uid"=>"10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1a359d14-b495-4c40-aebf-aefde2bacf13"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: e7b08025-54fb-4127-b269-7d29100974e4\nstage_uid: ddb08b4d-c9de-4606-9f6b-eacc6099e05f\napp_uid: 10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5\n"], ["created_at", "2018-10-18 02:32:41.129878"], ["updated_at", "2018-10-18 02:32:41.129878"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "10c9a0aa-6a4e-41ba-9bbe-525eed8ec8d5"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ddb08b4d-c9de-4606-9f6b-eacc6099e05f"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "e7b08025-54fb-4127-b269-7d29100974e4"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:32:41.132915"], ["updated_at", "2018-10-18 02:32:41.132915"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 54ms (ActiveRecord: 3.8ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f223f65e-90d8-4362-8d3f-c7300155074d"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 39e07d67-7568-49ef-b2f1-fb0dd851e2f5\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:32:41.147102"], ["updated_at", "2018-10-18 02:32:41.147102"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "39e07d67-7568-49ef-b2f1-fb0dd851e2f5"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:32:41.152585"], ["updated_at", "2018-10-18 02:32:41.152585"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6b80e709-f20b-484a-9896-2556856f979d"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:32:41.156683"], ["updated_at", "2018-10-18 02:32:41.156683"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8f441a01-62d0-4e91-8d63-5a5b7291bb1b"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 188b6ff6-2af5-4a42-b23f-dcfd8106c654\n"], ["created_at", "2018-10-18 02:32:41.161986"], ["updated_at", "2018-10-18 02:32:41.161986"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "188b6ff6-2af5-4a42-b23f-dcfd8106c654"], ["name", "test2"], ["created_at", "2018-10-18 02:32:41.165168"], ["updated_at", "2018-10-18 02:32:41.165168"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "442f1dc5-49cb-4cc3-aa6d-8fd85e176f27"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: f4ce76cb-a916-4cc3-9ade-079c22f2f03e\n"], ["created_at", "2018-10-18 02:32:41.168017"], ["updated_at", "2018-10-18 02:32:41.168017"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "f4ce76cb-a916-4cc3-9ade-079c22f2f03e"], ["name", "test"], ["created_at", "2018-10-18 02:32:41.170516"], ["updated_at", "2018-10-18 02:32:41.170516"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a6d702a0-aa54-4333-a70c-1ea881adddba"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:32:41.172429"], ["updated_at", "2018-10-18 02:32:41.172429"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7408d48a-36cc-47b7-9d83-745ac76c4e46"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 257803e6-d63d-4b1b-92fd-215726966754\n"], ["created_at", "2018-10-18 02:32:41.175945"], ["updated_at", "2018-10-18 02:32:41.175945"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "257803e6-d63d-4b1b-92fd-215726966754"], ["name", "test"], ["created_at", "2018-10-18 02:32:41.179068"], ["updated_at", "2018-10-18 02:32:41.179068"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "99d5c8d9-6118-4054-98e4-e0fe76495f7d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: a8f1b860-49c8-4781-aa48-cf5ce91d766f\n"], ["created_at", "2018-10-18 02:32:41.182351"], ["updated_at", "2018-10-18 02:32:41.182351"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a8f1b860-49c8-4781-aa48-cf5ce91d766f"], ["name", "test2"], ["created_at", "2018-10-18 02:32:41.184962"], ["updated_at", "2018-10-18 02:32:41.184962"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "06c4cc42-6364-468d-8080-968e6c8da39b"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:32:41.188199"], ["updated_at", "2018-10-18 02:32:41.188199"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:32:41.191592"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d8d632da-b298-40df-8403-8f81ba4b6ef4"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:32:41.194449"], ["updated_at", "2018-10-18 02:32:41.194449"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:32:41.196407"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:34:24.327011', '2018-10-18 02:34:24.327011')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:34:24.329410', '2018-10-18 02:34:24.329410')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:34:24.331090', '2018-10-18 02:34:24.331090', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:34:24.332425', '2018-10-18 02:34:24.332425')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:34:24.333848', '2018-10-18 02:34:24.333848', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f785eff1-ad19-4385-b819-f951b3ba4732"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 3ddaef85-22b6-421a-869e-5fe41aec11a9\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:34:24.359364"], ["updated_at", "2018-10-18 02:34:24.359364"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "3ddaef85-22b6-421a-869e-5fe41aec11a9"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:34:24.366693"], ["updated_at", "2018-10-18 02:34:24.366693"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "37a703ef-5930-4da6-a12d-5d513fc721d4"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 2e413d4e-497e-472c-b3d4-43aabe4cf147\n"], ["created_at", "2018-10-18 02:34:24.371334"], ["updated_at", "2018-10-18 02:34:24.371334"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2e413d4e-497e-472c-b3d4-43aabe4cf147"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:34:24.378033"], ["updated_at", "2018-10-18 02:34:24.378033"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: c2e086da-2085-4f45-89de-66ba8da4ce13) to Async(default) with arguments: "37a703ef-5930-4da6-a12d-5d513fc721d4"
[ActiveJob] [ReleaseJob] [c2e086da-2085-4f45-89de-66ba8da4ce13] Performing ReleaseJob (Job ID: c2e086da-2085-4f45-89de-66ba8da4ce13) from Async(default) with arguments: "37a703ef-5930-4da6-a12d-5d513fc721d4"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [c2e086da-2085-4f45-89de-66ba8da4ce13]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "37a703ef-5930-4da6-a12d-5d513fc721d4"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [c2e086da-2085-4f45-89de-66ba8da4ce13] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [c2e086da-2085-4f45-89de-66ba8da4ce13] Error performing ReleaseJob (Job ID: c2e086da-2085-4f45-89de-66ba8da4ce13) from Async(default) in 12.64ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a7ce6c68-820f-479a-882d-f57984b3c2da"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 9b413018-3d0f-4f5a-8a11-b2525249e2a7\n"], ["created_at", "2018-10-18 02:34:24.393186"], ["updated_at", "2018-10-18 02:34:24.393186"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "9b413018-3d0f-4f5a-8a11-b2525249e2a7"], ["status", "PENDING"], ["created_at", "2018-10-18 02:34:24.401868"], ["updated_at", "2018-10-18 02:34:24.401868"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
----------------------------
AppsTest: test_create_an_app
----------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:34:24 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0bf49bfc-d1a3-4fb8-80ae-d404f2b11a96"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: fa0618c1-63bd-40b6-9575-d0f589dd8aa0\n"], ["created_at", "2018-10-18 02:34:24.416647"], ["updated_at", "2018-10-18 02:34:24.416647"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "fa0618c1-63bd-40b6-9575-d0f589dd8aa0"], ["name", "test"], ["created_at", "2018-10-18 02:34:24.419163"], ["updated_at", "2018-10-18 02:34:24.419163"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"fa0618c1-63bd-40b6-9575-d0f589dd8aa0"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "25021f7b-be25-41ec-98df-ce5e162ec1e4"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: e223dc1b-9294-46ea-8623-212f6421731b\napp_uid: fa0618c1-63bd-40b6-9575-d0f589dd8aa0\n"], ["created_at", "2018-10-18 02:34:24.421659"], ["updated_at", "2018-10-18 02:34:24.421659"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "fa0618c1-63bd-40b6-9575-d0f589dd8aa0"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "e223dc1b-9294-46ea-8623-212f6421731b"], ["name", "review"], ["created_at", "2018-10-18 02:34:24.424623"], ["updated_at", "2018-10-18 02:34:24.424623"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e223dc1b-9294-46ea-8623-212f6421731b"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"e223dc1b-9294-46ea-8623-212f6421731b", "app_uid"=>"fa0618c1-63bd-40b6-9575-d0f589dd8aa0"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b71c7b21-b158-4b8e-b2de-088f00049564"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: f6299dfe-fa16-4bd1-a160-172a2e2c0dd5\nstage_uid: e223dc1b-9294-46ea-8623-212f6421731b\napp_uid: fa0618c1-63bd-40b6-9575-d0f589dd8aa0\n"], ["created_at", "2018-10-18 02:34:24.427703"], ["updated_at", "2018-10-18 02:34:24.427703"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "fa0618c1-63bd-40b6-9575-d0f589dd8aa0"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e223dc1b-9294-46ea-8623-212f6421731b"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "f6299dfe-fa16-4bd1-a160-172a2e2c0dd5"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:34:24.430649"], ["updated_at", "2018-10-18 02:34:24.430649"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"fa0618c1-63bd-40b6-9575-d0f589dd8aa0"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1dabc98b-ef32-4756-a993-8a04b58ad60d"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 67e14805-0fa4-48f6-90cd-bc71b14dea1c\napp_uid: fa0618c1-63bd-40b6-9575-d0f589dd8aa0\n"], ["created_at", "2018-10-18 02:34:24.434401"], ["updated_at", "2018-10-18 02:34:24.434401"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "fa0618c1-63bd-40b6-9575-d0f589dd8aa0"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "67e14805-0fa4-48f6-90cd-bc71b14dea1c"], ["name", "staging"], ["created_at", "2018-10-18 02:34:24.436942"], ["updated_at", "2018-10-18 02:34:24.436942"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "67e14805-0fa4-48f6-90cd-bc71b14dea1c"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"67e14805-0fa4-48f6-90cd-bc71b14dea1c", "app_uid"=>"fa0618c1-63bd-40b6-9575-d0f589dd8aa0"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "26773921-6357-4afd-9a2c-a1309ea6acba"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 7eece266-72fc-455e-947d-2ec8c98533cb\nstage_uid: 67e14805-0fa4-48f6-90cd-bc71b14dea1c\napp_uid: fa0618c1-63bd-40b6-9575-d0f589dd8aa0\n"], ["created_at", "2018-10-18 02:34:24.439650"], ["updated_at", "2018-10-18 02:34:24.439650"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "fa0618c1-63bd-40b6-9575-d0f589dd8aa0"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "67e14805-0fa4-48f6-90cd-bc71b14dea1c"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "7eece266-72fc-455e-947d-2ec8c98533cb"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:34:24.442635"], ["updated_at", "2018-10-18 02:34:24.442635"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 36ms (ActiveRecord: 3.4ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b3ab1fee-56cb-4a98-9769-971b4e8cd997"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 6e187045-04fc-4a3e-8350-8baba6e6db63\n"], ["created_at", "2018-10-18 02:34:24.450385"], ["updated_at", "2018-10-18 02:34:24.450385"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "6e187045-04fc-4a3e-8350-8baba6e6db63"], ["name", "test2"], ["created_at", "2018-10-18 02:34:24.453999"], ["updated_at", "2018-10-18 02:34:24.453999"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "57eec1ca-e5fc-4d38-af61-655783bb98c5"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:34:24.456449"], ["updated_at", "2018-10-18 02:34:24.456449"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "78a82a22-014f-43f8-a080-4b099b3fcdbd"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:34:24.459702"], ["updated_at", "2018-10-18 02:34:24.459702"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0063eda2-c178-46bd-9d51-e861bcc55fd3"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:34:24.463893"], ["updated_at", "2018-10-18 02:34:24.463893"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:34:24.465934"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "07bbeb68-7192-42a9-ae4a-57350e3b130f"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:34:24.469613"], ["updated_at", "2018-10-18 02:34:24.469613"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:34:24.473460"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0c768035-b16e-45e3-b105-c756ef2de595"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 34c5667e-576d-4928-a083-c34de7d6f36d\n"], ["created_at", "2018-10-18 02:34:24.476174"], ["updated_at", "2018-10-18 02:34:24.476174"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "34c5667e-576d-4928-a083-c34de7d6f36d"], ["name", "test"], ["created_at", "2018-10-18 02:34:24.479220"], ["updated_at", "2018-10-18 02:34:24.479220"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "deed6bcb-7563-424e-857f-9a798813f30d"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 29761713-fbdf-4c89-8843-957c4ca63e61\n"], ["created_at", "2018-10-18 02:34:24.481511"], ["updated_at", "2018-10-18 02:34:24.481511"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "29761713-fbdf-4c89-8843-957c4ca63e61"], ["name", "test"], ["created_at", "2018-10-18 02:34:24.484078"], ["updated_at", "2018-10-18 02:34:24.484078"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "102623e6-6da4-4edc-80d5-2f4128d76f2f"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: cbf6483b-21a5-4a40-9f83-3589779bba7b\n"], ["created_at", "2018-10-18 02:34:24.486900"], ["updated_at", "2018-10-18 02:34:24.486900"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "cbf6483b-21a5-4a40-9f83-3589779bba7b"], ["name", "test2"], ["created_at", "2018-10-18 02:34:24.489503"], ["updated_at", "2018-10-18 02:34:24.489503"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:34:56.790909', '2018-10-18 02:34:56.790909')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:34:56.792844', '2018-10-18 02:34:56.792844')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:34:56.794456', '2018-10-18 02:34:56.794456', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:34:56.796188', '2018-10-18 02:34:56.796188')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:34:56.797620', '2018-10-18 02:34:56.797620', 980190962)[0m
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9716a86d-58ea-4ac9-961d-372207b5a1e0"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 81352369-0220-4efd-82a0-35256b1163b8\n"], ["created_at", "2018-10-18 02:34:56.815680"], ["updated_at", "2018-10-18 02:34:56.815680"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "81352369-0220-4efd-82a0-35256b1163b8"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:34:56.824049"], ["updated_at", "2018-10-18 02:34:56.824049"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: dd622df9-42dd-4b1a-bf65-6684a69b7420) to Async(default) with arguments: "9716a86d-58ea-4ac9-961d-372207b5a1e0"
[ActiveJob] [ReleaseJob] [dd622df9-42dd-4b1a-bf65-6684a69b7420] Performing ReleaseJob (Job ID: dd622df9-42dd-4b1a-bf65-6684a69b7420) from Async(default) with arguments: "9716a86d-58ea-4ac9-961d-372207b5a1e0"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "31eddf9b-0de6-4556-b999-f043678d684a"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: a5ae1c76-b473-477f-8c29-d415d61ee9f8\n"], ["created_at", "2018-10-18 02:34:56.837019"], ["updated_at", "2018-10-18 02:34:56.837019"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "a5ae1c76-b473-477f-8c29-d415d61ee9f8"], ["status", "PENDING"], ["created_at", "2018-10-18 02:34:56.845938"], ["updated_at", "2018-10-18 02:34:56.845938"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [dd622df9-42dd-4b1a-bf65-6684a69b7420]   [1m[36mEvent Load (7.5ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "9716a86d-58ea-4ac9-961d-372207b5a1e0"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [dd622df9-42dd-4b1a-bf65-6684a69b7420] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
[ActiveJob] [ReleaseJob] [dd622df9-42dd-4b1a-bf65-6684a69b7420] Error performing ReleaseJob (Job ID: dd622df9-42dd-4b1a-bf65-6684a69b7420) from Async(default) in 21.76ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:34:56 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9a02e75d-2a17-4557-a4a3-33b8a9c13d6c"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 94f10f22-bd66-402b-9a95-96629ae3aadc\n"], ["created_at", "2018-10-18 02:34:56.861746"], ["updated_at", "2018-10-18 02:34:56.861746"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "94f10f22-bd66-402b-9a95-96629ae3aadc"], ["name", "test"], ["created_at", "2018-10-18 02:34:56.866795"], ["updated_at", "2018-10-18 02:34:56.866795"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"94f10f22-bd66-402b-9a95-96629ae3aadc"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9d23b4fd-8cb0-42cf-a7f2-746b8e72612e"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 9b664217-9144-4e65-addb-f4488507c502\napp_uid: 94f10f22-bd66-402b-9a95-96629ae3aadc\n"], ["created_at", "2018-10-18 02:34:56.869427"], ["updated_at", "2018-10-18 02:34:56.869427"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "94f10f22-bd66-402b-9a95-96629ae3aadc"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9b664217-9144-4e65-addb-f4488507c502"], ["name", "review"], ["created_at", "2018-10-18 02:34:56.877652"], ["updated_at", "2018-10-18 02:34:56.877652"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9b664217-9144-4e65-addb-f4488507c502"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"9b664217-9144-4e65-addb-f4488507c502", "app_uid"=>"94f10f22-bd66-402b-9a95-96629ae3aadc"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "47b5d541-04c4-40cd-a9f2-ee51b310bee0"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 8f8830e3-c0b8-41e5-a5f5-a5e78cbb0734\nstage_uid: 9b664217-9144-4e65-addb-f4488507c502\napp_uid: 94f10f22-bd66-402b-9a95-96629ae3aadc\n"], ["created_at", "2018-10-18 02:34:56.881728"], ["updated_at", "2018-10-18 02:34:56.881728"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "94f10f22-bd66-402b-9a95-96629ae3aadc"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9b664217-9144-4e65-addb-f4488507c502"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "8f8830e3-c0b8-41e5-a5f5-a5e78cbb0734"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:34:56.885271"], ["updated_at", "2018-10-18 02:34:56.885271"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"94f10f22-bd66-402b-9a95-96629ae3aadc"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3c3a469d-f602-472e-b9ca-1e13bd106ed8"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 84a3ad41-3df0-47b5-9731-148347f8da0c\napp_uid: 94f10f22-bd66-402b-9a95-96629ae3aadc\n"], ["created_at", "2018-10-18 02:34:56.889200"], ["updated_at", "2018-10-18 02:34:56.889200"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "94f10f22-bd66-402b-9a95-96629ae3aadc"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "84a3ad41-3df0-47b5-9731-148347f8da0c"], ["name", "staging"], ["created_at", "2018-10-18 02:34:56.891798"], ["updated_at", "2018-10-18 02:34:56.891798"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "84a3ad41-3df0-47b5-9731-148347f8da0c"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"84a3ad41-3df0-47b5-9731-148347f8da0c", "app_uid"=>"94f10f22-bd66-402b-9a95-96629ae3aadc"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "92324c95-c7ef-4c8e-a69e-944b7b505566"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: f0f917cc-4fdb-4a38-82fd-fa5b510175db\nstage_uid: 84a3ad41-3df0-47b5-9731-148347f8da0c\napp_uid: 94f10f22-bd66-402b-9a95-96629ae3aadc\n"], ["created_at", "2018-10-18 02:34:56.894487"], ["updated_at", "2018-10-18 02:34:56.894487"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "94f10f22-bd66-402b-9a95-96629ae3aadc"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "84a3ad41-3df0-47b5-9731-148347f8da0c"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "f0f917cc-4fdb-4a38-82fd-fa5b510175db"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:34:56.897851"], ["updated_at", "2018-10-18 02:34:56.897851"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 51ms (ActiveRecord: 3.5ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:34:56 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 3ms (ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "98b63b7f-785d-4430-b160-23ea5e5c41b1"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 4c3ef241-fe05-4cf4-9ab7-09535cdfa669\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:34:56.914871"], ["updated_at", "2018-10-18 02:34:56.914871"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "4c3ef241-fe05-4cf4-9ab7-09535cdfa669"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:34:56.919900"], ["updated_at", "2018-10-18 02:34:56.919900"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dac5cfa0-23d7-45a7-98e4-4c4c65fa3686"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 7ac0ebe8-958b-4980-a8a2-19bdcef97f9e\n"], ["created_at", "2018-10-18 02:34:56.924058"], ["updated_at", "2018-10-18 02:34:56.924058"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "7ac0ebe8-958b-4980-a8a2-19bdcef97f9e"], ["name", "test"], ["created_at", "2018-10-18 02:34:56.927224"], ["updated_at", "2018-10-18 02:34:56.927224"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "05712957-3128-4fdc-9579-b2cdc2a8840a"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:34:56.930710"], ["updated_at", "2018-10-18 02:34:56.930710"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:34:56.933947"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8093b84e-c8e8-4758-ac3f-31d1aa673fca"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:34:56.936367"], ["updated_at", "2018-10-18 02:34:56.936367"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5596c783-9b1f-4a40-bb06-d4ec958cc398"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: a9ac94ff-d3fe-48f7-936f-e663ff7869ab\n"], ["created_at", "2018-10-18 02:34:56.941016"], ["updated_at", "2018-10-18 02:34:56.941016"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a9ac94ff-d3fe-48f7-936f-e663ff7869ab"], ["name", "test2"], ["created_at", "2018-10-18 02:34:56.943723"], ["updated_at", "2018-10-18 02:34:56.943723"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "13d18b4c-54f7-4f2c-8aaf-a18ec2651a0e"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:34:56.946031"], ["updated_at", "2018-10-18 02:34:56.946031"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:34:56.948489"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8294425d-5189-4301-9fd5-118f1299cb56"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: f9248249-e850-4d1a-8acc-fdd4407b2668\n"], ["created_at", "2018-10-18 02:34:56.951391"], ["updated_at", "2018-10-18 02:34:56.951391"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "f9248249-e850-4d1a-8acc-fdd4407b2668"], ["name", "test"], ["created_at", "2018-10-18 02:34:56.953783"], ["updated_at", "2018-10-18 02:34:56.953783"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0ac44b89-c9bf-481d-8a44-cf867fbf999d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 7eda9f30-5ffc-4c81-9c0d-83ab66235322\n"], ["created_at", "2018-10-18 02:34:56.956869"], ["updated_at", "2018-10-18 02:34:56.956869"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "7eda9f30-5ffc-4c81-9c0d-83ab66235322"], ["name", "test2"], ["created_at", "2018-10-18 02:34:56.960433"], ["updated_at", "2018-10-18 02:34:56.960433"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3681f18f-fe7a-4805-80ec-41857ee7e7ef"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:34:56.963035"], ["updated_at", "2018-10-18 02:34:56.963035"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:35:28.308772', '2018-10-18 02:35:28.308772')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:35:28.311785', '2018-10-18 02:35:28.311785')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:35:28.314161', '2018-10-18 02:35:28.314161', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:35:28.316166', '2018-10-18 02:35:28.316166')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:35:28.317985', '2018-10-18 02:35:28.317985', 980190962)[0m
  [1m[35m (4.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3f7eb0d6-1d09-4e71-a371-eeb40be6f9af"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 1a98788f-a6ab-47f5-ba71-4d6aaddccda0\n"], ["created_at", "2018-10-18 02:35:28.335852"], ["updated_at", "2018-10-18 02:35:28.335852"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1a98788f-a6ab-47f5-ba71-4d6aaddccda0"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:35:28.343723"], ["updated_at", "2018-10-18 02:35:28.343723"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 1359d9dc-2ac7-4d9d-9920-95d998b07ebd) to Async(default) with arguments: "3f7eb0d6-1d09-4e71-a371-eeb40be6f9af"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [1359d9dc-2ac7-4d9d-9920-95d998b07ebd] Performing ReleaseJob (Job ID: 1359d9dc-2ac7-4d9d-9920-95d998b07ebd) from Async(default) with arguments: "3f7eb0d6-1d09-4e71-a371-eeb40be6f9af"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f1c97811-7a13-4db8-baf0-f2b916645c14"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: d115d608-0506-4afb-9ce3-ddbdf23c8b7f\n"], ["created_at", "2018-10-18 02:35:28.356936"], ["updated_at", "2018-10-18 02:35:28.356936"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "d115d608-0506-4afb-9ce3-ddbdf23c8b7f"], ["status", "PENDING"], ["created_at", "2018-10-18 02:35:28.366712"], ["updated_at", "2018-10-18 02:35:28.366712"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [1359d9dc-2ac7-4d9d-9920-95d998b07ebd]   [1m[36mEvent Load (6.9ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "3f7eb0d6-1d09-4e71-a371-eeb40be6f9af"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [1359d9dc-2ac7-4d9d-9920-95d998b07ebd] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [1359d9dc-2ac7-4d9d-9920-95d998b07ebd] Error performing ReleaseJob (Job ID: 1359d9dc-2ac7-4d9d-9920-95d998b07ebd) from Async(default) in 22.68ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "638bab38-abf4-436d-bdcf-4602de6119a9"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 877f70a0-8851-4876-9db5-ec64765c4070\n"], ["created_at", "2018-10-18 02:35:28.379467"], ["updated_at", "2018-10-18 02:35:28.379467"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "877f70a0-8851-4876-9db5-ec64765c4070"], ["name", "test2"], ["created_at", "2018-10-18 02:35:28.383747"], ["updated_at", "2018-10-18 02:35:28.383747"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c914812c-cc4c-4769-8244-2c82a6cf0a6d"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:35:28.386576"], ["updated_at", "2018-10-18 02:35:28.386576"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bbf1641e-2f5a-4c84-9bd6-040bafb3acd3"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: a2a17e1d-8cc6-4f12-9681-522fa5eb3fb9\n"], ["created_at", "2018-10-18 02:35:28.391342"], ["updated_at", "2018-10-18 02:35:28.391342"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "a2a17e1d-8cc6-4f12-9681-522fa5eb3fb9"], ["name", "test"], ["created_at", "2018-10-18 02:35:28.393811"], ["updated_at", "2018-10-18 02:35:28.393811"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "36901fa3-04d1-41cc-a5c3-63a649339baf"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 5e2cdece-3bec-4ba9-bd62-f2d995d223a3\n"], ["created_at", "2018-10-18 02:35:28.396885"], ["updated_at", "2018-10-18 02:35:28.396885"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "5e2cdece-3bec-4ba9-bd62-f2d995d223a3"], ["name", "test2"], ["created_at", "2018-10-18 02:35:28.399915"], ["updated_at", "2018-10-18 02:35:28.399915"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ebf13112-f9d6-4882-a264-2d91a8054933"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:35:28.403524"], ["updated_at", "2018-10-18 02:35:28.403524"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:35:28.407272"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "551471d8-44c1-40f1-8cc2-40b25b699550"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 417427e8-957f-43c8-bac1-159a3ee0c45e\n"], ["created_at", "2018-10-18 02:35:28.410611"], ["updated_at", "2018-10-18 02:35:28.410611"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "417427e8-957f-43c8-bac1-159a3ee0c45e"], ["name", "test"], ["created_at", "2018-10-18 02:35:28.413023"], ["updated_at", "2018-10-18 02:35:28.413023"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e891c8e9-90bb-4a12-b02b-be06f9f06d9c"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:35:28.414752"], ["updated_at", "2018-10-18 02:35:28.414752"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2b4dd0b2-94ee-4661-8bf0-b8938f2fe916"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:35:28.418100"], ["updated_at", "2018-10-18 02:35:28.418100"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:35:28.420098"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:35:28 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "16113f1f-77f9-4b30-94f7-b7667c4265ea"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 83386bea-c5be-4def-a891-2e32b9d3e0c1\n"], ["created_at", "2018-10-18 02:35:28.440609"], ["updated_at", "2018-10-18 02:35:28.440609"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "83386bea-c5be-4def-a891-2e32b9d3e0c1"], ["name", "test"], ["created_at", "2018-10-18 02:35:28.443340"], ["updated_at", "2018-10-18 02:35:28.443340"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"83386bea-c5be-4def-a891-2e32b9d3e0c1"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b5da1894-7537-49fc-b319-97b8a686b5fa"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: cef0c8c4-ae7c-4c9f-8b21-4d528e88f158\napp_uid: 83386bea-c5be-4def-a891-2e32b9d3e0c1\n"], ["created_at", "2018-10-18 02:35:28.446658"], ["updated_at", "2018-10-18 02:35:28.446658"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "83386bea-c5be-4def-a891-2e32b9d3e0c1"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "cef0c8c4-ae7c-4c9f-8b21-4d528e88f158"], ["name", "review"], ["created_at", "2018-10-18 02:35:28.449144"], ["updated_at", "2018-10-18 02:35:28.449144"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "cef0c8c4-ae7c-4c9f-8b21-4d528e88f158"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"cef0c8c4-ae7c-4c9f-8b21-4d528e88f158", "app_uid"=>"83386bea-c5be-4def-a891-2e32b9d3e0c1"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f1851338-7213-4454-9ef1-f3d2da6f6e3b"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 4578bcf9-b7d1-4c9d-bb66-3614ea1c3fae\nstage_uid: cef0c8c4-ae7c-4c9f-8b21-4d528e88f158\napp_uid: 83386bea-c5be-4def-a891-2e32b9d3e0c1\n"], ["created_at", "2018-10-18 02:35:28.452579"], ["updated_at", "2018-10-18 02:35:28.452579"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "83386bea-c5be-4def-a891-2e32b9d3e0c1"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "cef0c8c4-ae7c-4c9f-8b21-4d528e88f158"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "4578bcf9-b7d1-4c9d-bb66-3614ea1c3fae"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:35:28.456247"], ["updated_at", "2018-10-18 02:35:28.456247"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"83386bea-c5be-4def-a891-2e32b9d3e0c1"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fd123832-b706-4b88-b45b-357733be39eb"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 8e47c52c-6f3d-44f5-a157-1af707d417d6\napp_uid: 83386bea-c5be-4def-a891-2e32b9d3e0c1\n"], ["created_at", "2018-10-18 02:35:28.461463"], ["updated_at", "2018-10-18 02:35:28.461463"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "83386bea-c5be-4def-a891-2e32b9d3e0c1"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "8e47c52c-6f3d-44f5-a157-1af707d417d6"], ["name", "staging"], ["created_at", "2018-10-18 02:35:28.464039"], ["updated_at", "2018-10-18 02:35:28.464039"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "8e47c52c-6f3d-44f5-a157-1af707d417d6"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"8e47c52c-6f3d-44f5-a157-1af707d417d6", "app_uid"=>"83386bea-c5be-4def-a891-2e32b9d3e0c1"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1defa7eb-1fb7-4511-8c0a-72fdef877d99"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 3654d1ec-b2f2-4088-b294-119490df895d\nstage_uid: 8e47c52c-6f3d-44f5-a157-1af707d417d6\napp_uid: 83386bea-c5be-4def-a891-2e32b9d3e0c1\n"], ["created_at", "2018-10-18 02:35:28.466810"], ["updated_at", "2018-10-18 02:35:28.466810"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "83386bea-c5be-4def-a891-2e32b9d3e0c1"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "8e47c52c-6f3d-44f5-a157-1af707d417d6"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "3654d1ec-b2f2-4088-b294-119490df895d"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:35:28.469980"], ["updated_at", "2018-10-18 02:35:28.469980"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 40ms (ActiveRecord: 3.6ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:35:28 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 12ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "68c77e8e-0f17-487d-9886-8d16bb639b03"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: e8e622ea-65b1-4c77-839c-653884924e0a\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:35:28.491272"], ["updated_at", "2018-10-18 02:35:28.491272"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "e8e622ea-65b1-4c77-839c-653884924e0a"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:35:28.496421"], ["updated_at", "2018-10-18 02:35:28.496421"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:35:39.226835', '2018-10-18 02:35:39.226835')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:35:39.228862', '2018-10-18 02:35:39.228862')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:35:39.230328', '2018-10-18 02:35:39.230328', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:35:39.231783', '2018-10-18 02:35:39.231783')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:35:39.233171', '2018-10-18 02:35:39.233171', 980190962)[0m
  [1m[35m (8.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "51cb6c5d-f7e0-4e73-a050-37c12135d72a"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: ef04ca6d-8343-46c0-8d41-89de08637c25\n"], ["created_at", "2018-10-18 02:35:39.254487"], ["updated_at", "2018-10-18 02:35:39.254487"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ef04ca6d-8343-46c0-8d41-89de08637c25"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:35:39.261117"], ["updated_at", "2018-10-18 02:35:39.261117"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 0449b3db-c3ff-4d28-aba7-db6ed510fb95) to Async(default) with arguments: "51cb6c5d-f7e0-4e73-a050-37c12135d72a"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0449b3db-c3ff-4d28-aba7-db6ed510fb95] Performing ReleaseJob (Job ID: 0449b3db-c3ff-4d28-aba7-db6ed510fb95) from Async(default) with arguments: "51cb6c5d-f7e0-4e73-a050-37c12135d72a"
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "910f8d0b-c5f7-4a6d-b7ca-8a1712171eb8"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 4fec9f8f-6554-4deb-a670-25c78108fc8f\n"], ["created_at", "2018-10-18 02:35:39.272710"], ["updated_at", "2018-10-18 02:35:39.272710"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "4fec9f8f-6554-4deb-a670-25c78108fc8f"], ["status", "PENDING"], ["created_at", "2018-10-18 02:35:39.282027"], ["updated_at", "2018-10-18 02:35:39.282027"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
[ActiveJob] [ReleaseJob] [0449b3db-c3ff-4d28-aba7-db6ed510fb95]   [1m[36mEvent Load (0.3ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "51cb6c5d-f7e0-4e73-a050-37c12135d72a"], ["LIMIT", 1]]
--------------------------------------
[ActiveJob] [ReleaseJob] [0449b3db-c3ff-4d28-aba7-db6ed510fb95] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0449b3db-c3ff-4d28-aba7-db6ed510fb95] Error performing ReleaseJob (Job ID: 0449b3db-c3ff-4d28-aba7-db6ed510fb95) from Async(default) in 23.55ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "14523e71-0c78-4400-bde6-ac0712f83d85"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: b38d9b99-a209-4d12-84db-7f68486d0276\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:35:39.297376"], ["updated_at", "2018-10-18 02:35:39.297376"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "b38d9b99-a209-4d12-84db-7f68486d0276"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:35:39.303594"], ["updated_at", "2018-10-18 02:35:39.303594"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a17092b4-7b3c-4ff9-9007-33b5d4589d87"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: e1575f34-da50-4dab-ae5a-64f06fa1f7de\n"], ["created_at", "2018-10-18 02:35:39.307305"], ["updated_at", "2018-10-18 02:35:39.307305"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "e1575f34-da50-4dab-ae5a-64f06fa1f7de"], ["name", "test"], ["created_at", "2018-10-18 02:35:39.309172"], ["updated_at", "2018-10-18 02:35:39.309172"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b69001a4-513b-418e-a478-d2216b8407cb"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: b88570e7-817f-48a8-a59a-9b46edbe1844\n"], ["created_at", "2018-10-18 02:35:39.311586"], ["updated_at", "2018-10-18 02:35:39.311586"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "b88570e7-817f-48a8-a59a-9b46edbe1844"], ["name", "test"], ["created_at", "2018-10-18 02:35:39.314085"], ["updated_at", "2018-10-18 02:35:39.314085"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "43ea68b4-e768-48e0-9527-0c07a1c17d46"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 109bf1ab-5e94-4896-971e-12515b4b8ca1\n"], ["created_at", "2018-10-18 02:35:39.317041"], ["updated_at", "2018-10-18 02:35:39.317041"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "109bf1ab-5e94-4896-971e-12515b4b8ca1"], ["name", "test2"], ["created_at", "2018-10-18 02:35:39.320487"], ["updated_at", "2018-10-18 02:35:39.320487"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "df424de9-f266-45ce-86c8-5963ef7a3d4f"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:35:39.324200"], ["updated_at", "2018-10-18 02:35:39.324200"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:35:39.327575"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1411f714-1110-44f2-ac72-e117cedafc06"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:35:39.329992"], ["updated_at", "2018-10-18 02:35:39.329992"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bd2cf97a-4b1f-4692-a195-b74587e5a3b8"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: f55b43bf-cb5c-42a7-a40e-4fde71a34f00\n"], ["created_at", "2018-10-18 02:35:39.334100"], ["updated_at", "2018-10-18 02:35:39.334100"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "f55b43bf-cb5c-42a7-a40e-4fde71a34f00"], ["name", "test2"], ["created_at", "2018-10-18 02:35:39.336766"], ["updated_at", "2018-10-18 02:35:39.336766"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d983da3-f9a9-4df6-8bf9-b1b4d31f5556"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:35:39.339884"], ["updated_at", "2018-10-18 02:35:39.339884"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7f78f8bf-ac65-4ea5-84c1-538ab55a574e"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:35:39.349459"], ["updated_at", "2018-10-18 02:35:39.349459"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:35:39.351637"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:35:39 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4e895586-dc0a-41c0-b827-0480f19d7948"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: b80c93a8-135d-49a4-bf26-1daac5a6de82\n"], ["created_at", "2018-10-18 02:35:39.366164"], ["updated_at", "2018-10-18 02:35:39.366164"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "b80c93a8-135d-49a4-bf26-1daac5a6de82"], ["name", "test"], ["created_at", "2018-10-18 02:35:39.368749"], ["updated_at", "2018-10-18 02:35:39.368749"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"b80c93a8-135d-49a4-bf26-1daac5a6de82"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9d28c40a-6fbc-4693-a62a-47c2bd4ffa0d"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: a1e76297-2846-4928-ad45-791f4b020f78\napp_uid: b80c93a8-135d-49a4-bf26-1daac5a6de82\n"], ["created_at", "2018-10-18 02:35:39.371459"], ["updated_at", "2018-10-18 02:35:39.371459"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b80c93a8-135d-49a4-bf26-1daac5a6de82"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "a1e76297-2846-4928-ad45-791f4b020f78"], ["name", "review"], ["created_at", "2018-10-18 02:35:39.373665"], ["updated_at", "2018-10-18 02:35:39.373665"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "a1e76297-2846-4928-ad45-791f4b020f78"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"a1e76297-2846-4928-ad45-791f4b020f78", "app_uid"=>"b80c93a8-135d-49a4-bf26-1daac5a6de82"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a1ba1f4d-bc54-454f-9104-779d8f37fec6"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 9a4eb889-0776-4f5a-a3f2-fcfb089d896d\nstage_uid: a1e76297-2846-4928-ad45-791f4b020f78\napp_uid: b80c93a8-135d-49a4-bf26-1daac5a6de82\n"], ["created_at", "2018-10-18 02:35:39.376415"], ["updated_at", "2018-10-18 02:35:39.376415"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b80c93a8-135d-49a4-bf26-1daac5a6de82"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "a1e76297-2846-4928-ad45-791f4b020f78"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "9a4eb889-0776-4f5a-a3f2-fcfb089d896d"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:35:39.379589"], ["updated_at", "2018-10-18 02:35:39.379589"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"b80c93a8-135d-49a4-bf26-1daac5a6de82"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "77a75785-d437-4f3f-9f84-64beb987028d"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: ff2b6fd3-141a-4510-997d-0ac2225ae74c\napp_uid: b80c93a8-135d-49a4-bf26-1daac5a6de82\n"], ["created_at", "2018-10-18 02:35:39.383585"], ["updated_at", "2018-10-18 02:35:39.383585"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b80c93a8-135d-49a4-bf26-1daac5a6de82"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "ff2b6fd3-141a-4510-997d-0ac2225ae74c"], ["name", "staging"], ["created_at", "2018-10-18 02:35:39.385723"], ["updated_at", "2018-10-18 02:35:39.385723"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ff2b6fd3-141a-4510-997d-0ac2225ae74c"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"ff2b6fd3-141a-4510-997d-0ac2225ae74c", "app_uid"=>"b80c93a8-135d-49a4-bf26-1daac5a6de82"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bc9f7e65-6020-4407-bff1-b7a0ef6a155c"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: ed1b316f-fe2d-4c0d-a22e-b81c12a0365d\nstage_uid: ff2b6fd3-141a-4510-997d-0ac2225ae74c\napp_uid: b80c93a8-135d-49a4-bf26-1daac5a6de82\n"], ["created_at", "2018-10-18 02:35:39.388319"], ["updated_at", "2018-10-18 02:35:39.388319"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b80c93a8-135d-49a4-bf26-1daac5a6de82"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ff2b6fd3-141a-4510-997d-0ac2225ae74c"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "ed1b316f-fe2d-4c0d-a22e-b81c12a0365d"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:35:39.391136"], ["updated_at", "2018-10-18 02:35:39.391136"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 35ms (ActiveRecord: 3.3ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:35:39 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:36:32.515635', '2018-10-18 02:36:32.515635')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:36:32.517741', '2018-10-18 02:36:32.517741')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:36:32.519556', '2018-10-18 02:36:32.519556', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:36:32.520879', '2018-10-18 02:36:32.520879')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:36:32.522500', '2018-10-18 02:36:32.522500', 980190962)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:36:32 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0cd47bb1-d643-4658-860e-762d7db96e3f"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: c9c365d2-c310-4b19-b0d9-0866899863dc\n"], ["created_at", "2018-10-18 02:36:32.547703"], ["updated_at", "2018-10-18 02:36:32.547703"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "c9c365d2-c310-4b19-b0d9-0866899863dc"], ["name", "test"], ["created_at", "2018-10-18 02:36:32.552842"], ["updated_at", "2018-10-18 02:36:32.552842"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"c9c365d2-c310-4b19-b0d9-0866899863dc"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9bd5a23a-8dbd-4cd5-90e3-984dd79d8cf9"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 9e7ee6f6-8d71-4796-a6e0-1b1079a7b8a4\napp_uid: c9c365d2-c310-4b19-b0d9-0866899863dc\n"], ["created_at", "2018-10-18 02:36:32.556148"], ["updated_at", "2018-10-18 02:36:32.556148"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "c9c365d2-c310-4b19-b0d9-0866899863dc"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9e7ee6f6-8d71-4796-a6e0-1b1079a7b8a4"], ["name", "review"], ["created_at", "2018-10-18 02:36:32.563622"], ["updated_at", "2018-10-18 02:36:32.563622"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9e7ee6f6-8d71-4796-a6e0-1b1079a7b8a4"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"9e7ee6f6-8d71-4796-a6e0-1b1079a7b8a4", "app_uid"=>"c9c365d2-c310-4b19-b0d9-0866899863dc"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7d4c1c45-9d26-4045-9b80-17d1f00f4bdc"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 12235a12-c398-448d-bdc0-dbd5f086bb06\nstage_uid: 9e7ee6f6-8d71-4796-a6e0-1b1079a7b8a4\napp_uid: c9c365d2-c310-4b19-b0d9-0866899863dc\n"], ["created_at", "2018-10-18 02:36:32.568751"], ["updated_at", "2018-10-18 02:36:32.568751"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "c9c365d2-c310-4b19-b0d9-0866899863dc"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9e7ee6f6-8d71-4796-a6e0-1b1079a7b8a4"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "12235a12-c398-448d-bdc0-dbd5f086bb06"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:36:32.576864"], ["updated_at", "2018-10-18 02:36:32.576864"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"c9c365d2-c310-4b19-b0d9-0866899863dc"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5597551f-2bbb-4d0e-b26a-1ce63eacd77f"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 52fab2b4-ffcc-4f26-bdd6-f17dccfa3571\napp_uid: c9c365d2-c310-4b19-b0d9-0866899863dc\n"], ["created_at", "2018-10-18 02:36:32.581793"], ["updated_at", "2018-10-18 02:36:32.581793"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "c9c365d2-c310-4b19-b0d9-0866899863dc"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "52fab2b4-ffcc-4f26-bdd6-f17dccfa3571"], ["name", "staging"], ["created_at", "2018-10-18 02:36:32.584757"], ["updated_at", "2018-10-18 02:36:32.584757"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "52fab2b4-ffcc-4f26-bdd6-f17dccfa3571"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"52fab2b4-ffcc-4f26-bdd6-f17dccfa3571", "app_uid"=>"c9c365d2-c310-4b19-b0d9-0866899863dc"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e0d19bfa-13fa-4a44-a014-51ac6a5b4df6"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: a949f81b-7ba4-4397-949c-5a8d4b1c8a86\nstage_uid: 52fab2b4-ffcc-4f26-bdd6-f17dccfa3571\napp_uid: c9c365d2-c310-4b19-b0d9-0866899863dc\n"], ["created_at", "2018-10-18 02:36:32.587852"], ["updated_at", "2018-10-18 02:36:32.587852"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "c9c365d2-c310-4b19-b0d9-0866899863dc"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "52fab2b4-ffcc-4f26-bdd6-f17dccfa3571"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "a949f81b-7ba4-4397-949c-5a8d4b1c8a86"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:36:32.591143"], ["updated_at", "2018-10-18 02:36:32.591143"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 61ms (ActiveRecord: 4.6ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:36:32 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 14ms (Views: 0.3ms | ActiveRecord: 1.1ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:36:32 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"c9c365d2-c310-4b19-b0d9-0866899863dc"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "336a89ae-5980-46ad-95a1-37743a41883a"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: c9c365d2-c310-4b19-b0d9-0866899863dc\n"], ["created_at", "2018-10-18 02:36:32.613680"], ["updated_at", "2018-10-18 02:36:32.613680"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "c9c365d2-c310-4b19-b0d9-0866899863dc"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a2a0613f-1d46-4474-b281-a2427005aea9"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 7f1dd3bf-dfef-4129-b353-939d23e00bd9\n"], ["created_at", "2018-10-18 02:36:32.618805"], ["updated_at", "2018-10-18 02:36:32.618805"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "7f1dd3bf-dfef-4129-b353-939d23e00bd9"], ["name", "test2"], ["created_at", "2018-10-18 02:36:32.622405"], ["updated_at", "2018-10-18 02:36:32.622405"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "97deb9c1-f669-4715-9418-735363f0b246"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:36:32.624855"], ["updated_at", "2018-10-18 02:36:32.624855"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "daa5d70d-0ecd-4b68-9fef-5905ad31ebde"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: a826ca04-1f1e-43cc-b24f-99d2fe9f1fe3\n"], ["created_at", "2018-10-18 02:36:32.628918"], ["updated_at", "2018-10-18 02:36:32.628918"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a826ca04-1f1e-43cc-b24f-99d2fe9f1fe3"], ["name", "test2"], ["created_at", "2018-10-18 02:36:32.631528"], ["updated_at", "2018-10-18 02:36:32.631528"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "88989a1f-9edb-4e64-93d1-0111ff3cb593"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: ef600e99-148e-4c18-ab7f-16ec4183a697\n"], ["created_at", "2018-10-18 02:36:32.634017"], ["updated_at", "2018-10-18 02:36:32.634017"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "ef600e99-148e-4c18-ab7f-16ec4183a697"], ["name", "test"], ["created_at", "2018-10-18 02:36:32.637231"], ["updated_at", "2018-10-18 02:36:32.637231"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1b0c3a3e-3da4-4d1d-905e-a902fbdb349d"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:36:32.639862"], ["updated_at", "2018-10-18 02:36:32.639862"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:36:32.641937"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "79da7cd6-f04f-4155-9720-0dd070b1c551"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 6a43a575-4e09-4faa-969b-07f9826caf4a\n"], ["created_at", "2018-10-18 02:36:32.644340"], ["updated_at", "2018-10-18 02:36:32.644340"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "6a43a575-4e09-4faa-969b-07f9826caf4a"], ["name", "test"], ["created_at", "2018-10-18 02:36:32.646550"], ["updated_at", "2018-10-18 02:36:32.646550"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6fa83bf2-cfb5-4b09-a455-ed93d32ad450"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:36:32.648292"], ["updated_at", "2018-10-18 02:36:32.648292"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ab391897-d7eb-41b3-ab02-1b11b3ce9625"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:36:32.652180"], ["updated_at", "2018-10-18 02:36:32.652180"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:36:32.655171"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (4.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "663b2bcb-eeac-4b59-b81b-630c27d4f6b9"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 06f65aca-0038-4d79-b9b7-5802a5e7e434\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:36:32.669340"], ["updated_at", "2018-10-18 02:36:32.669340"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "06f65aca-0038-4d79-b9b7-5802a5e7e434"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:36:32.675565"], ["updated_at", "2018-10-18 02:36:32.675565"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "25e2c948-28d4-419e-b3f6-3ae296e9e9d8"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 868d1233-0c7d-4209-a980-eed8a9fdf02a\n"], ["created_at", "2018-10-18 02:36:32.679951"], ["updated_at", "2018-10-18 02:36:32.679951"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "868d1233-0c7d-4209-a980-eed8a9fdf02a"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:36:32.685745"], ["updated_at", "2018-10-18 02:36:32.685745"]]
[ActiveJob] [ReleaseJob] [ff459434-6034-438c-baec-b5ed7cceb30e] Performing ReleaseJob (Job ID: ff459434-6034-438c-baec-b5ed7cceb30e) from Async(default) with arguments: "25e2c948-28d4-419e-b3f6-3ae296e9e9d8"
[ActiveJob] Enqueued ReleaseJob (Job ID: ff459434-6034-438c-baec-b5ed7cceb30e) to Async(default) with arguments: "25e2c948-28d4-419e-b3f6-3ae296e9e9d8"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [ff459434-6034-438c-baec-b5ed7cceb30e]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "25e2c948-28d4-419e-b3f6-3ae296e9e9d8"], ["LIMIT", 1]]
------------------------------------------
[ActiveJob] [ReleaseJob] [ff459434-6034-438c-baec-b5ed7cceb30e] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ff459434-6034-438c-baec-b5ed7cceb30e] Error performing ReleaseJob (Job ID: ff459434-6034-438c-baec-b5ed7cceb30e) from Async(default) in 7.74ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b9fe8eb9-1ca7-4544-9edf-728188ae8c8e"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: dbb45dd5-6ffb-4a08-8786-4bd762d7abb8\n"], ["created_at", "2018-10-18 02:36:32.697675"], ["updated_at", "2018-10-18 02:36:32.697675"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "dbb45dd5-6ffb-4a08-8786-4bd762d7abb8"], ["status", "PENDING"], ["created_at", "2018-10-18 02:36:32.707145"], ["updated_at", "2018-10-18 02:36:32.707145"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:38:32.591973', '2018-10-18 02:38:32.591973')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:38:32.594558', '2018-10-18 02:38:32.594558')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:38:32.596210', '2018-10-18 02:38:32.596210', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:38:32.597552', '2018-10-18 02:38:32.597552')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:38:32.599299', '2018-10-18 02:38:32.599299', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cbe276af-e36b-4191-b782-7afaf8706f26"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: f50dec99-2c49-4dcb-b7d4-5dcac3dd2a0e\n"], ["created_at", "2018-10-18 02:38:32.616359"], ["updated_at", "2018-10-18 02:38:32.616359"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f50dec99-2c49-4dcb-b7d4-5dcac3dd2a0e"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:38:32.624077"], ["updated_at", "2018-10-18 02:38:32.624077"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 81371c91-7c56-4aa1-b51f-77dca3f7f4b2) to Async(default) with arguments: "cbe276af-e36b-4191-b782-7afaf8706f26"
[ActiveJob] [ReleaseJob] [81371c91-7c56-4aa1-b51f-77dca3f7f4b2] Performing ReleaseJob (Job ID: 81371c91-7c56-4aa1-b51f-77dca3f7f4b2) from Async(default) with arguments: "cbe276af-e36b-4191-b782-7afaf8706f26"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b6d67a68-ed63-423f-9b1d-c7d6917f5212"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 150c7a42-ea13-4b4c-a4ae-b0e9e4f246ff\n"], ["created_at", "2018-10-18 02:38:32.636992"], ["updated_at", "2018-10-18 02:38:32.636992"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "150c7a42-ea13-4b4c-a4ae-b0e9e4f246ff"], ["status", "PENDING"], ["created_at", "2018-10-18 02:38:32.646141"], ["updated_at", "2018-10-18 02:38:32.646141"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
[ActiveJob] [ReleaseJob] [81371c91-7c56-4aa1-b51f-77dca3f7f4b2]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "cbe276af-e36b-4191-b782-7afaf8706f26"], ["LIMIT", 1]]
AppCommandsTest: test_update_a_stage
[ActiveJob] [ReleaseJob] [81371c91-7c56-4aa1-b51f-77dca3f7f4b2] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
------------------------------------
[ActiveJob] [ReleaseJob] [81371c91-7c56-4aa1-b51f-77dca3f7f4b2] Error performing ReleaseJob (Job ID: 81371c91-7c56-4aa1-b51f-77dca3f7f4b2) from Async(default) in 24.18ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a8ba059b-0c1e-4b32-859d-9401206a40cd"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:38:32.660438"], ["updated_at", "2018-10-18 02:38:32.660438"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:38:32.664394"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "68d66d0b-85bb-4d81-a555-cab6ed7ea6c5"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: fd989ac2-6d44-4c10-9bdd-d355e74d153e\n"], ["created_at", "2018-10-18 02:38:32.667780"], ["updated_at", "2018-10-18 02:38:32.667780"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "fd989ac2-6d44-4c10-9bdd-d355e74d153e"], ["name", "test2"], ["created_at", "2018-10-18 02:38:32.671800"], ["updated_at", "2018-10-18 02:38:32.671800"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8ea06dab-25a7-4b69-bcfc-55c0c7f90a2c"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:38:32.674554"], ["updated_at", "2018-10-18 02:38:32.674554"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e5bfe09b-0b2a-4403-b74f-94089ea8aeb1"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 99114165-40b5-4a1c-9c32-7636555db6ea\n"], ["created_at", "2018-10-18 02:38:32.677763"], ["updated_at", "2018-10-18 02:38:32.677763"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "99114165-40b5-4a1c-9c32-7636555db6ea"], ["name", "test"], ["created_at", "2018-10-18 02:38:32.680009"], ["updated_at", "2018-10-18 02:38:32.680009"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8a20276a-4f69-4bc9-a522-86e8045f0188"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 9b1bebb5-b23b-4d99-8d70-7e38cc2cd162\n"], ["created_at", "2018-10-18 02:38:32.682266"], ["updated_at", "2018-10-18 02:38:32.682266"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "9b1bebb5-b23b-4d99-8d70-7e38cc2cd162"], ["name", "test"], ["created_at", "2018-10-18 02:38:32.685189"], ["updated_at", "2018-10-18 02:38:32.685189"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a6c24d34-aeea-4e47-bb21-7e36e2d31163"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:38:32.687343"], ["updated_at", "2018-10-18 02:38:32.687343"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "eb27618b-acb3-4b6b-b71c-e47f4f98fd70"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 5c2bc713-75b7-45e5-a1ad-424bb28876ac\n"], ["created_at", "2018-10-18 02:38:32.691554"], ["updated_at", "2018-10-18 02:38:32.691554"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "5c2bc713-75b7-45e5-a1ad-424bb28876ac"], ["name", "test2"], ["created_at", "2018-10-18 02:38:32.694495"], ["updated_at", "2018-10-18 02:38:32.694495"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ab878366-b726-41f3-b144-e36a5cadce60"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:38:32.697019"], ["updated_at", "2018-10-18 02:38:32.697019"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:38:32.699121"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b840d5e6-30fb-46aa-823b-6be86bf1ae9b"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: ce6ad255-781b-4209-a0ac-2aa031fa35dd\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:38:32.702721"], ["updated_at", "2018-10-18 02:38:32.702721"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "ce6ad255-781b-4209-a0ac-2aa031fa35dd"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:38:32.712785"], ["updated_at", "2018-10-18 02:38:32.712785"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:38:32 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4730d25a-a8bc-4123-adba-76ac2dd45fd6"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: f16c3b7a-7bf6-4faf-907c-d8e52202e2bb\n"], ["created_at", "2018-10-18 02:38:32.728840"], ["updated_at", "2018-10-18 02:38:32.728840"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "f16c3b7a-7bf6-4faf-907c-d8e52202e2bb"], ["name", "test"], ["created_at", "2018-10-18 02:38:32.731148"], ["updated_at", "2018-10-18 02:38:32.731148"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"f16c3b7a-7bf6-4faf-907c-d8e52202e2bb"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4bef0bcc-e93f-4584-816e-190788dcdfa4"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: e4a97ce7-b0a4-41be-986d-71e7121130bf\napp_uid: f16c3b7a-7bf6-4faf-907c-d8e52202e2bb\n"], ["created_at", "2018-10-18 02:38:32.733452"], ["updated_at", "2018-10-18 02:38:32.733452"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f16c3b7a-7bf6-4faf-907c-d8e52202e2bb"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "e4a97ce7-b0a4-41be-986d-71e7121130bf"], ["name", "review"], ["created_at", "2018-10-18 02:38:32.735685"], ["updated_at", "2018-10-18 02:38:32.735685"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e4a97ce7-b0a4-41be-986d-71e7121130bf"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"e4a97ce7-b0a4-41be-986d-71e7121130bf", "app_uid"=>"f16c3b7a-7bf6-4faf-907c-d8e52202e2bb"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1d9e3743-ea85-4384-ad9e-443517552db6"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 339c5066-a282-42c5-8b7d-83fd26d76ff8\nstage_uid: e4a97ce7-b0a4-41be-986d-71e7121130bf\napp_uid: f16c3b7a-7bf6-4faf-907c-d8e52202e2bb\n"], ["created_at", "2018-10-18 02:38:32.738461"], ["updated_at", "2018-10-18 02:38:32.738461"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f16c3b7a-7bf6-4faf-907c-d8e52202e2bb"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e4a97ce7-b0a4-41be-986d-71e7121130bf"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "339c5066-a282-42c5-8b7d-83fd26d76ff8"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:38:32.741792"], ["updated_at", "2018-10-18 02:38:32.741792"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"f16c3b7a-7bf6-4faf-907c-d8e52202e2bb"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d3c0536d-2742-4b68-908e-b1859636ecd8"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 239f84b7-5347-4afd-9734-8dd0fbfade3d\napp_uid: f16c3b7a-7bf6-4faf-907c-d8e52202e2bb\n"], ["created_at", "2018-10-18 02:38:32.745703"], ["updated_at", "2018-10-18 02:38:32.745703"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f16c3b7a-7bf6-4faf-907c-d8e52202e2bb"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "239f84b7-5347-4afd-9734-8dd0fbfade3d"], ["name", "staging"], ["created_at", "2018-10-18 02:38:32.748115"], ["updated_at", "2018-10-18 02:38:32.748115"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "239f84b7-5347-4afd-9734-8dd0fbfade3d"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"239f84b7-5347-4afd-9734-8dd0fbfade3d", "app_uid"=>"f16c3b7a-7bf6-4faf-907c-d8e52202e2bb"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9bd6df20-6848-4849-a817-266c4895c4ba"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 2517a5f0-4c4c-4ae6-bb93-1ad26cedd401\nstage_uid: 239f84b7-5347-4afd-9734-8dd0fbfade3d\napp_uid: f16c3b7a-7bf6-4faf-907c-d8e52202e2bb\n"], ["created_at", "2018-10-18 02:38:32.751487"], ["updated_at", "2018-10-18 02:38:32.751487"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f16c3b7a-7bf6-4faf-907c-d8e52202e2bb"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "239f84b7-5347-4afd-9734-8dd0fbfade3d"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "2517a5f0-4c4c-4ae6-bb93-1ad26cedd401"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:38:32.754949"], ["updated_at", "2018-10-18 02:38:32.754949"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 37ms (ActiveRecord: 3.4ms)
Started GET "/api/v1/builds?version=v1&&app=test&stage=review" for 127.0.0.1 at 2018-10-17 19:38:32 -0700
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:38:32 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e37dca38-9f13-4daf-b055-7d95b223e60a"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: b67130d4-29fe-4f66-b658-d5304ae3cf16\n"], ["created_at", "2018-10-18 02:38:32.764680"], ["updated_at", "2018-10-18 02:38:32.764680"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "b67130d4-29fe-4f66-b658-d5304ae3cf16"], ["name", "test"], ["created_at", "2018-10-18 02:38:32.766613"], ["updated_at", "2018-10-18 02:38:32.766613"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"b67130d4-29fe-4f66-b658-d5304ae3cf16"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "42c25323-960a-4231-b3c1-3cc0fa4745ee"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 84cf6aea-78ea-4e8b-90fe-547a085c1ee9\napp_uid: b67130d4-29fe-4f66-b658-d5304ae3cf16\n"], ["created_at", "2018-10-18 02:38:32.768350"], ["updated_at", "2018-10-18 02:38:32.768350"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b67130d4-29fe-4f66-b658-d5304ae3cf16"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "84cf6aea-78ea-4e8b-90fe-547a085c1ee9"], ["name", "review"], ["created_at", "2018-10-18 02:38:32.770964"], ["updated_at", "2018-10-18 02:38:32.770964"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "84cf6aea-78ea-4e8b-90fe-547a085c1ee9"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"84cf6aea-78ea-4e8b-90fe-547a085c1ee9", "app_uid"=>"b67130d4-29fe-4f66-b658-d5304ae3cf16"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2911d190-62bb-42de-bdec-db0652fb281a"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: a9421356-4500-413c-b919-d40d4ab932ce\nstage_uid: 84cf6aea-78ea-4e8b-90fe-547a085c1ee9\napp_uid: b67130d4-29fe-4f66-b658-d5304ae3cf16\n"], ["created_at", "2018-10-18 02:38:32.774922"], ["updated_at", "2018-10-18 02:38:32.774922"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b67130d4-29fe-4f66-b658-d5304ae3cf16"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "84cf6aea-78ea-4e8b-90fe-547a085c1ee9"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "a9421356-4500-413c-b919-d40d4ab932ce"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:38:32.778733"], ["updated_at", "2018-10-18 02:38:32.778733"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"b67130d4-29fe-4f66-b658-d5304ae3cf16"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a7c693db-b0db-48a8-8264-7408d3ac7eb4"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 5a4f0de1-a5fa-4748-90da-be88f2e147e4\napp_uid: b67130d4-29fe-4f66-b658-d5304ae3cf16\n"], ["created_at", "2018-10-18 02:38:32.781902"], ["updated_at", "2018-10-18 02:38:32.781902"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b67130d4-29fe-4f66-b658-d5304ae3cf16"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "5a4f0de1-a5fa-4748-90da-be88f2e147e4"], ["name", "staging"], ["created_at", "2018-10-18 02:38:32.784338"], ["updated_at", "2018-10-18 02:38:32.784338"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "5a4f0de1-a5fa-4748-90da-be88f2e147e4"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"5a4f0de1-a5fa-4748-90da-be88f2e147e4", "app_uid"=>"b67130d4-29fe-4f66-b658-d5304ae3cf16"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "397acb6b-111e-4590-a161-f87976a3fd57"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: c0f5053e-fe9c-4243-a6e5-d184cbac53eb\nstage_uid: 5a4f0de1-a5fa-4748-90da-be88f2e147e4\napp_uid: b67130d4-29fe-4f66-b658-d5304ae3cf16\n"], ["created_at", "2018-10-18 02:38:32.787075"], ["updated_at", "2018-10-18 02:38:32.787075"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b67130d4-29fe-4f66-b658-d5304ae3cf16"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "5a4f0de1-a5fa-4748-90da-be88f2e147e4"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "c0f5053e-fe9c-4243-a6e5-d184cbac53eb"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:38:32.789658"], ["updated_at", "2018-10-18 02:38:32.789658"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 30ms (ActiveRecord: 3.4ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:38:32 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:38:32 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"b67130d4-29fe-4f66-b658-d5304ae3cf16"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5634d57f-9573-4323-b71e-3e8c22bb545a"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: b67130d4-29fe-4f66-b658-d5304ae3cf16\n"], ["created_at", "2018-10-18 02:38:32.807618"], ["updated_at", "2018-10-18 02:38:32.807618"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b67130d4-29fe-4f66-b658-d5304ae3cf16"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:38:54.473228', '2018-10-18 02:38:54.473228')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:38:54.475730', '2018-10-18 02:38:54.475730')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:38:54.477253', '2018-10-18 02:38:54.477253', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:38:54.479076', '2018-10-18 02:38:54.479076')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:38:54.480627', '2018-10-18 02:38:54.480627', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:38:54 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "08723a2a-cc11-4f47-a592-6062b3df6efa"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 25273562-17d6-4220-9a41-c3dca2580665\n"], ["created_at", "2018-10-18 02:38:54.505056"], ["updated_at", "2018-10-18 02:38:54.505056"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "25273562-17d6-4220-9a41-c3dca2580665"], ["name", "test"], ["created_at", "2018-10-18 02:38:54.510119"], ["updated_at", "2018-10-18 02:38:54.510119"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"25273562-17d6-4220-9a41-c3dca2580665"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "90160ada-2a98-4fe6-b5d9-84c5d6044959"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: d07c607b-3b66-4140-b703-8a2276b37a89\napp_uid: 25273562-17d6-4220-9a41-c3dca2580665\n"], ["created_at", "2018-10-18 02:38:54.512474"], ["updated_at", "2018-10-18 02:38:54.512474"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "25273562-17d6-4220-9a41-c3dca2580665"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "d07c607b-3b66-4140-b703-8a2276b37a89"], ["name", "review"], ["created_at", "2018-10-18 02:38:54.519442"], ["updated_at", "2018-10-18 02:38:54.519442"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d07c607b-3b66-4140-b703-8a2276b37a89"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"d07c607b-3b66-4140-b703-8a2276b37a89", "app_uid"=>"25273562-17d6-4220-9a41-c3dca2580665"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "df2da3b6-ec7b-4e37-bbce-70dafc2dda3b"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: ff84be2a-0418-470b-bf34-ae82baa199d3\nstage_uid: d07c607b-3b66-4140-b703-8a2276b37a89\napp_uid: 25273562-17d6-4220-9a41-c3dca2580665\n"], ["created_at", "2018-10-18 02:38:54.522928"], ["updated_at", "2018-10-18 02:38:54.522928"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "25273562-17d6-4220-9a41-c3dca2580665"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d07c607b-3b66-4140-b703-8a2276b37a89"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "ff84be2a-0418-470b-bf34-ae82baa199d3"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:38:54.529748"], ["updated_at", "2018-10-18 02:38:54.529748"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"25273562-17d6-4220-9a41-c3dca2580665"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7c56bf46-459d-4388-a679-d3d561366c51"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 1065c694-1b2c-4b49-85e3-c387bb42edd8\napp_uid: 25273562-17d6-4220-9a41-c3dca2580665\n"], ["created_at", "2018-10-18 02:38:54.534037"], ["updated_at", "2018-10-18 02:38:54.534037"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "25273562-17d6-4220-9a41-c3dca2580665"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "1065c694-1b2c-4b49-85e3-c387bb42edd8"], ["name", "staging"], ["created_at", "2018-10-18 02:38:54.536579"], ["updated_at", "2018-10-18 02:38:54.536579"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1065c694-1b2c-4b49-85e3-c387bb42edd8"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"1065c694-1b2c-4b49-85e3-c387bb42edd8", "app_uid"=>"25273562-17d6-4220-9a41-c3dca2580665"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "99a4b8d2-b17a-4ab2-8e68-590654225c56"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 79e79498-2c4b-4205-aaed-8964209d5243\nstage_uid: 1065c694-1b2c-4b49-85e3-c387bb42edd8\napp_uid: 25273562-17d6-4220-9a41-c3dca2580665\n"], ["created_at", "2018-10-18 02:38:54.539145"], ["updated_at", "2018-10-18 02:38:54.539145"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "25273562-17d6-4220-9a41-c3dca2580665"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1065c694-1b2c-4b49-85e3-c387bb42edd8"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "79e79498-2c4b-4205-aaed-8964209d5243"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:38:54.542156"], ["updated_at", "2018-10-18 02:38:54.542156"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 53ms (ActiveRecord: 3.9ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:38:54 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 12ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:38:54 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"25273562-17d6-4220-9a41-c3dca2580665"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5b834159-1073-447d-bf86-f3b19af99907"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 25273562-17d6-4220-9a41-c3dca2580665\n"], ["created_at", "2018-10-18 02:38:54.561847"], ["updated_at", "2018-10-18 02:38:54.561847"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "25273562-17d6-4220-9a41-c3dca2580665"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (ActiveRecord: 0.4ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:38:54 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e30e1d24-b3de-4957-98ef-88f4f595660b"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: e2b4c919-96bb-46ab-a75a-5f760c98574a\n"], ["created_at", "2018-10-18 02:38:54.568444"], ["updated_at", "2018-10-18 02:38:54.568444"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "e2b4c919-96bb-46ab-a75a-5f760c98574a"], ["name", "test"], ["created_at", "2018-10-18 02:38:54.570600"], ["updated_at", "2018-10-18 02:38:54.570600"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"e2b4c919-96bb-46ab-a75a-5f760c98574a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "51ae61a8-e37b-4988-a15e-5aa9d3150c1a"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 56bc1830-b558-4f77-8667-05e54e63a689\napp_uid: e2b4c919-96bb-46ab-a75a-5f760c98574a\n"], ["created_at", "2018-10-18 02:38:54.572348"], ["updated_at", "2018-10-18 02:38:54.572348"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e2b4c919-96bb-46ab-a75a-5f760c98574a"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "56bc1830-b558-4f77-8667-05e54e63a689"], ["name", "review"], ["created_at", "2018-10-18 02:38:54.575046"], ["updated_at", "2018-10-18 02:38:54.575046"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "56bc1830-b558-4f77-8667-05e54e63a689"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"56bc1830-b558-4f77-8667-05e54e63a689", "app_uid"=>"e2b4c919-96bb-46ab-a75a-5f760c98574a"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aa1075d5-d798-4179-9b33-df75cf5b4b11"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 039ab654-c38f-4b74-8c2d-ba66e6a44069\nstage_uid: 56bc1830-b558-4f77-8667-05e54e63a689\napp_uid: e2b4c919-96bb-46ab-a75a-5f760c98574a\n"], ["created_at", "2018-10-18 02:38:54.578213"], ["updated_at", "2018-10-18 02:38:54.578213"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e2b4c919-96bb-46ab-a75a-5f760c98574a"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "56bc1830-b558-4f77-8667-05e54e63a689"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "039ab654-c38f-4b74-8c2d-ba66e6a44069"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:38:54.581621"], ["updated_at", "2018-10-18 02:38:54.581621"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"e2b4c919-96bb-46ab-a75a-5f760c98574a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "13562aa2-1241-45da-bc1e-b504f31ee57d"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 049e7b3d-f1bc-46b4-a6e0-4da0a34edec7\napp_uid: e2b4c919-96bb-46ab-a75a-5f760c98574a\n"], ["created_at", "2018-10-18 02:38:54.584894"], ["updated_at", "2018-10-18 02:38:54.584894"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e2b4c919-96bb-46ab-a75a-5f760c98574a"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "049e7b3d-f1bc-46b4-a6e0-4da0a34edec7"], ["name", "staging"], ["created_at", "2018-10-18 02:38:54.587584"], ["updated_at", "2018-10-18 02:38:54.587584"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "049e7b3d-f1bc-46b4-a6e0-4da0a34edec7"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"049e7b3d-f1bc-46b4-a6e0-4da0a34edec7", "app_uid"=>"e2b4c919-96bb-46ab-a75a-5f760c98574a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0cd7e7e7-2e9c-4f6f-b61b-217454e0bcb3"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: b9a72bac-1ac6-49bb-94b0-dc8af93405e0\nstage_uid: 049e7b3d-f1bc-46b4-a6e0-4da0a34edec7\napp_uid: e2b4c919-96bb-46ab-a75a-5f760c98574a\n"], ["created_at", "2018-10-18 02:38:54.590184"], ["updated_at", "2018-10-18 02:38:54.590184"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e2b4c919-96bb-46ab-a75a-5f760c98574a"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "049e7b3d-f1bc-46b4-a6e0-4da0a34edec7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "b9a72bac-1ac6-49bb-94b0-dc8af93405e0"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:38:54.592841"], ["updated_at", "2018-10-18 02:38:54.592841"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 29ms (ActiveRecord: 3.2ms)
Started POST "/api/v1/builds" for 127.0.0.1 at 2018-10-17 19:38:54 -0700
Processing by BuildsController#create as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"e2b4c919-96bb-46ab-a75a-5f760c98574a", :stage_uid=>"56bc1830-b558-4f77-8667-05e54e63a689"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6a829f25-bec0-4bbc-8235-dba89dcef659"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: e2b4c919-96bb-46ab-a75a-5f760c98574a\nstage_uid: 56bc1830-b558-4f77-8667-05e54e63a689\nbuild_uid: 7c1282e4-7849-4d9f-8a3c-41932ae6b170\n"], ["created_at", "2018-10-18 02:38:54.599196"], ["updated_at", "2018-10-18 02:38:54.599196"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e2b4c919-96bb-46ab-a75a-5f760c98574a"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "56bc1830-b558-4f77-8667-05e54e63a689"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "7c1282e4-7849-4d9f-8a3c-41932ae6b170"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 02:38:54.613294"], ["updated_at", "2018-10-18 02:38:54.613294"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 17ms (ActiveRecord: 0.9ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:38:54 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 1.1ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6841bc22-676d-4413-b744-e9715f07b3c1"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 32defd4c-2d68-4332-b03b-8f902f5f760c\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:38:54.630392"], ["updated_at", "2018-10-18 02:38:54.630392"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "32defd4c-2d68-4332-b03b-8f902f5f760c"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:38:54.634833"], ["updated_at", "2018-10-18 02:38:54.634833"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cf564504-3cf2-4b1d-9f7e-c93b38651417"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: f171e2a2-99a8-4006-9795-490bd440ebba\n"], ["created_at", "2018-10-18 02:38:54.644077"], ["updated_at", "2018-10-18 02:38:54.644077"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "f171e2a2-99a8-4006-9795-490bd440ebba"], ["status", "PENDING"], ["created_at", "2018-10-18 02:38:54.652098"], ["updated_at", "2018-10-18 02:38:54.652098"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "741f448a-05d9-499f-84cf-c5c1ffc93b85"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: de6169ee-4f46-4bb4-bcd5-964e681c81a3\n"], ["created_at", "2018-10-18 02:38:54.655310"], ["updated_at", "2018-10-18 02:38:54.655310"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "de6169ee-4f46-4bb4-bcd5-964e681c81a3"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:38:54.658951"], ["updated_at", "2018-10-18 02:38:54.658951"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: d56ecbce-498d-4e76-a9f0-64137ce3f1b9) to Async(default) with arguments: "741f448a-05d9-499f-84cf-c5c1ffc93b85"
[ActiveJob] [ReleaseJob] [d56ecbce-498d-4e76-a9f0-64137ce3f1b9] Performing ReleaseJob (Job ID: d56ecbce-498d-4e76-a9f0-64137ce3f1b9) from Async(default) with arguments: "741f448a-05d9-499f-84cf-c5c1ffc93b85"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "50f51c54-dbc0-4034-93d5-5c2e946d66fb"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 76a08dcc-17d4-401c-84ee-a28cac622d55\n"], ["created_at", "2018-10-18 02:38:54.664740"], ["updated_at", "2018-10-18 02:38:54.664740"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "76a08dcc-17d4-401c-84ee-a28cac622d55"], ["name", "test"], ["created_at", "2018-10-18 02:38:54.667508"], ["updated_at", "2018-10-18 02:38:54.667508"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [d56ecbce-498d-4e76-a9f0-64137ce3f1b9]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "741f448a-05d9-499f-84cf-c5c1ffc93b85"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [d56ecbce-498d-4e76-a9f0-64137ce3f1b9] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
--------------------------------------
[ActiveJob] [ReleaseJob] [d56ecbce-498d-4e76-a9f0-64137ce3f1b9] Error performing ReleaseJob (Job ID: d56ecbce-498d-4e76-a9f0-64137ce3f1b9) from Async(default) in 10.78ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e7d0c18b-8a20-45a3-a621-052917360704"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 1cc191f7-14da-43be-ba44-273cee0be3c0\n"], ["created_at", "2018-10-18 02:38:54.673642"], ["updated_at", "2018-10-18 02:38:54.673642"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "1cc191f7-14da-43be-ba44-273cee0be3c0"], ["name", "test2"], ["created_at", "2018-10-18 02:38:54.677078"], ["updated_at", "2018-10-18 02:38:54.677078"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1dd61276-4024-4b41-a804-3b63d24ba3d7"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:38:54.680030"], ["updated_at", "2018-10-18 02:38:54.680030"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:38:54.682042"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "663ba85e-e1b2-4c9d-b9fb-ce701f3e13e6"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:38:54.684903"], ["updated_at", "2018-10-18 02:38:54.684903"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d349b4d6-919e-4e14-b911-1995c4f7144b"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:38:54.689019"], ["updated_at", "2018-10-18 02:38:54.689019"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:38:54.691841"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e9c28ffe-7a2b-4c49-a7db-80f7a00fee5f"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: d4ac09f8-5c4f-48c5-b1d1-33b354e59361\n"], ["created_at", "2018-10-18 02:38:54.695018"], ["updated_at", "2018-10-18 02:38:54.695018"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "d4ac09f8-5c4f-48c5-b1d1-33b354e59361"], ["name", "test"], ["created_at", "2018-10-18 02:38:54.697437"], ["updated_at", "2018-10-18 02:38:54.697437"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "98b42dc4-2301-458c-a30b-e0826ba78d50"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: d2337ac3-e4aa-4d02-8481-6b6a2486d357\n"], ["created_at", "2018-10-18 02:38:54.700135"], ["updated_at", "2018-10-18 02:38:54.700135"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "d2337ac3-e4aa-4d02-8481-6b6a2486d357"], ["name", "test2"], ["created_at", "2018-10-18 02:38:54.703217"], ["updated_at", "2018-10-18 02:38:54.703217"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9a93d077-5ac2-4cde-b2b7-5d93cef106ef"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:38:54.705064"], ["updated_at", "2018-10-18 02:38:54.705064"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:40:34.909148', '2018-10-18 02:40:34.909148')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:40:34.911575', '2018-10-18 02:40:34.911575')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:40:34.913044', '2018-10-18 02:40:34.913044', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:40:34.914527', '2018-10-18 02:40:34.914527')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:40:34.916112', '2018-10-18 02:40:34.916112', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "047ae2fd-887c-46e4-b33b-ccc17b1b735f"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 6af71fdf-888c-462b-9457-654e0ec47fa0\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:40:34.941716"], ["updated_at", "2018-10-18 02:40:34.941716"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "6af71fdf-888c-462b-9457-654e0ec47fa0"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:40:34.950298"], ["updated_at", "2018-10-18 02:40:34.950298"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:40:34 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
Completed 400 Bad Request in 6ms (Views: 0.1ms | ActiveRecord: 0.2ms)
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:40:34 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
Completed 400 Bad Request in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "13ccb042-c095-42ee-b10a-0638ca11302f"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 1c32d5bd-90b7-49b2-86c2-a2adc8c3868b\n"], ["created_at", "2018-10-18 02:40:34.974069"], ["updated_at", "2018-10-18 02:40:34.974069"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1c32d5bd-90b7-49b2-86c2-a2adc8c3868b"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:40:34.981022"], ["updated_at", "2018-10-18 02:40:34.981022"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 266c6904-3bb7-4095-aba6-0becdb7e05fb) to Async(default) with arguments: "13ccb042-c095-42ee-b10a-0638ca11302f"
[ActiveJob] [ReleaseJob] [266c6904-3bb7-4095-aba6-0becdb7e05fb] Performing ReleaseJob (Job ID: 266c6904-3bb7-4095-aba6-0becdb7e05fb) from Async(default) with arguments: "13ccb042-c095-42ee-b10a-0638ca11302f"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1040e493-4517-4e02-87bd-6b44b76a605c"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 97a2a286-3d3c-49d8-867a-667ac78ee719\n"], ["created_at", "2018-10-18 02:40:34.995677"], ["updated_at", "2018-10-18 02:40:34.995677"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "97a2a286-3d3c-49d8-867a-667ac78ee719"], ["status", "PENDING"], ["created_at", "2018-10-18 02:40:35.004868"], ["updated_at", "2018-10-18 02:40:35.004868"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [266c6904-3bb7-4095-aba6-0becdb7e05fb]   [1m[36mEvent Load (0.4ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "13ccb042-c095-42ee-b10a-0638ca11302f"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [266c6904-3bb7-4095-aba6-0becdb7e05fb] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [266c6904-3bb7-4095-aba6-0becdb7e05fb] Error performing ReleaseJob (Job ID: 266c6904-3bb7-4095-aba6-0becdb7e05fb) from Async(default) in 25.22ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d037c214-b236-4911-8166-cff66b8538ad"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 7a36e85e-f054-452f-ac52-6ec1c32d2a17\n"], ["created_at", "2018-10-18 02:40:35.010312"], ["updated_at", "2018-10-18 02:40:35.010312"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "7a36e85e-f054-452f-ac52-6ec1c32d2a17"], ["name", "test"], ["created_at", "2018-10-18 02:40:35.014057"], ["updated_at", "2018-10-18 02:40:35.014057"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7084d2b3-e960-4597-ad5f-0bb7403f829f"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:40:35.016143"], ["updated_at", "2018-10-18 02:40:35.016143"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "13e35d2b-7d59-491f-a963-52ca8751882a"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:40:35.019886"], ["updated_at", "2018-10-18 02:40:35.019886"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b5b97f49-ca04-4bda-bc79-98db781e6680"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:40:35.023926"], ["updated_at", "2018-10-18 02:40:35.023926"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:40:35.030601"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a102150e-8b7a-4385-9108-d8c0a658b0ea"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 81fc4d6b-5734-47a6-bdf9-da895b173b17\n"], ["created_at", "2018-10-18 02:40:35.033804"], ["updated_at", "2018-10-18 02:40:35.033804"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "81fc4d6b-5734-47a6-bdf9-da895b173b17"], ["name", "test"], ["created_at", "2018-10-18 02:40:35.035960"], ["updated_at", "2018-10-18 02:40:35.035960"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "12fc41ba-4487-48e3-8830-950a94b9545b"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:40:35.038825"], ["updated_at", "2018-10-18 02:40:35.038825"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:40:35.041865"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "14189247-662f-41d5-b11c-d06c304b3bcb"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 03128865-178f-42b5-ac7e-137f2975cfdf\n"], ["created_at", "2018-10-18 02:40:35.045090"], ["updated_at", "2018-10-18 02:40:35.045090"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "03128865-178f-42b5-ac7e-137f2975cfdf"], ["name", "test2"], ["created_at", "2018-10-18 02:40:35.048647"], ["updated_at", "2018-10-18 02:40:35.048647"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3ecadc9d-1db1-4388-9858-4143f79a5684"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: a92b460b-2b54-48ea-8361-0ba38d5faeb3\n"], ["created_at", "2018-10-18 02:40:35.052568"], ["updated_at", "2018-10-18 02:40:35.052568"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a92b460b-2b54-48ea-8361-0ba38d5faeb3"], ["name", "test2"], ["created_at", "2018-10-18 02:40:35.055433"], ["updated_at", "2018-10-18 02:40:35.055433"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:41:19.929442', '2018-10-18 02:41:19.929442')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:41:19.932224', '2018-10-18 02:41:19.932224')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:41:19.934063', '2018-10-18 02:41:19.934063', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:41:19.936236', '2018-10-18 02:41:19.936236')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:41:19.938312', '2018-10-18 02:41:19.938312', 980190962)[0m
  [1m[35m (9.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1f44e30a-37c9-419b-8c4a-2f5bdc32e4dd"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: d8f699c7-b96d-428c-ab43-3d4c26971991\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:41:19.969937"], ["updated_at", "2018-10-18 02:41:19.969937"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "d8f699c7-b96d-428c-ab43-3d4c26971991"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:41:19.976677"], ["updated_at", "2018-10-18 02:41:19.976677"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:41:19 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a8bdc804-fc47-462a-b1de-db4add39f1d5"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 5ac1fb79-4a38-484e-82f7-99d4a1d68625\n"], ["created_at", "2018-10-18 02:41:19.993351"], ["updated_at", "2018-10-18 02:41:19.993351"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "5ac1fb79-4a38-484e-82f7-99d4a1d68625"], ["name", "test"], ["created_at", "2018-10-18 02:41:19.995894"], ["updated_at", "2018-10-18 02:41:19.995894"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"5ac1fb79-4a38-484e-82f7-99d4a1d68625"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2827232a-f3f8-4d8c-b1a8-8f1f9c50eec2"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 782c320a-0e00-411e-b994-8ea7355d70b4\napp_uid: 5ac1fb79-4a38-484e-82f7-99d4a1d68625\n"], ["created_at", "2018-10-18 02:41:19.998649"], ["updated_at", "2018-10-18 02:41:19.998649"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5ac1fb79-4a38-484e-82f7-99d4a1d68625"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "782c320a-0e00-411e-b994-8ea7355d70b4"], ["name", "review"], ["created_at", "2018-10-18 02:41:20.001301"], ["updated_at", "2018-10-18 02:41:20.001301"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "782c320a-0e00-411e-b994-8ea7355d70b4"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"782c320a-0e00-411e-b994-8ea7355d70b4", "app_uid"=>"5ac1fb79-4a38-484e-82f7-99d4a1d68625"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fa93ba84-f5c6-4c52-a688-ab057a0384af"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 1735996d-48f6-40e7-86a6-803ee4f6822e\nstage_uid: 782c320a-0e00-411e-b994-8ea7355d70b4\napp_uid: 5ac1fb79-4a38-484e-82f7-99d4a1d68625\n"], ["created_at", "2018-10-18 02:41:20.004889"], ["updated_at", "2018-10-18 02:41:20.004889"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5ac1fb79-4a38-484e-82f7-99d4a1d68625"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "782c320a-0e00-411e-b994-8ea7355d70b4"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "1735996d-48f6-40e7-86a6-803ee4f6822e"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:41:20.012276"], ["updated_at", "2018-10-18 02:41:20.012276"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"5ac1fb79-4a38-484e-82f7-99d4a1d68625"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "05dfe556-ea81-4bcb-ae52-cf6c1250b5c1"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 1b07c510-7664-4694-ba0a-a47edc557336\napp_uid: 5ac1fb79-4a38-484e-82f7-99d4a1d68625\n"], ["created_at", "2018-10-18 02:41:20.016370"], ["updated_at", "2018-10-18 02:41:20.016370"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5ac1fb79-4a38-484e-82f7-99d4a1d68625"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "1b07c510-7664-4694-ba0a-a47edc557336"], ["name", "staging"], ["created_at", "2018-10-18 02:41:20.018926"], ["updated_at", "2018-10-18 02:41:20.018926"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1b07c510-7664-4694-ba0a-a47edc557336"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"1b07c510-7664-4694-ba0a-a47edc557336", "app_uid"=>"5ac1fb79-4a38-484e-82f7-99d4a1d68625"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "070cba94-b387-4571-bb17-81674235643e"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 5783742a-f372-44a8-a650-e9f449a20eaa\nstage_uid: 1b07c510-7664-4694-ba0a-a47edc557336\napp_uid: 5ac1fb79-4a38-484e-82f7-99d4a1d68625\n"], ["created_at", "2018-10-18 02:41:20.021582"], ["updated_at", "2018-10-18 02:41:20.021582"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5ac1fb79-4a38-484e-82f7-99d4a1d68625"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1b07c510-7664-4694-ba0a-a47edc557336"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "5783742a-f372-44a8-a650-e9f449a20eaa"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:41:20.024792"], ["updated_at", "2018-10-18 02:41:20.024792"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 42ms (ActiveRecord: 3.6ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 19:41:20 -0700
Processing by AppsController#build as HTML
  Parameters: {"version"=>"v1", "stage"=>"review", "app_id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"5ac1fb79-4a38-484e-82f7-99d4a1d68625", :stage_uid=>"782c320a-0e00-411e-b994-8ea7355d70b4"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "670be912-edbd-493b-ad47-7a881773697c"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: 5ac1fb79-4a38-484e-82f7-99d4a1d68625\nstage_uid: 782c320a-0e00-411e-b994-8ea7355d70b4\nbuild_uid: 45a15c04-33a9-40ac-9328-2557cf7a32d1\n"], ["created_at", "2018-10-18 02:41:20.033112"], ["updated_at", "2018-10-18 02:41:20.033112"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5ac1fb79-4a38-484e-82f7-99d4a1d68625"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "782c320a-0e00-411e-b994-8ea7355d70b4"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "45a15c04-33a9-40ac-9328-2557cf7a32d1"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 02:41:20.037216"], ["updated_at", "2018-10-18 02:41:20.037216"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 8ms (ActiveRecord: 0.8ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:41:20 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 15ms (Views: 0.3ms | ActiveRecord: 1.1ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:41:20 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ac22995b-0847-4886-a581-ba3de685a723"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 5baf2a3e-ddd3-4d63-ab5d-313c06a0914f\n"], ["created_at", "2018-10-18 02:41:20.062538"], ["updated_at", "2018-10-18 02:41:20.062538"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"], ["name", "test"], ["created_at", "2018-10-18 02:41:20.065275"], ["updated_at", "2018-10-18 02:41:20.065275"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a5db1b5a-307d-4da8-a41c-5fe6c3fc6907"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 6b32c92f-cdea-4d34-8c35-43d184dc4bd0\napp_uid: 5baf2a3e-ddd3-4d63-ab5d-313c06a0914f\n"], ["created_at", "2018-10-18 02:41:20.067350"], ["updated_at", "2018-10-18 02:41:20.067350"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "6b32c92f-cdea-4d34-8c35-43d184dc4bd0"], ["name", "review"], ["created_at", "2018-10-18 02:41:20.070179"], ["updated_at", "2018-10-18 02:41:20.070179"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "6b32c92f-cdea-4d34-8c35-43d184dc4bd0"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"6b32c92f-cdea-4d34-8c35-43d184dc4bd0", "app_uid"=>"5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "94ccdff8-37c2-447e-aca9-8fe7f22840d0"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: e828e770-4fd1-4e28-893f-79e4e5f286cc\nstage_uid: 6b32c92f-cdea-4d34-8c35-43d184dc4bd0\napp_uid: 5baf2a3e-ddd3-4d63-ab5d-313c06a0914f\n"], ["created_at", "2018-10-18 02:41:20.073461"], ["updated_at", "2018-10-18 02:41:20.073461"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "6b32c92f-cdea-4d34-8c35-43d184dc4bd0"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "e828e770-4fd1-4e28-893f-79e4e5f286cc"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:41:20.076740"], ["updated_at", "2018-10-18 02:41:20.076740"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ed809c24-9564-4065-bb6e-4a414cb6828c"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 14fe3cd9-10d1-4578-b361-c3a19742a4bc\napp_uid: 5baf2a3e-ddd3-4d63-ab5d-313c06a0914f\n"], ["created_at", "2018-10-18 02:41:20.079730"], ["updated_at", "2018-10-18 02:41:20.079730"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "14fe3cd9-10d1-4578-b361-c3a19742a4bc"], ["name", "staging"], ["created_at", "2018-10-18 02:41:20.082480"], ["updated_at", "2018-10-18 02:41:20.082480"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "14fe3cd9-10d1-4578-b361-c3a19742a4bc"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"14fe3cd9-10d1-4578-b361-c3a19742a4bc", "app_uid"=>"5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0a09e089-2221-4987-8f51-9632b5fd8ebd"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 49b42dcb-f887-4abf-9eba-d72ca241ca9f\nstage_uid: 14fe3cd9-10d1-4578-b361-c3a19742a4bc\napp_uid: 5baf2a3e-ddd3-4d63-ab5d-313c06a0914f\n"], ["created_at", "2018-10-18 02:41:20.085360"], ["updated_at", "2018-10-18 02:41:20.085360"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "14fe3cd9-10d1-4578-b361-c3a19742a4bc"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "49b42dcb-f887-4abf-9eba-d72ca241ca9f"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:41:20.088736"], ["updated_at", "2018-10-18 02:41:20.088736"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 31ms (ActiveRecord: 3.3ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:41:20 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:41:20 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7d6b40de-e8dd-423b-9380-9003eaf616f0"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 5baf2a3e-ddd3-4d63-ab5d-313c06a0914f\n"], ["created_at", "2018-10-18 02:41:20.102346"], ["updated_at", "2018-10-18 02:41:20.102346"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "5baf2a3e-ddd3-4d63-ab5d-313c06a0914f"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aac1147b-46e4-4f0b-9508-5b1cfbed6a3e"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 61a55234-c99c-41e7-add4-206dcd2082d2\n"], ["created_at", "2018-10-18 02:41:20.111501"], ["updated_at", "2018-10-18 02:41:20.111501"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "61a55234-c99c-41e7-add4-206dcd2082d2"], ["status", "PENDING"], ["created_at", "2018-10-18 02:41:20.119551"], ["updated_at", "2018-10-18 02:41:20.119551"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7330d26f-5bb1-4f20-8e96-7a5016e1d41f"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 11d6e079-7422-4484-b9ed-2b3ed95445de\n"], ["created_at", "2018-10-18 02:41:20.122370"], ["updated_at", "2018-10-18 02:41:20.122370"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "11d6e079-7422-4484-b9ed-2b3ed95445de"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:41:20.127151"], ["updated_at", "2018-10-18 02:41:20.127151"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: c23b99c1-64e5-4c91-b3b1-b5ddf9fd4810) to Async(default) with arguments: "7330d26f-5bb1-4f20-8e96-7a5016e1d41f"
[ActiveJob] [ReleaseJob] [c23b99c1-64e5-4c91-b3b1-b5ddf9fd4810] Performing ReleaseJob (Job ID: c23b99c1-64e5-4c91-b3b1-b5ddf9fd4810) from Async(default) with arguments: "7330d26f-5bb1-4f20-8e96-7a5016e1d41f"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f2ea0708-28d9-496d-8d02-5404ca1dc81b"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:41:20.135833"], ["updated_at", "2018-10-18 02:41:20.135833"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [c23b99c1-64e5-4c91-b3b1-b5ddf9fd4810]   [1m[36mEvent Load (3.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "7330d26f-5bb1-4f20-8e96-7a5016e1d41f"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [c23b99c1-64e5-4c91-b3b1-b5ddf9fd4810] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [c23b99c1-64e5-4c91-b3b1-b5ddf9fd4810] Error performing ReleaseJob (Job ID: c23b99c1-64e5-4c91-b3b1-b5ddf9fd4810) from Async(default) in 10.88ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b82c1d8a-163d-40cb-b8b1-51adc4116619"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: aee482a2-6552-4b7f-8568-7ffe9cadd5bd\n"], ["created_at", "2018-10-18 02:41:20.142702"], ["updated_at", "2018-10-18 02:41:20.142702"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "aee482a2-6552-4b7f-8568-7ffe9cadd5bd"], ["name", "test2"], ["created_at", "2018-10-18 02:41:20.146705"], ["updated_at", "2018-10-18 02:41:20.146705"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b0d51762-a527-4ebb-a1ab-1a5385692241"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 8f90f5a2-1f25-4308-b0bc-5a241de2d64f\n"], ["created_at", "2018-10-18 02:41:20.150858"], ["updated_at", "2018-10-18 02:41:20.150858"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "8f90f5a2-1f25-4308-b0bc-5a241de2d64f"], ["name", "test2"], ["created_at", "2018-10-18 02:41:20.154696"], ["updated_at", "2018-10-18 02:41:20.154696"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "93842a9a-b0fa-43bc-9373-8ca4733122b9"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:41:20.158214"], ["updated_at", "2018-10-18 02:41:20.158214"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:41:20.161333"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f05d1f8d-1333-4ff0-a1f7-a9c8cfacd1ae"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 6efabab5-01cf-4f58-ac23-204cafbd772e\n"], ["created_at", "2018-10-18 02:41:20.164671"], ["updated_at", "2018-10-18 02:41:20.164671"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "6efabab5-01cf-4f58-ac23-204cafbd772e"], ["name", "test"], ["created_at", "2018-10-18 02:41:20.167758"], ["updated_at", "2018-10-18 02:41:20.167758"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e64a9989-f410-4d6f-8d1f-aea6d09214c6"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:41:20.170173"], ["updated_at", "2018-10-18 02:41:20.170173"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "730a2172-7d25-4a5e-8fd6-e78054ab61dd"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:41:20.173877"], ["updated_at", "2018-10-18 02:41:20.173877"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:41:20.176757"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1357150b-7615-4139-bcb6-7637ff440e43"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: bca70ab0-5929-40b5-89b4-e9a3b0fe1c26\n"], ["created_at", "2018-10-18 02:41:20.179324"], ["updated_at", "2018-10-18 02:41:20.179324"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "bca70ab0-5929-40b5-89b4-e9a3b0fe1c26"], ["name", "test"], ["created_at", "2018-10-18 02:41:20.181349"], ["updated_at", "2018-10-18 02:41:20.181349"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:43:16.112478', '2018-10-18 02:43:16.112478')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:43:16.114658', '2018-10-18 02:43:16.114658')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:43:16.116172', '2018-10-18 02:43:16.116172', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:43:16.117592', '2018-10-18 02:43:16.117592')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:43:16.119071', '2018-10-18 02:43:16.119071', 980190962)[0m
  [1m[35m (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:43:16 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5c56d07d-813b-4d7d-8a94-198bb517bddc"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 553962ac-46ae-4195-9a03-4e35c38325ca\n"], ["created_at", "2018-10-18 02:43:16.143353"], ["updated_at", "2018-10-18 02:43:16.143353"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "553962ac-46ae-4195-9a03-4e35c38325ca"], ["name", "test"], ["created_at", "2018-10-18 02:43:16.148986"], ["updated_at", "2018-10-18 02:43:16.148986"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"553962ac-46ae-4195-9a03-4e35c38325ca"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "51a798e0-47d6-4316-badd-64313cc02ca6"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: f7a34f41-048c-45ec-9144-ed463c516bd5\napp_uid: 553962ac-46ae-4195-9a03-4e35c38325ca\n"], ["created_at", "2018-10-18 02:43:16.152074"], ["updated_at", "2018-10-18 02:43:16.152074"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "553962ac-46ae-4195-9a03-4e35c38325ca"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "f7a34f41-048c-45ec-9144-ed463c516bd5"], ["name", "review"], ["created_at", "2018-10-18 02:43:16.159766"], ["updated_at", "2018-10-18 02:43:16.159766"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "f7a34f41-048c-45ec-9144-ed463c516bd5"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"f7a34f41-048c-45ec-9144-ed463c516bd5", "app_uid"=>"553962ac-46ae-4195-9a03-4e35c38325ca"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d2cdee8e-7e06-4086-8f89-8d069d2dd992"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 9debeac6-08ec-451f-a58f-25b7798de6d8\nstage_uid: f7a34f41-048c-45ec-9144-ed463c516bd5\napp_uid: 553962ac-46ae-4195-9a03-4e35c38325ca\n"], ["created_at", "2018-10-18 02:43:16.163641"], ["updated_at", "2018-10-18 02:43:16.163641"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "553962ac-46ae-4195-9a03-4e35c38325ca"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "f7a34f41-048c-45ec-9144-ed463c516bd5"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "9debeac6-08ec-451f-a58f-25b7798de6d8"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:43:16.171186"], ["updated_at", "2018-10-18 02:43:16.171186"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"553962ac-46ae-4195-9a03-4e35c38325ca"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d01d2f45-209c-4517-8d72-b4180090a4bb"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 9786c9b2-f257-4928-811c-8be094279ba1\napp_uid: 553962ac-46ae-4195-9a03-4e35c38325ca\n"], ["created_at", "2018-10-18 02:43:16.175826"], ["updated_at", "2018-10-18 02:43:16.175826"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "553962ac-46ae-4195-9a03-4e35c38325ca"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9786c9b2-f257-4928-811c-8be094279ba1"], ["name", "staging"], ["created_at", "2018-10-18 02:43:16.178275"], ["updated_at", "2018-10-18 02:43:16.178275"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9786c9b2-f257-4928-811c-8be094279ba1"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"9786c9b2-f257-4928-811c-8be094279ba1", "app_uid"=>"553962ac-46ae-4195-9a03-4e35c38325ca"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a6d8fedc-8ab0-4766-b90a-8b7a3de5ca45"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: d6e5b27a-2aa7-4e7d-a9f9-9b0992249199\nstage_uid: 9786c9b2-f257-4928-811c-8be094279ba1\napp_uid: 553962ac-46ae-4195-9a03-4e35c38325ca\n"], ["created_at", "2018-10-18 02:43:16.180973"], ["updated_at", "2018-10-18 02:43:16.180973"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "553962ac-46ae-4195-9a03-4e35c38325ca"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9786c9b2-f257-4928-811c-8be094279ba1"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "d6e5b27a-2aa7-4e7d-a9f9-9b0992249199"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:43:16.184401"], ["updated_at", "2018-10-18 02:43:16.184401"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 58ms (ActiveRecord: 4.1ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:43:16 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 12ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:43:16 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"553962ac-46ae-4195-9a03-4e35c38325ca"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1b32346e-5f12-4158-9b37-947713bcf8a6"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 553962ac-46ae-4195-9a03-4e35c38325ca\n"], ["created_at", "2018-10-18 02:43:16.204836"], ["updated_at", "2018-10-18 02:43:16.204836"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "553962ac-46ae-4195-9a03-4e35c38325ca"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:43:16 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c0c4042d-8491-4be8-a225-2cf4949e55aa"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: e79f443b-73db-4fad-8bb6-ff592c7c6186\n"], ["created_at", "2018-10-18 02:43:16.210452"], ["updated_at", "2018-10-18 02:43:16.210452"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "e79f443b-73db-4fad-8bb6-ff592c7c6186"], ["name", "test"], ["created_at", "2018-10-18 02:43:16.212650"], ["updated_at", "2018-10-18 02:43:16.212650"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"e79f443b-73db-4fad-8bb6-ff592c7c6186"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cdb44781-1f29-44ae-8018-fb9a2df4e7f4"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: afa5ecc0-d3a3-4fc5-9dfa-92f98ecab0fc\napp_uid: e79f443b-73db-4fad-8bb6-ff592c7c6186\n"], ["created_at", "2018-10-18 02:43:16.214778"], ["updated_at", "2018-10-18 02:43:16.214778"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e79f443b-73db-4fad-8bb6-ff592c7c6186"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "afa5ecc0-d3a3-4fc5-9dfa-92f98ecab0fc"], ["name", "review"], ["created_at", "2018-10-18 02:43:16.217030"], ["updated_at", "2018-10-18 02:43:16.217030"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "afa5ecc0-d3a3-4fc5-9dfa-92f98ecab0fc"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"afa5ecc0-d3a3-4fc5-9dfa-92f98ecab0fc", "app_uid"=>"e79f443b-73db-4fad-8bb6-ff592c7c6186"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f9c98dd3-52b1-4ccb-bb8b-73535f766693"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 448898d7-ddda-4310-bc09-f89cd307df78\nstage_uid: afa5ecc0-d3a3-4fc5-9dfa-92f98ecab0fc\napp_uid: e79f443b-73db-4fad-8bb6-ff592c7c6186\n"], ["created_at", "2018-10-18 02:43:16.219787"], ["updated_at", "2018-10-18 02:43:16.219787"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e79f443b-73db-4fad-8bb6-ff592c7c6186"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "afa5ecc0-d3a3-4fc5-9dfa-92f98ecab0fc"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "448898d7-ddda-4310-bc09-f89cd307df78"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:43:16.222897"], ["updated_at", "2018-10-18 02:43:16.222897"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"e79f443b-73db-4fad-8bb6-ff592c7c6186"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "573a4ecf-a308-46b2-b44b-21a80a65020a"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 5a24329a-c2d9-448b-940f-73b8bd0af475\napp_uid: e79f443b-73db-4fad-8bb6-ff592c7c6186\n"], ["created_at", "2018-10-18 02:43:16.226148"], ["updated_at", "2018-10-18 02:43:16.226148"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e79f443b-73db-4fad-8bb6-ff592c7c6186"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "5a24329a-c2d9-448b-940f-73b8bd0af475"], ["name", "staging"], ["created_at", "2018-10-18 02:43:16.228645"], ["updated_at", "2018-10-18 02:43:16.228645"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "5a24329a-c2d9-448b-940f-73b8bd0af475"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"5a24329a-c2d9-448b-940f-73b8bd0af475", "app_uid"=>"e79f443b-73db-4fad-8bb6-ff592c7c6186"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b43b7e2a-0fe7-42bb-9543-27a3cecd32a0"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 2bee18ff-0d8d-41fe-a938-2b560354ad72\nstage_uid: 5a24329a-c2d9-448b-940f-73b8bd0af475\napp_uid: e79f443b-73db-4fad-8bb6-ff592c7c6186\n"], ["created_at", "2018-10-18 02:43:16.231307"], ["updated_at", "2018-10-18 02:43:16.231307"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e79f443b-73db-4fad-8bb6-ff592c7c6186"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "5a24329a-c2d9-448b-940f-73b8bd0af475"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "2bee18ff-0d8d-41fe-a938-2b560354ad72"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:43:16.234435"], ["updated_at", "2018-10-18 02:43:16.234435"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 28ms (ActiveRecord: 3.2ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 19:43:16 -0700
Processing by AppsController#build as HTML
  Parameters: {"version"=>"v1", "stage"=>"review", "app_id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"e79f443b-73db-4fad-8bb6-ff592c7c6186", :stage_uid=>"afa5ecc0-d3a3-4fc5-9dfa-92f98ecab0fc"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "29af4eb1-5ddb-4df9-b93e-e98a864800c0"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: e79f443b-73db-4fad-8bb6-ff592c7c6186\nstage_uid: afa5ecc0-d3a3-4fc5-9dfa-92f98ecab0fc\nbuild_uid: 9db4c7f3-222b-4a7e-a2f4-fc23706e1668\n"], ["created_at", "2018-10-18 02:43:16.240201"], ["updated_at", "2018-10-18 02:43:16.240201"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e79f443b-73db-4fad-8bb6-ff592c7c6186"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "afa5ecc0-d3a3-4fc5-9dfa-92f98ecab0fc"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "9db4c7f3-222b-4a7e-a2f4-fc23706e1668"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 02:43:16.249755"], ["updated_at", "2018-10-18 02:43:16.249755"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 13ms (ActiveRecord: 0.9ms)
Started POST "/api/v1/apps/test/release?version=v1" for 127.0.0.1 at 2018-10-17 19:43:16 -0700
Processing by AppsController#release as HTML
  Parameters: {"version"=>"v1", "app_id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? AND "builds"."app_id" = 2 LIMIT ?[0m  [["uid", "v1"], ["LIMIT", 1]]
Completed 400 Bad Request in 2ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "065a5beb-d31f-4662-98c9-98899980eb99"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 9b7b456a-610a-40f1-8d0c-51dd78e6dc4c\n"], ["created_at", "2018-10-18 02:43:16.261571"], ["updated_at", "2018-10-18 02:43:16.261571"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "9b7b456a-610a-40f1-8d0c-51dd78e6dc4c"], ["status", "PENDING"], ["created_at", "2018-10-18 02:43:16.271169"], ["updated_at", "2018-10-18 02:43:16.271169"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "686f8d22-078c-44ef-906d-2db9a0dd83ea"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 86f09b8c-335c-4935-8076-3355a11a16fc\n"], ["created_at", "2018-10-18 02:43:16.274267"], ["updated_at", "2018-10-18 02:43:16.274267"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "86f09b8c-335c-4935-8076-3355a11a16fc"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:43:16.278233"], ["updated_at", "2018-10-18 02:43:16.278233"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: ceec8150-2f98-42de-a239-27799803b015) to Async(default) with arguments: "686f8d22-078c-44ef-906d-2db9a0dd83ea"
[ActiveJob] [ReleaseJob] [ceec8150-2f98-42de-a239-27799803b015] Performing ReleaseJob (Job ID: ceec8150-2f98-42de-a239-27799803b015) from Async(default) with arguments: "686f8d22-078c-44ef-906d-2db9a0dd83ea"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
[ActiveJob] [ReleaseJob] [ceec8150-2f98-42de-a239-27799803b015]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "686f8d22-078c-44ef-906d-2db9a0dd83ea"], ["LIMIT", 1]]
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ceec8150-2f98-42de-a239-27799803b015] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ceec8150-2f98-42de-a239-27799803b015] Error performing ReleaseJob (Job ID: ceec8150-2f98-42de-a239-27799803b015) from Async(default) in 7.46ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c887f4f7-6b16-43e6-b7bd-26689e61c7b4"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 6956adf3-db20-4669-8dbf-b892660c3dcc\n"], ["created_at", "2018-10-18 02:43:16.288535"], ["updated_at", "2018-10-18 02:43:16.288535"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "6956adf3-db20-4669-8dbf-b892660c3dcc"], ["name", "test2"], ["created_at", "2018-10-18 02:43:16.291945"], ["updated_at", "2018-10-18 02:43:16.291945"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d3e245ce-6435-4a5c-88c7-139dc526913d"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 0f4d7cf4-1492-47f7-9899-6d893c4111d7\n"], ["created_at", "2018-10-18 02:43:16.293787"], ["updated_at", "2018-10-18 02:43:16.293787"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "0f4d7cf4-1492-47f7-9899-6d893c4111d7"], ["name", "test"], ["created_at", "2018-10-18 02:43:16.300634"], ["updated_at", "2018-10-18 02:43:16.300634"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2ffb800e-d9c7-486d-86e5-ebf326b10264"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:43:16.303489"], ["updated_at", "2018-10-18 02:43:16.303489"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:43:16.306202"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "98b3bc21-8528-458f-bd8f-17d09962874a"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:43:16.309248"], ["updated_at", "2018-10-18 02:43:16.309248"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5f775add-e599-42fb-a88e-3973487ce24f"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:43:16.313478"], ["updated_at", "2018-10-18 02:43:16.313478"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:43:16.316837"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2157ca42-3a65-4f0e-b828-fe5282c682c6"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 8a29ebe8-02d3-48f4-b4f0-0f9e48e0bd46\n"], ["created_at", "2018-10-18 02:43:16.319990"], ["updated_at", "2018-10-18 02:43:16.319990"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "8a29ebe8-02d3-48f4-b4f0-0f9e48e0bd46"], ["name", "test"], ["created_at", "2018-10-18 02:43:16.322884"], ["updated_at", "2018-10-18 02:43:16.322884"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3a7b48c4-9ed0-4430-b8e3-28b3f5d17063"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:43:16.324958"], ["updated_at", "2018-10-18 02:43:16.324958"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2558a053-513f-4532-a4b2-102e9e7b0a6e"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 0109ceee-5bc2-4ecc-b839-3892305eeb18\n"], ["created_at", "2018-10-18 02:43:16.329076"], ["updated_at", "2018-10-18 02:43:16.329076"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "0109ceee-5bc2-4ecc-b839-3892305eeb18"], ["name", "test2"], ["created_at", "2018-10-18 02:43:16.332659"], ["updated_at", "2018-10-18 02:43:16.332659"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cefb89c3-3bf9-4bcd-9588-44649feae627"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 90dd6afa-aa52-4bf3-8fa9-6af19efe55c1\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:43:16.336334"], ["updated_at", "2018-10-18 02:43:16.336334"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "90dd6afa-aa52-4bf3-8fa9-6af19efe55c1"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:43:16.341374"], ["updated_at", "2018-10-18 02:43:16.341374"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:43:32.243964', '2018-10-18 02:43:32.243964')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:43:32.246468', '2018-10-18 02:43:32.246468')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:43:32.248585', '2018-10-18 02:43:32.248585', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:43:32.250090', '2018-10-18 02:43:32.250090')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:43:32.251645', '2018-10-18 02:43:32.251645', 980190962)[0m
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.3ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0b9f8203-3a8a-42e5-b3f0-4c7a57de6890"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 76865da0-497b-4d7f-ac61-940db58e370b\n"], ["created_at", "2018-10-18 02:43:32.276113"], ["updated_at", "2018-10-18 02:43:32.276113"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "76865da0-497b-4d7f-ac61-940db58e370b"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:43:32.283911"], ["updated_at", "2018-10-18 02:43:32.283911"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 335c1834-97fe-4320-bff3-35351f1f8690) to Async(default) with arguments: "0b9f8203-3a8a-42e5-b3f0-4c7a57de6890"
[ActiveJob] [ReleaseJob] [335c1834-97fe-4320-bff3-35351f1f8690] Performing ReleaseJob (Job ID: 335c1834-97fe-4320-bff3-35351f1f8690) from Async(default) with arguments: "0b9f8203-3a8a-42e5-b3f0-4c7a57de6890"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
[ActiveJob] [ReleaseJob] [335c1834-97fe-4320-bff3-35351f1f8690]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "0b9f8203-3a8a-42e5-b3f0-4c7a57de6890"], ["LIMIT", 1]]
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [335c1834-97fe-4320-bff3-35351f1f8690] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
------------------------------------------
[ActiveJob] [ReleaseJob] [335c1834-97fe-4320-bff3-35351f1f8690] Error performing ReleaseJob (Job ID: 335c1834-97fe-4320-bff3-35351f1f8690) from Async(default) in 6.26ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d3a17d58-406c-4737-90a7-09fd7dbf70a1"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 4e1da043-b748-44e5-b41f-4a8300245303\n"], ["created_at", "2018-10-18 02:43:32.299351"], ["updated_at", "2018-10-18 02:43:32.299351"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "4e1da043-b748-44e5-b41f-4a8300245303"], ["status", "PENDING"], ["created_at", "2018-10-18 02:43:32.307475"], ["updated_at", "2018-10-18 02:43:32.307475"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a0c8211f-ff22-4e30-ab16-6e679312588a"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: c0fdec30-c833-4a76-87ad-0173d0d6b80e\n"], ["created_at", "2018-10-18 02:43:32.310084"], ["updated_at", "2018-10-18 02:43:32.310084"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "c0fdec30-c833-4a76-87ad-0173d0d6b80e"], ["name", "test"], ["created_at", "2018-10-18 02:43:32.315195"], ["updated_at", "2018-10-18 02:43:32.315195"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4586fe5c-bffe-4dd0-9a95-125e2346e5e2"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:43:32.318368"], ["updated_at", "2018-10-18 02:43:32.318368"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:43:32.321701"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "56bf2975-801a-47d0-8981-56973906d272"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 6a6eaa90-dc93-40a0-9233-ec1af3d46cd0\n"], ["created_at", "2018-10-18 02:43:32.330139"], ["updated_at", "2018-10-18 02:43:32.330139"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "6a6eaa90-dc93-40a0-9233-ec1af3d46cd0"], ["name", "test2"], ["created_at", "2018-10-18 02:43:32.335045"], ["updated_at", "2018-10-18 02:43:32.335045"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0222785d-0f37-43e0-b440-9962d4c81ca0"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 08cb3bd9-c4b3-4868-88c6-1a32eaada57d\n"], ["created_at", "2018-10-18 02:43:32.337846"], ["updated_at", "2018-10-18 02:43:32.337846"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "08cb3bd9-c4b3-4868-88c6-1a32eaada57d"], ["name", "test2"], ["created_at", "2018-10-18 02:43:32.341353"], ["updated_at", "2018-10-18 02:43:32.341353"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9a9ece89-d5d0-4f47-95c8-627fa45f592e"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 848b8ce4-8a8f-4e98-91a9-e580409c4867\n"], ["created_at", "2018-10-18 02:43:32.344148"], ["updated_at", "2018-10-18 02:43:32.344148"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "848b8ce4-8a8f-4e98-91a9-e580409c4867"], ["name", "test"], ["created_at", "2018-10-18 02:43:32.347510"], ["updated_at", "2018-10-18 02:43:32.347510"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "821fae66-2068-4722-a460-c176631f73f2"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:43:32.349302"], ["updated_at", "2018-10-18 02:43:32.349302"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "18c1d200-ad04-4b9b-a288-b99d0625839d"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:43:32.353949"], ["updated_at", "2018-10-18 02:43:32.353949"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:43:32.357081"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b9f1dc98-0abe-45e5-98d4-88cbb4569ebf"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:43:32.359790"], ["updated_at", "2018-10-18 02:43:32.359790"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af986b39-582b-4de0-9bc1-ee4be7ee4314"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: dc9ec7cf-f806-4240-af1c-60c83b5f302a\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:43:32.365572"], ["updated_at", "2018-10-18 02:43:32.365572"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "dc9ec7cf-f806-4240-af1c-60c83b5f302a"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:43:32.375575"], ["updated_at", "2018-10-18 02:43:32.375575"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:43:32 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bc345008-b1fc-4c15-be28-68f1cabb2ffe"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7\n"], ["created_at", "2018-10-18 02:43:32.392386"], ["updated_at", "2018-10-18 02:43:32.392386"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"], ["name", "test"], ["created_at", "2018-10-18 02:43:32.394833"], ["updated_at", "2018-10-18 02:43:32.394833"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6e794853-c182-4859-8ed4-0b498285cb6c"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 768e33ac-8a5d-4a76-8fad-76e85f7c2f61\napp_uid: 4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7\n"], ["created_at", "2018-10-18 02:43:32.397111"], ["updated_at", "2018-10-18 02:43:32.397111"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "768e33ac-8a5d-4a76-8fad-76e85f7c2f61"], ["name", "review"], ["created_at", "2018-10-18 02:43:32.400036"], ["updated_at", "2018-10-18 02:43:32.400036"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "768e33ac-8a5d-4a76-8fad-76e85f7c2f61"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"768e33ac-8a5d-4a76-8fad-76e85f7c2f61", "app_uid"=>"4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a575af65-af77-4174-97e8-49111bbcecc7"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 6bc09875-c133-4d0d-a5cb-66e76a570507\nstage_uid: 768e33ac-8a5d-4a76-8fad-76e85f7c2f61\napp_uid: 4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7\n"], ["created_at", "2018-10-18 02:43:32.402768"], ["updated_at", "2018-10-18 02:43:32.402768"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "768e33ac-8a5d-4a76-8fad-76e85f7c2f61"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "6bc09875-c133-4d0d-a5cb-66e76a570507"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:43:32.405745"], ["updated_at", "2018-10-18 02:43:32.405745"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2f6dfb51-1734-4464-bb01-fce289af9d68"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: dfabe282-c447-420a-be04-9bb195e5f625\napp_uid: 4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7\n"], ["created_at", "2018-10-18 02:43:32.409581"], ["updated_at", "2018-10-18 02:43:32.409581"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "dfabe282-c447-420a-be04-9bb195e5f625"], ["name", "staging"], ["created_at", "2018-10-18 02:43:32.411944"], ["updated_at", "2018-10-18 02:43:32.411944"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dfabe282-c447-420a-be04-9bb195e5f625"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"dfabe282-c447-420a-be04-9bb195e5f625", "app_uid"=>"4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fda6bbdd-74e4-4da5-b251-94114e19effb"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 47ce9ec9-34b6-4bc7-89de-72e2fe8278df\nstage_uid: dfabe282-c447-420a-be04-9bb195e5f625\napp_uid: 4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7\n"], ["created_at", "2018-10-18 02:43:32.415222"], ["updated_at", "2018-10-18 02:43:32.415222"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dfabe282-c447-420a-be04-9bb195e5f625"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "47ce9ec9-34b6-4bc7-89de-72e2fe8278df"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:43:32.418290"], ["updated_at", "2018-10-18 02:43:32.418290"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 36ms (ActiveRecord: 3.4ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:43:32 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 10ms (Views: 0.4ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:43:32 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3c53bb4a-ba79-42c1-ab17-ac5969e66c7e"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7\n"], ["created_at", "2018-10-18 02:43:32.436366"], ["updated_at", "2018-10-18 02:43:32.436366"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4a22d0b4-87ca-401f-bbce-d91ed8e9e8d7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:43:32 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ff686bff-cd28-4944-a5ac-749dc6033f61"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: dcbca8ce-930c-4c46-ba84-6e649413a3d7\n"], ["created_at", "2018-10-18 02:43:32.441996"], ["updated_at", "2018-10-18 02:43:32.441996"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "dcbca8ce-930c-4c46-ba84-6e649413a3d7"], ["name", "test"], ["created_at", "2018-10-18 02:43:32.444276"], ["updated_at", "2018-10-18 02:43:32.444276"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"dcbca8ce-930c-4c46-ba84-6e649413a3d7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6244da04-ae17-48b3-b679-ea6caed0c330"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 21f7fb26-9a04-4d0d-9190-059113777edc\napp_uid: dcbca8ce-930c-4c46-ba84-6e649413a3d7\n"], ["created_at", "2018-10-18 02:43:32.446183"], ["updated_at", "2018-10-18 02:43:32.446183"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "dcbca8ce-930c-4c46-ba84-6e649413a3d7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "21f7fb26-9a04-4d0d-9190-059113777edc"], ["name", "review"], ["created_at", "2018-10-18 02:43:32.448636"], ["updated_at", "2018-10-18 02:43:32.448636"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "21f7fb26-9a04-4d0d-9190-059113777edc"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"21f7fb26-9a04-4d0d-9190-059113777edc", "app_uid"=>"dcbca8ce-930c-4c46-ba84-6e649413a3d7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "15a1bf0f-0199-4756-a325-f8ec83edbe89"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: b29dab5b-967b-45d2-bd67-862879383052\nstage_uid: 21f7fb26-9a04-4d0d-9190-059113777edc\napp_uid: dcbca8ce-930c-4c46-ba84-6e649413a3d7\n"], ["created_at", "2018-10-18 02:43:32.451588"], ["updated_at", "2018-10-18 02:43:32.451588"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "dcbca8ce-930c-4c46-ba84-6e649413a3d7"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "21f7fb26-9a04-4d0d-9190-059113777edc"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "b29dab5b-967b-45d2-bd67-862879383052"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:43:32.454406"], ["updated_at", "2018-10-18 02:43:32.454406"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"dcbca8ce-930c-4c46-ba84-6e649413a3d7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "900dfe27-92d2-414f-82b8-9fdda637c2be"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 85c29054-b689-430d-a07b-2f3a4fb37d23\napp_uid: dcbca8ce-930c-4c46-ba84-6e649413a3d7\n"], ["created_at", "2018-10-18 02:43:32.457736"], ["updated_at", "2018-10-18 02:43:32.457736"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "dcbca8ce-930c-4c46-ba84-6e649413a3d7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "85c29054-b689-430d-a07b-2f3a4fb37d23"], ["name", "staging"], ["created_at", "2018-10-18 02:43:32.460524"], ["updated_at", "2018-10-18 02:43:32.460524"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "85c29054-b689-430d-a07b-2f3a4fb37d23"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"85c29054-b689-430d-a07b-2f3a4fb37d23", "app_uid"=>"dcbca8ce-930c-4c46-ba84-6e649413a3d7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "594db6ca-076c-44c3-87b8-e90f467eb741"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: ec1de12c-caff-48e2-a88a-2fc4d3fc1750\nstage_uid: 85c29054-b689-430d-a07b-2f3a4fb37d23\napp_uid: dcbca8ce-930c-4c46-ba84-6e649413a3d7\n"], ["created_at", "2018-10-18 02:43:32.463102"], ["updated_at", "2018-10-18 02:43:32.463102"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "dcbca8ce-930c-4c46-ba84-6e649413a3d7"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "85c29054-b689-430d-a07b-2f3a4fb37d23"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "ec1de12c-caff-48e2-a88a-2fc4d3fc1750"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:43:32.465827"], ["updated_at", "2018-10-18 02:43:32.465827"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 28ms (ActiveRecord: 3.0ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 19:43:32 -0700
Processing by AppsController#build as HTML
  Parameters: {"version"=>"v1", "stage"=>"review", "app_id"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"dcbca8ce-930c-4c46-ba84-6e649413a3d7", :stage_uid=>"21f7fb26-9a04-4d0d-9190-059113777edc"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "59793bfb-e35e-44c7-872b-680b97ad73f5"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: dcbca8ce-930c-4c46-ba84-6e649413a3d7\nstage_uid: 21f7fb26-9a04-4d0d-9190-059113777edc\nbuild_uid: 86ec04a7-0109-463b-90b7-6e396483d3c7\n"], ["created_at", "2018-10-18 02:43:32.471810"], ["updated_at", "2018-10-18 02:43:32.471810"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "dcbca8ce-930c-4c46-ba84-6e649413a3d7"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "21f7fb26-9a04-4d0d-9190-059113777edc"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "86ec04a7-0109-463b-90b7-6e396483d3c7"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 02:43:32.475311"], ["updated_at", "2018-10-18 02:43:32.475311"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
Started POST "/api/v1/apps/test/release?version=v1" for 127.0.0.1 at 2018-10-17 19:43:32 -0700
Processing by AppsController#release as HTML
  Parameters: {"version"=>"v1", "app_id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"86ec04a7-0109-463b-90b7-6e396483d3c7"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "70587f4f-0d6e-47fa-953a-fed3c9685082"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 86ec04a7-0109-463b-90b7-6e396483d3c7\nrelease_uid: 29b828b6-ae76-430b-b032-69f9016f4acd\n"], ["created_at", "2018-10-18 02:43:32.479301"], ["updated_at", "2018-10-18 02:43:32.479301"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "86ec04a7-0109-463b-90b7-6e396483d3c7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "29b828b6-ae76-430b-b032-69f9016f4acd"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 02:43:32.481610"], ["updated_at", "2018-10-18 02:43:32.481610"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: a91165f3-dbe7-4242-8fff-a806ea0fc6e7) to Async(default) with arguments: "70587f4f-0d6e-47fa-953a-fed3c9685082"
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7] Performing ReleaseJob (Job ID: a91165f3-dbe7-4242-8fff-a806ea0fc6e7) from Async(default) with arguments: "70587f4f-0d6e-47fa-953a-fed3c9685082"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "70587f4f-0d6e-47fa-953a-fed3c9685082"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:43:32 -0700
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mBuild Load (0.7ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "86ec04a7-0109-463b-90b7-6e396483d3c7"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"id"=>"test"}
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7] Executing command Releases::StatusCommand: {:release_uid=>"29b828b6-ae76-430b-b032-69f9016f4acd", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "718efd44-2138-4280-bdd5-c55661eb4da0"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 29b828b6-ae76-430b-b032-69f9016f4acd\nstatus: PENDING\n"], ["created_at", "2018-10-18 02:43:32.488149"], ["updated_at", "2018-10-18 02:43:32.488149"]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "29b828b6-ae76-430b-b032-69f9016f4acd"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 02:43:32.491087"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e0e66cc0-5675-4e1a-acec-e236dcaef0af"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 29b828b6-ae76-430b-b032-69f9016f4acd\ncluster_uid: b29dab5b-967b-45d2-bd67-862879383052\ndeploy_uid: 23aa2753-10a8-421e-b0cd-0de6629b3a77\n"], ["created_at", "2018-10-18 02:43:32.495233"], ["updated_at", "2018-10-18 02:43:32.495233"]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "29b828b6-ae76-430b-b032-69f9016f4acd"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "b29dab5b-967b-45d2-bd67-862879383052"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "23aa2753-10a8-421e-b0cd-0de6629b3a77"], ["status", "PENDING"], ["created_at", "2018-10-18 02:43:32.499368"], ["updated_at", "2018-10-18 02:43:32.499368"]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7] Executing command Releases::StatusCommand: {:release_uid=>"29b828b6-ae76-430b-b032-69f9016f4acd", :cluster_uid=>"b29dab5b-967b-45d2-bd67-862879383052", :status=>"PENDING", :error=>nil}
  [1m[36mRelease Load (0.3ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "039eec83-759b-4fd0-b089-0dadf5d24183"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 29b828b6-ae76-430b-b032-69f9016f4acd\nstatus: PENDING\n"], ["created_at", "2018-10-18 02:43:32.503044"], ["updated_at", "2018-10-18 02:43:32.503044"]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "29b828b6-ae76-430b-b032-69f9016f4acd"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 31ms (Views: 0.3ms | ActiveRecord: 1.5ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [a91165f3-dbe7-4242-8fff-a806ea0fc6e7] Performed ReleaseJob (Job ID: a91165f3-dbe7-4242-8fff-a806ea0fc6e7) from Async(default) in 34.95ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:45:24.810990', '2018-10-18 02:45:24.810990')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:45:24.813277', '2018-10-18 02:45:24.813277')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:45:24.815138', '2018-10-18 02:45:24.815138', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:45:24.816867', '2018-10-18 02:45:24.816867')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:45:24.818385', '2018-10-18 02:45:24.818385', 980190962)[0m
  [1m[35m (4.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d608b8b4-30c5-4bec-9dab-d56fd2c3a69a"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: bca899c7-3397-4cae-92e8-9932f6312e3d\n"], ["created_at", "2018-10-18 02:45:24.841216"], ["updated_at", "2018-10-18 02:45:24.841216"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "bca899c7-3397-4cae-92e8-9932f6312e3d"], ["name", "test2"], ["created_at", "2018-10-18 02:45:24.850449"], ["updated_at", "2018-10-18 02:45:24.850449"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7926caad-0547-4226-a5bd-10826061a0e1"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:45:24.853107"], ["updated_at", "2018-10-18 02:45:24.853107"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a25a20ba-fb87-4554-a40b-f6c48f273eb3"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 4472a997-8c56-4e66-8323-735e403a6960\n"], ["created_at", "2018-10-18 02:45:24.857175"], ["updated_at", "2018-10-18 02:45:24.857175"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "4472a997-8c56-4e66-8323-735e403a6960"], ["name", "test"], ["created_at", "2018-10-18 02:45:24.859648"], ["updated_at", "2018-10-18 02:45:24.859648"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a517493f-38a8-44b7-a37b-80352a8dc574"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 20639d2b-da39-4eca-843a-12ec60dd302e\n"], ["created_at", "2018-10-18 02:45:24.862663"], ["updated_at", "2018-10-18 02:45:24.862663"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "20639d2b-da39-4eca-843a-12ec60dd302e"], ["name", "test2"], ["created_at", "2018-10-18 02:45:24.866698"], ["updated_at", "2018-10-18 02:45:24.866698"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "eec0e6c7-442a-43fc-91d0-98266d7bf12c"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:45:24.869346"], ["updated_at", "2018-10-18 02:45:24.869346"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:45:24.871476"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a9ef86dc-7a4f-4b1a-84fd-6a5b875a010e"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:45:24.874113"], ["updated_at", "2018-10-18 02:45:24.874113"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "566819f7-0647-4f4a-a237-3a1ae31edb4d"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:45:24.878709"], ["updated_at", "2018-10-18 02:45:24.878709"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:45:24.882151"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e093008c-b5cd-404f-83cf-f287d1944945"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 5d5972e5-5454-4318-8a2e-6752f0aa009f\n"], ["created_at", "2018-10-18 02:45:24.885592"], ["updated_at", "2018-10-18 02:45:24.885592"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "5d5972e5-5454-4318-8a2e-6752f0aa009f"], ["name", "test"], ["created_at", "2018-10-18 02:45:24.888577"], ["updated_at", "2018-10-18 02:45:24.888577"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ddf708d2-4cdf-4957-8b2c-d8e06fc0c6c1"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 3d727393-a433-433c-8193-4f1467fe5eb2\n"], ["created_at", "2018-10-18 02:45:24.897937"], ["updated_at", "2018-10-18 02:45:24.897937"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3d727393-a433-433c-8193-4f1467fe5eb2"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:45:24.904243"], ["updated_at", "2018-10-18 02:45:24.904243"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: ded3f195-79d3-4076-99b0-d686e0aa9299) to Async(default) with arguments: "ddf708d2-4cdf-4957-8b2c-d8e06fc0c6c1"
[ActiveJob] [ReleaseJob] [ded3f195-79d3-4076-99b0-d686e0aa9299] Performing ReleaseJob (Job ID: ded3f195-79d3-4076-99b0-d686e0aa9299) from Async(default) with arguments: "ddf708d2-4cdf-4957-8b2c-d8e06fc0c6c1"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af31c4bf-ef17-4e3e-b1a9-e5ef4f46dc8e"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 95cab3fe-e3cc-4bd5-b1d7-d303be5db177\n"], ["created_at", "2018-10-18 02:45:24.914420"], ["updated_at", "2018-10-18 02:45:24.914420"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "95cab3fe-e3cc-4bd5-b1d7-d303be5db177"], ["status", "PENDING"], ["created_at", "2018-10-18 02:45:24.922695"], ["updated_at", "2018-10-18 02:45:24.922695"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [ded3f195-79d3-4076-99b0-d686e0aa9299]   [1m[36mEvent Load (10.8ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "ddf708d2-4cdf-4957-8b2c-d8e06fc0c6c1"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [ded3f195-79d3-4076-99b0-d686e0aa9299] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
--------------------------------------
[ActiveJob] [ReleaseJob] [ded3f195-79d3-4076-99b0-d686e0aa9299] Error performing ReleaseJob (Job ID: ded3f195-79d3-4076-99b0-d686e0aa9299) from Async(default) in 19.88ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f7cb7f87-6095-4920-8333-514ccf5b6754"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 1b62d1e7-ca95-4d80-ae5b-f5f64b20b3d1\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:45:24.929389"], ["updated_at", "2018-10-18 02:45:24.929389"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "1b62d1e7-ca95-4d80-ae5b-f5f64b20b3d1"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:45:24.939384"], ["updated_at", "2018-10-18 02:45:24.939384"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:45:24 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "33be4ee5-835b-4318-b4fd-754ed3b3a755"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: f928168c-9575-4339-aa5b-815ff53ffe5d\n"], ["created_at", "2018-10-18 02:45:24.955437"], ["updated_at", "2018-10-18 02:45:24.955437"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "f928168c-9575-4339-aa5b-815ff53ffe5d"], ["name", "test"], ["created_at", "2018-10-18 02:45:24.957621"], ["updated_at", "2018-10-18 02:45:24.957621"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"f928168c-9575-4339-aa5b-815ff53ffe5d"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bb26ae4e-d5dc-4272-9b67-49dd696ad532"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 61510669-6c9e-4fb4-8577-268431533ee2\napp_uid: f928168c-9575-4339-aa5b-815ff53ffe5d\n"], ["created_at", "2018-10-18 02:45:24.961371"], ["updated_at", "2018-10-18 02:45:24.961371"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f928168c-9575-4339-aa5b-815ff53ffe5d"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "61510669-6c9e-4fb4-8577-268431533ee2"], ["name", "review"], ["created_at", "2018-10-18 02:45:24.964696"], ["updated_at", "2018-10-18 02:45:24.964696"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "61510669-6c9e-4fb4-8577-268431533ee2"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"61510669-6c9e-4fb4-8577-268431533ee2", "app_uid"=>"f928168c-9575-4339-aa5b-815ff53ffe5d"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8078d7a7-b7ee-487c-aabc-4dbcc88c6aeb"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 240a66e9-7774-4dc5-822d-b8f803960feb\nstage_uid: 61510669-6c9e-4fb4-8577-268431533ee2\napp_uid: f928168c-9575-4339-aa5b-815ff53ffe5d\n"], ["created_at", "2018-10-18 02:45:24.967699"], ["updated_at", "2018-10-18 02:45:24.967699"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f928168c-9575-4339-aa5b-815ff53ffe5d"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "61510669-6c9e-4fb4-8577-268431533ee2"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "240a66e9-7774-4dc5-822d-b8f803960feb"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:45:24.971334"], ["updated_at", "2018-10-18 02:45:24.971334"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"f928168c-9575-4339-aa5b-815ff53ffe5d"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "57f4c9ad-48c9-43fd-973d-bb29b4f22664"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 1de58980-7c62-4c8e-9c45-3b8edf3629c9\napp_uid: f928168c-9575-4339-aa5b-815ff53ffe5d\n"], ["created_at", "2018-10-18 02:45:24.975440"], ["updated_at", "2018-10-18 02:45:24.975440"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f928168c-9575-4339-aa5b-815ff53ffe5d"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "1de58980-7c62-4c8e-9c45-3b8edf3629c9"], ["name", "staging"], ["created_at", "2018-10-18 02:45:24.977799"], ["updated_at", "2018-10-18 02:45:24.977799"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1de58980-7c62-4c8e-9c45-3b8edf3629c9"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"1de58980-7c62-4c8e-9c45-3b8edf3629c9", "app_uid"=>"f928168c-9575-4339-aa5b-815ff53ffe5d"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b439655c-1a28-4fa0-a218-26672614efd7"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 123f4147-6de6-42d7-9699-da82cd6cccb2\nstage_uid: 1de58980-7c62-4c8e-9c45-3b8edf3629c9\napp_uid: f928168c-9575-4339-aa5b-815ff53ffe5d\n"], ["created_at", "2018-10-18 02:45:24.980864"], ["updated_at", "2018-10-18 02:45:24.980864"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f928168c-9575-4339-aa5b-815ff53ffe5d"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1de58980-7c62-4c8e-9c45-3b8edf3629c9"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "123f4147-6de6-42d7-9699-da82cd6cccb2"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:45:24.983894"], ["updated_at", "2018-10-18 02:45:24.983894"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 38ms (ActiveRecord: 3.6ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 19:45:24 -0700
Processing by AppsController#build as HTML
  Parameters: {"version"=>"v1", "stage"=>"review", "app_id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"f928168c-9575-4339-aa5b-815ff53ffe5d", :stage_uid=>"61510669-6c9e-4fb4-8577-268431533ee2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "28ab0ccf-b68d-4306-bc80-abffa8a0afcf"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: f928168c-9575-4339-aa5b-815ff53ffe5d\nstage_uid: 61510669-6c9e-4fb4-8577-268431533ee2\nbuild_uid: f7b4045e-b18e-4041-bcb4-eef282ccfa1d\n"], ["created_at", "2018-10-18 02:45:24.991196"], ["updated_at", "2018-10-18 02:45:24.991196"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f928168c-9575-4339-aa5b-815ff53ffe5d"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "61510669-6c9e-4fb4-8577-268431533ee2"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "f7b4045e-b18e-4041-bcb4-eef282ccfa1d"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 02:45:24.994580"], ["updated_at", "2018-10-18 02:45:24.994580"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.7ms)
Started POST "/api/v1/apps/test/release?version=v1" for 127.0.0.1 at 2018-10-17 19:45:24 -0700
Processing by AppsController#release as HTML
  Parameters: {"version"=>"v1", "app_id"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"f7b4045e-b18e-4041-bcb4-eef282ccfa1d"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c80e038a-e97f-415b-ac85-16e061310a63"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: f7b4045e-b18e-4041-bcb4-eef282ccfa1d\nrelease_uid: 5bd2bd53-00fc-439f-9489-38db3cc3ace3\n"], ["created_at", "2018-10-18 02:45:24.998077"], ["updated_at", "2018-10-18 02:45:24.998077"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "f7b4045e-b18e-4041-bcb4-eef282ccfa1d"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5bd2bd53-00fc-439f-9489-38db3cc3ace3"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 02:45:25.000428"], ["updated_at", "2018-10-18 02:45:25.000428"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: e8cfa97a-eb4b-4b58-a244-fda45b28ccc0) to Async(default) with arguments: "c80e038a-e97f-415b-ac85-16e061310a63"
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0] Performing ReleaseJob (Job ID: e8cfa97a-eb4b-4b58-a244-fda45b28ccc0) from Async(default) with arguments: "c80e038a-e97f-415b-ac85-16e061310a63"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.5ms)
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "c80e038a-e97f-415b-ac85-16e061310a63"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:45:25 -0700
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mBuild Load (0.8ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "f7b4045e-b18e-4041-bcb4-eef282ccfa1d"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"id"=>"test"}
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0] Executing command Releases::StatusCommand: {:release_uid=>"5bd2bd53-00fc-439f-9489-38db3cc3ace3", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "83aa6261-da88-4a1d-b9f6-cf3214a30c5f"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 5bd2bd53-00fc-439f-9489-38db3cc3ace3\nstatus: PENDING\n"], ["created_at", "2018-10-18 02:45:25.007476"], ["updated_at", "2018-10-18 02:45:25.007476"]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "5bd2bd53-00fc-439f-9489-38db3cc3ace3"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 02:45:25.010420"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "96e744d0-fea7-45f9-bc73-a33a3ecea059"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 5bd2bd53-00fc-439f-9489-38db3cc3ace3\ncluster_uid: 240a66e9-7774-4dc5-822d-b8f803960feb\ndeploy_uid: e12e7ee9-a9b2-45ea-930c-be7c784ea83d\n"], ["created_at", "2018-10-18 02:45:25.017682"], ["updated_at", "2018-10-18 02:45:25.017682"]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "5bd2bd53-00fc-439f-9489-38db3cc3ace3"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "240a66e9-7774-4dc5-822d-b8f803960feb"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "e12e7ee9-a9b2-45ea-930c-be7c784ea83d"], ["status", "PENDING"], ["created_at", "2018-10-18 02:45:25.020578"], ["updated_at", "2018-10-18 02:45:25.020578"]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0] Executing command Releases::StatusCommand: {:release_uid=>"5bd2bd53-00fc-439f-9489-38db3cc3ace3", :cluster_uid=>"240a66e9-7774-4dc5-822d-b8f803960feb", :status=>"PENDING", :error=>nil}
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c8657458-12df-4137-bcca-86d534ca76c8"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 5bd2bd53-00fc-439f-9489-38db3cc3ace3\nstatus: PENDING\n"], ["created_at", "2018-10-18 02:45:25.022874"], ["updated_at", "2018-10-18 02:45:25.022874"]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "5bd2bd53-00fc-439f-9489-38db3cc3ace3"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 30ms (Views: 0.4ms | ActiveRecord: 1.5ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:45:25 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "57013ed1-4d85-4dc4-945f-bf19e9fd79ed"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 77f992a5-715b-4fee-afc0-bf70cd4729b0\n"], ["created_at", "2018-10-18 02:45:25.039631"], ["updated_at", "2018-10-18 02:45:25.039631"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "77f992a5-715b-4fee-afc0-bf70cd4729b0"], ["name", "test"], ["created_at", "2018-10-18 02:45:25.042142"], ["updated_at", "2018-10-18 02:45:25.042142"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"77f992a5-715b-4fee-afc0-bf70cd4729b0"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7811102e-1559-41e6-88a2-509488ded62b"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 776df951-66cb-4ebc-9443-096c69e56c7d\napp_uid: 77f992a5-715b-4fee-afc0-bf70cd4729b0\n"], ["created_at", "2018-10-18 02:45:25.044025"], ["updated_at", "2018-10-18 02:45:25.044025"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "77f992a5-715b-4fee-afc0-bf70cd4729b0"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "776df951-66cb-4ebc-9443-096c69e56c7d"], ["name", "review"], ["created_at", "2018-10-18 02:45:25.046522"], ["updated_at", "2018-10-18 02:45:25.046522"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "776df951-66cb-4ebc-9443-096c69e56c7d"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"776df951-66cb-4ebc-9443-096c69e56c7d", "app_uid"=>"77f992a5-715b-4fee-afc0-bf70cd4729b0"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "95c8aa8e-4fe8-4893-8248-f54bc7f5c998"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: e4391824-5be8-4ebe-83c3-cf873f02864c\nstage_uid: 776df951-66cb-4ebc-9443-096c69e56c7d\napp_uid: 77f992a5-715b-4fee-afc0-bf70cd4729b0\n"], ["created_at", "2018-10-18 02:45:25.049257"], ["updated_at", "2018-10-18 02:45:25.049257"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "77f992a5-715b-4fee-afc0-bf70cd4729b0"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "776df951-66cb-4ebc-9443-096c69e56c7d"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "e4391824-5be8-4ebe-83c3-cf873f02864c"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:45:25.052147"], ["updated_at", "2018-10-18 02:45:25.052147"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"77f992a5-715b-4fee-afc0-bf70cd4729b0"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ee645b9a-2909-43e2-a3cb-eea68c5fc5c1"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: ed550a8c-122b-4c05-bc6f-d0b8d01cd9d6\napp_uid: 77f992a5-715b-4fee-afc0-bf70cd4729b0\n"], ["created_at", "2018-10-18 02:45:25.055328"], ["updated_at", "2018-10-18 02:45:25.055328"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "77f992a5-715b-4fee-afc0-bf70cd4729b0"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "ed550a8c-122b-4c05-bc6f-d0b8d01cd9d6"], ["name", "staging"], ["created_at", "2018-10-18 02:45:25.057680"], ["updated_at", "2018-10-18 02:45:25.057680"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ed550a8c-122b-4c05-bc6f-d0b8d01cd9d6"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"ed550a8c-122b-4c05-bc6f-d0b8d01cd9d6", "app_uid"=>"77f992a5-715b-4fee-afc0-bf70cd4729b0"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6586ea96-4695-417e-a915-60a0c57e46cf"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: dac5cbb5-6f86-45ca-903d-9c333639b5c3\nstage_uid: ed550a8c-122b-4c05-bc6f-d0b8d01cd9d6\napp_uid: 77f992a5-715b-4fee-afc0-bf70cd4729b0\n"], ["created_at", "2018-10-18 02:45:25.060615"], ["updated_at", "2018-10-18 02:45:25.060615"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "77f992a5-715b-4fee-afc0-bf70cd4729b0"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ed550a8c-122b-4c05-bc6f-d0b8d01cd9d6"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "dac5cbb5-6f86-45ca-903d-9c333639b5c3"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:45:25.063471"], ["updated_at", "2018-10-18 02:45:25.063471"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 28ms (ActiveRecord: 3.1ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:45:25 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 0.8ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:45:25 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"77f992a5-715b-4fee-afc0-bf70cd4729b0"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "654a8331-f7ee-47d7-8371-a0ef0a9e26d6"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 77f992a5-715b-4fee-afc0-bf70cd4729b0\n"], ["created_at", "2018-10-18 02:45:25.077517"], ["updated_at", "2018-10-18 02:45:25.077517"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "77f992a5-715b-4fee-afc0-bf70cd4729b0"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [e8cfa97a-eb4b-4b58-a244-fda45b28ccc0] Performed ReleaseJob (Job ID: e8cfa97a-eb4b-4b58-a244-fda45b28ccc0) from Async(default) in 78.42ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:47:07.619145', '2018-10-18 02:47:07.619145')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:47:07.621483', '2018-10-18 02:47:07.621483')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:47:07.623023', '2018-10-18 02:47:07.623023', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:47:07.624397', '2018-10-18 02:47:07.624397')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:47:07.625855', '2018-10-18 02:47:07.625855', 980190962)[0m
  [1m[35m (3.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4c22bba4-913f-4d02-a8f5-5d8c9b35dd26"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 98c5b2ac-16fe-4532-a0ba-7d10a1ccfbfe\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:47:07.651369"], ["updated_at", "2018-10-18 02:47:07.651369"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "98c5b2ac-16fe-4532-a0ba-7d10a1ccfbfe"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:47:07.659087"], ["updated_at", "2018-10-18 02:47:07.659087"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "937d7507-89e6-47d2-b72e-1f4102e99dc7"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 4028c0d2-0d66-49cf-9f7b-cd64cfe19df6\n"], ["created_at", "2018-10-18 02:47:07.663857"], ["updated_at", "2018-10-18 02:47:07.663857"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4028c0d2-0d66-49cf-9f7b-cd64cfe19df6"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:47:07.670811"], ["updated_at", "2018-10-18 02:47:07.670811"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 1d771338-37f2-499f-a3d6-ff214ee0cc63) to Async(default) with arguments: "937d7507-89e6-47d2-b72e-1f4102e99dc7"
[ActiveJob] [ReleaseJob] [1d771338-37f2-499f-a3d6-ff214ee0cc63] Performing ReleaseJob (Job ID: 1d771338-37f2-499f-a3d6-ff214ee0cc63) from Async(default) with arguments: "937d7507-89e6-47d2-b72e-1f4102e99dc7"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [1d771338-37f2-499f-a3d6-ff214ee0cc63]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "937d7507-89e6-47d2-b72e-1f4102e99dc7"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [1d771338-37f2-499f-a3d6-ff214ee0cc63] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [1d771338-37f2-499f-a3d6-ff214ee0cc63] Error performing ReleaseJob (Job ID: 1d771338-37f2-499f-a3d6-ff214ee0cc63) from Async(default) in 12.31ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "59692c91-2ba9-4339-bd1c-00f784b335b6"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 2be56241-60ee-481b-981e-8002eb68d407\n"], ["created_at", "2018-10-18 02:47:07.685942"], ["updated_at", "2018-10-18 02:47:07.685942"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "2be56241-60ee-481b-981e-8002eb68d407"], ["status", "PENDING"], ["created_at", "2018-10-18 02:47:07.694683"], ["updated_at", "2018-10-18 02:47:07.694683"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c225b89f-8b6d-4dfc-b6a6-0b6d9a121b41"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 6eb4fc19-9fb2-4bd4-8159-2f40dc5fffde\n"], ["created_at", "2018-10-18 02:47:07.697540"], ["updated_at", "2018-10-18 02:47:07.697540"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "6eb4fc19-9fb2-4bd4-8159-2f40dc5fffde"], ["name", "test"], ["created_at", "2018-10-18 02:47:07.700918"], ["updated_at", "2018-10-18 02:47:07.700918"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "52bb180b-92f4-4916-b3b7-8e338770f84a"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: c491e31d-524f-41ad-9d27-69242dbb6662\n"], ["created_at", "2018-10-18 02:47:07.702853"], ["updated_at", "2018-10-18 02:47:07.702853"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "c491e31d-524f-41ad-9d27-69242dbb6662"], ["name", "test"], ["created_at", "2018-10-18 02:47:07.704707"], ["updated_at", "2018-10-18 02:47:07.704707"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5927be2e-9f25-44d6-8b13-f073450c7fe2"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:47:07.706484"], ["updated_at", "2018-10-18 02:47:07.706484"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "95a1993d-7c84-4dde-aa36-b756012c1a62"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:47:07.709702"], ["updated_at", "2018-10-18 02:47:07.709702"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:47:07.711864"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cd196800-20ab-48f6-9613-80d2644238de"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: e2204db8-36d1-4455-990c-4712c0a57c5a\n"], ["created_at", "2018-10-18 02:47:07.715957"], ["updated_at", "2018-10-18 02:47:07.715957"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "e2204db8-36d1-4455-990c-4712c0a57c5a"], ["name", "test2"], ["created_at", "2018-10-18 02:47:07.719329"], ["updated_at", "2018-10-18 02:47:07.719329"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e430be2a-6b6f-48d9-a022-89361e9be34a"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: a7a3cb50-85ab-461c-ac65-778123ad261f\n"], ["created_at", "2018-10-18 02:47:07.722071"], ["updated_at", "2018-10-18 02:47:07.722071"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a7a3cb50-85ab-461c-ac65-778123ad261f"], ["name", "test2"], ["created_at", "2018-10-18 02:47:07.724691"], ["updated_at", "2018-10-18 02:47:07.724691"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1ad22755-542a-4fc0-8a64-e2ac0f774a2b"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:47:07.727564"], ["updated_at", "2018-10-18 02:47:07.727564"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:47:07.735282"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bfb634c6-4542-42da-bd0f-0db6f7da1dba"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:47:07.738579"], ["updated_at", "2018-10-18 02:47:07.738579"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:47:07 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "704c33b4-f6d6-436d-931f-14b2266e9c0c"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 3fd44146-8008-464f-bf5d-2a663e9cce84\n"], ["created_at", "2018-10-18 02:47:07.755366"], ["updated_at", "2018-10-18 02:47:07.755366"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "3fd44146-8008-464f-bf5d-2a663e9cce84"], ["name", "test"], ["created_at", "2018-10-18 02:47:07.757697"], ["updated_at", "2018-10-18 02:47:07.757697"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"3fd44146-8008-464f-bf5d-2a663e9cce84"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3fcf2798-ea3c-4b8b-889b-9f29c85d9afb"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 27b9fadf-dbd9-4116-aa63-54b34fccedd3\napp_uid: 3fd44146-8008-464f-bf5d-2a663e9cce84\n"], ["created_at", "2018-10-18 02:47:07.760455"], ["updated_at", "2018-10-18 02:47:07.760455"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3fd44146-8008-464f-bf5d-2a663e9cce84"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "27b9fadf-dbd9-4116-aa63-54b34fccedd3"], ["name", "review"], ["created_at", "2018-10-18 02:47:07.763308"], ["updated_at", "2018-10-18 02:47:07.763308"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "27b9fadf-dbd9-4116-aa63-54b34fccedd3"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"27b9fadf-dbd9-4116-aa63-54b34fccedd3", "app_uid"=>"3fd44146-8008-464f-bf5d-2a663e9cce84"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c46a941a-463a-4f91-96c0-6dc7c8532045"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 7983925b-9335-441a-b328-25c32da27030\nstage_uid: 27b9fadf-dbd9-4116-aa63-54b34fccedd3\napp_uid: 3fd44146-8008-464f-bf5d-2a663e9cce84\n"], ["created_at", "2018-10-18 02:47:07.766561"], ["updated_at", "2018-10-18 02:47:07.766561"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3fd44146-8008-464f-bf5d-2a663e9cce84"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "27b9fadf-dbd9-4116-aa63-54b34fccedd3"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "7983925b-9335-441a-b328-25c32da27030"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:47:07.769623"], ["updated_at", "2018-10-18 02:47:07.769623"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"3fd44146-8008-464f-bf5d-2a663e9cce84"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d93eef57-6654-4d08-b032-e411f6dd8df4"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: ef033f86-ba68-4a42-8a3c-7ba308fef398\napp_uid: 3fd44146-8008-464f-bf5d-2a663e9cce84\n"], ["created_at", "2018-10-18 02:47:07.773567"], ["updated_at", "2018-10-18 02:47:07.773567"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3fd44146-8008-464f-bf5d-2a663e9cce84"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "ef033f86-ba68-4a42-8a3c-7ba308fef398"], ["name", "staging"], ["created_at", "2018-10-18 02:47:07.775899"], ["updated_at", "2018-10-18 02:47:07.775899"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ef033f86-ba68-4a42-8a3c-7ba308fef398"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"ef033f86-ba68-4a42-8a3c-7ba308fef398", "app_uid"=>"3fd44146-8008-464f-bf5d-2a663e9cce84"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fb970042-7e3c-48db-af47-eeb5e83d0211"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 7c6ffcfc-72c2-4ae7-b5e1-456c985b4599\nstage_uid: ef033f86-ba68-4a42-8a3c-7ba308fef398\napp_uid: 3fd44146-8008-464f-bf5d-2a663e9cce84\n"], ["created_at", "2018-10-18 02:47:07.778913"], ["updated_at", "2018-10-18 02:47:07.778913"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3fd44146-8008-464f-bf5d-2a663e9cce84"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ef033f86-ba68-4a42-8a3c-7ba308fef398"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "7c6ffcfc-72c2-4ae7-b5e1-456c985b4599"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:47:07.782378"], ["updated_at", "2018-10-18 02:47:07.782378"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 38ms (ActiveRecord: 3.6ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:47:07 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 1.0ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:47:07 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"3fd44146-8008-464f-bf5d-2a663e9cce84"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "200eeb05-daf2-4813-a747-bae7f53668fe"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 3fd44146-8008-464f-bf5d-2a663e9cce84\n"], ["created_at", "2018-10-18 02:47:07.801861"], ["updated_at", "2018-10-18 02:47:07.801861"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3fd44146-8008-464f-bf5d-2a663e9cce84"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:47:07 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c5fa687d-d349-4186-8c90-6d3e78b881f3"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: bb4f8bd5-6c19-44b2-978e-44369fb0b865\n"], ["created_at", "2018-10-18 02:47:07.807768"], ["updated_at", "2018-10-18 02:47:07.807768"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "bb4f8bd5-6c19-44b2-978e-44369fb0b865"], ["name", "test"], ["created_at", "2018-10-18 02:47:07.809992"], ["updated_at", "2018-10-18 02:47:07.809992"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"bb4f8bd5-6c19-44b2-978e-44369fb0b865"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cfda8543-add9-48f7-b4a9-3eb0977e219e"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: d96c8269-a040-44a6-ae29-0f74ec9a7326\napp_uid: bb4f8bd5-6c19-44b2-978e-44369fb0b865\n"], ["created_at", "2018-10-18 02:47:07.811895"], ["updated_at", "2018-10-18 02:47:07.811895"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "bb4f8bd5-6c19-44b2-978e-44369fb0b865"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "d96c8269-a040-44a6-ae29-0f74ec9a7326"], ["name", "review"], ["created_at", "2018-10-18 02:47:07.814066"], ["updated_at", "2018-10-18 02:47:07.814066"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d96c8269-a040-44a6-ae29-0f74ec9a7326"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"d96c8269-a040-44a6-ae29-0f74ec9a7326", "app_uid"=>"bb4f8bd5-6c19-44b2-978e-44369fb0b865"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2d098841-e4ee-453a-b34f-f7331ef46faa"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: a27d48d9-1402-4285-929b-c1de584cc0f9\nstage_uid: d96c8269-a040-44a6-ae29-0f74ec9a7326\napp_uid: bb4f8bd5-6c19-44b2-978e-44369fb0b865\n"], ["created_at", "2018-10-18 02:47:07.816609"], ["updated_at", "2018-10-18 02:47:07.816609"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "bb4f8bd5-6c19-44b2-978e-44369fb0b865"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d96c8269-a040-44a6-ae29-0f74ec9a7326"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "a27d48d9-1402-4285-929b-c1de584cc0f9"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:47:07.819385"], ["updated_at", "2018-10-18 02:47:07.819385"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"bb4f8bd5-6c19-44b2-978e-44369fb0b865"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5e59095d-a8b1-4abf-ad7d-58cdc80cadc1"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: af43c3d1-0710-4e6a-8a8d-d937afd8133e\napp_uid: bb4f8bd5-6c19-44b2-978e-44369fb0b865\n"], ["created_at", "2018-10-18 02:47:07.822454"], ["updated_at", "2018-10-18 02:47:07.822454"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "bb4f8bd5-6c19-44b2-978e-44369fb0b865"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "af43c3d1-0710-4e6a-8a8d-d937afd8133e"], ["name", "staging"], ["created_at", "2018-10-18 02:47:07.824489"], ["updated_at", "2018-10-18 02:47:07.824489"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "af43c3d1-0710-4e6a-8a8d-d937afd8133e"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"af43c3d1-0710-4e6a-8a8d-d937afd8133e", "app_uid"=>"bb4f8bd5-6c19-44b2-978e-44369fb0b865"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "734acf48-0e55-4a6a-ac3d-6bd3652ce9cc"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 33a59f51-2be3-43ee-bf66-0aac7341c4a8\nstage_uid: af43c3d1-0710-4e6a-8a8d-d937afd8133e\napp_uid: bb4f8bd5-6c19-44b2-978e-44369fb0b865\n"], ["created_at", "2018-10-18 02:47:07.827318"], ["updated_at", "2018-10-18 02:47:07.827318"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "bb4f8bd5-6c19-44b2-978e-44369fb0b865"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "af43c3d1-0710-4e6a-8a8d-d937afd8133e"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "33a59f51-2be3-43ee-bf66-0aac7341c4a8"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:47:07.830331"], ["updated_at", "2018-10-18 02:47:07.830331"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 27ms (ActiveRecord: 3.1ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 19:47:07 -0700
Processing by AppsController#build as HTML
  Parameters: {"version"=>"v1", "stage"=>"review", "app_id"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"bb4f8bd5-6c19-44b2-978e-44369fb0b865", :stage_uid=>"d96c8269-a040-44a6-ae29-0f74ec9a7326"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "171d69a2-1dab-4e80-bbdb-28b9053daf47"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: bb4f8bd5-6c19-44b2-978e-44369fb0b865\nstage_uid: d96c8269-a040-44a6-ae29-0f74ec9a7326\nbuild_uid: e4c88176-b84a-43cf-accf-c43e5d047f86\n"], ["created_at", "2018-10-18 02:47:07.835690"], ["updated_at", "2018-10-18 02:47:07.835690"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "bb4f8bd5-6c19-44b2-978e-44369fb0b865"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d96c8269-a040-44a6-ae29-0f74ec9a7326"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "e4c88176-b84a-43cf-accf-c43e5d047f86"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 02:47:07.838896"], ["updated_at", "2018-10-18 02:47:07.838896"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.7ms)
Started POST "/api/v1/apps/test/release?version=v1&stage=review" for 127.0.0.1 at 2018-10-17 19:47:07 -0700
Processing by AppsController#release as HTML
  Parameters: {"version"=>"v1", "stage"=>"review", "app_id"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"e4c88176-b84a-43cf-accf-c43e5d047f86"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "97677e65-0caa-49bf-955d-055153335e8d"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: e4c88176-b84a-43cf-accf-c43e5d047f86\nrelease_uid: b514d3db-b406-4636-8118-8dfec0d85083\n"], ["created_at", "2018-10-18 02:47:07.842941"], ["updated_at", "2018-10-18 02:47:07.842941"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "e4c88176-b84a-43cf-accf-c43e5d047f86"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b514d3db-b406-4636-8118-8dfec0d85083"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 02:47:07.844785"], ["updated_at", "2018-10-18 02:47:07.844785"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 340cc94b-c980-4711-99a7-5ee06642d42c) to Async(default) with arguments: "97677e65-0caa-49bf-955d-055153335e8d"
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c] Performing ReleaseJob (Job ID: 340cc94b-c980-4711-99a7-5ee06642d42c) from Async(default) with arguments: "97677e65-0caa-49bf-955d-055153335e8d"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "97677e65-0caa-49bf-955d-055153335e8d"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:47:07 -0700
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mBuild Load (0.7ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "e4c88176-b84a-43cf-accf-c43e5d047f86"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"id"=>"test"}
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c] Executing command Releases::StatusCommand: {:release_uid=>"b514d3db-b406-4636-8118-8dfec0d85083", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "703cc16c-3de8-4c79-b6e8-e17a6fb24941"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b514d3db-b406-4636-8118-8dfec0d85083\nstatus: PENDING\n"], ["created_at", "2018-10-18 02:47:07.851845"], ["updated_at", "2018-10-18 02:47:07.851845"]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b514d3db-b406-4636-8118-8dfec0d85083"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 02:47:07.855717"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7d99a594-7a74-4004-9038-f1661e7e24f2"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b514d3db-b406-4636-8118-8dfec0d85083\ncluster_uid: a27d48d9-1402-4285-929b-c1de584cc0f9\ndeploy_uid: 756bb5fd-12ee-4791-8d47-99e3a43aca1b\n"], ["created_at", "2018-10-18 02:47:07.860188"], ["updated_at", "2018-10-18 02:47:07.860188"]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b514d3db-b406-4636-8118-8dfec0d85083"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "a27d48d9-1402-4285-929b-c1de584cc0f9"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "756bb5fd-12ee-4791-8d47-99e3a43aca1b"], ["status", "PENDING"], ["created_at", "2018-10-18 02:47:07.862856"], ["updated_at", "2018-10-18 02:47:07.862856"]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c] Executing command Releases::StatusCommand: {:release_uid=>"b514d3db-b406-4636-8118-8dfec0d85083", :cluster_uid=>"a27d48d9-1402-4285-929b-c1de584cc0f9", :status=>"PENDING", :error=>nil}
  [1m[36mRelease Load (0.3ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "05e11d6e-136e-443f-a24c-1152f2abddfe"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b514d3db-b406-4636-8118-8dfec0d85083\nstatus: PENDING\n"], ["created_at", "2018-10-18 02:47:07.865530"], ["updated_at", "2018-10-18 02:47:07.865530"]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b514d3db-b406-4636-8118-8dfec0d85083"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 31ms (Views: 0.5ms | ActiveRecord: 1.7ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [340cc94b-c980-4711-99a7-5ee06642d42c] Performed ReleaseJob (Job ID: 340cc94b-c980-4711-99a7-5ee06642d42c) from Async(default) in 36.08ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 02:49:11.271609', '2018-10-18 02:49:11.271609')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 02:49:11.274355', '2018-10-18 02:49:11.274355')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 02:49:11.276078', '2018-10-18 02:49:11.276078', 980190962)[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 02:49:11.277586', '2018-10-18 02:49:11.277586')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 02:49:11.279417', '2018-10-18 02:49:11.279417', 980190962)[0m
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "563f8dec-735f-48f4-8fbf-1fc06b5a1e72"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 02:49:11.294691"], ["updated_at", "2018-10-18 02:49:11.294691"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "90a2b628-9dbc-4dcf-802e-5b14872a5336"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 02:49:11.306437"], ["updated_at", "2018-10-18 02:49:11.306437"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:49:11.310483"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c3c9258a-b7d2-489d-a4b9-8191389b77fc"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 6468a920-0738-44b6-b933-f50b84bb89b6\n"], ["created_at", "2018-10-18 02:49:11.313580"], ["updated_at", "2018-10-18 02:49:11.313580"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "6468a920-0738-44b6-b933-f50b84bb89b6"], ["name", "test"], ["created_at", "2018-10-18 02:49:11.316991"], ["updated_at", "2018-10-18 02:49:11.316991"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "194fc0fb-c1d3-4724-970e-019161a379aa"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 02:49:11.318871"], ["updated_at", "2018-10-18 02:49:11.318871"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6e248f2d-048b-46ab-b78e-b188b6bd556e"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: e8b23cca-2d12-42f1-8020-c318c0fbe38e\n"], ["created_at", "2018-10-18 02:49:11.323080"], ["updated_at", "2018-10-18 02:49:11.323080"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "e8b23cca-2d12-42f1-8020-c318c0fbe38e"], ["name", "test2"], ["created_at", "2018-10-18 02:49:11.330426"], ["updated_at", "2018-10-18 02:49:11.330426"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6f1d07c6-2670-4096-804f-af11f1e46382"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 4e801b67-9ea9-480f-aa8d-2b154d63c76d\n"], ["created_at", "2018-10-18 02:49:11.333819"], ["updated_at", "2018-10-18 02:49:11.333819"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "4e801b67-9ea9-480f-aa8d-2b154d63c76d"], ["name", "test2"], ["created_at", "2018-10-18 02:49:11.337739"], ["updated_at", "2018-10-18 02:49:11.337739"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9a61d3bf-44ae-4776-9268-43758c0fa49f"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 02:49:11.340266"], ["updated_at", "2018-10-18 02:49:11.340266"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 02:49:11.342313"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bc0182b1-1ab3-4ca7-a85f-b14146b3eb50"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: ac70495a-c4d4-4968-8374-9a80791217ce\n"], ["created_at", "2018-10-18 02:49:11.344300"], ["updated_at", "2018-10-18 02:49:11.344300"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "ac70495a-c4d4-4968-8374-9a80791217ce"], ["name", "test"], ["created_at", "2018-10-18 02:49:11.346063"], ["updated_at", "2018-10-18 02:49:11.346063"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:49:11 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "eac15641-43b3-41b1-a427-35e11ba30198"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: a7297f0a-604e-4c7f-8e04-3f790423cf45\n"], ["created_at", "2018-10-18 02:49:11.361292"], ["updated_at", "2018-10-18 02:49:11.361292"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "a7297f0a-604e-4c7f-8e04-3f790423cf45"], ["name", "test"], ["created_at", "2018-10-18 02:49:11.363509"], ["updated_at", "2018-10-18 02:49:11.363509"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"a7297f0a-604e-4c7f-8e04-3f790423cf45"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f30a56b0-93e4-4d04-9620-957c8cf0f8c1"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 7ff88b08-c54e-4c85-949b-f52d9db47d68\napp_uid: a7297f0a-604e-4c7f-8e04-3f790423cf45\n"], ["created_at", "2018-10-18 02:49:11.365726"], ["updated_at", "2018-10-18 02:49:11.365726"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "a7297f0a-604e-4c7f-8e04-3f790423cf45"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "7ff88b08-c54e-4c85-949b-f52d9db47d68"], ["name", "review"], ["created_at", "2018-10-18 02:49:11.368238"], ["updated_at", "2018-10-18 02:49:11.368238"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "7ff88b08-c54e-4c85-949b-f52d9db47d68"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"7ff88b08-c54e-4c85-949b-f52d9db47d68", "app_uid"=>"a7297f0a-604e-4c7f-8e04-3f790423cf45"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0f6499eb-b338-47b3-912e-f06669660746"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 538ca124-71ed-4379-be3c-2f59d1b113e0\nstage_uid: 7ff88b08-c54e-4c85-949b-f52d9db47d68\napp_uid: a7297f0a-604e-4c7f-8e04-3f790423cf45\n"], ["created_at", "2018-10-18 02:49:11.371139"], ["updated_at", "2018-10-18 02:49:11.371139"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "a7297f0a-604e-4c7f-8e04-3f790423cf45"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "7ff88b08-c54e-4c85-949b-f52d9db47d68"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "538ca124-71ed-4379-be3c-2f59d1b113e0"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:49:11.374780"], ["updated_at", "2018-10-18 02:49:11.374780"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"a7297f0a-604e-4c7f-8e04-3f790423cf45"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "674aa908-63d1-4ca5-a6bd-3d4e4c78fb45"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 9dc907cb-96a8-4004-8b7e-35bb0cd3e430\napp_uid: a7297f0a-604e-4c7f-8e04-3f790423cf45\n"], ["created_at", "2018-10-18 02:49:11.379125"], ["updated_at", "2018-10-18 02:49:11.379125"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "a7297f0a-604e-4c7f-8e04-3f790423cf45"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9dc907cb-96a8-4004-8b7e-35bb0cd3e430"], ["name", "staging"], ["created_at", "2018-10-18 02:49:11.381619"], ["updated_at", "2018-10-18 02:49:11.381619"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9dc907cb-96a8-4004-8b7e-35bb0cd3e430"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"9dc907cb-96a8-4004-8b7e-35bb0cd3e430", "app_uid"=>"a7297f0a-604e-4c7f-8e04-3f790423cf45"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "204bfd23-44c4-4dd5-a925-862079a5b47c"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: a54b1619-36b9-4b73-bb8d-5e70e68965e3\nstage_uid: 9dc907cb-96a8-4004-8b7e-35bb0cd3e430\napp_uid: a7297f0a-604e-4c7f-8e04-3f790423cf45\n"], ["created_at", "2018-10-18 02:49:11.384097"], ["updated_at", "2018-10-18 02:49:11.384097"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "a7297f0a-604e-4c7f-8e04-3f790423cf45"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9dc907cb-96a8-4004-8b7e-35bb0cd3e430"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "a54b1619-36b9-4b73-bb8d-5e70e68965e3"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:49:11.386640"], ["updated_at", "2018-10-18 02:49:11.386640"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 37ms (ActiveRecord: 3.4ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 19:49:11 -0700
Processing by AppsController#build as HTML
  Parameters: {"version"=>"v1", "stage"=>"review", "app_id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"a7297f0a-604e-4c7f-8e04-3f790423cf45", :stage_uid=>"7ff88b08-c54e-4c85-949b-f52d9db47d68"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0f732b99-b8ab-45c1-90b5-232656ef7be2"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: a7297f0a-604e-4c7f-8e04-3f790423cf45\nstage_uid: 7ff88b08-c54e-4c85-949b-f52d9db47d68\nbuild_uid: 108916a3-7ec0-4521-9ad8-cac053cad7ad\n"], ["created_at", "2018-10-18 02:49:11.395016"], ["updated_at", "2018-10-18 02:49:11.395016"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "a7297f0a-604e-4c7f-8e04-3f790423cf45"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "7ff88b08-c54e-4c85-949b-f52d9db47d68"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "108916a3-7ec0-4521-9ad8-cac053cad7ad"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 02:49:11.404847"], ["updated_at", "2018-10-18 02:49:11.404847"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 13ms (ActiveRecord: 0.8ms)
Started POST "/api/v1/apps/test/release?version=v1&stage=review" for 127.0.0.1 at 2018-10-17 19:49:11 -0700
Processing by AppsController#release as HTML
  Parameters: {"version"=>"v1", "stage"=>"review", "app_id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"108916a3-7ec0-4521-9ad8-cac053cad7ad"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6867c8cc-30b9-4f43-a095-84d4c0a8911d"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 108916a3-7ec0-4521-9ad8-cac053cad7ad\nrelease_uid: 8196d881-3539-4341-9cda-b219c4d44de9\n"], ["created_at", "2018-10-18 02:49:11.409534"], ["updated_at", "2018-10-18 02:49:11.409534"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "108916a3-7ec0-4521-9ad8-cac053cad7ad"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8196d881-3539-4341-9cda-b219c4d44de9"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 02:49:11.415618"], ["updated_at", "2018-10-18 02:49:11.415618"]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc] Performing ReleaseJob (Job ID: 7f27527b-4852-4400-94b3-205d40e961cc) from Async(default) with arguments: "6867c8cc-30b9-4f43-a095-84d4c0a8911d"
[ActiveJob] Enqueued ReleaseJob (Job ID: 7f27527b-4852-4400-94b3-205d40e961cc) to Async(default) with arguments: "6867c8cc-30b9-4f43-a095-84d4c0a8911d"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 12ms (ActiveRecord: 0.7ms)
Started POST "/api/v1/apps/test/promote?version=v1&stage=review&to=staging" for 127.0.0.1 at 2018-10-17 19:49:11 -0700
Processing by AppsController#promote as HTML
  Parameters: {"version"=>"v1", "stage"=>"review", "to"=>"staging", "app_id"=>"test"}
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "6867c8cc-30b9-4f43-a095-84d4c0a8911d"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "108916a3-7ec0-4521-9ad8-cac053cad7ad"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc] Executing command Releases::StatusCommand: {:release_uid=>"8196d881-3539-4341-9cda-b219c4d44de9", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "437ecd04-72d5-48c4-a893-87b5aa566462"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 8196d881-3539-4341-9cda-b219c4d44de9\nstatus: PENDING\n"], ["created_at", "2018-10-18 02:49:11.427968"], ["updated_at", "2018-10-18 02:49:11.427968"]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "8196d881-3539-4341-9cda-b219c4d44de9"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 02:49:11.431252"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"108916a3-7ec0-4521-9ad8-cac053cad7ad", :target_stage_uid=>"9dc907cb-96a8-4004-8b7e-35bb0cd3e430"}
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9f3c34a7-64ca-4da0-b0a2-ea42ba8c8435"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: 108916a3-7ec0-4521-9ad8-cac053cad7ad\ntarget_stage_uid: 9dc907cb-96a8-4004-8b7e-35bb0cd3e430\nbuild_uid: d27dc861-e30d-4bb7-9b63-ca35660a9365\n"], ["created_at", "2018-10-18 02:49:11.433955"], ["updated_at", "2018-10-18 02:49:11.433955"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "108916a3-7ec0-4521-9ad8-cac053cad7ad"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9dc907cb-96a8-4004-8b7e-35bb0cd3e430"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 02:49:11.438984"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "d27dc861-e30d-4bb7-9b63-ca35660a9365"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 02:49:11.440841"], ["updated_at", "2018-10-18 02:49:11.440841"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 19ms (ActiveRecord: 1.3ms)
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a704126c-4aae-49dd-b398-c71ced75b4f6"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 8196d881-3539-4341-9cda-b219c4d44de9\ncluster_uid: 538ca124-71ed-4379-be3c-2f59d1b113e0\ndeploy_uid: 6fe68b27-8183-4b6f-9aa7-949d9e6fc414\n"], ["created_at", "2018-10-18 02:49:11.442407"], ["updated_at", "2018-10-18 02:49:11.442407"]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "8196d881-3539-4341-9cda-b219c4d44de9"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "538ca124-71ed-4379-be3c-2f59d1b113e0"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "6fe68b27-8183-4b6f-9aa7-949d9e6fc414"], ["status", "PENDING"], ["created_at", "2018-10-18 02:49:11.450566"], ["updated_at", "2018-10-18 02:49:11.450566"]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc] Executing command Releases::StatusCommand: {:release_uid=>"8196d881-3539-4341-9cda-b219c4d44de9", :cluster_uid=>"538ca124-71ed-4379-be3c-2f59d1b113e0", :status=>"PENDING", :error=>nil}
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:49:11 -0700
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "67108bd7-b7ad-4b6e-a16a-c6d29325e259"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 8196d881-3539-4341-9cda-b219c4d44de9\nstatus: PENDING\n"], ["created_at", "2018-10-18 02:49:11.453410"], ["updated_at", "2018-10-18 02:49:11.453410"]]
  Parameters: {"id"=>"test"}
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "8196d881-3539-4341-9cda-b219c4d44de9"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.3ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
Completed 200 OK in 24ms (Views: 0.4ms | ActiveRecord: 1.7ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 19:49:11 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "44679220-dc7a-441a-814b-d8ca853bc598"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: b367b98f-0e3e-4c26-8101-f4c9043700c6\n"], ["created_at", "2018-10-18 02:49:11.483123"], ["updated_at", "2018-10-18 02:49:11.483123"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "b367b98f-0e3e-4c26-8101-f4c9043700c6"], ["name", "test"], ["created_at", "2018-10-18 02:49:11.485419"], ["updated_at", "2018-10-18 02:49:11.485419"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"b367b98f-0e3e-4c26-8101-f4c9043700c6"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6fec7584-bf8e-4c03-ae71-a88a7166cc8d"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 461c03b5-bdba-42fe-aa89-a73e16fd69e2\napp_uid: b367b98f-0e3e-4c26-8101-f4c9043700c6\n"], ["created_at", "2018-10-18 02:49:11.487391"], ["updated_at", "2018-10-18 02:49:11.487391"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b367b98f-0e3e-4c26-8101-f4c9043700c6"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "461c03b5-bdba-42fe-aa89-a73e16fd69e2"], ["name", "review"], ["created_at", "2018-10-18 02:49:11.490024"], ["updated_at", "2018-10-18 02:49:11.490024"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "461c03b5-bdba-42fe-aa89-a73e16fd69e2"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"461c03b5-bdba-42fe-aa89-a73e16fd69e2", "app_uid"=>"b367b98f-0e3e-4c26-8101-f4c9043700c6"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5166cacd-ce40-4951-8bcc-f4fdf36d1d39"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 600ef2b2-fd9b-4779-a5e0-d04dc53d4e6c\nstage_uid: 461c03b5-bdba-42fe-aa89-a73e16fd69e2\napp_uid: b367b98f-0e3e-4c26-8101-f4c9043700c6\n"], ["created_at", "2018-10-18 02:49:11.493026"], ["updated_at", "2018-10-18 02:49:11.493026"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b367b98f-0e3e-4c26-8101-f4c9043700c6"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "461c03b5-bdba-42fe-aa89-a73e16fd69e2"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "600ef2b2-fd9b-4779-a5e0-d04dc53d4e6c"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 02:49:11.496489"], ["updated_at", "2018-10-18 02:49:11.496489"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"b367b98f-0e3e-4c26-8101-f4c9043700c6"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "69bff774-6f88-4b26-a596-a8f0968f2298"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 9f832d57-31e5-48bb-9110-1c3b54b403d7\napp_uid: b367b98f-0e3e-4c26-8101-f4c9043700c6\n"], ["created_at", "2018-10-18 02:49:11.499691"], ["updated_at", "2018-10-18 02:49:11.499691"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b367b98f-0e3e-4c26-8101-f4c9043700c6"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9f832d57-31e5-48bb-9110-1c3b54b403d7"], ["name", "staging"], ["created_at", "2018-10-18 02:49:11.502257"], ["updated_at", "2018-10-18 02:49:11.502257"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9f832d57-31e5-48bb-9110-1c3b54b403d7"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"9f832d57-31e5-48bb-9110-1c3b54b403d7", "app_uid"=>"b367b98f-0e3e-4c26-8101-f4c9043700c6"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "df170310-24ce-4d48-b2cc-1b139373d3ea"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 05f0e850-b7fa-46e7-8aab-11d65e608aac\nstage_uid: 9f832d57-31e5-48bb-9110-1c3b54b403d7\napp_uid: b367b98f-0e3e-4c26-8101-f4c9043700c6\n"], ["created_at", "2018-10-18 02:49:11.505019"], ["updated_at", "2018-10-18 02:49:11.505019"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b367b98f-0e3e-4c26-8101-f4c9043700c6"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9f832d57-31e5-48bb-9110-1c3b54b403d7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "05f0e850-b7fa-46e7-8aab-11d65e608aac"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 02:49:11.508148"], ["updated_at", "2018-10-18 02:49:11.508148"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 30ms (ActiveRecord: 3.4ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:49:11 -0700
Processing by AppsController#show as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 0.8ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 19:49:11 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"id"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"b367b98f-0e3e-4c26-8101-f4c9043700c6"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b86fc699-1c1f-444d-aee5-38ab9ae95c5c"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: b367b98f-0e3e-4c26-8101-f4c9043700c6\n"], ["created_at", "2018-10-18 02:49:11.522748"], ["updated_at", "2018-10-18 02:49:11.522748"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b367b98f-0e3e-4c26-8101-f4c9043700c6"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (ActiveRecord: 0.4ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a68a5a73-6378-4e2e-829d-204cab4bc908"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: eb05eb25-a135-4ffd-a54f-ef1ba6d199d3\n"], ["created_at", "2018-10-18 02:49:11.527267"], ["updated_at", "2018-10-18 02:49:11.527267"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "eb05eb25-a135-4ffd-a54f-ef1ba6d199d3"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 02:49:11.530070"], ["updated_at", "2018-10-18 02:49:11.530070"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: a27609af-b27c-4839-bdd5-8510624794f2) to Async(default) with arguments: "a68a5a73-6378-4e2e-829d-204cab4bc908"
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2] Performing ReleaseJob (Job ID: a27609af-b27c-4839-bdd5-8510624794f2) from Async(default) with arguments: "a68a5a73-6378-4e2e-829d-204cab4bc908"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[36mEvent Load (0.5ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "a68a5a73-6378-4e2e-829d-204cab4bc908"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2] Executing command Releases::StatusCommand: {:release_uid=>"eb05eb25-a135-4ffd-a54f-ef1ba6d199d3", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "03d815df-fb2b-40ea-bfaf-489bec8b20e3"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: eb05eb25-a135-4ffd-a54f-ef1ba6d199d3\nstatus: PENDING\n"], ["created_at", "2018-10-18 02:49:11.536035"], ["updated_at", "2018-10-18 02:49:11.536035"]]
------------------------------------------
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.6ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[36mRelease Load (0.3ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "eb05eb25-a135-4ffd-a54f-ef1ba6d199d3"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2] Executing command Releases::StatusCommand: {:release_uid=>"eb05eb25-a135-4ffd-a54f-ef1ba6d199d3", :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Release>}
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "37adc62c-cf9d-4130-bfbd-0aff2dcb9ddb"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 73f2d9df-4646-4633-a5a1-fd708f0ca38d\n"], ["created_at", "2018-10-18 02:49:11.540889"], ["updated_at", "2018-10-18 02:49:11.540889"]]
  [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "73f2d9df-4646-4633-a5a1-fd708f0ca38d"], ["status", "PENDING"], ["created_at", "2018-10-18 02:49:11.545369"], ["updated_at", "2018-10-18 02:49:11.545369"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[35mSQL (2.8ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4dd63dfb-3be9-4297-9800-11dd9334f30e"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: eb05eb25-a135-4ffd-a54f-ef1ba6d199d3\nstatus: ERRORED\n"], ["created_at", "2018-10-18 02:49:11.542918"], ["updated_at", "2018-10-18 02:49:11.542918"]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2]   [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "eb05eb25-a135-4ffd-a54f-ef1ba6d199d3"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a27609af-b27c-4839-bdd5-8510624794f2] Error performing ReleaseJob (Job ID: a27609af-b27c-4839-bdd5-8510624794f2) from Async(default) in 16.36ms: ActiveRecord::RecordNotFound (Couldn't find Release):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/core.rb:228:in `find_by!'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/dynamic_matchers.rb:66:in `find_by_uid!'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/release.rb:22:in `block in <class:Release>'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:14:in `block (2 levels) in play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `each'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `block in play'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:233:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/transactions.rb:210:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:10:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a192151f-42ac-4bda-96e7-c2d5fb4397dd"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: c7bf03ba-577f-4df3-9493-f5ae4a5886af\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 02:49:11.552281"], ["updated_at", "2018-10-18 02:49:11.552281"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "c7bf03ba-577f-4df3-9493-f5ae4a5886af"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 02:49:11.556767"], ["updated_at", "2018-10-18 02:49:11.556767"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [7f27527b-4852-4400-94b3-205d40e961cc] Performed ReleaseJob (Job ID: 7f27527b-4852-4400-94b3-205d40e961cc) from Async(default) in 142.32ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 03:22:50.563590', '2018-10-18 03:22:50.563590')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 03:22:50.566114', '2018-10-18 03:22:50.566114')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 03:22:50.567622', '2018-10-18 03:22:50.567622', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 03:22:50.568983', '2018-10-18 03:22:50.568983')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 03:22:50.570525', '2018-10-18 03:22:50.570525', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d2741643-3c75-469d-a87a-a53de5310517"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: c4762319-36e1-4a07-8acb-af49599615e6\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 03:22:50.595088"], ["updated_at", "2018-10-18 03:22:50.595088"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "c4762319-36e1-4a07-8acb-af49599615e6"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 03:22:50.601498"], ["updated_at", "2018-10-18 03:22:50.601498"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "364218c2-5705-44eb-a5ed-97a5da12eec5"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: bc651011-4368-4726-8898-b056df3ceaad\n"], ["created_at", "2018-10-18 03:22:50.613547"], ["updated_at", "2018-10-18 03:22:50.613547"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "bc651011-4368-4726-8898-b056df3ceaad"], ["status", "PENDING"], ["created_at", "2018-10-18 03:22:50.621359"], ["updated_at", "2018-10-18 03:22:50.621359"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "039164e5-008a-4c39-beef-1aa1e59d2f3c"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 64f5ceaf-8550-4215-9aff-0aeb9a28be22\n"], ["created_at", "2018-10-18 03:22:50.624166"], ["updated_at", "2018-10-18 03:22:50.624166"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "64f5ceaf-8550-4215-9aff-0aeb9a28be22"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 03:22:50.627964"], ["updated_at", "2018-10-18 03:22:50.627964"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: a044da0f-1c2f-4c3b-b4f4-ecacaa50f992) to Async(default) with arguments: "039164e5-008a-4c39-beef-1aa1e59d2f3c"
[ActiveJob] [ReleaseJob] [a044da0f-1c2f-4c3b-b4f4-ecacaa50f992] Performing ReleaseJob (Job ID: a044da0f-1c2f-4c3b-b4f4-ecacaa50f992) from Async(default) with arguments: "039164e5-008a-4c39-beef-1aa1e59d2f3c"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
[ActiveJob] [ReleaseJob] [a044da0f-1c2f-4c3b-b4f4-ecacaa50f992]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "039164e5-008a-4c39-beef-1aa1e59d2f3c"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [a044da0f-1c2f-4c3b-b4f4-ecacaa50f992] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
[ActiveJob] [ReleaseJob] [a044da0f-1c2f-4c3b-b4f4-ecacaa50f992] Error performing ReleaseJob (Job ID: a044da0f-1c2f-4c3b-b4f4-ecacaa50f992) from Async(default) in 8.86ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 20:22:50 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f73cdf9d-4d8a-454d-9f21-25fc7c19dffb"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 8beac9cf-320a-4e4e-9bc2-6a622a61e79e\n"], ["created_at", "2018-10-18 03:22:50.649730"], ["updated_at", "2018-10-18 03:22:50.649730"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "8beac9cf-320a-4e4e-9bc2-6a622a61e79e"], ["name", "test"], ["created_at", "2018-10-18 03:22:50.651955"], ["updated_at", "2018-10-18 03:22:50.651955"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"8beac9cf-320a-4e4e-9bc2-6a622a61e79e"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "97786c22-e0aa-4430-8e13-6c5150cdb849"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 18d5dcbc-6f7a-4ce3-bd9b-e83ed7f3a303\napp_uid: 8beac9cf-320a-4e4e-9bc2-6a622a61e79e\n"], ["created_at", "2018-10-18 03:22:50.654171"], ["updated_at", "2018-10-18 03:22:50.654171"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "8beac9cf-320a-4e4e-9bc2-6a622a61e79e"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "18d5dcbc-6f7a-4ce3-bd9b-e83ed7f3a303"], ["name", "review"], ["created_at", "2018-10-18 03:22:50.656883"], ["updated_at", "2018-10-18 03:22:50.656883"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "18d5dcbc-6f7a-4ce3-bd9b-e83ed7f3a303"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"18d5dcbc-6f7a-4ce3-bd9b-e83ed7f3a303", "app_uid"=>"8beac9cf-320a-4e4e-9bc2-6a622a61e79e"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7004e7ce-810f-4642-be7d-3a317c9467ca"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 19729f58-d523-4d90-a62b-2c1790c4e85d\nstage_uid: 18d5dcbc-6f7a-4ce3-bd9b-e83ed7f3a303\napp_uid: 8beac9cf-320a-4e4e-9bc2-6a622a61e79e\n"], ["created_at", "2018-10-18 03:22:50.659727"], ["updated_at", "2018-10-18 03:22:50.659727"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "8beac9cf-320a-4e4e-9bc2-6a622a61e79e"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "18d5dcbc-6f7a-4ce3-bd9b-e83ed7f3a303"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "19729f58-d523-4d90-a62b-2c1790c4e85d"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 03:22:50.663287"], ["updated_at", "2018-10-18 03:22:50.663287"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"8beac9cf-320a-4e4e-9bc2-6a622a61e79e"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4824dec8-a0a9-4e96-8db2-9c43060f5d74"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 85c66759-d1ee-472b-9af6-d29d75059c18\napp_uid: 8beac9cf-320a-4e4e-9bc2-6a622a61e79e\n"], ["created_at", "2018-10-18 03:22:50.667480"], ["updated_at", "2018-10-18 03:22:50.667480"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "8beac9cf-320a-4e4e-9bc2-6a622a61e79e"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "85c66759-d1ee-472b-9af6-d29d75059c18"], ["name", "staging"], ["created_at", "2018-10-18 03:22:50.674629"], ["updated_at", "2018-10-18 03:22:50.674629"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "85c66759-d1ee-472b-9af6-d29d75059c18"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"85c66759-d1ee-472b-9af6-d29d75059c18", "app_uid"=>"8beac9cf-320a-4e4e-9bc2-6a622a61e79e"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2e8a8554-481f-48d7-815b-d09dc1d094e1"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 9803823d-83e4-4fd0-b6e6-420efa06a1fa\nstage_uid: 85c66759-d1ee-472b-9af6-d29d75059c18\napp_uid: 8beac9cf-320a-4e4e-9bc2-6a622a61e79e\n"], ["created_at", "2018-10-18 03:22:50.678110"], ["updated_at", "2018-10-18 03:22:50.678110"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "8beac9cf-320a-4e4e-9bc2-6a622a61e79e"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "85c66759-d1ee-472b-9af6-d29d75059c18"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "9803823d-83e4-4fd0-b6e6-420efa06a1fa"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 03:22:50.681236"], ["updated_at", "2018-10-18 03:22:50.681236"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 42ms (ActiveRecord: 3.3ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 20:22:50 -0700
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 20:22:50 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "131e44c4-1ba8-44e3-80b7-d7b8b326a337"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: e622637a-e067-4cf4-8ff6-f869622bca37\n"], ["created_at", "2018-10-18 03:22:50.690387"], ["updated_at", "2018-10-18 03:22:50.690387"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "e622637a-e067-4cf4-8ff6-f869622bca37"], ["name", "test"], ["created_at", "2018-10-18 03:22:50.692407"], ["updated_at", "2018-10-18 03:22:50.692407"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"e622637a-e067-4cf4-8ff6-f869622bca37"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f562e8bd-8d9e-4124-a89a-f8139a9b34d6"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 962ee767-798b-4efd-ac74-bd5da787c90c\napp_uid: e622637a-e067-4cf4-8ff6-f869622bca37\n"], ["created_at", "2018-10-18 03:22:50.695015"], ["updated_at", "2018-10-18 03:22:50.695015"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e622637a-e067-4cf4-8ff6-f869622bca37"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "962ee767-798b-4efd-ac74-bd5da787c90c"], ["name", "review"], ["created_at", "2018-10-18 03:22:50.697622"], ["updated_at", "2018-10-18 03:22:50.697622"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "962ee767-798b-4efd-ac74-bd5da787c90c"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"962ee767-798b-4efd-ac74-bd5da787c90c", "app_uid"=>"e622637a-e067-4cf4-8ff6-f869622bca37"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a74a10fc-c34e-44be-8aa7-05d64c4b305f"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 705f1c26-308e-4ac0-9460-83cf36a209f5\nstage_uid: 962ee767-798b-4efd-ac74-bd5da787c90c\napp_uid: e622637a-e067-4cf4-8ff6-f869622bca37\n"], ["created_at", "2018-10-18 03:22:50.700213"], ["updated_at", "2018-10-18 03:22:50.700213"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e622637a-e067-4cf4-8ff6-f869622bca37"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "962ee767-798b-4efd-ac74-bd5da787c90c"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "705f1c26-308e-4ac0-9460-83cf36a209f5"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 03:22:50.703140"], ["updated_at", "2018-10-18 03:22:50.703140"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"e622637a-e067-4cf4-8ff6-f869622bca37"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6110a2b5-90bb-4c2b-9330-980145ba0579"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 39b27054-9523-4fb5-8827-04ecb198fb12\napp_uid: e622637a-e067-4cf4-8ff6-f869622bca37\n"], ["created_at", "2018-10-18 03:22:50.706218"], ["updated_at", "2018-10-18 03:22:50.706218"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e622637a-e067-4cf4-8ff6-f869622bca37"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "39b27054-9523-4fb5-8827-04ecb198fb12"], ["name", "staging"], ["created_at", "2018-10-18 03:22:50.708819"], ["updated_at", "2018-10-18 03:22:50.708819"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "39b27054-9523-4fb5-8827-04ecb198fb12"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"39b27054-9523-4fb5-8827-04ecb198fb12", "app_uid"=>"e622637a-e067-4cf4-8ff6-f869622bca37"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af3b6ce4-2d04-4a09-8faf-d6b0511ff5b7"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 45d8725a-0d17-43cd-a2ea-c95a71db1683\nstage_uid: 39b27054-9523-4fb5-8827-04ecb198fb12\napp_uid: e622637a-e067-4cf4-8ff6-f869622bca37\n"], ["created_at", "2018-10-18 03:22:50.711722"], ["updated_at", "2018-10-18 03:22:50.711722"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e622637a-e067-4cf4-8ff6-f869622bca37"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "39b27054-9523-4fb5-8827-04ecb198fb12"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "45d8725a-0d17-43cd-a2ea-c95a71db1683"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 03:22:50.714708"], ["updated_at", "2018-10-18 03:22:50.714708"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 29ms (ActiveRecord: 3.2ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 20:22:50 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
Completed 400 Bad Request in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e2aa6973-14b6-4618-b592-30f168b9a226"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 47f95712-bc47-4ade-b259-bd892e159a90\n"], ["created_at", "2018-10-18 03:22:50.721784"], ["updated_at", "2018-10-18 03:22:50.721784"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "47f95712-bc47-4ade-b259-bd892e159a90"], ["name", "test"], ["created_at", "2018-10-18 03:22:50.724448"], ["updated_at", "2018-10-18 03:22:50.724448"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e097031c-5c6d-4b17-ac66-52f40477ee70"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 03:22:50.726819"], ["updated_at", "2018-10-18 03:22:50.726819"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 03:22:50.729093"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a57589e9-8755-4a25-b8d1-0ed6e2aa1973"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 9696e381-a6e7-40b2-a4c8-f7fc32331ecb\n"], ["created_at", "2018-10-18 03:22:50.733968"], ["updated_at", "2018-10-18 03:22:50.733968"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "9696e381-a6e7-40b2-a4c8-f7fc32331ecb"], ["name", "test2"], ["created_at", "2018-10-18 03:22:50.737667"], ["updated_at", "2018-10-18 03:22:50.737667"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1fbe8d96-7ffe-4cd0-b2f0-6d227de7e107"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 54749d9e-691b-4106-bd4c-9a91c35ee46e\n"], ["created_at", "2018-10-18 03:22:50.739600"], ["updated_at", "2018-10-18 03:22:50.739600"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "54749d9e-691b-4106-bd4c-9a91c35ee46e"], ["name", "test"], ["created_at", "2018-10-18 03:22:50.741775"], ["updated_at", "2018-10-18 03:22:50.741775"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af7daba5-678b-468a-9d90-92e99ec7fbb0"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 03:22:50.744444"], ["updated_at", "2018-10-18 03:22:50.744444"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 03:22:50.748602"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "36f0feac-9ad5-4b44-8b53-fe6632b2d8e9"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 03:22:50.751572"], ["updated_at", "2018-10-18 03:22:50.751572"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9069ca4f-00bc-459e-a29d-37369a486b6b"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 5b9f8dd2-f680-4db3-9563-d80e44d3ac66\n"], ["created_at", "2018-10-18 03:22:50.756338"], ["updated_at", "2018-10-18 03:22:50.756338"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "5b9f8dd2-f680-4db3-9563-d80e44d3ac66"], ["name", "test2"], ["created_at", "2018-10-18 03:22:50.760337"], ["updated_at", "2018-10-18 03:22:50.760337"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "837ef151-e18b-490c-8586-7e6092630c4f"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 03:22:50.763578"], ["updated_at", "2018-10-18 03:22:50.763578"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:06:57.810004', '2018-10-18 04:06:57.810004')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:06:57.812358', '2018-10-18 04:06:57.812358')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:06:57.813912', '2018-10-18 04:06:57.813912', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:06:57.815295', '2018-10-18 04:06:57.815295')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:06:57.816930', '2018-10-18 04:06:57.816930', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "efcdfe2a-6e62-4857-a294-3a6e27826dbe"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: fc29b0d7-dcda-4bd5-ace3-acb3439d3b67\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:06:57.843537"], ["updated_at", "2018-10-18 04:06:57.843537"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "fc29b0d7-dcda-4bd5-ace3-acb3439d3b67"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:06:57.851438"], ["updated_at", "2018-10-18 04:06:57.851438"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b9b9980d-423b-4b3a-9c0d-613005e2f2a7"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:06:57.855541"], ["updated_at", "2018-10-18 04:06:57.855541"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:06:57.858297"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "18e43e60-6f5d-4088-8ae3-2dfe254571c4"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: f0e401aa-5242-451a-9594-0cbad8dca906\n"], ["created_at", "2018-10-18 04:06:57.861011"], ["updated_at", "2018-10-18 04:06:57.861011"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "f0e401aa-5242-451a-9594-0cbad8dca906"], ["name", "test"], ["created_at", "2018-10-18 04:06:57.863112"], ["updated_at", "2018-10-18 04:06:57.863112"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ce042e4d-8c42-422c-a929-2fc0fb7bb3c0"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:06:57.865446"], ["updated_at", "2018-10-18 04:06:57.865446"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "92029778-ae91-4823-9819-e944dec1d2a4"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 652b8d7b-d071-4ecb-8465-5398ff5a91e8\n"], ["created_at", "2018-10-18 04:06:57.869608"], ["updated_at", "2018-10-18 04:06:57.869608"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "652b8d7b-d071-4ecb-8465-5398ff5a91e8"], ["name", "test2"], ["created_at", "2018-10-18 04:06:57.877677"], ["updated_at", "2018-10-18 04:06:57.877677"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2a2c31ab-8a54-4df8-8566-9151258bbd75"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:06:57.880873"], ["updated_at", "2018-10-18 04:06:57.880873"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "64759eda-224d-418a-b474-91483eb610ae"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:06:57.885397"], ["updated_at", "2018-10-18 04:06:57.885397"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:06:57.888678"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5d8f6fb0-4f7c-4646-8168-dcd7d0d61c53"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 7d7d9415-84ff-4bfd-ac10-9fe5e9adb55c\n"], ["created_at", "2018-10-18 04:06:57.891506"], ["updated_at", "2018-10-18 04:06:57.891506"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "7d7d9415-84ff-4bfd-ac10-9fe5e9adb55c"], ["name", "test2"], ["created_at", "2018-10-18 04:06:57.894445"], ["updated_at", "2018-10-18 04:06:57.894445"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "db04866c-6fb0-4ea9-bbeb-0f29b26a116c"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 3e2ef9bc-9f99-4d2a-a023-51dd0d477c38\n"], ["created_at", "2018-10-18 04:06:57.896962"], ["updated_at", "2018-10-18 04:06:57.896962"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "3e2ef9bc-9f99-4d2a-a023-51dd0d477c38"], ["name", "test"], ["created_at", "2018-10-18 04:06:57.900350"], ["updated_at", "2018-10-18 04:06:57.900350"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:06:57 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e4904d11-5cf0-4ac7-8541-4739d5d6a952"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 20a3a598-0030-4604-9eac-9f7b232a1f93\n"], ["created_at", "2018-10-18 04:06:57.915035"], ["updated_at", "2018-10-18 04:06:57.915035"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "20a3a598-0030-4604-9eac-9f7b232a1f93"], ["name", "test"], ["created_at", "2018-10-18 04:06:57.917726"], ["updated_at", "2018-10-18 04:06:57.917726"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"20a3a598-0030-4604-9eac-9f7b232a1f93"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e5fcb618-597b-4595-b031-88d310933498"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: aa89472b-b902-4bfc-bc83-9d2fa845d91f\napp_uid: 20a3a598-0030-4604-9eac-9f7b232a1f93\n"], ["created_at", "2018-10-18 04:06:57.920023"], ["updated_at", "2018-10-18 04:06:57.920023"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "20a3a598-0030-4604-9eac-9f7b232a1f93"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "aa89472b-b902-4bfc-bc83-9d2fa845d91f"], ["name", "review"], ["created_at", "2018-10-18 04:06:57.922333"], ["updated_at", "2018-10-18 04:06:57.922333"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "aa89472b-b902-4bfc-bc83-9d2fa845d91f"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"aa89472b-b902-4bfc-bc83-9d2fa845d91f", "app_uid"=>"20a3a598-0030-4604-9eac-9f7b232a1f93"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2b101941-3943-40ce-88f3-519104a87296"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: e577c131-94db-42aa-832d-10b31b35c66d\nstage_uid: aa89472b-b902-4bfc-bc83-9d2fa845d91f\napp_uid: 20a3a598-0030-4604-9eac-9f7b232a1f93\n"], ["created_at", "2018-10-18 04:06:57.925598"], ["updated_at", "2018-10-18 04:06:57.925598"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "20a3a598-0030-4604-9eac-9f7b232a1f93"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "aa89472b-b902-4bfc-bc83-9d2fa845d91f"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "e577c131-94db-42aa-832d-10b31b35c66d"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:06:57.928291"], ["updated_at", "2018-10-18 04:06:57.928291"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"20a3a598-0030-4604-9eac-9f7b232a1f93"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b6651943-4784-4ed0-bd77-0bb6b994cf8b"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: a7ac0c72-4fac-45ee-b6ce-9f1974684bf0\napp_uid: 20a3a598-0030-4604-9eac-9f7b232a1f93\n"], ["created_at", "2018-10-18 04:06:57.931899"], ["updated_at", "2018-10-18 04:06:57.931899"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "20a3a598-0030-4604-9eac-9f7b232a1f93"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "a7ac0c72-4fac-45ee-b6ce-9f1974684bf0"], ["name", "staging"], ["created_at", "2018-10-18 04:06:57.934290"], ["updated_at", "2018-10-18 04:06:57.934290"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "a7ac0c72-4fac-45ee-b6ce-9f1974684bf0"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"a7ac0c72-4fac-45ee-b6ce-9f1974684bf0", "app_uid"=>"20a3a598-0030-4604-9eac-9f7b232a1f93"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2caf674d-679f-49a2-a7ce-0abf58d42452"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: f836f5eb-86ef-4096-bc52-0aef58e59cb6\nstage_uid: a7ac0c72-4fac-45ee-b6ce-9f1974684bf0\napp_uid: 20a3a598-0030-4604-9eac-9f7b232a1f93\n"], ["created_at", "2018-10-18 04:06:57.936893"], ["updated_at", "2018-10-18 04:06:57.936893"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "20a3a598-0030-4604-9eac-9f7b232a1f93"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "a7ac0c72-4fac-45ee-b6ce-9f1974684bf0"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "f836f5eb-86ef-4096-bc52-0aef58e59cb6"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:06:57.944158"], ["updated_at", "2018-10-18 04:06:57.944158"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 40ms (ActiveRecord: 3.4ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:06:57 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
Completed 400 Bad Request in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:06:57 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "efa4cc27-cb25-4a7c-bc70-3200234ee7f4"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 89bd0c90-0e7e-4bf7-94ed-386d31eff172\n"], ["created_at", "2018-10-18 04:06:57.956289"], ["updated_at", "2018-10-18 04:06:57.956289"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "89bd0c90-0e7e-4bf7-94ed-386d31eff172"], ["name", "test"], ["created_at", "2018-10-18 04:06:57.959578"], ["updated_at", "2018-10-18 04:06:57.959578"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"89bd0c90-0e7e-4bf7-94ed-386d31eff172"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "72cb4991-f840-4af1-9a56-96a10f060017"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 38377f34-8f7a-4279-a2b1-7302eb03610f\napp_uid: 89bd0c90-0e7e-4bf7-94ed-386d31eff172\n"], ["created_at", "2018-10-18 04:06:57.962271"], ["updated_at", "2018-10-18 04:06:57.962271"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "89bd0c90-0e7e-4bf7-94ed-386d31eff172"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "38377f34-8f7a-4279-a2b1-7302eb03610f"], ["name", "review"], ["created_at", "2018-10-18 04:06:57.965441"], ["updated_at", "2018-10-18 04:06:57.965441"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "38377f34-8f7a-4279-a2b1-7302eb03610f"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"38377f34-8f7a-4279-a2b1-7302eb03610f", "app_uid"=>"89bd0c90-0e7e-4bf7-94ed-386d31eff172"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2c9a66f9-53e4-4c4e-9673-4b671be036b5"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: e4a892f3-fcbb-46a1-b18b-df9fe8cbc700\nstage_uid: 38377f34-8f7a-4279-a2b1-7302eb03610f\napp_uid: 89bd0c90-0e7e-4bf7-94ed-386d31eff172\n"], ["created_at", "2018-10-18 04:06:57.969398"], ["updated_at", "2018-10-18 04:06:57.969398"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "89bd0c90-0e7e-4bf7-94ed-386d31eff172"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "38377f34-8f7a-4279-a2b1-7302eb03610f"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "e4a892f3-fcbb-46a1-b18b-df9fe8cbc700"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:06:57.972683"], ["updated_at", "2018-10-18 04:06:57.972683"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"89bd0c90-0e7e-4bf7-94ed-386d31eff172"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bbe78699-6038-44f3-8dbd-bde0eefe468b"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: e8bd6ab2-c550-491e-9590-efecfff78cba\napp_uid: 89bd0c90-0e7e-4bf7-94ed-386d31eff172\n"], ["created_at", "2018-10-18 04:06:57.976952"], ["updated_at", "2018-10-18 04:06:57.976952"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "89bd0c90-0e7e-4bf7-94ed-386d31eff172"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "e8bd6ab2-c550-491e-9590-efecfff78cba"], ["name", "staging"], ["created_at", "2018-10-18 04:06:57.979872"], ["updated_at", "2018-10-18 04:06:57.979872"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e8bd6ab2-c550-491e-9590-efecfff78cba"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"e8bd6ab2-c550-491e-9590-efecfff78cba", "app_uid"=>"89bd0c90-0e7e-4bf7-94ed-386d31eff172"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "391777fe-cc0b-4df3-9f5e-4622672d9cf7"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 615a1089-cf00-41bb-87d3-457997b4a7ce\nstage_uid: e8bd6ab2-c550-491e-9590-efecfff78cba\napp_uid: 89bd0c90-0e7e-4bf7-94ed-386d31eff172\n"], ["created_at", "2018-10-18 04:06:57.983724"], ["updated_at", "2018-10-18 04:06:57.983724"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "89bd0c90-0e7e-4bf7-94ed-386d31eff172"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e8bd6ab2-c550-491e-9590-efecfff78cba"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "615a1089-cf00-41bb-87d3-457997b4a7ce"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:06:57.987000"], ["updated_at", "2018-10-18 04:06:57.987000"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 36ms (ActiveRecord: 3.8ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 21:06:57 -0700
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7187f637-d390-4069-ad3b-9e42b0734dd9"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 6dc394d6-73f5-4dcf-8ac1-9fb38fc0afdd\n"], ["created_at", "2018-10-18 04:06:57.994613"], ["updated_at", "2018-10-18 04:06:57.994613"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6dc394d6-73f5-4dcf-8ac1-9fb38fc0afdd"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:06:58.001935"], ["updated_at", "2018-10-18 04:06:58.001935"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: e123045b-20b5-4e09-861c-50aa91d60d7a) to Async(default) with arguments: "7187f637-d390-4069-ad3b-9e42b0734dd9"
[ActiveJob] [ReleaseJob] [e123045b-20b5-4e09-861c-50aa91d60d7a] Performing ReleaseJob (Job ID: e123045b-20b5-4e09-861c-50aa91d60d7a) from Async(default) with arguments: "7187f637-d390-4069-ad3b-9e42b0734dd9"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
[ActiveJob] [ReleaseJob] [e123045b-20b5-4e09-861c-50aa91d60d7a]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "7187f637-d390-4069-ad3b-9e42b0734dd9"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e123045b-20b5-4e09-861c-50aa91d60d7a] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e123045b-20b5-4e09-861c-50aa91d60d7a] Error performing ReleaseJob (Job ID: e123045b-20b5-4e09-861c-50aa91d60d7a) from Async(default) in 8.26ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "23e24d06-ce70-4ea0-bf30-b29eeb7a0b08"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: d5953277-9f5e-4157-81fb-204e0be78a23\n"], ["created_at", "2018-10-18 04:06:58.014490"], ["updated_at", "2018-10-18 04:06:58.014490"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "d5953277-9f5e-4157-81fb-204e0be78a23"], ["status", "PENDING"], ["created_at", "2018-10-18 04:06:58.022979"], ["updated_at", "2018-10-18 04:06:58.022979"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:07:41.471727', '2018-10-18 04:07:41.471727')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:07:41.473717', '2018-10-18 04:07:41.473717')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:07:41.475167', '2018-10-18 04:07:41.475167', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:07:41.476467', '2018-10-18 04:07:41.476467')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:07:41.477959', '2018-10-18 04:07:41.477959', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d5e36e99-8a81-4bc6-9e2c-f6ff4530bfc6"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 627442d3-560c-4010-8ea4-e27f739fb16b\n"], ["created_at", "2018-10-18 04:07:41.494907"], ["updated_at", "2018-10-18 04:07:41.494907"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "627442d3-560c-4010-8ea4-e27f739fb16b"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:07:41.502253"], ["updated_at", "2018-10-18 04:07:41.502253"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 0a680483-f074-461a-9bdc-2b3f7d845de8) to Async(default) with arguments: "d5e36e99-8a81-4bc6-9e2c-f6ff4530bfc6"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [0a680483-f074-461a-9bdc-2b3f7d845de8] Performing ReleaseJob (Job ID: 0a680483-f074-461a-9bdc-2b3f7d845de8) from Async(default) with arguments: "d5e36e99-8a81-4bc6-9e2c-f6ff4530bfc6"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e8b12a6a-2a18-4aa4-be86-254a9ba9c512"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 1392e54f-9987-442c-9474-69f975d6a819\n"], ["created_at", "2018-10-18 04:07:41.515064"], ["updated_at", "2018-10-18 04:07:41.515064"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "1392e54f-9987-442c-9474-69f975d6a819"], ["status", "PENDING"], ["created_at", "2018-10-18 04:07:41.524644"], ["updated_at", "2018-10-18 04:07:41.524644"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [0a680483-f074-461a-9bdc-2b3f7d845de8]   [1m[36mEvent Load (0.8ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "d5e36e99-8a81-4bc6-9e2c-f6ff4530bfc6"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [0a680483-f074-461a-9bdc-2b3f7d845de8] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
-----------------------------------
[ActiveJob] [ReleaseJob] [0a680483-f074-461a-9bdc-2b3f7d845de8] Error performing ReleaseJob (Job ID: 0a680483-f074-461a-9bdc-2b3f7d845de8) from Async(default) in 23.98ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6a80cbc7-befc-4f2a-bb7d-bbe0374fa983"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 0b9ae992-f157-4520-8518-4842d0f9ba99\n"], ["created_at", "2018-10-18 04:07:41.530122"], ["updated_at", "2018-10-18 04:07:41.530122"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "0b9ae992-f157-4520-8518-4842d0f9ba99"], ["name", "test"], ["created_at", "2018-10-18 04:07:41.535362"], ["updated_at", "2018-10-18 04:07:41.535362"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bb854f92-3cbd-4f6a-8ae2-63101ba7f5b9"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:07:41.537948"], ["updated_at", "2018-10-18 04:07:41.537948"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:07:41.540389"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "36959191-203a-4101-85f3-f22b011c7168"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:07:41.543176"], ["updated_at", "2018-10-18 04:07:41.543176"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e3006f26-3ae2-43e3-9d84-3e76c68180c9"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:07:41.546782"], ["updated_at", "2018-10-18 04:07:41.546782"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e8579bb2-cc03-49b3-b163-0cce912cf3f6"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: b54e501b-0d03-4a4e-9185-4e68cdbe7c70\n"], ["created_at", "2018-10-18 04:07:41.551548"], ["updated_at", "2018-10-18 04:07:41.551548"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "b54e501b-0d03-4a4e-9185-4e68cdbe7c70"], ["name", "test"], ["created_at", "2018-10-18 04:07:41.559150"], ["updated_at", "2018-10-18 04:07:41.559150"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2c22df36-5d8e-4045-9d23-bb5b08e3890f"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:07:41.563498"], ["updated_at", "2018-10-18 04:07:41.563498"]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:07:41.568770"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0838c32b-a0da-4511-b18a-ad4d4167e507"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 5ae2deb1-89a3-40b8-a6fa-33d631efe607\n"], ["created_at", "2018-10-18 04:07:41.572990"], ["updated_at", "2018-10-18 04:07:41.572990"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "5ae2deb1-89a3-40b8-a6fa-33d631efe607"], ["name", "test2"], ["created_at", "2018-10-18 04:07:41.577104"], ["updated_at", "2018-10-18 04:07:41.577104"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1fa9ef0b-5aaa-4f4c-853e-f0813f9e98be"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 51394fbe-fb58-40a6-a9e5-3c25823e2d6c\n"], ["created_at", "2018-10-18 04:07:41.580995"], ["updated_at", "2018-10-18 04:07:41.580995"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "51394fbe-fb58-40a6-a9e5-3c25823e2d6c"], ["name", "test2"], ["created_at", "2018-10-18 04:07:41.585202"], ["updated_at", "2018-10-18 04:07:41.585202"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:07:41 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "70c31c03-c5bb-4b50-a23c-b9025a316421"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: b5c3c881-38d1-47fb-a5e4-e77c69e11006\n"], ["created_at", "2018-10-18 04:07:41.605775"], ["updated_at", "2018-10-18 04:07:41.605775"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "b5c3c881-38d1-47fb-a5e4-e77c69e11006"], ["name", "test"], ["created_at", "2018-10-18 04:07:41.608071"], ["updated_at", "2018-10-18 04:07:41.608071"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"b5c3c881-38d1-47fb-a5e4-e77c69e11006"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d490436c-af6d-4ef2-9724-813670cb4a91"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: dffc903f-27e1-45d9-bd5b-5cc29ae95b5d\napp_uid: b5c3c881-38d1-47fb-a5e4-e77c69e11006\n"], ["created_at", "2018-10-18 04:07:41.610517"], ["updated_at", "2018-10-18 04:07:41.610517"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b5c3c881-38d1-47fb-a5e4-e77c69e11006"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "dffc903f-27e1-45d9-bd5b-5cc29ae95b5d"], ["name", "review"], ["created_at", "2018-10-18 04:07:41.612659"], ["updated_at", "2018-10-18 04:07:41.612659"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dffc903f-27e1-45d9-bd5b-5cc29ae95b5d"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"dffc903f-27e1-45d9-bd5b-5cc29ae95b5d", "app_uid"=>"b5c3c881-38d1-47fb-a5e4-e77c69e11006"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9f7c7a77-d13c-4849-9483-30f132c5223e"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 4c1c6634-4b58-41a2-808c-7d2a40c8f9c7\nstage_uid: dffc903f-27e1-45d9-bd5b-5cc29ae95b5d\napp_uid: b5c3c881-38d1-47fb-a5e4-e77c69e11006\n"], ["created_at", "2018-10-18 04:07:41.615495"], ["updated_at", "2018-10-18 04:07:41.615495"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b5c3c881-38d1-47fb-a5e4-e77c69e11006"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dffc903f-27e1-45d9-bd5b-5cc29ae95b5d"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "4c1c6634-4b58-41a2-808c-7d2a40c8f9c7"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:07:41.618790"], ["updated_at", "2018-10-18 04:07:41.618790"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"b5c3c881-38d1-47fb-a5e4-e77c69e11006"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cd183e34-f552-4442-a359-11b23fc27594"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 85e5f9d6-8b00-43f6-8538-fa63e421c7ec\napp_uid: b5c3c881-38d1-47fb-a5e4-e77c69e11006\n"], ["created_at", "2018-10-18 04:07:41.623393"], ["updated_at", "2018-10-18 04:07:41.623393"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b5c3c881-38d1-47fb-a5e4-e77c69e11006"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "85e5f9d6-8b00-43f6-8538-fa63e421c7ec"], ["name", "staging"], ["created_at", "2018-10-18 04:07:41.625961"], ["updated_at", "2018-10-18 04:07:41.625961"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "85e5f9d6-8b00-43f6-8538-fa63e421c7ec"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"85e5f9d6-8b00-43f6-8538-fa63e421c7ec", "app_uid"=>"b5c3c881-38d1-47fb-a5e4-e77c69e11006"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "15be0749-7791-4f9b-a481-b7bccb56c449"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: ad13f98a-3261-4bfc-a900-8c06c3974370\nstage_uid: 85e5f9d6-8b00-43f6-8538-fa63e421c7ec\napp_uid: b5c3c881-38d1-47fb-a5e4-e77c69e11006\n"], ["created_at", "2018-10-18 04:07:41.628924"], ["updated_at", "2018-10-18 04:07:41.628924"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b5c3c881-38d1-47fb-a5e4-e77c69e11006"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "85e5f9d6-8b00-43f6-8538-fa63e421c7ec"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "ad13f98a-3261-4bfc-a900-8c06c3974370"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:07:41.631688"], ["updated_at", "2018-10-18 04:07:41.631688"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 38ms (ActiveRecord: 3.6ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:07:41 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" IS NULL LIMIT ?[0m  [["LIMIT", 1]]
Completed 400 Bad Request in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:07:41 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2467de3f-0830-47a2-ad17-bb7c278f0d43"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 9d7d0541-5267-46bf-966d-7a7215e5a673\n"], ["created_at", "2018-10-18 04:07:41.642401"], ["updated_at", "2018-10-18 04:07:41.642401"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "9d7d0541-5267-46bf-966d-7a7215e5a673"], ["name", "test"], ["created_at", "2018-10-18 04:07:41.644722"], ["updated_at", "2018-10-18 04:07:41.644722"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"9d7d0541-5267-46bf-966d-7a7215e5a673"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "041b22ce-21e7-4aaf-9576-0859ec395266"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: b21190f1-6589-41f7-a799-224cb4761947\napp_uid: 9d7d0541-5267-46bf-966d-7a7215e5a673\n"], ["created_at", "2018-10-18 04:07:41.647152"], ["updated_at", "2018-10-18 04:07:41.647152"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "9d7d0541-5267-46bf-966d-7a7215e5a673"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "b21190f1-6589-41f7-a799-224cb4761947"], ["name", "review"], ["created_at", "2018-10-18 04:07:41.649931"], ["updated_at", "2018-10-18 04:07:41.649931"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b21190f1-6589-41f7-a799-224cb4761947"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"b21190f1-6589-41f7-a799-224cb4761947", "app_uid"=>"9d7d0541-5267-46bf-966d-7a7215e5a673"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0b0f313b-6062-403b-8dd2-ac718bef0e8d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 3a097a7a-47cd-4e50-9d31-97a2eb7d6d79\nstage_uid: b21190f1-6589-41f7-a799-224cb4761947\napp_uid: 9d7d0541-5267-46bf-966d-7a7215e5a673\n"], ["created_at", "2018-10-18 04:07:41.653995"], ["updated_at", "2018-10-18 04:07:41.653995"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "9d7d0541-5267-46bf-966d-7a7215e5a673"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b21190f1-6589-41f7-a799-224cb4761947"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "3a097a7a-47cd-4e50-9d31-97a2eb7d6d79"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:07:41.657697"], ["updated_at", "2018-10-18 04:07:41.657697"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"9d7d0541-5267-46bf-966d-7a7215e5a673"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "abb74af3-fb9d-4138-8598-4526029fb01f"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 9577c7d8-fc69-47ec-a19c-c1587ee273bd\napp_uid: 9d7d0541-5267-46bf-966d-7a7215e5a673\n"], ["created_at", "2018-10-18 04:07:41.661975"], ["updated_at", "2018-10-18 04:07:41.661975"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "9d7d0541-5267-46bf-966d-7a7215e5a673"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9577c7d8-fc69-47ec-a19c-c1587ee273bd"], ["name", "staging"], ["created_at", "2018-10-18 04:07:41.665107"], ["updated_at", "2018-10-18 04:07:41.665107"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9577c7d8-fc69-47ec-a19c-c1587ee273bd"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"9577c7d8-fc69-47ec-a19c-c1587ee273bd", "app_uid"=>"9d7d0541-5267-46bf-966d-7a7215e5a673"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "90b0bf15-64c6-4e92-91c0-1469614fa869"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 462bb392-6291-4556-8ae4-6ca6ac1e930e\nstage_uid: 9577c7d8-fc69-47ec-a19c-c1587ee273bd\napp_uid: 9d7d0541-5267-46bf-966d-7a7215e5a673\n"], ["created_at", "2018-10-18 04:07:41.669627"], ["updated_at", "2018-10-18 04:07:41.669627"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "9d7d0541-5267-46bf-966d-7a7215e5a673"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9577c7d8-fc69-47ec-a19c-c1587ee273bd"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "462bb392-6291-4556-8ae4-6ca6ac1e930e"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:07:41.673660"], ["updated_at", "2018-10-18 04:07:41.673660"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 36ms (ActiveRecord: 3.9ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 21:07:41 -0700
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dd83860c-1fcc-487a-bc6e-1367643c2fac"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 5eecb3f1-3325-464e-8947-67d3db8a90d2\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:07:41.680864"], ["updated_at", "2018-10-18 04:07:41.680864"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "5eecb3f1-3325-464e-8947-67d3db8a90d2"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:07:41.686072"], ["updated_at", "2018-10-18 04:07:41.686072"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:09:00.365610', '2018-10-18 04:09:00.365610')[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:09:00.367719', '2018-10-18 04:09:00.367719')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:09:00.369442', '2018-10-18 04:09:00.369442', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:09:00.370829', '2018-10-18 04:09:00.370829')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:09:00.372238', '2018-10-18 04:09:00.372238', 980190962)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:09:00 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "34248e64-5f79-43af-9bb4-9643557f3af2"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 86ae055a-84fd-4b24-8dca-571510f2c81a\n"], ["created_at", "2018-10-18 04:09:00.396471"], ["updated_at", "2018-10-18 04:09:00.396471"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "86ae055a-84fd-4b24-8dca-571510f2c81a"], ["name", "test"], ["created_at", "2018-10-18 04:09:00.401962"], ["updated_at", "2018-10-18 04:09:00.401962"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"86ae055a-84fd-4b24-8dca-571510f2c81a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d491ad80-f99e-4992-a340-d4523e2e150c"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 63b3b370-83ef-49d3-88cf-fea534b4d7ae\napp_uid: 86ae055a-84fd-4b24-8dca-571510f2c81a\n"], ["created_at", "2018-10-18 04:09:00.405085"], ["updated_at", "2018-10-18 04:09:00.405085"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "86ae055a-84fd-4b24-8dca-571510f2c81a"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "63b3b370-83ef-49d3-88cf-fea534b4d7ae"], ["name", "review"], ["created_at", "2018-10-18 04:09:00.412584"], ["updated_at", "2018-10-18 04:09:00.412584"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "63b3b370-83ef-49d3-88cf-fea534b4d7ae"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"63b3b370-83ef-49d3-88cf-fea534b4d7ae", "app_uid"=>"86ae055a-84fd-4b24-8dca-571510f2c81a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1cd1d546-e03b-4f59-94b4-01fca00709ed"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: ed936253-ddc1-42ce-928b-528db5671f25\nstage_uid: 63b3b370-83ef-49d3-88cf-fea534b4d7ae\napp_uid: 86ae055a-84fd-4b24-8dca-571510f2c81a\n"], ["created_at", "2018-10-18 04:09:00.416467"], ["updated_at", "2018-10-18 04:09:00.416467"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "86ae055a-84fd-4b24-8dca-571510f2c81a"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "63b3b370-83ef-49d3-88cf-fea534b4d7ae"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "ed936253-ddc1-42ce-928b-528db5671f25"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:09:00.423592"], ["updated_at", "2018-10-18 04:09:00.423592"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"86ae055a-84fd-4b24-8dca-571510f2c81a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b6f46382-8d9a-4a00-af56-d0d65b5dc88b"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: abccce04-d582-4ef7-aaba-ab71fa2ee212\napp_uid: 86ae055a-84fd-4b24-8dca-571510f2c81a\n"], ["created_at", "2018-10-18 04:09:00.427630"], ["updated_at", "2018-10-18 04:09:00.427630"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "86ae055a-84fd-4b24-8dca-571510f2c81a"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "abccce04-d582-4ef7-aaba-ab71fa2ee212"], ["name", "staging"], ["created_at", "2018-10-18 04:09:00.429943"], ["updated_at", "2018-10-18 04:09:00.429943"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "abccce04-d582-4ef7-aaba-ab71fa2ee212"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"abccce04-d582-4ef7-aaba-ab71fa2ee212", "app_uid"=>"86ae055a-84fd-4b24-8dca-571510f2c81a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7b0f0dae-e38e-4814-b7f9-eb5fbc50a4a3"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 83541c23-7020-44f1-9b75-14d0067cff12\nstage_uid: abccce04-d582-4ef7-aaba-ab71fa2ee212\napp_uid: 86ae055a-84fd-4b24-8dca-571510f2c81a\n"], ["created_at", "2018-10-18 04:09:00.432450"], ["updated_at", "2018-10-18 04:09:00.432450"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "86ae055a-84fd-4b24-8dca-571510f2c81a"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "abccce04-d582-4ef7-aaba-ab71fa2ee212"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "83541c23-7020-44f1-9b75-14d0067cff12"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:09:00.435975"], ["updated_at", "2018-10-18 04:09:00.435975"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 55ms (ActiveRecord: 4.0ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:09:00 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:09:00 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"86ae055a-84fd-4b24-8dca-571510f2c81a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "24e27fb0-6dc5-4192-a8fc-f83b0748ee83"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 86ae055a-84fd-4b24-8dca-571510f2c81a\n"], ["created_at", "2018-10-18 04:09:00.455222"], ["updated_at", "2018-10-18 04:09:00.455222"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "86ae055a-84fd-4b24-8dca-571510f2c81a"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:09:00 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dee9ff47-7804-4be4-bd97-dfe12c8fbe7e"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: baac4ef8-f0f2-48ba-ab8b-2953771a094b\n"], ["created_at", "2018-10-18 04:09:00.460841"], ["updated_at", "2018-10-18 04:09:00.460841"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "baac4ef8-f0f2-48ba-ab8b-2953771a094b"], ["name", "test"], ["created_at", "2018-10-18 04:09:00.463318"], ["updated_at", "2018-10-18 04:09:00.463318"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"baac4ef8-f0f2-48ba-ab8b-2953771a094b"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fb38142a-abae-4f18-aa0c-72ca3f8b765e"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 4a234596-32aa-4747-a3a8-eb24c5314c02\napp_uid: baac4ef8-f0f2-48ba-ab8b-2953771a094b\n"], ["created_at", "2018-10-18 04:09:00.465106"], ["updated_at", "2018-10-18 04:09:00.465106"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "baac4ef8-f0f2-48ba-ab8b-2953771a094b"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "4a234596-32aa-4747-a3a8-eb24c5314c02"], ["name", "review"], ["created_at", "2018-10-18 04:09:00.467846"], ["updated_at", "2018-10-18 04:09:00.467846"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "4a234596-32aa-4747-a3a8-eb24c5314c02"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"4a234596-32aa-4747-a3a8-eb24c5314c02", "app_uid"=>"baac4ef8-f0f2-48ba-ab8b-2953771a094b"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cb1c9e9c-5905-4ee2-99dc-51c702a50464"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 049db796-22f7-42ff-93b6-a11c32f6e7a9\nstage_uid: 4a234596-32aa-4747-a3a8-eb24c5314c02\napp_uid: baac4ef8-f0f2-48ba-ab8b-2953771a094b\n"], ["created_at", "2018-10-18 04:09:00.470634"], ["updated_at", "2018-10-18 04:09:00.470634"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "baac4ef8-f0f2-48ba-ab8b-2953771a094b"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "4a234596-32aa-4747-a3a8-eb24c5314c02"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "049db796-22f7-42ff-93b6-a11c32f6e7a9"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:09:00.473610"], ["updated_at", "2018-10-18 04:09:00.473610"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"baac4ef8-f0f2-48ba-ab8b-2953771a094b"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "779caac2-64b9-4f10-a3e4-348022fe7b9b"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: a6b7e42c-e441-42ed-a1ae-08c90746dcd4\napp_uid: baac4ef8-f0f2-48ba-ab8b-2953771a094b\n"], ["created_at", "2018-10-18 04:09:00.476592"], ["updated_at", "2018-10-18 04:09:00.476592"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "baac4ef8-f0f2-48ba-ab8b-2953771a094b"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "a6b7e42c-e441-42ed-a1ae-08c90746dcd4"], ["name", "staging"], ["created_at", "2018-10-18 04:09:00.478780"], ["updated_at", "2018-10-18 04:09:00.478780"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "a6b7e42c-e441-42ed-a1ae-08c90746dcd4"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"a6b7e42c-e441-42ed-a1ae-08c90746dcd4", "app_uid"=>"baac4ef8-f0f2-48ba-ab8b-2953771a094b"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "665c44a8-948a-433e-a6b2-16a19435491d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 019f15d7-22db-4fd9-9576-9597df2c0e8e\nstage_uid: a6b7e42c-e441-42ed-a1ae-08c90746dcd4\napp_uid: baac4ef8-f0f2-48ba-ab8b-2953771a094b\n"], ["created_at", "2018-10-18 04:09:00.481404"], ["updated_at", "2018-10-18 04:09:00.481404"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "baac4ef8-f0f2-48ba-ab8b-2953771a094b"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "a6b7e42c-e441-42ed-a1ae-08c90746dcd4"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "019f15d7-22db-4fd9-9576-9597df2c0e8e"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:09:00.484480"], ["updated_at", "2018-10-18 04:09:00.484480"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 28ms (ActiveRecord: 3.2ms)
Started POST "/api/v1/apps/test/build" for 127.0.0.1 at 2018-10-17 21:09:00 -0700
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d4ad4da8-12ca-4d2e-8da6-3fe6caa2d333"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 1ba93a22-ee45-44cc-a667-4009b8ee7f29\n"], ["created_at", "2018-10-18 04:09:00.491208"], ["updated_at", "2018-10-18 04:09:00.491208"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "1ba93a22-ee45-44cc-a667-4009b8ee7f29"], ["name", "test"], ["created_at", "2018-10-18 04:09:00.498792"], ["updated_at", "2018-10-18 04:09:00.498792"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b75abfc1-60a1-4ff5-927f-4c43d013088d"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:09:00.502309"], ["updated_at", "2018-10-18 04:09:00.502309"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "063126c9-9f5c-4dd3-85a8-ff7c64ae498c"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:09:00.507285"], ["updated_at", "2018-10-18 04:09:00.507285"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:09:00.510355"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d8d248f0-78ed-4d66-8a45-ae7208a22a82"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 433fb3a0-4cec-45c3-8c25-d00aacb96782\n"], ["created_at", "2018-10-18 04:09:00.513235"], ["updated_at", "2018-10-18 04:09:00.513235"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "433fb3a0-4cec-45c3-8c25-d00aacb96782"], ["name", "test"], ["created_at", "2018-10-18 04:09:00.516291"], ["updated_at", "2018-10-18 04:09:00.516291"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5dc293e7-ae96-4ce9-a775-b667b77cb45c"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:09:00.518630"], ["updated_at", "2018-10-18 04:09:00.518630"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2a978c34-0c6b-46cc-b28a-3d4949962ff9"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:09:00.523909"], ["updated_at", "2018-10-18 04:09:00.523909"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:09:00.526616"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "539a7eb3-b816-4734-9adf-aa1984e34d94"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 2665b2a2-a3aa-4b2a-b168-b26f5f907bfd\n"], ["created_at", "2018-10-18 04:09:00.530712"], ["updated_at", "2018-10-18 04:09:00.530712"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "2665b2a2-a3aa-4b2a-b168-b26f5f907bfd"], ["name", "test2"], ["created_at", "2018-10-18 04:09:00.534760"], ["updated_at", "2018-10-18 04:09:00.534760"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "511419d0-a8cd-465f-aea1-6f24f0f7ee55"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 7feb5fbf-ed5a-487d-bb09-deb8fb4dd1e8\n"], ["created_at", "2018-10-18 04:09:00.538780"], ["updated_at", "2018-10-18 04:09:00.538780"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "7feb5fbf-ed5a-487d-bb09-deb8fb4dd1e8"], ["name", "test2"], ["created_at", "2018-10-18 04:09:00.542360"], ["updated_at", "2018-10-18 04:09:00.542360"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "754602a7-db28-44f0-a23f-c01d587ceddf"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 86adef05-f023-4008-a607-91a7f2be1334\n"], ["created_at", "2018-10-18 04:09:00.551955"], ["updated_at", "2018-10-18 04:09:00.551955"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "86adef05-f023-4008-a607-91a7f2be1334"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:09:00.559577"], ["updated_at", "2018-10-18 04:09:00.559577"]]
[ActiveJob] [ReleaseJob] [ebc1be8f-fc9b-49ac-996a-e36b4b96071a] Performing ReleaseJob (Job ID: ebc1be8f-fc9b-49ac-996a-e36b4b96071a) from Async(default) with arguments: "754602a7-db28-44f0-a23f-c01d587ceddf"
[ActiveJob] Enqueued ReleaseJob (Job ID: ebc1be8f-fc9b-49ac-996a-e36b4b96071a) to Async(default) with arguments: "754602a7-db28-44f0-a23f-c01d587ceddf"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ebc1be8f-fc9b-49ac-996a-e36b4b96071a]   [1m[36mEvent Load (0.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "754602a7-db28-44f0-a23f-c01d587ceddf"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ebc1be8f-fc9b-49ac-996a-e36b4b96071a] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e1c49a4b-2104-4c63-811f-944a67c39b87"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: da0de7a1-b934-4df2-a3aa-3e0b3911778b\n"], ["created_at", "2018-10-18 04:09:00.570090"], ["updated_at", "2018-10-18 04:09:00.570090"]]
[ActiveJob] [ReleaseJob] [ebc1be8f-fc9b-49ac-996a-e36b4b96071a] Error performing ReleaseJob (Job ID: ebc1be8f-fc9b-49ac-996a-e36b4b96071a) from Async(default) in 10.14ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "da0de7a1-b934-4df2-a3aa-3e0b3911778b"], ["status", "PENDING"], ["created_at", "2018-10-18 04:09:00.578941"], ["updated_at", "2018-10-18 04:09:00.578941"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e52c3d6f-ba37-418d-b296-b3f63bc9b1bc"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: b3a70fa1-761d-4002-9945-811c8aef25fa\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:09:00.583491"], ["updated_at", "2018-10-18 04:09:00.583491"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "b3a70fa1-761d-4002-9945-811c8aef25fa"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:09:00.588998"], ["updated_at", "2018-10-18 04:09:00.588998"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:11:05.873014', '2018-10-18 04:11:05.873014')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:11:05.875356', '2018-10-18 04:11:05.875356')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:11:05.876926', '2018-10-18 04:11:05.876926', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:11:05.878385', '2018-10-18 04:11:05.878385')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:11:05.880017', '2018-10-18 04:11:05.880017', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1c62c3a1-b617-44e2-98e2-d6c85e322b68"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: f5fb3ebb-4df7-43cb-9c59-e56897795d9e\n"], ["created_at", "2018-10-18 04:11:05.890921"], ["updated_at", "2018-10-18 04:11:05.890921"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "f5fb3ebb-4df7-43cb-9c59-e56897795d9e"], ["name", "test"], ["created_at", "2018-10-18 04:11:05.896115"], ["updated_at", "2018-10-18 04:11:05.896115"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4546ff23-6890-4b5f-a50a-056aafb09ba2"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:11:05.898744"], ["updated_at", "2018-10-18 04:11:05.898744"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "da925965-a148-4bea-8dd0-080ebc2a1949"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:11:05.911262"], ["updated_at", "2018-10-18 04:11:05.911262"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:11:05.915973"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ea6ebc69-ce19-4d49-bb59-f2e3910846ca"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:11:05.919937"], ["updated_at", "2018-10-18 04:11:05.919937"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:11:05.923158"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "95a0f7d6-035e-4af5-8752-940ece3059aa"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: f3018ab1-fb09-4468-9ba5-5af230a7cbea\n"], ["created_at", "2018-10-18 04:11:05.927397"], ["updated_at", "2018-10-18 04:11:05.927397"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "f3018ab1-fb09-4468-9ba5-5af230a7cbea"], ["name", "test2"], ["created_at", "2018-10-18 04:11:05.935223"], ["updated_at", "2018-10-18 04:11:05.935223"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7e903d03-09ce-4075-a45b-8d66ceeba9d9"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:11:05.939224"], ["updated_at", "2018-10-18 04:11:05.939224"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c02d6984-0105-4585-a94a-89573f833165"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: a464cd33-4f0e-41a4-838f-1c5d662ce450\n"], ["created_at", "2018-10-18 04:11:05.944929"], ["updated_at", "2018-10-18 04:11:05.944929"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a464cd33-4f0e-41a4-838f-1c5d662ce450"], ["name", "test2"], ["created_at", "2018-10-18 04:11:05.949311"], ["updated_at", "2018-10-18 04:11:05.949311"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5c8922b1-2350-4d98-a1af-89c5be5ef914"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 0a775836-e487-4217-83d3-f750d75fc093\n"], ["created_at", "2018-10-18 04:11:05.952704"], ["updated_at", "2018-10-18 04:11:05.952704"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "0a775836-e487-4217-83d3-f750d75fc093"], ["name", "test"], ["created_at", "2018-10-18 04:11:05.955860"], ["updated_at", "2018-10-18 04:11:05.955860"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:11:05 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "45db4918-5075-435e-a45a-3eabe30bc070"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: ebfc9ca4-c8a8-4455-8825-af065bd26f62\n"], ["created_at", "2018-10-18 04:11:05.971813"], ["updated_at", "2018-10-18 04:11:05.971813"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "ebfc9ca4-c8a8-4455-8825-af065bd26f62"], ["name", "test"], ["created_at", "2018-10-18 04:11:05.974129"], ["updated_at", "2018-10-18 04:11:05.974129"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"ebfc9ca4-c8a8-4455-8825-af065bd26f62"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2e88cd50-fbe6-4cfa-ad58-32885b683e62"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 3dee26f5-8a89-4d42-be8e-7dcf6cf28e25\napp_uid: ebfc9ca4-c8a8-4455-8825-af065bd26f62\n"], ["created_at", "2018-10-18 04:11:05.977066"], ["updated_at", "2018-10-18 04:11:05.977066"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ebfc9ca4-c8a8-4455-8825-af065bd26f62"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "3dee26f5-8a89-4d42-be8e-7dcf6cf28e25"], ["name", "review"], ["created_at", "2018-10-18 04:11:05.979760"], ["updated_at", "2018-10-18 04:11:05.979760"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "3dee26f5-8a89-4d42-be8e-7dcf6cf28e25"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"3dee26f5-8a89-4d42-be8e-7dcf6cf28e25", "app_uid"=>"ebfc9ca4-c8a8-4455-8825-af065bd26f62"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5ae71cd6-2577-4da0-a76a-816f50911491"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 0d258547-2a12-479c-9227-0a20ecc6d4a2\nstage_uid: 3dee26f5-8a89-4d42-be8e-7dcf6cf28e25\napp_uid: ebfc9ca4-c8a8-4455-8825-af065bd26f62\n"], ["created_at", "2018-10-18 04:11:05.983244"], ["updated_at", "2018-10-18 04:11:05.983244"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ebfc9ca4-c8a8-4455-8825-af065bd26f62"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "3dee26f5-8a89-4d42-be8e-7dcf6cf28e25"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "0d258547-2a12-479c-9227-0a20ecc6d4a2"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:11:05.986908"], ["updated_at", "2018-10-18 04:11:05.986908"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"ebfc9ca4-c8a8-4455-8825-af065bd26f62"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e37ed6f2-e8ae-47e2-8d4d-ec3c3748674f"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 2b4959dd-9eb4-4c47-8b07-08b30c0e94a3\napp_uid: ebfc9ca4-c8a8-4455-8825-af065bd26f62\n"], ["created_at", "2018-10-18 04:11:05.991808"], ["updated_at", "2018-10-18 04:11:05.991808"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ebfc9ca4-c8a8-4455-8825-af065bd26f62"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "2b4959dd-9eb4-4c47-8b07-08b30c0e94a3"], ["name", "staging"], ["created_at", "2018-10-18 04:11:05.994636"], ["updated_at", "2018-10-18 04:11:05.994636"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2b4959dd-9eb4-4c47-8b07-08b30c0e94a3"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"2b4959dd-9eb4-4c47-8b07-08b30c0e94a3", "app_uid"=>"ebfc9ca4-c8a8-4455-8825-af065bd26f62"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c4561b1d-456d-48f4-b58a-706401f80a75"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: b6f06b4d-aeaf-4a94-ad1a-ef01e1e24c60\nstage_uid: 2b4959dd-9eb4-4c47-8b07-08b30c0e94a3\napp_uid: ebfc9ca4-c8a8-4455-8825-af065bd26f62\n"], ["created_at", "2018-10-18 04:11:05.997683"], ["updated_at", "2018-10-18 04:11:05.997683"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ebfc9ca4-c8a8-4455-8825-af065bd26f62"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2b4959dd-9eb4-4c47-8b07-08b30c0e94a3"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "b6f06b4d-aeaf-4a94-ad1a-ef01e1e24c60"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:11:06.000915"], ["updated_at", "2018-10-18 04:11:06.000915"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 40ms (ActiveRecord: 3.7ms)
Started POST "/api/v1/apps/test/builds" for 127.0.0.1 at 2018-10-17 21:11:06 -0700
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:11:06 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "50ff2b1c-69f7-4d79-9d58-ac0a925360b0"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 28a5c42d-2d67-4c9a-8426-eaad0fefc6c0\n"], ["created_at", "2018-10-18 04:11:06.011846"], ["updated_at", "2018-10-18 04:11:06.011846"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"], ["name", "test"], ["created_at", "2018-10-18 04:11:06.015235"], ["updated_at", "2018-10-18 04:11:06.015235"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "df5e7e80-a833-41b7-884c-0cbca4fc0c8b"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: b0170e20-968f-4c60-9208-eb3005facf12\napp_uid: 28a5c42d-2d67-4c9a-8426-eaad0fefc6c0\n"], ["created_at", "2018-10-18 04:11:06.017612"], ["updated_at", "2018-10-18 04:11:06.017612"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "b0170e20-968f-4c60-9208-eb3005facf12"], ["name", "review"], ["created_at", "2018-10-18 04:11:06.020176"], ["updated_at", "2018-10-18 04:11:06.020176"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b0170e20-968f-4c60-9208-eb3005facf12"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"b0170e20-968f-4c60-9208-eb3005facf12", "app_uid"=>"28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e37336a9-74e7-40a3-96aa-9550fc292485"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: d8e1446a-80c2-4568-a9c5-7171a85281e1\nstage_uid: b0170e20-968f-4c60-9208-eb3005facf12\napp_uid: 28a5c42d-2d67-4c9a-8426-eaad0fefc6c0\n"], ["created_at", "2018-10-18 04:11:06.023767"], ["updated_at", "2018-10-18 04:11:06.023767"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b0170e20-968f-4c60-9208-eb3005facf12"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "d8e1446a-80c2-4568-a9c5-7171a85281e1"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:11:06.027096"], ["updated_at", "2018-10-18 04:11:06.027096"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6ade5947-871a-4627-b333-ba66fd2fd565"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: be6973eb-182d-4874-8780-63e0bb35b6e8\napp_uid: 28a5c42d-2d67-4c9a-8426-eaad0fefc6c0\n"], ["created_at", "2018-10-18 04:11:06.035491"], ["updated_at", "2018-10-18 04:11:06.035491"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "be6973eb-182d-4874-8780-63e0bb35b6e8"], ["name", "staging"], ["created_at", "2018-10-18 04:11:06.039568"], ["updated_at", "2018-10-18 04:11:06.039568"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "be6973eb-182d-4874-8780-63e0bb35b6e8"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"be6973eb-182d-4874-8780-63e0bb35b6e8", "app_uid"=>"28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "107b2d6f-57b1-4e8d-a7a9-da92aaf26144"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: a92db57e-c41d-4b18-8404-a023239ad24a\nstage_uid: be6973eb-182d-4874-8780-63e0bb35b6e8\napp_uid: 28a5c42d-2d67-4c9a-8426-eaad0fefc6c0\n"], ["created_at", "2018-10-18 04:11:06.042965"], ["updated_at", "2018-10-18 04:11:06.042965"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "be6973eb-182d-4874-8780-63e0bb35b6e8"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "a92db57e-c41d-4b18-8404-a023239ad24a"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:11:06.046019"], ["updated_at", "2018-10-18 04:11:06.046019"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 39ms (ActiveRecord: 3.6ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:11:06 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:11:06 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4dc8160e-1259-4f83-a106-b4800b8e7ef9"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 28a5c42d-2d67-4c9a-8426-eaad0fefc6c0\n"], ["created_at", "2018-10-18 04:11:06.063920"], ["updated_at", "2018-10-18 04:11:06.063920"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "28a5c42d-2d67-4c9a-8426-eaad0fefc6c0"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4b2c0313-7ac8-4118-8f16-63cdcb85550f"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: efa299cf-0089-47a7-a24e-b19962d3a05d\n"], ["created_at", "2018-10-18 04:11:06.073514"], ["updated_at", "2018-10-18 04:11:06.073514"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "efa299cf-0089-47a7-a24e-b19962d3a05d"], ["status", "PENDING"], ["created_at", "2018-10-18 04:11:06.081357"], ["updated_at", "2018-10-18 04:11:06.081357"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cdade446-edec-4313-bece-78fac3771691"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 510851db-d2f6-462d-9e60-ad8d59f78756\n"], ["created_at", "2018-10-18 04:11:06.090386"], ["updated_at", "2018-10-18 04:11:06.090386"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "510851db-d2f6-462d-9e60-ad8d59f78756"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:11:06.093926"], ["updated_at", "2018-10-18 04:11:06.093926"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 24ecee00-3e74-432b-bd7b-974de2d2d046) to Async(default) with arguments: "cdade446-edec-4313-bece-78fac3771691"
[ActiveJob] [ReleaseJob] [24ecee00-3e74-432b-bd7b-974de2d2d046] Performing ReleaseJob (Job ID: 24ecee00-3e74-432b-bd7b-974de2d2d046) from Async(default) with arguments: "cdade446-edec-4313-bece-78fac3771691"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
[ActiveJob] [ReleaseJob] [24ecee00-3e74-432b-bd7b-974de2d2d046]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "cdade446-edec-4313-bece-78fac3771691"], ["LIMIT", 1]]
BuildCommandsTest: test_create_a_build
[ActiveJob] [ReleaseJob] [24ecee00-3e74-432b-bd7b-974de2d2d046] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
--------------------------------------
[ActiveJob] [ReleaseJob] [24ecee00-3e74-432b-bd7b-974de2d2d046] Error performing ReleaseJob (Job ID: 24ecee00-3e74-432b-bd7b-974de2d2d046) from Async(default) in 5.59ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c3385976-6979-4ce5-bb93-52a747bacfb6"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 7732db31-206d-4bff-8b54-5e8e9ad98cab\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:11:06.103463"], ["updated_at", "2018-10-18 04:11:06.103463"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "7732db31-206d-4bff-8b54-5e8e9ad98cab"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:11:06.109049"], ["updated_at", "2018-10-18 04:11:06.109049"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:12:22.997363', '2018-10-18 04:12:22.997363')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:12:22.999667', '2018-10-18 04:12:22.999667')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:12:23.001202', '2018-10-18 04:12:23.001202', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:12:23.002714', '2018-10-18 04:12:23.002714')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:12:23.004402', '2018-10-18 04:12:23.004402', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c570d1ed-0650-455b-a123-45aeaf96b21a"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 35cd88e6-6ed7-4b05-924c-6ad8bfddee55\n"], ["created_at", "2018-10-18 04:12:23.024512"], ["updated_at", "2018-10-18 04:12:23.024512"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "35cd88e6-6ed7-4b05-924c-6ad8bfddee55"], ["status", "PENDING"], ["created_at", "2018-10-18 04:12:23.034159"], ["updated_at", "2018-10-18 04:12:23.034159"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b022003b-7bb3-460d-af94-876141bd63da"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: a472c210-0331-4e3f-abe3-b1ca46b2065d\n"], ["created_at", "2018-10-18 04:12:23.043380"], ["updated_at", "2018-10-18 04:12:23.043380"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a472c210-0331-4e3f-abe3-b1ca46b2065d"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:12:23.046681"], ["updated_at", "2018-10-18 04:12:23.046681"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: fbd542ed-2343-4946-bdba-df0ae4c66e6f) to Async(default) with arguments: "b022003b-7bb3-460d-af94-876141bd63da"
[ActiveJob] [ReleaseJob] [fbd542ed-2343-4946-bdba-df0ae4c66e6f] Performing ReleaseJob (Job ID: fbd542ed-2343-4946-bdba-df0ae4c66e6f) from Async(default) with arguments: "b022003b-7bb3-460d-af94-876141bd63da"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
[ActiveJob] [ReleaseJob] [fbd542ed-2343-4946-bdba-df0ae4c66e6f]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "b022003b-7bb3-460d-af94-876141bd63da"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [fbd542ed-2343-4946-bdba-df0ae4c66e6f] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
[ActiveJob] [ReleaseJob] [fbd542ed-2343-4946-bdba-df0ae4c66e6f] Error performing ReleaseJob (Job ID: fbd542ed-2343-4946-bdba-df0ae4c66e6f) from Async(default) in 7.64ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:12:23 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8e0de45e-31c7-4cc6-9be8-6adab7599699"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: ecb1c18b-627b-45a2-853f-8d70b7ed4f0a\n"], ["created_at", "2018-10-18 04:12:23.067804"], ["updated_at", "2018-10-18 04:12:23.067804"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "ecb1c18b-627b-45a2-853f-8d70b7ed4f0a"], ["name", "test"], ["created_at", "2018-10-18 04:12:23.073226"], ["updated_at", "2018-10-18 04:12:23.073226"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"ecb1c18b-627b-45a2-853f-8d70b7ed4f0a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0794936a-ee50-404e-a914-88d6cc14a297"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 9b56481a-5f45-4e68-a53b-e5a7d7dd513f\napp_uid: ecb1c18b-627b-45a2-853f-8d70b7ed4f0a\n"], ["created_at", "2018-10-18 04:12:23.076380"], ["updated_at", "2018-10-18 04:12:23.076380"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ecb1c18b-627b-45a2-853f-8d70b7ed4f0a"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9b56481a-5f45-4e68-a53b-e5a7d7dd513f"], ["name", "review"], ["created_at", "2018-10-18 04:12:23.084389"], ["updated_at", "2018-10-18 04:12:23.084389"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9b56481a-5f45-4e68-a53b-e5a7d7dd513f"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"9b56481a-5f45-4e68-a53b-e5a7d7dd513f", "app_uid"=>"ecb1c18b-627b-45a2-853f-8d70b7ed4f0a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9067cb48-ac17-432f-a798-5bbe6e212500"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: ceda6e56-f29c-4ada-ade9-1515170c9199\nstage_uid: 9b56481a-5f45-4e68-a53b-e5a7d7dd513f\napp_uid: ecb1c18b-627b-45a2-853f-8d70b7ed4f0a\n"], ["created_at", "2018-10-18 04:12:23.088062"], ["updated_at", "2018-10-18 04:12:23.088062"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ecb1c18b-627b-45a2-853f-8d70b7ed4f0a"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9b56481a-5f45-4e68-a53b-e5a7d7dd513f"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "ceda6e56-f29c-4ada-ade9-1515170c9199"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:12:23.091298"], ["updated_at", "2018-10-18 04:12:23.091298"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"ecb1c18b-627b-45a2-853f-8d70b7ed4f0a"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9bdfb101-47af-4095-a092-98ad5440b6a3"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 1ec2be52-f2a6-4a70-86e1-235b217a09d4\napp_uid: ecb1c18b-627b-45a2-853f-8d70b7ed4f0a\n"], ["created_at", "2018-10-18 04:12:23.095519"], ["updated_at", "2018-10-18 04:12:23.095519"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ecb1c18b-627b-45a2-853f-8d70b7ed4f0a"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "1ec2be52-f2a6-4a70-86e1-235b217a09d4"], ["name", "staging"], ["created_at", "2018-10-18 04:12:23.098113"], ["updated_at", "2018-10-18 04:12:23.098113"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1ec2be52-f2a6-4a70-86e1-235b217a09d4"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"1ec2be52-f2a6-4a70-86e1-235b217a09d4", "app_uid"=>"ecb1c18b-627b-45a2-853f-8d70b7ed4f0a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "233ef7f0-1eeb-4a49-b3db-88546cc5ea43"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 9b7c30b1-1046-439a-9dcd-d7df95387131\nstage_uid: 1ec2be52-f2a6-4a70-86e1-235b217a09d4\napp_uid: ecb1c18b-627b-45a2-853f-8d70b7ed4f0a\n"], ["created_at", "2018-10-18 04:12:23.101336"], ["updated_at", "2018-10-18 04:12:23.101336"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ecb1c18b-627b-45a2-853f-8d70b7ed4f0a"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1ec2be52-f2a6-4a70-86e1-235b217a09d4"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "9b7c30b1-1046-439a-9dcd-d7df95387131"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:12:23.104610"], ["updated_at", "2018-10-18 04:12:23.104610"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 51ms (ActiveRecord: 3.7ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:12:23 -0700
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:12:23 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0709c56c-797d-4af6-adc7-0ef8e8ec1085"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 7a8f1ba8-249f-46a2-b831-c97e16cd17a4\n"], ["created_at", "2018-10-18 04:12:23.122589"], ["updated_at", "2018-10-18 04:12:23.122589"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "7a8f1ba8-249f-46a2-b831-c97e16cd17a4"], ["name", "test"], ["created_at", "2018-10-18 04:12:23.125406"], ["updated_at", "2018-10-18 04:12:23.125406"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"7a8f1ba8-249f-46a2-b831-c97e16cd17a4"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "17284279-213f-4c28-a649-a3c3a9e97ac3"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 25631693-14a6-478b-b07c-b6a149dfa31f\napp_uid: 7a8f1ba8-249f-46a2-b831-c97e16cd17a4\n"], ["created_at", "2018-10-18 04:12:23.127784"], ["updated_at", "2018-10-18 04:12:23.127784"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7a8f1ba8-249f-46a2-b831-c97e16cd17a4"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "25631693-14a6-478b-b07c-b6a149dfa31f"], ["name", "review"], ["created_at", "2018-10-18 04:12:23.130309"], ["updated_at", "2018-10-18 04:12:23.130309"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "25631693-14a6-478b-b07c-b6a149dfa31f"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"25631693-14a6-478b-b07c-b6a149dfa31f", "app_uid"=>"7a8f1ba8-249f-46a2-b831-c97e16cd17a4"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a0398121-f55a-433a-9069-1102a97cf153"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: cf1bfe29-3b53-4b53-86c5-04f90b3d3536\nstage_uid: 25631693-14a6-478b-b07c-b6a149dfa31f\napp_uid: 7a8f1ba8-249f-46a2-b831-c97e16cd17a4\n"], ["created_at", "2018-10-18 04:12:23.132902"], ["updated_at", "2018-10-18 04:12:23.132902"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7a8f1ba8-249f-46a2-b831-c97e16cd17a4"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "25631693-14a6-478b-b07c-b6a149dfa31f"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "cf1bfe29-3b53-4b53-86c5-04f90b3d3536"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:12:23.135758"], ["updated_at", "2018-10-18 04:12:23.135758"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"7a8f1ba8-249f-46a2-b831-c97e16cd17a4"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "eb9c7e0b-4ecd-4006-9c57-61e4240c1d68"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: e91bd645-2cff-427c-83ff-e72b454f87e1\napp_uid: 7a8f1ba8-249f-46a2-b831-c97e16cd17a4\n"], ["created_at", "2018-10-18 04:12:23.139470"], ["updated_at", "2018-10-18 04:12:23.139470"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7a8f1ba8-249f-46a2-b831-c97e16cd17a4"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "e91bd645-2cff-427c-83ff-e72b454f87e1"], ["name", "staging"], ["created_at", "2018-10-18 04:12:23.141800"], ["updated_at", "2018-10-18 04:12:23.141800"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e91bd645-2cff-427c-83ff-e72b454f87e1"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"e91bd645-2cff-427c-83ff-e72b454f87e1", "app_uid"=>"7a8f1ba8-249f-46a2-b831-c97e16cd17a4"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f9f573bc-a06d-412a-bdaa-e30d16df4d9b"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: b1578683-3c27-4022-bbdb-af7481a2ed47\nstage_uid: e91bd645-2cff-427c-83ff-e72b454f87e1\napp_uid: 7a8f1ba8-249f-46a2-b831-c97e16cd17a4\n"], ["created_at", "2018-10-18 04:12:23.144511"], ["updated_at", "2018-10-18 04:12:23.144511"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7a8f1ba8-249f-46a2-b831-c97e16cd17a4"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e91bd645-2cff-427c-83ff-e72b454f87e1"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "b1578683-3c27-4022-bbdb-af7481a2ed47"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:12:23.147156"], ["updated_at", "2018-10-18 04:12:23.147156"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 29ms (ActiveRecord: 3.3ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:12:23 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:12:23 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"7a8f1ba8-249f-46a2-b831-c97e16cd17a4"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "43d0d5f1-ed5b-4b70-b17a-d8dce6afd651"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 7a8f1ba8-249f-46a2-b831-c97e16cd17a4\n"], ["created_at", "2018-10-18 04:12:23.164732"], ["updated_at", "2018-10-18 04:12:23.164732"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7a8f1ba8-249f-46a2-b831-c97e16cd17a4"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d0b54bb-6d25-42de-b960-8fb84a312b11"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:12:23.169298"], ["updated_at", "2018-10-18 04:12:23.169298"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "21a52a15-35a8-4e5a-98b9-832559c73ef1"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:12:23.173682"], ["updated_at", "2018-10-18 04:12:23.173682"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:12:23.175676"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "20708fb9-7564-4391-a8eb-07d33c9234da"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: beda1986-c581-493d-89da-05d9ca4833da\n"], ["created_at", "2018-10-18 04:12:23.179189"], ["updated_at", "2018-10-18 04:12:23.179189"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "beda1986-c581-493d-89da-05d9ca4833da"], ["name", "test2"], ["created_at", "2018-10-18 04:12:23.182488"], ["updated_at", "2018-10-18 04:12:23.182488"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "81e8d23a-ecff-47d5-8afc-4c2d3ed61b4e"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 0bb6bdde-bc89-4d0f-8710-61745aaa413c\n"], ["created_at", "2018-10-18 04:12:23.184940"], ["updated_at", "2018-10-18 04:12:23.184940"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "0bb6bdde-bc89-4d0f-8710-61745aaa413c"], ["name", "test"], ["created_at", "2018-10-18 04:12:23.187640"], ["updated_at", "2018-10-18 04:12:23.187640"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "225144a6-4e8a-489f-8075-32a55c4c11f8"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: cd66d3d3-e64a-45d5-b4be-ca342fd74b2c\n"], ["created_at", "2018-10-18 04:12:23.189668"], ["updated_at", "2018-10-18 04:12:23.189668"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "cd66d3d3-e64a-45d5-b4be-ca342fd74b2c"], ["name", "test"], ["created_at", "2018-10-18 04:12:23.192321"], ["updated_at", "2018-10-18 04:12:23.192321"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "936620b7-cd2d-4490-b56b-95d2466de07b"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: d2ace272-41af-4f87-b59e-8d7546ec4e0f\n"], ["created_at", "2018-10-18 04:12:23.195060"], ["updated_at", "2018-10-18 04:12:23.195060"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "d2ace272-41af-4f87-b59e-8d7546ec4e0f"], ["name", "test2"], ["created_at", "2018-10-18 04:12:23.197691"], ["updated_at", "2018-10-18 04:12:23.197691"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d0fc1e56-0961-4b38-a0c2-0797fcb1da10"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:12:23.199896"], ["updated_at", "2018-10-18 04:12:23.199896"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a0b1309e-87b4-4997-ae80-8b7a9e13ce5d"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:12:23.204170"], ["updated_at", "2018-10-18 04:12:23.204170"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:12:23.207032"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3a21d175-22fc-4b3c-b270-d9281969fd58"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: a1b7f1b8-ffa1-4642-8bd3-59009c5ab7fc\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:12:23.210934"], ["updated_at", "2018-10-18 04:12:23.210934"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a1b7f1b8-ffa1-4642-8bd3-59009c5ab7fc"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:12:23.216083"], ["updated_at", "2018-10-18 04:12:23.216083"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:12:43.125927', '2018-10-18 04:12:43.125927')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:12:43.128293', '2018-10-18 04:12:43.128293')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:12:43.129992', '2018-10-18 04:12:43.129992', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:12:43.131392', '2018-10-18 04:12:43.131392')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:12:43.132914', '2018-10-18 04:12:43.132914', 980190962)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "60093a93-1ba4-4329-8ce8-58564c0a8aca"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 7a8f4d84-aaed-4906-a458-3c2bea1faaea\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:12:43.158893"], ["updated_at", "2018-10-18 04:12:43.158893"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "7a8f4d84-aaed-4906-a458-3c2bea1faaea"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:12:43.166818"], ["updated_at", "2018-10-18 04:12:43.166818"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "08a9fcae-39b4-4756-aba8-244ae611590d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: c8c084d5-93e2-45c4-89ce-1339f4f0adca\n"], ["created_at", "2018-10-18 04:12:43.173036"], ["updated_at", "2018-10-18 04:12:43.173036"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "c8c084d5-93e2-45c4-89ce-1339f4f0adca"], ["name", "test2"], ["created_at", "2018-10-18 04:12:43.180938"], ["updated_at", "2018-10-18 04:12:43.180938"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e0c92267-f95d-4891-a2c0-ab9894713c77"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:12:43.183803"], ["updated_at", "2018-10-18 04:12:43.183803"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "42a1b271-7dfa-4205-aa86-4001f591cd42"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: c4032fed-5875-4f38-922c-a784ea8082f9\n"], ["created_at", "2018-10-18 04:12:43.188908"], ["updated_at", "2018-10-18 04:12:43.188908"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "c4032fed-5875-4f38-922c-a784ea8082f9"], ["name", "test"], ["created_at", "2018-10-18 04:12:43.191836"], ["updated_at", "2018-10-18 04:12:43.191836"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "11f1ad04-0400-4dbc-a560-d864a54da25c"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:12:43.195579"], ["updated_at", "2018-10-18 04:12:43.195579"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "85bb33f5-d149-4eaf-a6c1-c398a60a1f58"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 52c852fd-1962-47ee-a54f-917f47faaf19\n"], ["created_at", "2018-10-18 04:12:43.200834"], ["updated_at", "2018-10-18 04:12:43.200834"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "52c852fd-1962-47ee-a54f-917f47faaf19"], ["name", "test2"], ["created_at", "2018-10-18 04:12:43.204467"], ["updated_at", "2018-10-18 04:12:43.204467"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a508be81-dd01-42c3-a925-fd7c0efc92a0"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:12:43.208720"], ["updated_at", "2018-10-18 04:12:43.208720"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:12:43.212161"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "35d384c1-a15a-4daa-afd3-bc5d051aadf6"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:12:43.216385"], ["updated_at", "2018-10-18 04:12:43.216385"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:12:43.219338"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "01fe28e0-d0ec-4417-9136-4e468df26f1d"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 1dfdb613-ce19-4e93-8189-1f4a6106f376\n"], ["created_at", "2018-10-18 04:12:43.222080"], ["updated_at", "2018-10-18 04:12:43.222080"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "1dfdb613-ce19-4e93-8189-1f4a6106f376"], ["name", "test"], ["created_at", "2018-10-18 04:12:43.224671"], ["updated_at", "2018-10-18 04:12:43.224671"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1bc6380e-b956-4a63-a5da-79884cd5988b"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 07a8b0b6-9785-4534-aee4-9e04aafa8010\n"], ["created_at", "2018-10-18 04:12:43.228569"], ["updated_at", "2018-10-18 04:12:43.228569"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "07a8b0b6-9785-4534-aee4-9e04aafa8010"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:12:43.235718"], ["updated_at", "2018-10-18 04:12:43.235718"]]
[ActiveJob] [ReleaseJob] [e9b38aab-b31b-441a-942b-eeaece086fb9] Performing ReleaseJob (Job ID: e9b38aab-b31b-441a-942b-eeaece086fb9) from Async(default) with arguments: "1bc6380e-b956-4a63-a5da-79884cd5988b"
[ActiveJob] Enqueued ReleaseJob (Job ID: e9b38aab-b31b-441a-942b-eeaece086fb9) to Async(default) with arguments: "1bc6380e-b956-4a63-a5da-79884cd5988b"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [e9b38aab-b31b-441a-942b-eeaece086fb9]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "1bc6380e-b956-4a63-a5da-79884cd5988b"], ["LIMIT", 1]]
------------------------------------------
[ActiveJob] [ReleaseJob] [e9b38aab-b31b-441a-942b-eeaece086fb9] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [e9b38aab-b31b-441a-942b-eeaece086fb9] Error performing ReleaseJob (Job ID: e9b38aab-b31b-441a-942b-eeaece086fb9) from Async(default) in 6.35ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ffa25aea-a5f1-437c-bf4e-29d755ba046a"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 110485db-61d1-41af-a60e-eca81d2f861b\n"], ["created_at", "2018-10-18 04:12:43.246921"], ["updated_at", "2018-10-18 04:12:43.246921"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "110485db-61d1-41af-a60e-eca81d2f861b"], ["status", "PENDING"], ["created_at", "2018-10-18 04:12:43.259745"], ["updated_at", "2018-10-18 04:12:43.259745"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:12:43 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ec125600-e7a7-48c3-bd93-a420b47263fb"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 7b607606-fefc-4d49-86b6-678cc6f61bce\n"], ["created_at", "2018-10-18 04:12:43.274936"], ["updated_at", "2018-10-18 04:12:43.274936"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "7b607606-fefc-4d49-86b6-678cc6f61bce"], ["name", "test"], ["created_at", "2018-10-18 04:12:43.277408"], ["updated_at", "2018-10-18 04:12:43.277408"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"7b607606-fefc-4d49-86b6-678cc6f61bce"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8b2b869d-3ab7-4397-ab3d-fa681e376688"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 1f378ff1-30ff-4990-9f0c-24fcbd6f6702\napp_uid: 7b607606-fefc-4d49-86b6-678cc6f61bce\n"], ["created_at", "2018-10-18 04:12:43.279681"], ["updated_at", "2018-10-18 04:12:43.279681"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7b607606-fefc-4d49-86b6-678cc6f61bce"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "1f378ff1-30ff-4990-9f0c-24fcbd6f6702"], ["name", "review"], ["created_at", "2018-10-18 04:12:43.282166"], ["updated_at", "2018-10-18 04:12:43.282166"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1f378ff1-30ff-4990-9f0c-24fcbd6f6702"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"1f378ff1-30ff-4990-9f0c-24fcbd6f6702", "app_uid"=>"7b607606-fefc-4d49-86b6-678cc6f61bce"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b29673c5-5b50-466b-b738-ec94eb2356f1"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: b1fb0d44-177b-489a-8e4b-f57f73356e32\nstage_uid: 1f378ff1-30ff-4990-9f0c-24fcbd6f6702\napp_uid: 7b607606-fefc-4d49-86b6-678cc6f61bce\n"], ["created_at", "2018-10-18 04:12:43.285020"], ["updated_at", "2018-10-18 04:12:43.285020"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7b607606-fefc-4d49-86b6-678cc6f61bce"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1f378ff1-30ff-4990-9f0c-24fcbd6f6702"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "b1fb0d44-177b-489a-8e4b-f57f73356e32"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:12:43.288169"], ["updated_at", "2018-10-18 04:12:43.288169"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"7b607606-fefc-4d49-86b6-678cc6f61bce"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ee6e4a00-d5d2-4cb3-9398-0e38372c321d"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: c0e50a94-81e5-42f7-ba5b-83861ad36b94\napp_uid: 7b607606-fefc-4d49-86b6-678cc6f61bce\n"], ["created_at", "2018-10-18 04:12:43.291754"], ["updated_at", "2018-10-18 04:12:43.291754"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7b607606-fefc-4d49-86b6-678cc6f61bce"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "c0e50a94-81e5-42f7-ba5b-83861ad36b94"], ["name", "staging"], ["created_at", "2018-10-18 04:12:43.293974"], ["updated_at", "2018-10-18 04:12:43.293974"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "c0e50a94-81e5-42f7-ba5b-83861ad36b94"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"c0e50a94-81e5-42f7-ba5b-83861ad36b94", "app_uid"=>"7b607606-fefc-4d49-86b6-678cc6f61bce"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cdcc19ea-35a7-46aa-a9ee-fd9b38841bed"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 385b3a93-4c8b-4337-9d81-d768e35b3cc4\nstage_uid: c0e50a94-81e5-42f7-ba5b-83861ad36b94\napp_uid: 7b607606-fefc-4d49-86b6-678cc6f61bce\n"], ["created_at", "2018-10-18 04:12:43.296818"], ["updated_at", "2018-10-18 04:12:43.296818"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7b607606-fefc-4d49-86b6-678cc6f61bce"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "c0e50a94-81e5-42f7-ba5b-83861ad36b94"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "385b3a93-4c8b-4337-9d81-d768e35b3cc4"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:12:43.300368"], ["updated_at", "2018-10-18 04:12:43.300368"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 36ms (ActiveRecord: 3.4ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:12:43 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:12:43 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"7b607606-fefc-4d49-86b6-678cc6f61bce"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "588ac683-f888-4dc3-b853-692bdf3886a6"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 7b607606-fefc-4d49-86b6-678cc6f61bce\n"], ["created_at", "2018-10-18 04:12:43.319173"], ["updated_at", "2018-10-18 04:12:43.319173"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7b607606-fefc-4d49-86b6-678cc6f61bce"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:12:43 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "330afa21-1487-46db-8b2a-d89cabb343e1"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 533db77a-74c5-4c8f-b571-5423fd8ea4a8\n"], ["created_at", "2018-10-18 04:12:43.324926"], ["updated_at", "2018-10-18 04:12:43.324926"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "533db77a-74c5-4c8f-b571-5423fd8ea4a8"], ["name", "test"], ["created_at", "2018-10-18 04:12:43.327483"], ["updated_at", "2018-10-18 04:12:43.327483"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"533db77a-74c5-4c8f-b571-5423fd8ea4a8"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0956efa6-e5e7-45b9-bb12-fbe9236117dc"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 834600d7-eb72-40fa-a1ed-b55704dea816\napp_uid: 533db77a-74c5-4c8f-b571-5423fd8ea4a8\n"], ["created_at", "2018-10-18 04:12:43.329264"], ["updated_at", "2018-10-18 04:12:43.329264"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "533db77a-74c5-4c8f-b571-5423fd8ea4a8"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "834600d7-eb72-40fa-a1ed-b55704dea816"], ["name", "review"], ["created_at", "2018-10-18 04:12:43.331718"], ["updated_at", "2018-10-18 04:12:43.331718"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "834600d7-eb72-40fa-a1ed-b55704dea816"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"834600d7-eb72-40fa-a1ed-b55704dea816", "app_uid"=>"533db77a-74c5-4c8f-b571-5423fd8ea4a8"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "33245b99-36ff-46c1-932f-9baa2761f9bd"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 0a213a5e-8cb7-425a-8f50-753d439248a0\nstage_uid: 834600d7-eb72-40fa-a1ed-b55704dea816\napp_uid: 533db77a-74c5-4c8f-b571-5423fd8ea4a8\n"], ["created_at", "2018-10-18 04:12:43.334433"], ["updated_at", "2018-10-18 04:12:43.334433"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "533db77a-74c5-4c8f-b571-5423fd8ea4a8"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "834600d7-eb72-40fa-a1ed-b55704dea816"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "0a213a5e-8cb7-425a-8f50-753d439248a0"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:12:43.337720"], ["updated_at", "2018-10-18 04:12:43.337720"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"533db77a-74c5-4c8f-b571-5423fd8ea4a8"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "367d71a0-2638-4e70-a685-ca9155630c00"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: dc2c931b-108c-4bc0-b96f-f29f984d093a\napp_uid: 533db77a-74c5-4c8f-b571-5423fd8ea4a8\n"], ["created_at", "2018-10-18 04:12:43.341035"], ["updated_at", "2018-10-18 04:12:43.341035"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "533db77a-74c5-4c8f-b571-5423fd8ea4a8"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "dc2c931b-108c-4bc0-b96f-f29f984d093a"], ["name", "staging"], ["created_at", "2018-10-18 04:12:43.343499"], ["updated_at", "2018-10-18 04:12:43.343499"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dc2c931b-108c-4bc0-b96f-f29f984d093a"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"dc2c931b-108c-4bc0-b96f-f29f984d093a", "app_uid"=>"533db77a-74c5-4c8f-b571-5423fd8ea4a8"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d0d72f77-1e3d-4b7d-ab6d-e775aae67aaa"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: abc1fb82-c8fc-40e2-a04d-6a7a6e44795b\nstage_uid: dc2c931b-108c-4bc0-b96f-f29f984d093a\napp_uid: 533db77a-74c5-4c8f-b571-5423fd8ea4a8\n"], ["created_at", "2018-10-18 04:12:43.346076"], ["updated_at", "2018-10-18 04:12:43.346076"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "533db77a-74c5-4c8f-b571-5423fd8ea4a8"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dc2c931b-108c-4bc0-b96f-f29f984d093a"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "abc1fb82-c8fc-40e2-a04d-6a7a6e44795b"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:12:43.348675"], ["updated_at", "2018-10-18 04:12:43.348675"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 28ms (ActiveRecord: 3.0ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:12:43 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"533db77a-74c5-4c8f-b571-5423fd8ea4a8", :stage_uid=>"834600d7-eb72-40fa-a1ed-b55704dea816"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d2706cd7-df71-4631-9df5-d3e18b5c59a7"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: 533db77a-74c5-4c8f-b571-5423fd8ea4a8\nstage_uid: 834600d7-eb72-40fa-a1ed-b55704dea816\nbuild_uid: 9077e2d0-e2be-472e-bf53-76ebe963ae7f\n"], ["created_at", "2018-10-18 04:12:43.354597"], ["updated_at", "2018-10-18 04:12:43.354597"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "533db77a-74c5-4c8f-b571-5423fd8ea4a8"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "834600d7-eb72-40fa-a1ed-b55704dea816"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "9077e2d0-e2be-472e-bf53-76ebe963ae7f"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:12:43.358208"], ["updated_at", "2018-10-18 04:12:43.358208"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.7ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:12:43 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"9077e2d0-e2be-472e-bf53-76ebe963ae7f"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5201a0b4-5581-459d-929e-e3bce9e4a65e"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 9077e2d0-e2be-472e-bf53-76ebe963ae7f\nrelease_uid: 37a872ec-19d6-446d-9b0e-02eb6beb2f4f\n"], ["created_at", "2018-10-18 04:12:43.362342"], ["updated_at", "2018-10-18 04:12:43.362342"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "9077e2d0-e2be-472e-bf53-76ebe963ae7f"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "37a872ec-19d6-446d-9b0e-02eb6beb2f4f"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:12:43.364634"], ["updated_at", "2018-10-18 04:12:43.364634"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 9b7f46da-fa3c-4f0b-a002-a01dc9c80476) to Async(default) with arguments: "5201a0b4-5581-459d-929e-e3bce9e4a65e"
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476] Performing ReleaseJob (Job ID: 9b7f46da-fa3c-4f0b-a002-a01dc9c80476) from Async(default) with arguments: "5201a0b4-5581-459d-929e-e3bce9e4a65e"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "5201a0b4-5581-459d-929e-e3bce9e4a65e"], ["LIMIT", 1]]
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:12:43 -0700
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mBuild Load (0.7ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "9077e2d0-e2be-472e-bf53-76ebe963ae7f"], ["LIMIT", 1]]
Processing by ReleasesController#promote as HTML
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476] Executing command Releases::StatusCommand: {:release_uid=>"37a872ec-19d6-446d-9b0e-02eb6beb2f4f", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ed2f43ac-3dec-48e2-914e-aa48dab09d22"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 37a872ec-19d6-446d-9b0e-02eb6beb2f4f\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:12:43.372551"], ["updated_at", "2018-10-18 04:12:43.372551"]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "37a872ec-19d6-446d-9b0e-02eb6beb2f4f"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:12:43.375985"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c690c88e-6cb7-4b02-bb75-d0275d4d5394"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 37a872ec-19d6-446d-9b0e-02eb6beb2f4f\ncluster_uid: 0a213a5e-8cb7-425a-8f50-753d439248a0\ndeploy_uid: 4487d021-465a-40b5-b965-c2d8f47b4d49\n"], ["created_at", "2018-10-18 04:12:43.380002"], ["updated_at", "2018-10-18 04:12:43.380002"]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "37a872ec-19d6-446d-9b0e-02eb6beb2f4f"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "0a213a5e-8cb7-425a-8f50-753d439248a0"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "4487d021-465a-40b5-b965-c2d8f47b4d49"], ["status", "PENDING"], ["created_at", "2018-10-18 04:12:43.383809"], ["updated_at", "2018-10-18 04:12:43.383809"]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476] Executing command Releases::StatusCommand: {:release_uid=>"37a872ec-19d6-446d-9b0e-02eb6beb2f4f", :cluster_uid=>"0a213a5e-8cb7-425a-8f50-753d439248a0", :status=>"PENDING", :error=>nil}
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"9077e2d0-e2be-472e-bf53-76ebe963ae7f", :target_stage_uid=>"dc2c931b-108c-4bc0-b96f-f29f984d093a"}
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d272bb4b-992a-40b7-836b-9c3dedf760bf"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 37a872ec-19d6-446d-9b0e-02eb6beb2f4f\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:12:43.386448"], ["updated_at", "2018-10-18 04:12:43.386448"]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "37a872ec-19d6-446d-9b0e-02eb6beb2f4f"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e60b48bf-b75a-4f9f-a991-4ebd8c4e5d85"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: 9077e2d0-e2be-472e-bf53-76ebe963ae7f\ntarget_stage_uid: dc2c931b-108c-4bc0-b96f-f29f984d093a\nbuild_uid: 24d46de2-7e4c-4025-8659-b6e13b89e96d\n"], ["created_at", "2018-10-18 04:12:43.391031"], ["updated_at", "2018-10-18 04:12:43.391031"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "9077e2d0-e2be-472e-bf53-76ebe963ae7f"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dc2c931b-108c-4bc0-b96f-f29f984d093a"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:12:43.395830"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "24d46de2-7e4c-4025-8659-b6e13b89e96d"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:12:43.397784"], ["updated_at", "2018-10-18 04:12:43.397784"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 28ms (ActiveRecord: 1.3ms)
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:12:43 -0700
Processing by ReleasesController#remove as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"37a872ec-19d6-446d-9b0e-02eb6beb2f4f"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af2057aa-d7c6-4b61-ad38-b87aa433dc47"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: 37a872ec-19d6-446d-9b0e-02eb6beb2f4f\nrelease_uid: ac347edb-a3d1-4fea-859b-9feb5da87750\n"], ["created_at", "2018-10-18 04:12:43.404153"], ["updated_at", "2018-10-18 04:12:43.404153"]]
  [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "37a872ec-19d6-446d-9b0e-02eb6beb2f4f"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ac347edb-a3d1-4fea-859b-9feb5da87750"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:12:43.406913"], ["updated_at", "2018-10-18 04:12:43.406913"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: ab623ed1-3325-4baf-ab11-dee5a39d0f42) to Async(default) with arguments: "af2057aa-d7c6-4b61-ad38-b87aa433dc47"
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42] Performing ReleaseRemoveJob (Job ID: ab623ed1-3325-4baf-ab11-dee5a39d0f42) from Async(default) with arguments: "af2057aa-d7c6-4b61-ad38-b87aa433dc47"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 9ms (ActiveRecord: 0.8ms)
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "af2057aa-d7c6-4b61-ad38-b87aa433dc47"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:12:43 -0700
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mRelease Load (0.7ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "37a872ec-19d6-446d-9b0e-02eb6beb2f4f"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42] Executing command Releases::StatusCommand: {:release_uid=>"ac347edb-a3d1-4fea-859b-9feb5da87750", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "58fd315f-fb0a-4e37-ac6c-ae32ddfca334"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ac347edb-a3d1-4fea-859b-9feb5da87750\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:12:43.413323"], ["updated_at", "2018-10-18 04:12:43.413323"]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ac347edb-a3d1-4fea-859b-9feb5da87750"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:12:43.415749"], ["id", 980190964]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b8c523f3-9563-4caf-90b5-f1073bc0d2a1"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ac347edb-a3d1-4fea-859b-9feb5da87750\ncluster_uid: 0a213a5e-8cb7-425a-8f50-753d439248a0\ndeploy_uid: 250899be-eb55-4e02-a2d2-b5187cad0665\n"], ["created_at", "2018-10-18 04:12:43.420137"], ["updated_at", "2018-10-18 04:12:43.420137"]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ac347edb-a3d1-4fea-859b-9feb5da87750"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "0a213a5e-8cb7-425a-8f50-753d439248a0"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190963], ["uid", "250899be-eb55-4e02-a2d2-b5187cad0665"], ["status", "PENDING"], ["created_at", "2018-10-18 04:12:43.423401"], ["updated_at", "2018-10-18 04:12:43.423401"]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42] Executing command Releases::StatusCommand: {:release_uid=>"ac347edb-a3d1-4fea-859b-9feb5da87750", :cluster_uid=>"0a213a5e-8cb7-425a-8f50-753d439248a0", :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ae01523b-875e-43c8-92e5-1bb37ec6ec0b"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ac347edb-a3d1-4fea-859b-9feb5da87750\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:12:43.425571"], ["updated_at", "2018-10-18 04:12:43.425571"]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ac347edb-a3d1-4fea-859b-9feb5da87750"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "REMOVED"], ["updated_at", "2018-10-18 04:12:43.427885"], ["id", 980190964]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42] Executing command Releases::StatusCommand: {:release_uid=>"ac347edb-a3d1-4fea-859b-9feb5da87750", :cluster_uid=>nil, :status=>"REMOVED", :error=>nil}
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "06001067-fed4-4162-ad02-3d68997bb8f1"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ac347edb-a3d1-4fea-859b-9feb5da87750\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:12:43.430044"], ["updated_at", "2018-10-18 04:12:43.430044"]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ac347edb-a3d1-4fea-859b-9feb5da87750"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ab623ed1-3325-4baf-ab11-dee5a39d0f42] Performed ReleaseRemoveJob (Job ID: ab623ed1-3325-4baf-ab11-dee5a39d0f42) from Async(default) in 24.43ms
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
Completed 200 OK in 33ms (Views: 0.3ms | ActiveRecord: 1.7ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [9b7f46da-fa3c-4f0b-a002-a01dc9c80476] Performed ReleaseJob (Job ID: 9b7f46da-fa3c-4f0b-a002-a01dc9c80476) from Async(default) in 79.02ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:15:34.407267', '2018-10-18 04:15:34.407267')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:15:34.409508', '2018-10-18 04:15:34.409508')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:15:34.411034', '2018-10-18 04:15:34.411034', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:15:34.412472', '2018-10-18 04:15:34.412472')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:15:34.413857', '2018-10-18 04:15:34.413857', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ac38e783-2223-4631-b36d-f19c7c10067c"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 29db2c99-27d9-434e-9360-750d7e33d900\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:15:34.439338"], ["updated_at", "2018-10-18 04:15:34.439338"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "29db2c99-27d9-434e-9360-750d7e33d900"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:15:34.446578"], ["updated_at", "2018-10-18 04:15:34.446578"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8fa3de41-0495-43e6-af82-840a263362d2"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: c1a63fe8-a925-4684-a9d7-46842f8c2988\n"], ["created_at", "2018-10-18 04:15:34.451236"], ["updated_at", "2018-10-18 04:15:34.451236"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "c1a63fe8-a925-4684-a9d7-46842f8c2988"], ["name", "test2"], ["created_at", "2018-10-18 04:15:34.458620"], ["updated_at", "2018-10-18 04:15:34.458620"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "02de39df-f91e-44f9-927f-cd0619766974"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:15:34.460741"], ["updated_at", "2018-10-18 04:15:34.460741"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "01905b66-563b-4bed-a27e-abd2290df72c"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 2cb88a7c-77a6-4383-815e-0ab4e86e0323\n"], ["created_at", "2018-10-18 04:15:34.465225"], ["updated_at", "2018-10-18 04:15:34.465225"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "2cb88a7c-77a6-4383-815e-0ab4e86e0323"], ["name", "test2"], ["created_at", "2018-10-18 04:15:34.468253"], ["updated_at", "2018-10-18 04:15:34.468253"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "19c4c37f-9679-4a64-93a6-195e8dfabc03"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:15:34.470611"], ["updated_at", "2018-10-18 04:15:34.470611"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f38628e7-c291-4e8e-82ae-91ebcd7b59cc"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:15:34.475944"], ["updated_at", "2018-10-18 04:15:34.475944"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:15:34.479295"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "44436a0d-fe08-4a9e-85f1-c8601247790a"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:15:34.482511"], ["updated_at", "2018-10-18 04:15:34.482511"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:15:34.485012"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e0eb65c1-375f-4f8e-b4fc-bf0701397b00"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 0b9cef8b-6fd4-4556-91d8-917509596fd7\n"], ["created_at", "2018-10-18 04:15:34.487632"], ["updated_at", "2018-10-18 04:15:34.487632"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "0b9cef8b-6fd4-4556-91d8-917509596fd7"], ["name", "test"], ["created_at", "2018-10-18 04:15:34.490586"], ["updated_at", "2018-10-18 04:15:34.490586"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7c3d64e4-5ffa-4eda-a597-1363cb893e37"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: d60ce15c-cfe8-4e55-bc17-084a064ec902\n"], ["created_at", "2018-10-18 04:15:34.492967"], ["updated_at", "2018-10-18 04:15:34.492967"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "d60ce15c-cfe8-4e55-bc17-084a064ec902"], ["name", "test"], ["created_at", "2018-10-18 04:15:34.495232"], ["updated_at", "2018-10-18 04:15:34.495232"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0ec32e33-16d7-408c-bc30-36cf8744d73c"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: b9a8b84f-6ca1-4cbb-aeac-852750fd0ec8\n"], ["created_at", "2018-10-18 04:15:34.498087"], ["updated_at", "2018-10-18 04:15:34.498087"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b9a8b84f-6ca1-4cbb-aeac-852750fd0ec8"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:15:34.504522"], ["updated_at", "2018-10-18 04:15:34.504522"]]
[ActiveJob] [ReleaseJob] [3ccf0b75-24d4-430a-86ca-4c596250af05] Performing ReleaseJob (Job ID: 3ccf0b75-24d4-430a-86ca-4c596250af05) from Async(default) with arguments: "0ec32e33-16d7-408c-bc30-36cf8744d73c"
[ActiveJob] Enqueued ReleaseJob (Job ID: 3ccf0b75-24d4-430a-86ca-4c596250af05) to Async(default) with arguments: "0ec32e33-16d7-408c-bc30-36cf8744d73c"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "21b580e0-4870-4273-9a33-62931379f5ac"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 149b1176-8618-4063-9d99-0c92d54b2cda\n"], ["created_at", "2018-10-18 04:15:34.512537"], ["updated_at", "2018-10-18 04:15:34.512537"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "149b1176-8618-4063-9d99-0c92d54b2cda"], ["status", "PENDING"], ["created_at", "2018-10-18 04:15:34.526413"], ["updated_at", "2018-10-18 04:15:34.526413"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [3ccf0b75-24d4-430a-86ca-4c596250af05]   [1m[36mEvent Load (0.4ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "0ec32e33-16d7-408c-bc30-36cf8744d73c"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [3ccf0b75-24d4-430a-86ca-4c596250af05] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [3ccf0b75-24d4-430a-86ca-4c596250af05] Error performing ReleaseJob (Job ID: 3ccf0b75-24d4-430a-86ca-4c596250af05) from Async(default) in 23.8ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:15:34 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cd574f51-7424-487c-8f42-091e46753775"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 1291befe-d9aa-4574-9a36-4a3be93f61f6\n"], ["created_at", "2018-10-18 04:15:34.543759"], ["updated_at", "2018-10-18 04:15:34.543759"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "1291befe-d9aa-4574-9a36-4a3be93f61f6"], ["name", "test"], ["created_at", "2018-10-18 04:15:34.546140"], ["updated_at", "2018-10-18 04:15:34.546140"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"1291befe-d9aa-4574-9a36-4a3be93f61f6"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fad2d196-0c0c-4aeb-a15f-39ad9ec1528f"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 3007850c-c2b0-4ec0-8175-e6131bf84915\napp_uid: 1291befe-d9aa-4574-9a36-4a3be93f61f6\n"], ["created_at", "2018-10-18 04:15:34.548644"], ["updated_at", "2018-10-18 04:15:34.548644"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "1291befe-d9aa-4574-9a36-4a3be93f61f6"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "3007850c-c2b0-4ec0-8175-e6131bf84915"], ["name", "review"], ["created_at", "2018-10-18 04:15:34.551471"], ["updated_at", "2018-10-18 04:15:34.551471"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "3007850c-c2b0-4ec0-8175-e6131bf84915"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"3007850c-c2b0-4ec0-8175-e6131bf84915", "app_uid"=>"1291befe-d9aa-4574-9a36-4a3be93f61f6"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ea16d85e-560b-4350-af36-253e39fcf7d1"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 297c9b53-ad6b-4197-90de-0ec909682c1c\nstage_uid: 3007850c-c2b0-4ec0-8175-e6131bf84915\napp_uid: 1291befe-d9aa-4574-9a36-4a3be93f61f6\n"], ["created_at", "2018-10-18 04:15:34.554266"], ["updated_at", "2018-10-18 04:15:34.554266"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "1291befe-d9aa-4574-9a36-4a3be93f61f6"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "3007850c-c2b0-4ec0-8175-e6131bf84915"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "297c9b53-ad6b-4197-90de-0ec909682c1c"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:15:34.557225"], ["updated_at", "2018-10-18 04:15:34.557225"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"1291befe-d9aa-4574-9a36-4a3be93f61f6"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "44a3bd66-736a-4541-99f7-7c5b2e62dbbb"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: f620d20c-2dbd-4941-ba8e-e571c6747585\napp_uid: 1291befe-d9aa-4574-9a36-4a3be93f61f6\n"], ["created_at", "2018-10-18 04:15:34.561076"], ["updated_at", "2018-10-18 04:15:34.561076"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "1291befe-d9aa-4574-9a36-4a3be93f61f6"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "f620d20c-2dbd-4941-ba8e-e571c6747585"], ["name", "staging"], ["created_at", "2018-10-18 04:15:34.563385"], ["updated_at", "2018-10-18 04:15:34.563385"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "f620d20c-2dbd-4941-ba8e-e571c6747585"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"f620d20c-2dbd-4941-ba8e-e571c6747585", "app_uid"=>"1291befe-d9aa-4574-9a36-4a3be93f61f6"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5a44db97-918b-4937-b4f2-58fbfbc49c61"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: a932438e-98ed-400c-a7dc-e61fa1ec65c7\nstage_uid: f620d20c-2dbd-4941-ba8e-e571c6747585\napp_uid: 1291befe-d9aa-4574-9a36-4a3be93f61f6\n"], ["created_at", "2018-10-18 04:15:34.565915"], ["updated_at", "2018-10-18 04:15:34.565915"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "1291befe-d9aa-4574-9a36-4a3be93f61f6"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "f620d20c-2dbd-4941-ba8e-e571c6747585"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "a932438e-98ed-400c-a7dc-e61fa1ec65c7"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:15:34.568589"], ["updated_at", "2018-10-18 04:15:34.568589"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 35ms (ActiveRecord: 3.3ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:15:34 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 12ms (Views: 0.4ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:15:34 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"1291befe-d9aa-4574-9a36-4a3be93f61f6"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2e49c376-aae3-42fe-9276-6ca47a8b8bc5"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 1291befe-d9aa-4574-9a36-4a3be93f61f6\n"], ["created_at", "2018-10-18 04:15:34.588519"], ["updated_at", "2018-10-18 04:15:34.588519"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "1291befe-d9aa-4574-9a36-4a3be93f61f6"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:15:34 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "29490fad-10e2-4f0c-9917-f5f992df56ee"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 454184a1-deb5-490e-abca-728862a0ae3c\n"], ["created_at", "2018-10-18 04:15:34.595772"], ["updated_at", "2018-10-18 04:15:34.595772"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "454184a1-deb5-490e-abca-728862a0ae3c"], ["name", "test"], ["created_at", "2018-10-18 04:15:34.598543"], ["updated_at", "2018-10-18 04:15:34.598543"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"454184a1-deb5-490e-abca-728862a0ae3c"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "92ed7be6-0686-4709-8af8-58c9c3a6b442"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 7c20ca37-e51d-4b87-b184-c6c8a30b776c\napp_uid: 454184a1-deb5-490e-abca-728862a0ae3c\n"], ["created_at", "2018-10-18 04:15:34.600849"], ["updated_at", "2018-10-18 04:15:34.600849"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "454184a1-deb5-490e-abca-728862a0ae3c"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "7c20ca37-e51d-4b87-b184-c6c8a30b776c"], ["name", "review"], ["created_at", "2018-10-18 04:15:34.603704"], ["updated_at", "2018-10-18 04:15:34.603704"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "7c20ca37-e51d-4b87-b184-c6c8a30b776c"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"7c20ca37-e51d-4b87-b184-c6c8a30b776c", "app_uid"=>"454184a1-deb5-490e-abca-728862a0ae3c"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d9392779-badb-44ad-a3ad-a1a7df4b4e91"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: c88344fd-1310-4eda-a925-f48a33e6c380\nstage_uid: 7c20ca37-e51d-4b87-b184-c6c8a30b776c\napp_uid: 454184a1-deb5-490e-abca-728862a0ae3c\n"], ["created_at", "2018-10-18 04:15:34.607080"], ["updated_at", "2018-10-18 04:15:34.607080"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "454184a1-deb5-490e-abca-728862a0ae3c"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "7c20ca37-e51d-4b87-b184-c6c8a30b776c"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "c88344fd-1310-4eda-a925-f48a33e6c380"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:15:34.610288"], ["updated_at", "2018-10-18 04:15:34.610288"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"454184a1-deb5-490e-abca-728862a0ae3c"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "69a1a405-7188-4132-a505-6fad4b8e76d4"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 9ce85330-c563-42a2-960b-f211fe537af3\napp_uid: 454184a1-deb5-490e-abca-728862a0ae3c\n"], ["created_at", "2018-10-18 04:15:34.614351"], ["updated_at", "2018-10-18 04:15:34.614351"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "454184a1-deb5-490e-abca-728862a0ae3c"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "9ce85330-c563-42a2-960b-f211fe537af3"], ["name", "staging"], ["created_at", "2018-10-18 04:15:34.617329"], ["updated_at", "2018-10-18 04:15:34.617329"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9ce85330-c563-42a2-960b-f211fe537af3"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"9ce85330-c563-42a2-960b-f211fe537af3", "app_uid"=>"454184a1-deb5-490e-abca-728862a0ae3c"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d7bf2bf6-454e-4c2c-a538-e00e72f16880"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 2d385725-ef26-457c-a156-7cd643f328e0\nstage_uid: 9ce85330-c563-42a2-960b-f211fe537af3\napp_uid: 454184a1-deb5-490e-abca-728862a0ae3c\n"], ["created_at", "2018-10-18 04:15:34.620442"], ["updated_at", "2018-10-18 04:15:34.620442"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "454184a1-deb5-490e-abca-728862a0ae3c"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9ce85330-c563-42a2-960b-f211fe537af3"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "2d385725-ef26-457c-a156-7cd643f328e0"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:15:34.624186"], ["updated_at", "2018-10-18 04:15:34.624186"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 35ms (ActiveRecord: 3.5ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:15:34 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"454184a1-deb5-490e-abca-728862a0ae3c", :stage_uid=>"7c20ca37-e51d-4b87-b184-c6c8a30b776c"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "888d8be6-fcd4-4ebc-841b-216561828d16"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: 454184a1-deb5-490e-abca-728862a0ae3c\nstage_uid: 7c20ca37-e51d-4b87-b184-c6c8a30b776c\nbuild_uid: 84016f03-2a3a-4569-be9b-768ba442f71f\n"], ["created_at", "2018-10-18 04:15:34.632221"], ["updated_at", "2018-10-18 04:15:34.632221"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "454184a1-deb5-490e-abca-728862a0ae3c"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "7c20ca37-e51d-4b87-b184-c6c8a30b776c"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "84016f03-2a3a-4569-be9b-768ba442f71f"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:15:34.636539"], ["updated_at", "2018-10-18 04:15:34.636539"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 8ms (ActiveRecord: 0.8ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:15:34 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"84016f03-2a3a-4569-be9b-768ba442f71f"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bb80d8b9-230b-4dba-b0b7-84da45124a3b"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 84016f03-2a3a-4569-be9b-768ba442f71f\nrelease_uid: c45359b7-2f33-454a-bc4f-ae8082ff6130\n"], ["created_at", "2018-10-18 04:15:34.641995"], ["updated_at", "2018-10-18 04:15:34.641995"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "84016f03-2a3a-4569-be9b-768ba442f71f"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c45359b7-2f33-454a-bc4f-ae8082ff6130"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:15:34.644305"], ["updated_at", "2018-10-18 04:15:34.644305"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 0a550a94-e4e3-4b31-ad30-d448c805ed79) to Async(default) with arguments: "bb80d8b9-230b-4dba-b0b7-84da45124a3b"
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79] Performing ReleaseJob (Job ID: 0a550a94-e4e3-4b31-ad30-d448c805ed79) from Async(default) with arguments: "bb80d8b9-230b-4dba-b0b7-84da45124a3b"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 7ms (ActiveRecord: 0.7ms)
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "bb80d8b9-230b-4dba-b0b7-84da45124a3b"], ["LIMIT", 1]]
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:15:34 -0700
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mBuild Load (0.8ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "84016f03-2a3a-4569-be9b-768ba442f71f"], ["LIMIT", 1]]
Processing by ReleasesController#promote as HTML
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79] Executing command Releases::StatusCommand: {:release_uid=>"c45359b7-2f33-454a-bc4f-ae8082ff6130", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8ae2522e-f4a3-429f-a99e-b7a4547de4c8"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: c45359b7-2f33-454a-bc4f-ae8082ff6130\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:15:34.652061"], ["updated_at", "2018-10-18 04:15:34.652061"]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "c45359b7-2f33-454a-bc4f-ae8082ff6130"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:15:34.654800"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7eff2328-5210-426f-955f-200cf808064a"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: c45359b7-2f33-454a-bc4f-ae8082ff6130\ncluster_uid: c88344fd-1310-4eda-a925-f48a33e6c380\ndeploy_uid: a79593c0-aeff-4d9d-8b64-458648d01f34\n"], ["created_at", "2018-10-18 04:15:34.658840"], ["updated_at", "2018-10-18 04:15:34.658840"]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "c45359b7-2f33-454a-bc4f-ae8082ff6130"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "c88344fd-1310-4eda-a925-f48a33e6c380"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "a79593c0-aeff-4d9d-8b64-458648d01f34"], ["status", "PENDING"], ["created_at", "2018-10-18 04:15:34.661258"], ["updated_at", "2018-10-18 04:15:34.661258"]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79] Executing command Releases::StatusCommand: {:release_uid=>"c45359b7-2f33-454a-bc4f-ae8082ff6130", :cluster_uid=>"c88344fd-1310-4eda-a925-f48a33e6c380", :status=>"PENDING", :error=>nil}
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"84016f03-2a3a-4569-be9b-768ba442f71f", :target_stage_uid=>"9ce85330-c563-42a2-960b-f211fe537af3"}
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1cab0bc2-b34f-4892-bc69-8b30e538d3dc"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: c45359b7-2f33-454a-bc4f-ae8082ff6130\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:15:34.663591"], ["updated_at", "2018-10-18 04:15:34.663591"]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "c45359b7-2f33-454a-bc4f-ae8082ff6130"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7fa7e0e0-9005-4332-a0da-a5835c26e4b7"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: 84016f03-2a3a-4569-be9b-768ba442f71f\ntarget_stage_uid: 9ce85330-c563-42a2-960b-f211fe537af3\nbuild_uid: ce31d3c8-b0f6-40cc-8c55-2fd38e763251\n"], ["created_at", "2018-10-18 04:15:34.666946"], ["updated_at", "2018-10-18 04:15:34.666946"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "84016f03-2a3a-4569-be9b-768ba442f71f"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "9ce85330-c563-42a2-960b-f211fe537af3"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:15:34.672328"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "ce31d3c8-b0f6-40cc-8c55-2fd38e763251"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:15:34.674337"], ["updated_at", "2018-10-18 04:15:34.674337"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 25ms (ActiveRecord: 1.3ms)
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:15:34 -0700
Processing by ReleasesController#remove as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"c45359b7-2f33-454a-bc4f-ae8082ff6130"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "022151d7-448c-47e5-9750-a13e85b1216f"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: c45359b7-2f33-454a-bc4f-ae8082ff6130\nrelease_uid: ffda4161-c791-4d8a-a4c4-14ae3e204dba\n"], ["created_at", "2018-10-18 04:15:34.681838"], ["updated_at", "2018-10-18 04:15:34.681838"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "c45359b7-2f33-454a-bc4f-ae8082ff6130"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ffda4161-c791-4d8a-a4c4-14ae3e204dba"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:15:34.685076"], ["updated_at", "2018-10-18 04:15:34.685076"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: 07719e1c-fb00-4528-b98b-a430c9d64c33) to Async(default) with arguments: "022151d7-448c-47e5-9750-a13e85b1216f"
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33] Performing ReleaseRemoveJob (Job ID: 07719e1c-fb00-4528-b98b-a430c9d64c33) from Async(default) with arguments: "022151d7-448c-47e5-9750-a13e85b1216f"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 11ms (ActiveRecord: 0.9ms)
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "022151d7-448c-47e5-9750-a13e85b1216f"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:15:34 -0700
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mRelease Load (0.7ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "c45359b7-2f33-454a-bc4f-ae8082ff6130"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33] Executing command Releases::StatusCommand: {:release_uid=>"ffda4161-c791-4d8a-a4c4-14ae3e204dba", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4c510e28-7e1d-49f1-a0c5-ae528a3ff04a"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ffda4161-c791-4d8a-a4c4-14ae3e204dba\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:15:34.692801"], ["updated_at", "2018-10-18 04:15:34.692801"]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ffda4161-c791-4d8a-a4c4-14ae3e204dba"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:15:34.695819"], ["id", 980190964]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e72765cb-fee2-4446-aa8d-11e25519212b"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ffda4161-c791-4d8a-a4c4-14ae3e204dba\ncluster_uid: c88344fd-1310-4eda-a925-f48a33e6c380\ndeploy_uid: e40a7689-369f-4221-aaf8-8e2bba825eac\n"], ["created_at", "2018-10-18 04:15:34.700341"], ["updated_at", "2018-10-18 04:15:34.700341"]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ffda4161-c791-4d8a-a4c4-14ae3e204dba"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "c88344fd-1310-4eda-a925-f48a33e6c380"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190963], ["uid", "e40a7689-369f-4221-aaf8-8e2bba825eac"], ["status", "PENDING"], ["created_at", "2018-10-18 04:15:34.702829"], ["updated_at", "2018-10-18 04:15:34.702829"]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33] Executing command Releases::StatusCommand: {:release_uid=>"ffda4161-c791-4d8a-a4c4-14ae3e204dba", :cluster_uid=>"c88344fd-1310-4eda-a925-f48a33e6c380", :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.3ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d9540c07-5b54-424d-9c04-223b91f341b5"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ffda4161-c791-4d8a-a4c4-14ae3e204dba\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:15:34.705469"], ["updated_at", "2018-10-18 04:15:34.705469"]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ffda4161-c791-4d8a-a4c4-14ae3e204dba"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "REMOVED"], ["updated_at", "2018-10-18 04:15:34.708013"], ["id", 980190964]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33] Executing command Releases::StatusCommand: {:release_uid=>"ffda4161-c791-4d8a-a4c4-14ae3e204dba", :cluster_uid=>nil, :status=>"REMOVED", :error=>nil}
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3f6e173a-8db8-482d-b853-b2ae83699399"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ffda4161-c791-4d8a-a4c4-14ae3e204dba\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:15:34.710351"], ["updated_at", "2018-10-18 04:15:34.710351"]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ffda4161-c791-4d8a-a4c4-14ae3e204dba"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [07719e1c-fb00-4528-b98b-a430c9d64c33] Performed ReleaseRemoveJob (Job ID: 07719e1c-fb00-4528-b98b-a430c9d64c33) from Async(default) in 26.33ms
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
Completed 200 OK in 37ms (Views: 0.4ms | ActiveRecord: 1.9ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [0a550a94-e4e3-4b31-ad30-d448c805ed79] Performed ReleaseJob (Job ID: 0a550a94-e4e3-4b31-ad30-d448c805ed79) from Async(default) in 82.84ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:15:53.213907', '2018-10-18 04:15:53.213907')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:15:53.216166', '2018-10-18 04:15:53.216166')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:15:53.217834', '2018-10-18 04:15:53.217834', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:15:53.219211', '2018-10-18 04:15:53.219211')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:15:53.220730', '2018-10-18 04:15:53.220730', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bef60f10-122d-46c5-a183-889e8b8b8ed2"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 0345348c-44ea-4be2-8efe-f40a8a0d808b\n"], ["created_at", "2018-10-18 04:15:53.240228"], ["updated_at", "2018-10-18 04:15:53.240228"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "0345348c-44ea-4be2-8efe-f40a8a0d808b"], ["status", "PENDING"], ["created_at", "2018-10-18 04:15:53.249624"], ["updated_at", "2018-10-18 04:15:53.249624"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a2cfe699-a011-41b7-9609-0b469b13aac9"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 36a666b8-3b52-421f-8f34-7065b3f07b02\n"], ["created_at", "2018-10-18 04:15:53.257976"], ["updated_at", "2018-10-18 04:15:53.257976"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "36a666b8-3b52-421f-8f34-7065b3f07b02"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:15:53.261222"], ["updated_at", "2018-10-18 04:15:53.261222"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 91a75ea3-f8c8-4752-9fcf-06717de50fb8) to Async(default) with arguments: "a2cfe699-a011-41b7-9609-0b469b13aac9"
[ActiveJob] [ReleaseJob] [91a75ea3-f8c8-4752-9fcf-06717de50fb8] Performing ReleaseJob (Job ID: 91a75ea3-f8c8-4752-9fcf-06717de50fb8) from Async(default) with arguments: "a2cfe699-a011-41b7-9609-0b469b13aac9"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7bb4d502-34ab-4d6c-a008-ac9e599fe685"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: af1b3989-284d-4108-b538-de0b227c1379\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:15:53.277990"], ["updated_at", "2018-10-18 04:15:53.277990"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "af1b3989-284d-4108-b538-de0b227c1379"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:15:53.284537"], ["updated_at", "2018-10-18 04:15:53.284537"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [91a75ea3-f8c8-4752-9fcf-06717de50fb8]   [1m[36mEvent Load (4.9ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "a2cfe699-a011-41b7-9609-0b469b13aac9"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.3ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [91a75ea3-f8c8-4752-9fcf-06717de50fb8] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [91a75ea3-f8c8-4752-9fcf-06717de50fb8] Error performing ReleaseJob (Job ID: 91a75ea3-f8c8-4752-9fcf-06717de50fb8) from Async(default) in 24.6ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fbb356bf-680c-45c2-adda-c14d19777a94"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:15:53.290045"], ["updated_at", "2018-10-18 04:15:53.290045"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a1cc5c9e-10ee-42bf-9183-ca301835f0c3"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 5e4ded32-f2b9-4d6a-9a7f-a069708dcfc4\n"], ["created_at", "2018-10-18 04:15:53.293867"], ["updated_at", "2018-10-18 04:15:53.293867"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "5e4ded32-f2b9-4d6a-9a7f-a069708dcfc4"], ["name", "test"], ["created_at", "2018-10-18 04:15:53.296223"], ["updated_at", "2018-10-18 04:15:53.296223"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9bb75ce0-9ff6-4c0d-84c2-2099a59c2610"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:15:53.298614"], ["updated_at", "2018-10-18 04:15:53.298614"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:15:53.300531"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "efaafc54-656e-44c0-8f1d-c5f50e849e31"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 3a7a9aca-b3e4-4f4e-8350-c7e6ce21ca4a\n"], ["created_at", "2018-10-18 04:15:53.304556"], ["updated_at", "2018-10-18 04:15:53.304556"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "3a7a9aca-b3e4-4f4e-8350-c7e6ce21ca4a"], ["name", "test2"], ["created_at", "2018-10-18 04:15:53.308551"], ["updated_at", "2018-10-18 04:15:53.308551"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "652bbd9d-d793-4c21-8971-a4fa2667f841"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 55f0b344-dcbb-4c01-ac50-2f46b4074c67\n"], ["created_at", "2018-10-18 04:15:53.311301"], ["updated_at", "2018-10-18 04:15:53.311301"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "55f0b344-dcbb-4c01-ac50-2f46b4074c67"], ["name", "test"], ["created_at", "2018-10-18 04:15:53.314197"], ["updated_at", "2018-10-18 04:15:53.314197"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1fb18266-9379-414c-b02d-2783f89cad38"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:15:53.315958"], ["updated_at", "2018-10-18 04:15:53.315958"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "336299a6-d974-4638-a1d0-9c1a5e4c4bb5"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 5713790d-0d85-48f5-ac42-62e15528de06\n"], ["created_at", "2018-10-18 04:15:53.319882"], ["updated_at", "2018-10-18 04:15:53.319882"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "5713790d-0d85-48f5-ac42-62e15528de06"], ["name", "test2"], ["created_at", "2018-10-18 04:15:53.322937"], ["updated_at", "2018-10-18 04:15:53.322937"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "292b2ef6-09a2-4dd6-9579-b64801665c15"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:15:53.330864"], ["updated_at", "2018-10-18 04:15:53.330864"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:15:53.334479"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2d3f08e9-a3a9-467b-a1fe-ed84404861fc"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 17c55377-a788-4a82-9647-0cadfe43c606\n"], ["created_at", "2018-10-18 04:15:53.349905"], ["updated_at", "2018-10-18 04:15:53.349905"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "17c55377-a788-4a82-9647-0cadfe43c606"], ["name", "test"], ["created_at", "2018-10-18 04:15:53.352606"], ["updated_at", "2018-10-18 04:15:53.352606"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"17c55377-a788-4a82-9647-0cadfe43c606"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6606f902-686f-4b98-a3ea-9b61f1a70c95"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 33a4f7c3-2eaa-4fbb-be1a-d80722e12c82\napp_uid: 17c55377-a788-4a82-9647-0cadfe43c606\n"], ["created_at", "2018-10-18 04:15:53.355167"], ["updated_at", "2018-10-18 04:15:53.355167"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "17c55377-a788-4a82-9647-0cadfe43c606"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "33a4f7c3-2eaa-4fbb-be1a-d80722e12c82"], ["name", "review"], ["created_at", "2018-10-18 04:15:53.357700"], ["updated_at", "2018-10-18 04:15:53.357700"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "33a4f7c3-2eaa-4fbb-be1a-d80722e12c82"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"33a4f7c3-2eaa-4fbb-be1a-d80722e12c82", "app_uid"=>"17c55377-a788-4a82-9647-0cadfe43c606"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b0f4c88c-731f-4a9c-abba-bf93d69b9272"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: be1c767b-c331-4a75-be73-c239ee309b80\nstage_uid: 33a4f7c3-2eaa-4fbb-be1a-d80722e12c82\napp_uid: 17c55377-a788-4a82-9647-0cadfe43c606\n"], ["created_at", "2018-10-18 04:15:53.360409"], ["updated_at", "2018-10-18 04:15:53.360409"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "17c55377-a788-4a82-9647-0cadfe43c606"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "33a4f7c3-2eaa-4fbb-be1a-d80722e12c82"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "be1c767b-c331-4a75-be73-c239ee309b80"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:15:53.363331"], ["updated_at", "2018-10-18 04:15:53.363331"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"17c55377-a788-4a82-9647-0cadfe43c606"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "19d1fcee-0220-4357-b56b-edd87b7a739f"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 65ce797d-26c2-4f3b-b8a4-f0bacaa762c1\napp_uid: 17c55377-a788-4a82-9647-0cadfe43c606\n"], ["created_at", "2018-10-18 04:15:53.367279"], ["updated_at", "2018-10-18 04:15:53.367279"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "17c55377-a788-4a82-9647-0cadfe43c606"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "65ce797d-26c2-4f3b-b8a4-f0bacaa762c1"], ["name", "staging"], ["created_at", "2018-10-18 04:15:53.369660"], ["updated_at", "2018-10-18 04:15:53.369660"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "65ce797d-26c2-4f3b-b8a4-f0bacaa762c1"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"65ce797d-26c2-4f3b-b8a4-f0bacaa762c1", "app_uid"=>"17c55377-a788-4a82-9647-0cadfe43c606"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af44d53c-0370-46e4-8ad4-e2fc6837f4d2"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: dc63a76a-dbd4-4a47-b9d7-12d981ec81ae\nstage_uid: 65ce797d-26c2-4f3b-b8a4-f0bacaa762c1\napp_uid: 17c55377-a788-4a82-9647-0cadfe43c606\n"], ["created_at", "2018-10-18 04:15:53.372175"], ["updated_at", "2018-10-18 04:15:53.372175"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "17c55377-a788-4a82-9647-0cadfe43c606"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "65ce797d-26c2-4f3b-b8a4-f0bacaa762c1"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "dc63a76a-dbd4-4a47-b9d7-12d981ec81ae"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:15:53.374822"], ["updated_at", "2018-10-18 04:15:53.374822"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 35ms (ActiveRecord: 3.3ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"17c55377-a788-4a82-9647-0cadfe43c606", :stage_uid=>"33a4f7c3-2eaa-4fbb-be1a-d80722e12c82"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8f447300-bda3-4bc9-8573-8e0814017a6f"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: 17c55377-a788-4a82-9647-0cadfe43c606\nstage_uid: 33a4f7c3-2eaa-4fbb-be1a-d80722e12c82\nbuild_uid: 2baa2d2d-575c-488a-8fdc-810ce6cd0d7d\n"], ["created_at", "2018-10-18 04:15:53.383553"], ["updated_at", "2018-10-18 04:15:53.383553"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "17c55377-a788-4a82-9647-0cadfe43c606"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "33a4f7c3-2eaa-4fbb-be1a-d80722e12c82"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "2baa2d2d-575c-488a-8fdc-810ce6cd0d7d"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:15:53.387237"], ["updated_at", "2018-10-18 04:15:53.387237"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 7ms (ActiveRecord: 0.7ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"2baa2d2d-575c-488a-8fdc-810ce6cd0d7d"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3a3e7062-f53f-40b1-babe-c9c82b87c766"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 2baa2d2d-575c-488a-8fdc-810ce6cd0d7d\nrelease_uid: 35f60598-c872-4efa-bf98-1f0791664622\n"], ["created_at", "2018-10-18 04:15:53.391473"], ["updated_at", "2018-10-18 04:15:53.391473"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "2baa2d2d-575c-488a-8fdc-810ce6cd0d7d"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "35f60598-c872-4efa-bf98-1f0791664622"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:15:53.393751"], ["updated_at", "2018-10-18 04:15:53.393751"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 3a805e72-6561-4fd9-96f3-97ac77207d4a) to Async(default) with arguments: "3a3e7062-f53f-40b1-babe-c9c82b87c766"
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a] Performing ReleaseJob (Job ID: 3a805e72-6561-4fd9-96f3-97ac77207d4a) from Async(default) with arguments: "3a3e7062-f53f-40b1-babe-c9c82b87c766"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "3a3e7062-f53f-40b1-babe-c9c82b87c766"], ["LIMIT", 1]]
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mBuild Load (0.7ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "2baa2d2d-575c-488a-8fdc-810ce6cd0d7d"], ["LIMIT", 1]]
Processing by ReleasesController#promote as HTML
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a] Executing command Releases::StatusCommand: {:release_uid=>"35f60598-c872-4efa-bf98-1f0791664622", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7a298148-645c-46a4-9afa-f671ab5c43ea"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 35f60598-c872-4efa-bf98-1f0791664622\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:15:53.400262"], ["updated_at", "2018-10-18 04:15:53.400262"]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "35f60598-c872-4efa-bf98-1f0791664622"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:15:53.402989"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b4ec3db4-f262-4b28-9052-fc2760c9a981"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 35f60598-c872-4efa-bf98-1f0791664622\ncluster_uid: be1c767b-c331-4a75-be73-c239ee309b80\ndeploy_uid: 9c2da118-8317-4fc0-9ffe-dde3633ea6f0\n"], ["created_at", "2018-10-18 04:15:53.406440"], ["updated_at", "2018-10-18 04:15:53.406440"]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "35f60598-c872-4efa-bf98-1f0791664622"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "be1c767b-c331-4a75-be73-c239ee309b80"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "9c2da118-8317-4fc0-9ffe-dde3633ea6f0"], ["status", "PENDING"], ["created_at", "2018-10-18 04:15:53.409103"], ["updated_at", "2018-10-18 04:15:53.409103"]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a] Executing command Releases::StatusCommand: {:release_uid=>"35f60598-c872-4efa-bf98-1f0791664622", :cluster_uid=>"be1c767b-c331-4a75-be73-c239ee309b80", :status=>"PENDING", :error=>nil}
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"2baa2d2d-575c-488a-8fdc-810ce6cd0d7d", :target_stage_uid=>"65ce797d-26c2-4f3b-b8a4-f0bacaa762c1"}
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f26c02fa-354e-4a33-9cc5-b19609859836"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 35f60598-c872-4efa-bf98-1f0791664622\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:15:53.411428"], ["updated_at", "2018-10-18 04:15:53.411428"]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "35f60598-c872-4efa-bf98-1f0791664622"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "64d9d591-5c01-4d8c-8473-d35224f08742"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: 2baa2d2d-575c-488a-8fdc-810ce6cd0d7d\ntarget_stage_uid: 65ce797d-26c2-4f3b-b8a4-f0bacaa762c1\nbuild_uid: d13f3471-e57c-4529-94b7-38fad6c986fc\n"], ["created_at", "2018-10-18 04:15:53.415113"], ["updated_at", "2018-10-18 04:15:53.415113"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "2baa2d2d-575c-488a-8fdc-810ce6cd0d7d"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "65ce797d-26c2-4f3b-b8a4-f0bacaa762c1"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:15:53.420218"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "d13f3471-e57c-4529-94b7-38fad6c986fc"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:15:53.422040"], ["updated_at", "2018-10-18 04:15:53.422040"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 24ms (ActiveRecord: 1.3ms)
Started POST "/api/v1/apps/test/staging/release?version=v1" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"staging"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 3 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"d13f3471-e57c-4529-94b7-38fad6c986fc"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4bca7e26-96f3-40bf-b34d-0d6c71b2de91"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: d13f3471-e57c-4529-94b7-38fad6c986fc\nrelease_uid: aa58439d-281f-48bc-bd28-253827fee741\n"], ["created_at", "2018-10-18 04:15:53.426161"], ["updated_at", "2018-10-18 04:15:53.426161"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d13f3471-e57c-4529-94b7-38fad6c986fc"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aa58439d-281f-48bc-bd28-253827fee741"], ["build_id", 3], ["status", "INITIAL"], ["created_at", "2018-10-18 04:15:53.428121"], ["updated_at", "2018-10-18 04:15:53.428121"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 56b8bdd3-2631-47a3-99df-19178dec9d1f) to Async(default) with arguments: "4bca7e26-96f3-40bf-b34d-0d6c71b2de91"
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f] Performing ReleaseJob (Job ID: 56b8bdd3-2631-47a3-99df-19178dec9d1f) from Async(default) with arguments: "4bca7e26-96f3-40bf-b34d-0d6c71b2de91"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "4bca7e26-96f3-40bf-b34d-0d6c71b2de91"], ["LIMIT", 1]]
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mBuild Load (0.7ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d13f3471-e57c-4529-94b7-38fad6c986fc"], ["LIMIT", 1]]
Processing by ReleasesController#remove as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f] Executing command Releases::StatusCommand: {:release_uid=>"aa58439d-281f-48bc-bd28-253827fee741", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "37db3c09-a92d-4996-a16c-a562b76f697d"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: aa58439d-281f-48bc-bd28-253827fee741\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:15:53.434328"], ["updated_at", "2018-10-18 04:15:53.434328"]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "aa58439d-281f-48bc-bd28-253827fee741"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:15:53.436873"], ["id", 980190964]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d37d2eb9-3734-4d19-8968-6e41b821264b"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: aa58439d-281f-48bc-bd28-253827fee741\ncluster_uid: dc63a76a-dbd4-4a47-b9d7-12d981ec81ae\ndeploy_uid: 920228aa-dc6e-4c83-8661-1d58d82b8897\n"], ["created_at", "2018-10-18 04:15:53.443332"], ["updated_at", "2018-10-18 04:15:53.443332"]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "aa58439d-281f-48bc-bd28-253827fee741"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "dc63a76a-dbd4-4a47-b9d7-12d981ec81ae"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190964], ["uid", "920228aa-dc6e-4c83-8661-1d58d82b8897"], ["status", "PENDING"], ["created_at", "2018-10-18 04:15:53.446338"], ["updated_at", "2018-10-18 04:15:53.446338"]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f] Executing command Releases::StatusCommand: {:release_uid=>"aa58439d-281f-48bc-bd28-253827fee741", :cluster_uid=>"dc63a76a-dbd4-4a47-b9d7-12d981ec81ae", :status=>"PENDING", :error=>nil}
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5db37450-23bc-41a9-ac93-aeea327b4beb"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: aa58439d-281f-48bc-bd28-253827fee741\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:15:53.448618"], ["updated_at", "2018-10-18 04:15:53.448618"]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "aa58439d-281f-48bc-bd28-253827fee741"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"35f60598-c872-4efa-bf98-1f0791664622"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "344f8653-dccd-45c4-9373-66583f92f099"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: 35f60598-c872-4efa-bf98-1f0791664622\nrelease_uid: 2932b1e8-a9d3-4008-af1a-ed10fac91b42\n"], ["created_at", "2018-10-18 04:15:53.452373"], ["updated_at", "2018-10-18 04:15:53.452373"]]
  [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "35f60598-c872-4efa-bf98-1f0791664622"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2932b1e8-a9d3-4008-af1a-ed10fac91b42"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:15:53.455256"], ["updated_at", "2018-10-18 04:15:53.455256"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: 54773dd5-80b7-40d3-aaa0-ce6414d08480) to Async(default) with arguments: "344f8653-dccd-45c4-9373-66583f92f099"
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480] Performing ReleaseRemoveJob (Job ID: 54773dd5-80b7-40d3-aaa0-ce6414d08480) from Async(default) with arguments: "344f8653-dccd-45c4-9373-66583f92f099"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 24ms (ActiveRecord: 0.9ms)
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "344f8653-dccd-45c4-9373-66583f92f099"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mRelease Load (0.8ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "35f60598-c872-4efa-bf98-1f0791664622"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480] Executing command Releases::StatusCommand: {:release_uid=>"2932b1e8-a9d3-4008-af1a-ed10fac91b42", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2f872a10-1fae-4063-b52d-edb52e6c11ad"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 2932b1e8-a9d3-4008-af1a-ed10fac91b42\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:15:53.462367"], ["updated_at", "2018-10-18 04:15:53.462367"]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "2932b1e8-a9d3-4008-af1a-ed10fac91b42"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:15:53.464833"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b8944977-7337-4a08-914b-78f213b46ba6"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 2932b1e8-a9d3-4008-af1a-ed10fac91b42\ncluster_uid: be1c767b-c331-4a75-be73-c239ee309b80\ndeploy_uid: 8cf52797-602f-47b6-a603-4d60115e2205\n"], ["created_at", "2018-10-18 04:15:53.468834"], ["updated_at", "2018-10-18 04:15:53.468834"]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "2932b1e8-a9d3-4008-af1a-ed10fac91b42"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "be1c767b-c331-4a75-be73-c239ee309b80"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190965], ["cluster_id", 980190963], ["uid", "8cf52797-602f-47b6-a603-4d60115e2205"], ["status", "PENDING"], ["created_at", "2018-10-18 04:15:53.471591"], ["updated_at", "2018-10-18 04:15:53.471591"]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480] Executing command Releases::StatusCommand: {:release_uid=>"2932b1e8-a9d3-4008-af1a-ed10fac91b42", :cluster_uid=>"be1c767b-c331-4a75-be73-c239ee309b80", :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "52e808f5-9956-4315-86ea-15834425ee79"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 2932b1e8-a9d3-4008-af1a-ed10fac91b42\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:15:53.473671"], ["updated_at", "2018-10-18 04:15:53.473671"]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "2932b1e8-a9d3-4008-af1a-ed10fac91b42"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "REMOVED"], ["updated_at", "2018-10-18 04:15:53.476060"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480] Executing command Releases::StatusCommand: {:release_uid=>"2932b1e8-a9d3-4008-af1a-ed10fac91b42", :cluster_uid=>nil, :status=>"REMOVED", :error=>nil}
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5f7e64f9-a93a-47e5-9004-3aaa1596e7b3"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 2932b1e8-a9d3-4008-af1a-ed10fac91b42\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:15:53.478118"], ["updated_at", "2018-10-18 04:15:53.478118"]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "2932b1e8-a9d3-4008-af1a-ed10fac91b42"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [54773dd5-80b7-40d3-aaa0-ce6414d08480] Performed ReleaseRemoveJob (Job ID: 54773dd5-80b7-40d3-aaa0-ce6414d08480) from Async(default) in 24.02ms
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 3) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
Completed 200 OK in 35ms (Views: 0.4ms | ActiveRecord: 1.9ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "96a8a477-5ba1-4869-8039-632b4f7372a5"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 239e7623-890d-41b1-bda0-d3d05e997771\n"], ["created_at", "2018-10-18 04:15:53.499072"], ["updated_at", "2018-10-18 04:15:53.499072"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "239e7623-890d-41b1-bda0-d3d05e997771"], ["name", "test"], ["created_at", "2018-10-18 04:15:53.501737"], ["updated_at", "2018-10-18 04:15:53.501737"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"239e7623-890d-41b1-bda0-d3d05e997771"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "63e88ee8-c450-435f-a952-3cc3be947fb4"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: aa30a684-70d3-46f7-99a7-25cd42d014b0\napp_uid: 239e7623-890d-41b1-bda0-d3d05e997771\n"], ["created_at", "2018-10-18 04:15:53.503666"], ["updated_at", "2018-10-18 04:15:53.503666"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "239e7623-890d-41b1-bda0-d3d05e997771"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "aa30a684-70d3-46f7-99a7-25cd42d014b0"], ["name", "review"], ["created_at", "2018-10-18 04:15:53.505897"], ["updated_at", "2018-10-18 04:15:53.505897"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "aa30a684-70d3-46f7-99a7-25cd42d014b0"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"aa30a684-70d3-46f7-99a7-25cd42d014b0", "app_uid"=>"239e7623-890d-41b1-bda0-d3d05e997771"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1550bc9c-f5df-4510-9a0d-6ddde6a02e86"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: b5c31370-4cb2-4936-9198-faa582f96732\nstage_uid: aa30a684-70d3-46f7-99a7-25cd42d014b0\napp_uid: 239e7623-890d-41b1-bda0-d3d05e997771\n"], ["created_at", "2018-10-18 04:15:53.508622"], ["updated_at", "2018-10-18 04:15:53.508622"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "239e7623-890d-41b1-bda0-d3d05e997771"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "aa30a684-70d3-46f7-99a7-25cd42d014b0"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "b5c31370-4cb2-4936-9198-faa582f96732"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:15:53.512011"], ["updated_at", "2018-10-18 04:15:53.512011"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"239e7623-890d-41b1-bda0-d3d05e997771"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5a859ee3-074b-44cc-bd24-a96361a47fcd"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: dafbc466-f635-4a13-9b44-567343beaa72\napp_uid: 239e7623-890d-41b1-bda0-d3d05e997771\n"], ["created_at", "2018-10-18 04:15:53.515303"], ["updated_at", "2018-10-18 04:15:53.515303"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "239e7623-890d-41b1-bda0-d3d05e997771"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "dafbc466-f635-4a13-9b44-567343beaa72"], ["name", "staging"], ["created_at", "2018-10-18 04:15:53.517693"], ["updated_at", "2018-10-18 04:15:53.517693"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dafbc466-f635-4a13-9b44-567343beaa72"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"dafbc466-f635-4a13-9b44-567343beaa72", "app_uid"=>"239e7623-890d-41b1-bda0-d3d05e997771"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "844e44f7-ce6e-4194-be63-dbd8564980a8"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 0f543384-bc74-4e64-bf57-fa9e3aad9e71\nstage_uid: dafbc466-f635-4a13-9b44-567343beaa72\napp_uid: 239e7623-890d-41b1-bda0-d3d05e997771\n"], ["created_at", "2018-10-18 04:15:53.520454"], ["updated_at", "2018-10-18 04:15:53.520454"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "239e7623-890d-41b1-bda0-d3d05e997771"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dafbc466-f635-4a13-9b44-567343beaa72"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "0f543384-bc74-4e64-bf57-fa9e3aad9e71"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:15:53.523583"], ["updated_at", "2018-10-18 04:15:53.523583"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 29ms (ActiveRecord: 3.1ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 0.8ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:15:53 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"239e7623-890d-41b1-bda0-d3d05e997771"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "338df5fd-746e-40c0-89ff-9f8eb25a4033"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 239e7623-890d-41b1-bda0-d3d05e997771\n"], ["created_at", "2018-10-18 04:15:53.537977"], ["updated_at", "2018-10-18 04:15:53.537977"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "239e7623-890d-41b1-bda0-d3d05e997771"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [3a805e72-6561-4fd9-96f3-97ac77207d4a] Performed ReleaseJob (Job ID: 3a805e72-6561-4fd9-96f3-97ac77207d4a) from Async(default) in 145.67ms
[ActiveJob] [ReleaseJob] [56b8bdd3-2631-47a3-99df-19178dec9d1f] Performed ReleaseJob (Job ID: 56b8bdd3-2631-47a3-99df-19178dec9d1f) from Async(default) in 111.59ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:16:34.685735', '2018-10-18 04:16:34.685735')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:16:34.687760', '2018-10-18 04:16:34.687760')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:16:34.689199', '2018-10-18 04:16:34.689199', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:16:34.690687', '2018-10-18 04:16:34.690687')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:16:34.692182', '2018-10-18 04:16:34.692182', 980190962)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9d7ab180-bbcc-4490-8727-8f276ce61d29"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 9d22f5d0-ac8e-4882-b1e2-80f025f79184\n"], ["created_at", "2018-10-18 04:16:34.715185"], ["updated_at", "2018-10-18 04:16:34.715185"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "9d22f5d0-ac8e-4882-b1e2-80f025f79184"], ["name", "test"], ["created_at", "2018-10-18 04:16:34.720258"], ["updated_at", "2018-10-18 04:16:34.720258"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"9d22f5d0-ac8e-4882-b1e2-80f025f79184"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1d8ed11c-6d42-4378-acec-c6879b355fab"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 1f53f55b-2055-4efc-b37a-fe56c6caf008\napp_uid: 9d22f5d0-ac8e-4882-b1e2-80f025f79184\n"], ["created_at", "2018-10-18 04:16:34.722622"], ["updated_at", "2018-10-18 04:16:34.722622"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "9d22f5d0-ac8e-4882-b1e2-80f025f79184"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "1f53f55b-2055-4efc-b37a-fe56c6caf008"], ["name", "review"], ["created_at", "2018-10-18 04:16:34.730344"], ["updated_at", "2018-10-18 04:16:34.730344"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1f53f55b-2055-4efc-b37a-fe56c6caf008"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"1f53f55b-2055-4efc-b37a-fe56c6caf008", "app_uid"=>"9d22f5d0-ac8e-4882-b1e2-80f025f79184"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d3d95c21-906f-4220-b9f8-cf17b4612e44"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 5bef4fd2-30b5-46d0-a755-6de610ac3c78\nstage_uid: 1f53f55b-2055-4efc-b37a-fe56c6caf008\napp_uid: 9d22f5d0-ac8e-4882-b1e2-80f025f79184\n"], ["created_at", "2018-10-18 04:16:34.734517"], ["updated_at", "2018-10-18 04:16:34.734517"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "9d22f5d0-ac8e-4882-b1e2-80f025f79184"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1f53f55b-2055-4efc-b37a-fe56c6caf008"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "5bef4fd2-30b5-46d0-a755-6de610ac3c78"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:16:34.742161"], ["updated_at", "2018-10-18 04:16:34.742161"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"9d22f5d0-ac8e-4882-b1e2-80f025f79184"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8bb67584-6e21-4029-ab52-35c2dd74fe64"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: b70d35cc-21ec-4963-bbab-b9e0f140cab2\napp_uid: 9d22f5d0-ac8e-4882-b1e2-80f025f79184\n"], ["created_at", "2018-10-18 04:16:34.746374"], ["updated_at", "2018-10-18 04:16:34.746374"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "9d22f5d0-ac8e-4882-b1e2-80f025f79184"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "b70d35cc-21ec-4963-bbab-b9e0f140cab2"], ["name", "staging"], ["created_at", "2018-10-18 04:16:34.748625"], ["updated_at", "2018-10-18 04:16:34.748625"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b70d35cc-21ec-4963-bbab-b9e0f140cab2"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"b70d35cc-21ec-4963-bbab-b9e0f140cab2", "app_uid"=>"9d22f5d0-ac8e-4882-b1e2-80f025f79184"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b8aaf00e-94d6-441c-9971-6a3387097525"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 60e4a995-e85f-482a-8063-0421528fe82c\nstage_uid: b70d35cc-21ec-4963-bbab-b9e0f140cab2\napp_uid: 9d22f5d0-ac8e-4882-b1e2-80f025f79184\n"], ["created_at", "2018-10-18 04:16:34.751157"], ["updated_at", "2018-10-18 04:16:34.751157"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "9d22f5d0-ac8e-4882-b1e2-80f025f79184"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b70d35cc-21ec-4963-bbab-b9e0f140cab2"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "60e4a995-e85f-482a-8063-0421528fe82c"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:16:34.754150"], ["updated_at", "2018-10-18 04:16:34.754150"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 54ms (ActiveRecord: 3.8ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"9d22f5d0-ac8e-4882-b1e2-80f025f79184", :stage_uid=>"1f53f55b-2055-4efc-b37a-fe56c6caf008"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "95a226e4-6f7c-45e6-a2b8-f8ec5443efcd"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: 9d22f5d0-ac8e-4882-b1e2-80f025f79184\nstage_uid: 1f53f55b-2055-4efc-b37a-fe56c6caf008\nbuild_uid: 60a4bab0-ed1f-4b1b-836a-a5a4c74867ce\n"], ["created_at", "2018-10-18 04:16:34.761855"], ["updated_at", "2018-10-18 04:16:34.761855"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "9d22f5d0-ac8e-4882-b1e2-80f025f79184"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1f53f55b-2055-4efc-b37a-fe56c6caf008"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "60a4bab0-ed1f-4b1b-836a-a5a4c74867ce"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:16:34.771662"], ["updated_at", "2018-10-18 04:16:34.771662"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 13ms (ActiveRecord: 0.8ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"60a4bab0-ed1f-4b1b-836a-a5a4c74867ce"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e32abe55-ea88-468e-b758-0284547ebd82"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 60a4bab0-ed1f-4b1b-836a-a5a4c74867ce\nrelease_uid: a9b9d0b5-467b-4775-92d1-3f5b430c1cc9\n"], ["created_at", "2018-10-18 04:16:34.777162"], ["updated_at", "2018-10-18 04:16:34.777162"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "60a4bab0-ed1f-4b1b-836a-a5a4c74867ce"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a9b9d0b5-467b-4775-92d1-3f5b430c1cc9"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:16:34.782713"], ["updated_at", "2018-10-18 04:16:34.782713"]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f] Performing ReleaseJob (Job ID: 72161b8d-4e75-494e-8d36-2e131e8e9a9f) from Async(default) with arguments: "e32abe55-ea88-468e-b758-0284547ebd82"
[ActiveJob] Enqueued ReleaseJob (Job ID: 72161b8d-4e75-494e-8d36-2e131e8e9a9f) to Async(default) with arguments: "e32abe55-ea88-468e-b758-0284547ebd82"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 11ms (ActiveRecord: 0.7ms)
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
Processing by ReleasesController#promote as HTML
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "e32abe55-ea88-468e-b758-0284547ebd82"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"60a4bab0-ed1f-4b1b-836a-a5a4c74867ce", :target_stage_uid=>"b70d35cc-21ec-4963-bbab-b9e0f140cab2"}
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "60a4bab0-ed1f-4b1b-836a-a5a4c74867ce"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6b142534-626b-4d0a-92a5-4e9fde76ddaa"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: 60a4bab0-ed1f-4b1b-836a-a5a4c74867ce\ntarget_stage_uid: b70d35cc-21ec-4963-bbab-b9e0f140cab2\nbuild_uid: 4c240cfd-d13a-4240-8246-26658a8a164f\n"], ["created_at", "2018-10-18 04:16:34.794916"], ["updated_at", "2018-10-18 04:16:34.794916"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "60a4bab0-ed1f-4b1b-836a-a5a4c74867ce"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b70d35cc-21ec-4963-bbab-b9e0f140cab2"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:16:34.804926"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "4c240cfd-d13a-4240-8246-26658a8a164f"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:16:34.807532"], ["updated_at", "2018-10-18 04:16:34.807532"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 20ms (ActiveRecord: 1.4ms)
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f] Executing command Releases::StatusCommand: {:release_uid=>"a9b9d0b5-467b-4775-92d1-3f5b430c1cc9", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
Started POST "/api/v1/apps/test/staging/release?version=v1" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ReleasesController#release as HTML
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "451c4dac-0383-4bb6-ab96-64084a9e6184"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: a9b9d0b5-467b-4775-92d1-3f5b430c1cc9\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:16:34.810503"], ["updated_at", "2018-10-18 04:16:34.810503"]]
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"staging"}
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "a9b9d0b5-467b-4775-92d1-3f5b430c1cc9"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:16:34.814304"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0216c4f3-e040-4ccb-90e8-f3129719ca75"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: a9b9d0b5-467b-4775-92d1-3f5b430c1cc9\ncluster_uid: 5bef4fd2-30b5-46d0-a755-6de610ac3c78\ndeploy_uid: b0341142-ad2c-4144-988d-df786429ef27\n"], ["created_at", "2018-10-18 04:16:34.818104"], ["updated_at", "2018-10-18 04:16:34.818104"]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "a9b9d0b5-467b-4775-92d1-3f5b430c1cc9"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "5bef4fd2-30b5-46d0-a755-6de610ac3c78"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "b0341142-ad2c-4144-988d-df786429ef27"], ["status", "PENDING"], ["created_at", "2018-10-18 04:16:34.826227"], ["updated_at", "2018-10-18 04:16:34.826227"]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f] Executing command Releases::StatusCommand: {:release_uid=>"a9b9d0b5-467b-4775-92d1-3f5b430c1cc9", :cluster_uid=>"5bef4fd2-30b5-46d0-a755-6de610ac3c78", :status=>"PENDING", :error=>nil}
  [1m[36mBuild Load (0.4ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 3 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"4c240cfd-d13a-4240-8246-26658a8a164f"}
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d985b669-ad1f-4050-8b19-959f42f1573a"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: a9b9d0b5-467b-4775-92d1-3f5b430c1cc9\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:16:34.829124"], ["updated_at", "2018-10-18 04:16:34.829124"]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "a9b9d0b5-467b-4775-92d1-3f5b430c1cc9"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a7229072-ddae-4ad7-9cfa-1c876cab827d"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 4c240cfd-d13a-4240-8246-26658a8a164f\nrelease_uid: b4541426-5f33-4c4e-bf87-f4c55791bbb8\n"], ["created_at", "2018-10-18 04:16:34.832335"], ["updated_at", "2018-10-18 04:16:34.832335"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "4c240cfd-d13a-4240-8246-26658a8a164f"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b4541426-5f33-4c4e-bf87-f4c55791bbb8"], ["build_id", 3], ["status", "INITIAL"], ["created_at", "2018-10-18 04:16:34.834427"], ["updated_at", "2018-10-18 04:16:34.834427"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 12f0b084-4421-485a-ac9b-60469b3fb318) to Async(default) with arguments: "a7229072-ddae-4ad7-9cfa-1c876cab827d"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 23ms (ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
Processing by ReleasesController#remove as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"a9b9d0b5-467b-4775-92d1-3f5b430c1cc9"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aeb7a5fa-53f1-4b62-b694-5dee68782ad6"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: a9b9d0b5-467b-4775-92d1-3f5b430c1cc9\nrelease_uid: 6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d\n"], ["created_at", "2018-10-18 04:16:34.843229"], ["updated_at", "2018-10-18 04:16:34.843229"]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318] Performing ReleaseJob (Job ID: 12f0b084-4421-485a-ac9b-60469b3fb318) from Async(default) with arguments: "a7229072-ddae-4ad7-9cfa-1c876cab827d"
  [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "a9b9d0b5-467b-4775-92d1-3f5b430c1cc9"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:16:34.847444"], ["updated_at", "2018-10-18 04:16:34.847444"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: b68abd16-dc33-4f88-a783-a53aa1a99a7a) to Async(default) with arguments: "aeb7a5fa-53f1-4b62-b694-5dee68782ad6"
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a] Performing ReleaseRemoveJob (Job ID: b68abd16-dc33-4f88-a783-a53aa1a99a7a) from Async(default) with arguments: "aeb7a5fa-53f1-4b62-b694-5dee68782ad6"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 12ms (ActiveRecord: 0.8ms)
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "a7229072-ddae-4ad7-9cfa-1c876cab827d"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "aeb7a5fa-53f1-4b62-b694-5dee68782ad6"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mBuild Load (1.9ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "4c240cfd-d13a-4240-8246-26658a8a164f"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mRelease Load (2.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "a9b9d0b5-467b-4775-92d1-3f5b430c1cc9"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318] Executing command Releases::StatusCommand: {:release_uid=>"b4541426-5f33-4c4e-bf87-f4c55791bbb8", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ba5253e7-18fe-4a1f-8c23-3312bfb9d871"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b4541426-5f33-4c4e-bf87-f4c55791bbb8\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:16:34.856661"], ["updated_at", "2018-10-18 04:16:34.856661"]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b4541426-5f33-4c4e-bf87-f4c55791bbb8"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:16:34.859278"], ["id", 980190964]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a] Executing command Releases::StatusCommand: {:release_uid=>"6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bafb1407-0363-401b-bd0f-d90763122521"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:16:34.862850"], ["updated_at", "2018-10-18 04:16:34.862850"]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:16:34.865897"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d5b17d62-b483-4c4f-b3d5-cebf2e4cb778"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b4541426-5f33-4c4e-bf87-f4c55791bbb8\ncluster_uid: 60e4a995-e85f-482a-8063-0421528fe82c\ndeploy_uid: 54b95fba-cb6b-4597-8fb0-a2b4fbf2d603\n"], ["created_at", "2018-10-18 04:16:34.868888"], ["updated_at", "2018-10-18 04:16:34.868888"]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b4541426-5f33-4c4e-bf87-f4c55791bbb8"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "60e4a995-e85f-482a-8063-0421528fe82c"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190964], ["uid", "54b95fba-cb6b-4597-8fb0-a2b4fbf2d603"], ["status", "PENDING"], ["created_at", "2018-10-18 04:16:34.871928"], ["updated_at", "2018-10-18 04:16:34.871928"]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318] Executing command Releases::StatusCommand: {:release_uid=>"b4541426-5f33-4c4e-bf87-f4c55791bbb8", :cluster_uid=>"60e4a995-e85f-482a-8063-0421528fe82c", :status=>"PENDING", :error=>nil}
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "25535638-d1f2-422d-a051-d1ca25a45659"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b4541426-5f33-4c4e-bf87-f4c55791bbb8\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:16:34.875094"], ["updated_at", "2018-10-18 04:16:34.875094"]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b4541426-5f33-4c4e-bf87-f4c55791bbb8"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2429ca27-6abc-468e-bc2a-601ce172fbc5"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d\ncluster_uid: 5bef4fd2-30b5-46d0-a755-6de610ac3c78\ndeploy_uid: e85f9434-2a58-48b9-914f-cb256fc61864\n"], ["created_at", "2018-10-18 04:16:34.878377"], ["updated_at", "2018-10-18 04:16:34.878377"]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "5bef4fd2-30b5-46d0-a755-6de610ac3c78"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190965], ["cluster_id", 980190963], ["uid", "e85f9434-2a58-48b9-914f-cb256fc61864"], ["status", "PENDING"], ["created_at", "2018-10-18 04:16:34.880811"], ["updated_at", "2018-10-18 04:16:34.880811"]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a] Executing command Releases::StatusCommand: {:release_uid=>"6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d", :cluster_uid=>"5bef4fd2-30b5-46d0-a755-6de610ac3c78", :status=>"REMOVED", :error=>nil}
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "43e26d70-9271-4a9c-9f9b-71e28e0f8410"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:16:34.883141"], ["updated_at", "2018-10-18 04:16:34.883141"]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "REMOVED"], ["updated_at", "2018-10-18 04:16:34.885608"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a] Executing command Releases::StatusCommand: {:release_uid=>"6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d", :cluster_uid=>nil, :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3fa1cf22-87ab-492a-982a-86ed79357a01"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:16:34.887638"], ["updated_at", "2018-10-18 04:16:34.887638"]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "6cc67f9d-1fe2-4e03-8c31-ec975e1fa63d"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [b68abd16-dc33-4f88-a783-a53aa1a99a7a] Performed ReleaseRemoveJob (Job ID: b68abd16-dc33-4f88-a783-a53aa1a99a7a) from Async(default) in 41.58ms
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 3) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
Completed 200 OK in 49ms (Views: 0.4ms | ActiveRecord: 2.1ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b9d13941-8dfb-405c-9016-f86e4e1c9795"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 93b38512-a80a-414e-8371-2b4ab771e13d\n"], ["created_at", "2018-10-18 04:16:34.907616"], ["updated_at", "2018-10-18 04:16:34.907616"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "93b38512-a80a-414e-8371-2b4ab771e13d"], ["name", "test"], ["created_at", "2018-10-18 04:16:34.909854"], ["updated_at", "2018-10-18 04:16:34.909854"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"93b38512-a80a-414e-8371-2b4ab771e13d"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "900d52f3-f3f5-4849-ab1c-f906181d85ae"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 79e0947b-75dd-4469-a504-82639c30154d\napp_uid: 93b38512-a80a-414e-8371-2b4ab771e13d\n"], ["created_at", "2018-10-18 04:16:34.911774"], ["updated_at", "2018-10-18 04:16:34.911774"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "93b38512-a80a-414e-8371-2b4ab771e13d"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "79e0947b-75dd-4469-a504-82639c30154d"], ["name", "review"], ["created_at", "2018-10-18 04:16:34.914563"], ["updated_at", "2018-10-18 04:16:34.914563"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "79e0947b-75dd-4469-a504-82639c30154d"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"79e0947b-75dd-4469-a504-82639c30154d", "app_uid"=>"93b38512-a80a-414e-8371-2b4ab771e13d"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ace830d6-0dd0-4de7-adcf-8c0cd214a9f4"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: d32eb0dd-69b8-4424-bd2a-b2b24b63ad6d\nstage_uid: 79e0947b-75dd-4469-a504-82639c30154d\napp_uid: 93b38512-a80a-414e-8371-2b4ab771e13d\n"], ["created_at", "2018-10-18 04:16:34.919206"], ["updated_at", "2018-10-18 04:16:34.919206"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "93b38512-a80a-414e-8371-2b4ab771e13d"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "79e0947b-75dd-4469-a504-82639c30154d"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "d32eb0dd-69b8-4424-bd2a-b2b24b63ad6d"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:16:34.922944"], ["updated_at", "2018-10-18 04:16:34.922944"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"93b38512-a80a-414e-8371-2b4ab771e13d"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4ac52669-140a-483c-b504-024195324439"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 3172bf77-2b02-47f4-b9fb-e2350d7bdc53\napp_uid: 93b38512-a80a-414e-8371-2b4ab771e13d\n"], ["created_at", "2018-10-18 04:16:34.926352"], ["updated_at", "2018-10-18 04:16:34.926352"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "93b38512-a80a-414e-8371-2b4ab771e13d"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "3172bf77-2b02-47f4-b9fb-e2350d7bdc53"], ["name", "staging"], ["created_at", "2018-10-18 04:16:34.929030"], ["updated_at", "2018-10-18 04:16:34.929030"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "3172bf77-2b02-47f4-b9fb-e2350d7bdc53"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"3172bf77-2b02-47f4-b9fb-e2350d7bdc53", "app_uid"=>"93b38512-a80a-414e-8371-2b4ab771e13d"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "333cb511-12f2-4aab-8391-c7189e248587"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 0aa3a270-b778-453b-88c0-16ec525035eb\nstage_uid: 3172bf77-2b02-47f4-b9fb-e2350d7bdc53\napp_uid: 93b38512-a80a-414e-8371-2b4ab771e13d\n"], ["created_at", "2018-10-18 04:16:34.932273"], ["updated_at", "2018-10-18 04:16:34.932273"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "93b38512-a80a-414e-8371-2b4ab771e13d"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "3172bf77-2b02-47f4-b9fb-e2350d7bdc53"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "0aa3a270-b778-453b-88c0-16ec525035eb"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:16:34.936038"], ["updated_at", "2018-10-18 04:16:34.936038"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 34ms (ActiveRecord: 3.9ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:16:34 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"93b38512-a80a-414e-8371-2b4ab771e13d"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fe7e68c1-4f44-4735-89c5-e17627b7adbf"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 93b38512-a80a-414e-8371-2b4ab771e13d\n"], ["created_at", "2018-10-18 04:16:34.951519"], ["updated_at", "2018-10-18 04:16:34.951519"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "93b38512-a80a-414e-8371-2b4ab771e13d"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e1b25dde-1f6a-44a0-965f-6043649af480"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 2b0e45be-c40c-45c6-844b-59bd5f770a86\n"], ["created_at", "2018-10-18 04:16:34.955980"], ["updated_at", "2018-10-18 04:16:34.955980"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2b0e45be-c40c-45c6-844b-59bd5f770a86"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:16:34.958853"], ["updated_at", "2018-10-18 04:16:34.958853"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 034ac82e-bf63-4354-9973-17a81f1006f5) to Async(default) with arguments: "e1b25dde-1f6a-44a0-965f-6043649af480"
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5] Performing ReleaseJob (Job ID: 034ac82e-bf63-4354-9973-17a81f1006f5) from Async(default) with arguments: "e1b25dde-1f6a-44a0-965f-6043649af480"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[36mEvent Load (0.5ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "e1b25dde-1f6a-44a0-965f-6043649af480"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5] Executing command Releases::StatusCommand: {:release_uid=>"2b0e45be-c40c-45c6-844b-59bd5f770a86", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "83e597f7-d11e-4a3e-8249-ceb7bec83e31"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 2b0e45be-c40c-45c6-844b-59bd5f770a86\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:16:34.964801"], ["updated_at", "2018-10-18 04:16:34.964801"]]
------------------------------------------
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.5ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[36mRelease Load (0.3ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "2b0e45be-c40c-45c6-844b-59bd5f770a86"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5] Executing command Releases::StatusCommand: {:release_uid=>"2b0e45be-c40c-45c6-844b-59bd5f770a86", :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Release>}
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0c0d731e-ec2a-4c98-a8ec-e4d8070bc8ef"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 0db3b4a4-129e-4b2e-bc2a-266e8af11ba5\n"], ["created_at", "2018-10-18 04:16:34.969102"], ["updated_at", "2018-10-18 04:16:34.969102"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "0db3b4a4-129e-4b2e-bc2a-266e8af11ba5"], ["status", "PENDING"], ["created_at", "2018-10-18 04:16:34.973724"], ["updated_at", "2018-10-18 04:16:34.973724"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[35mSQL (3.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fb47d813-cbc0-45db-ba4e-8a12ea2edbe0"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 2b0e45be-c40c-45c6-844b-59bd5f770a86\nstatus: ERRORED\n"], ["created_at", "2018-10-18 04:16:34.971066"], ["updated_at", "2018-10-18 04:16:34.971066"]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5]   [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "2b0e45be-c40c-45c6-844b-59bd5f770a86"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [034ac82e-bf63-4354-9973-17a81f1006f5] Error performing ReleaseJob (Job ID: 034ac82e-bf63-4354-9973-17a81f1006f5) from Async(default) in 16.06ms: ActiveRecord::RecordNotFound (Couldn't find Release):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/core.rb:228:in `find_by!'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/dynamic_matchers.rb:66:in `find_by_uid!'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/release.rb:22:in `block in <class:Release>'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:14:in `block (2 levels) in play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `each'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `block in play'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:233:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/transactions.rb:210:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:10:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8bc2e86e-09ec-4c1b-b4db-014371aa31c1"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: ae1a4fa6-7369-437f-86f0-1352bbced38a\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:16:34.979524"], ["updated_at", "2018-10-18 04:16:34.979524"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "ae1a4fa6-7369-437f-86f0-1352bbced38a"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:16:34.983629"], ["updated_at", "2018-10-18 04:16:34.983629"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:16:34.988655', '2018-10-18 04:16:34.988655')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:16:34.990160', '2018-10-18 04:16:34.990160')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:16:34.991196', '2018-10-18 04:16:34.991196', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:16:34.992147', '2018-10-18 04:16:34.992147')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:16:34.993232', '2018-10-18 04:16:34.993232', 980190962)[0m
  [1m[35m (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cc95ad42-1a35-4980-a82e-46daeccaf26e"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 96724246-435b-42bc-a106-6a98b06637dd\n"], ["created_at", "2018-10-18 04:16:35.001003"], ["updated_at", "2018-10-18 04:16:35.001003"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "96724246-435b-42bc-a106-6a98b06637dd"], ["name", "test2"], ["created_at", "2018-10-18 04:16:35.004803"], ["updated_at", "2018-10-18 04:16:35.004803"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7aa29899-cc4a-4097-b53a-e635bd9a0928"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:16:35.007987"], ["updated_at", "2018-10-18 04:16:35.007987"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6928083c-cbcc-40c0-bd23-3b9633edca47"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 3d722b37-f86b-4c19-af40-930761adae0d\n"], ["created_at", "2018-10-18 04:16:35.013924"], ["updated_at", "2018-10-18 04:16:35.013924"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "3d722b37-f86b-4c19-af40-930761adae0d"], ["name", "test2"], ["created_at", "2018-10-18 04:16:35.017350"], ["updated_at", "2018-10-18 04:16:35.017350"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a19ca931-3bc4-4343-9b5d-efaf950c5b4a"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:16:35.019356"], ["updated_at", "2018-10-18 04:16:35.019356"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1dac5b6d-62e8-4441-8316-6754a59e5e76"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 34f46a91-2605-41e3-a90e-3ee59f3718f2\n"], ["created_at", "2018-10-18 04:16:35.022139"], ["updated_at", "2018-10-18 04:16:35.022139"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "34f46a91-2605-41e3-a90e-3ee59f3718f2"], ["name", "test"], ["created_at", "2018-10-18 04:16:35.024233"], ["updated_at", "2018-10-18 04:16:35.024233"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4358d674-5cf2-4aba-a4c7-43cc68cecf79"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:16:35.027049"], ["updated_at", "2018-10-18 04:16:35.027049"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:16:35.030704"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f831efb8-e9b9-4299-b13b-de235dc8aa96"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: dcc0d210-7201-43fb-a3cb-63310c6385a5\n"], ["created_at", "2018-10-18 04:16:35.034079"], ["updated_at", "2018-10-18 04:16:35.034079"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "dcc0d210-7201-43fb-a3cb-63310c6385a5"], ["name", "test"], ["created_at", "2018-10-18 04:16:35.036387"], ["updated_at", "2018-10-18 04:16:35.036387"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "40332487-e543-449c-9490-14d1ced1f251"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:16:35.038692"], ["updated_at", "2018-10-18 04:16:35.038692"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:16:35.040735"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [72161b8d-4e75-494e-8d36-2e131e8e9a9f] Performed ReleaseJob (Job ID: 72161b8d-4e75-494e-8d36-2e131e8e9a9f) from Async(default) in 257.3ms
[ActiveJob] [ReleaseJob] [12f0b084-4421-485a-ac9b-60469b3fb318] Performed ReleaseJob (Job ID: 12f0b084-4421-485a-ac9b-60469b3fb318) from Async(default) in 196.36ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:23:35.714929', '2018-10-18 04:23:35.714929')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:23:35.716869', '2018-10-18 04:23:35.716869')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:23:35.718419', '2018-10-18 04:23:35.718419', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:23:35.719841', '2018-10-18 04:23:35.719841')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:23:35.721401', '2018-10-18 04:23:35.721401', 980190962)[0m
  [1m[35m (65.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:23:35 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d958581-868b-4176-b88d-c7fb27c0d72d"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: f4644101-cb71-431a-a353-c12d086b9042\n"], ["created_at", "2018-10-18 04:23:35.816952"], ["updated_at", "2018-10-18 04:23:35.816952"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "f4644101-cb71-431a-a353-c12d086b9042"], ["name", "test"], ["created_at", "2018-10-18 04:23:35.823156"], ["updated_at", "2018-10-18 04:23:35.823156"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"f4644101-cb71-431a-a353-c12d086b9042"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c0ddd1be-7e30-4535-a4e6-3872e4dbee23"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 2b3c18e3-ab2c-44a2-a3ef-1395a64f6788\napp_uid: f4644101-cb71-431a-a353-c12d086b9042\n"], ["created_at", "2018-10-18 04:23:35.826067"], ["updated_at", "2018-10-18 04:23:35.826067"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f4644101-cb71-431a-a353-c12d086b9042"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "2b3c18e3-ab2c-44a2-a3ef-1395a64f6788"], ["name", "review"], ["created_at", "2018-10-18 04:23:35.833851"], ["updated_at", "2018-10-18 04:23:35.833851"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2b3c18e3-ab2c-44a2-a3ef-1395a64f6788"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"2b3c18e3-ab2c-44a2-a3ef-1395a64f6788", "app_uid"=>"f4644101-cb71-431a-a353-c12d086b9042"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8f6921a3-fcf5-4634-9df0-597646df5baa"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: d765c454-f666-4dc7-bede-8ce76cf99bd0\nstage_uid: 2b3c18e3-ab2c-44a2-a3ef-1395a64f6788\napp_uid: f4644101-cb71-431a-a353-c12d086b9042\n"], ["created_at", "2018-10-18 04:23:35.837673"], ["updated_at", "2018-10-18 04:23:35.837673"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f4644101-cb71-431a-a353-c12d086b9042"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2b3c18e3-ab2c-44a2-a3ef-1395a64f6788"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "d765c454-f666-4dc7-bede-8ce76cf99bd0"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:23:35.844700"], ["updated_at", "2018-10-18 04:23:35.844700"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"f4644101-cb71-431a-a353-c12d086b9042"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "383638b9-9261-4801-8b4b-caa0ae112c64"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: c7206a1c-fe4a-4a1f-a98d-0762ec42d967\napp_uid: f4644101-cb71-431a-a353-c12d086b9042\n"], ["created_at", "2018-10-18 04:23:35.849789"], ["updated_at", "2018-10-18 04:23:35.849789"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f4644101-cb71-431a-a353-c12d086b9042"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "c7206a1c-fe4a-4a1f-a98d-0762ec42d967"], ["name", "staging"], ["created_at", "2018-10-18 04:23:35.852195"], ["updated_at", "2018-10-18 04:23:35.852195"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "c7206a1c-fe4a-4a1f-a98d-0762ec42d967"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"c7206a1c-fe4a-4a1f-a98d-0762ec42d967", "app_uid"=>"f4644101-cb71-431a-a353-c12d086b9042"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f36db2b6-00c6-46aa-89d8-f887fe4e4a5f"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: d87b7385-323a-444a-95ff-0aeb73c49b91\nstage_uid: c7206a1c-fe4a-4a1f-a98d-0762ec42d967\napp_uid: f4644101-cb71-431a-a353-c12d086b9042\n"], ["created_at", "2018-10-18 04:23:35.854935"], ["updated_at", "2018-10-18 04:23:35.854935"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f4644101-cb71-431a-a353-c12d086b9042"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "c7206a1c-fe4a-4a1f-a98d-0762ec42d967"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "d87b7385-323a-444a-95ff-0aeb73c49b91"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:23:35.857592"], ["updated_at", "2018-10-18 04:23:35.857592"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 63ms (ActiveRecord: 4.4ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:23:35 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"f4644101-cb71-431a-a353-c12d086b9042", :stage_uid=>"2b3c18e3-ab2c-44a2-a3ef-1395a64f6788"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1a8a72c7-826d-4818-917a-6d66b55962fb"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: f4644101-cb71-431a-a353-c12d086b9042\nstage_uid: 2b3c18e3-ab2c-44a2-a3ef-1395a64f6788\nbuild_uid: 51f35f7a-074e-4b66-b4f2-1733ad63841a\n"], ["created_at", "2018-10-18 04:23:35.865615"], ["updated_at", "2018-10-18 04:23:35.865615"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "f4644101-cb71-431a-a353-c12d086b9042"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2b3c18e3-ab2c-44a2-a3ef-1395a64f6788"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "51f35f7a-074e-4b66-b4f2-1733ad63841a"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:23:35.875671"], ["updated_at", "2018-10-18 04:23:35.875671"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 14ms (ActiveRecord: 0.8ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:23:35 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"51f35f7a-074e-4b66-b4f2-1733ad63841a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7ce5ac67-ea47-48e5-8ac8-7f4286f56e39"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 51f35f7a-074e-4b66-b4f2-1733ad63841a\nrelease_uid: dc6a3e1e-de28-4bdd-b95c-4460a67e3a57\n"], ["created_at", "2018-10-18 04:23:35.881652"], ["updated_at", "2018-10-18 04:23:35.881652"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "51f35f7a-074e-4b66-b4f2-1733ad63841a"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dc6a3e1e-de28-4bdd-b95c-4460a67e3a57"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:23:35.887330"], ["updated_at", "2018-10-18 04:23:35.887330"]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78] Performing ReleaseJob (Job ID: 9a7b8338-d8b6-455d-abcb-76b3ecaddc78) from Async(default) with arguments: "7ce5ac67-ea47-48e5-8ac8-7f4286f56e39"
[ActiveJob] Enqueued ReleaseJob (Job ID: 9a7b8338-d8b6-455d-abcb-76b3ecaddc78) to Async(default) with arguments: "7ce5ac67-ea47-48e5-8ac8-7f4286f56e39"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 12ms (ActiveRecord: 0.8ms)
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:23:35 -0700
Processing by ReleasesController#promote as HTML
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "7ce5ac67-ea47-48e5-8ac8-7f4286f56e39"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"51f35f7a-074e-4b66-b4f2-1733ad63841a", :target_stage_uid=>"c7206a1c-fe4a-4a1f-a98d-0762ec42d967"}
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "51f35f7a-074e-4b66-b4f2-1733ad63841a"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5c1f2aa8-b40d-4989-8060-9290d08e18a5"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: 51f35f7a-074e-4b66-b4f2-1733ad63841a\ntarget_stage_uid: c7206a1c-fe4a-4a1f-a98d-0762ec42d967\nbuild_uid: d9e8ed8e-313f-4c40-8370-c94197e937b0\n"], ["created_at", "2018-10-18 04:23:35.900608"], ["updated_at", "2018-10-18 04:23:35.900608"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "51f35f7a-074e-4b66-b4f2-1733ad63841a"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "c7206a1c-fe4a-4a1f-a98d-0762ec42d967"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:23:35.910166"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "d9e8ed8e-313f-4c40-8370-c94197e937b0"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:23:35.912535"], ["updated_at", "2018-10-18 04:23:35.912535"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 19ms (ActiveRecord: 1.3ms)
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78] Executing command Releases::StatusCommand: {:release_uid=>"dc6a3e1e-de28-4bdd-b95c-4460a67e3a57", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
Started POST "/api/v1/apps/test/staging/release?version=v1" for 127.0.0.1 at 2018-10-17 21:23:35 -0700
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ReleasesController#release as HTML
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "16290b7c-7b03-4827-891e-20daf7f33b63"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: dc6a3e1e-de28-4bdd-b95c-4460a67e3a57\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:23:35.915474"], ["updated_at", "2018-10-18 04:23:35.915474"]]
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"staging"}
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "dc6a3e1e-de28-4bdd-b95c-4460a67e3a57"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:23:35.919635"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "439ec900-46c0-4b7e-b49b-4ec36477086a"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: dc6a3e1e-de28-4bdd-b95c-4460a67e3a57\ncluster_uid: d765c454-f666-4dc7-bede-8ce76cf99bd0\ndeploy_uid: 866ec496-01b2-4c42-9673-e0f5912c4bf0\n"], ["created_at", "2018-10-18 04:23:35.923264"], ["updated_at", "2018-10-18 04:23:35.923264"]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "dc6a3e1e-de28-4bdd-b95c-4460a67e3a57"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "d765c454-f666-4dc7-bede-8ce76cf99bd0"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "866ec496-01b2-4c42-9673-e0f5912c4bf0"], ["status", "PENDING"], ["created_at", "2018-10-18 04:23:35.930922"], ["updated_at", "2018-10-18 04:23:35.930922"]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78] Executing command Releases::StatusCommand: {:release_uid=>"dc6a3e1e-de28-4bdd-b95c-4460a67e3a57", :cluster_uid=>"d765c454-f666-4dc7-bede-8ce76cf99bd0", :status=>"PENDING", :error=>nil}
  [1m[36mBuild Load (0.3ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 3 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"d9e8ed8e-313f-4c40-8370-c94197e937b0"}
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "37eb3df7-cc75-47bb-b476-f0a1ec72bf04"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: dc6a3e1e-de28-4bdd-b95c-4460a67e3a57\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:23:35.933391"], ["updated_at", "2018-10-18 04:23:35.933391"]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "dc6a3e1e-de28-4bdd-b95c-4460a67e3a57"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a6960fa9-5a72-46f2-8922-d3966c39bd5c"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: d9e8ed8e-313f-4c40-8370-c94197e937b0\nrelease_uid: 88a86c28-dd0e-497b-bcdf-35a87dacb414\n"], ["created_at", "2018-10-18 04:23:35.936563"], ["updated_at", "2018-10-18 04:23:35.936563"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d9e8ed8e-313f-4c40-8370-c94197e937b0"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "88a86c28-dd0e-497b-bcdf-35a87dacb414"], ["build_id", 3], ["status", "INITIAL"], ["created_at", "2018-10-18 04:23:35.938698"], ["updated_at", "2018-10-18 04:23:35.938698"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 9a5a7f0b-99d6-4614-90df-b574cb44b2e8) to Async(default) with arguments: "a6960fa9-5a72-46f2-8922-d3966c39bd5c"
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8] Performing ReleaseJob (Job ID: 9a5a7f0b-99d6-4614-90df-b574cb44b2e8) from Async(default) with arguments: "a6960fa9-5a72-46f2-8922-d3966c39bd5c"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 23ms (ActiveRecord: 0.9ms)
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "a6960fa9-5a72-46f2-8922-d3966c39bd5c"], ["LIMIT", 1]]
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:23:35 -0700
Processing by ReleasesController#remove as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mBuild Load (1.4ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d9e8ed8e-313f-4c40-8370-c94197e937b0"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8] Executing command Releases::StatusCommand: {:release_uid=>"88a86c28-dd0e-497b-bcdf-35a87dacb414", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ac7b0ea1-6645-4530-9e3c-ee7022fd94a2"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 88a86c28-dd0e-497b-bcdf-35a87dacb414\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:23:35.948396"], ["updated_at", "2018-10-18 04:23:35.948396"]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "88a86c28-dd0e-497b-bcdf-35a87dacb414"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:23:35.951373"], ["id", 980190964]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ab8e2d3a-e803-4867-b2b6-517051f7f00b"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 88a86c28-dd0e-497b-bcdf-35a87dacb414\ncluster_uid: d87b7385-323a-444a-95ff-0aeb73c49b91\ndeploy_uid: b4bf7d96-5c9c-4d1e-adf4-84dad62510ae\n"], ["created_at", "2018-10-18 04:23:35.955277"], ["updated_at", "2018-10-18 04:23:35.955277"]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "88a86c28-dd0e-497b-bcdf-35a87dacb414"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "d87b7385-323a-444a-95ff-0aeb73c49b91"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190964], ["uid", "b4bf7d96-5c9c-4d1e-adf4-84dad62510ae"], ["status", "PENDING"], ["created_at", "2018-10-18 04:23:35.957807"], ["updated_at", "2018-10-18 04:23:35.957807"]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8] Executing command Releases::StatusCommand: {:release_uid=>"88a86c28-dd0e-497b-bcdf-35a87dacb414", :cluster_uid=>"d87b7385-323a-444a-95ff-0aeb73c49b91", :status=>"PENDING", :error=>nil}
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"dc6a3e1e-de28-4bdd-b95c-4460a67e3a57"}
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "626cf78d-97d7-42c2-b29f-8a8964eaf033"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 88a86c28-dd0e-497b-bcdf-35a87dacb414\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:23:35.959809"], ["updated_at", "2018-10-18 04:23:35.959809"]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "88a86c28-dd0e-497b-bcdf-35a87dacb414"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7b9bedab-9598-4de7-a4f8-33ad7fa7fc2e"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: dc6a3e1e-de28-4bdd-b95c-4460a67e3a57\nrelease_uid: c57eef0b-b1fd-4124-ad5c-73c9eab4add1\n"], ["created_at", "2018-10-18 04:23:35.962919"], ["updated_at", "2018-10-18 04:23:35.962919"]]
  [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "dc6a3e1e-de28-4bdd-b95c-4460a67e3a57"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c57eef0b-b1fd-4124-ad5c-73c9eab4add1"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:23:35.965125"], ["updated_at", "2018-10-18 04:23:35.965125"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: ca4c4b21-0488-4cd7-acb8-c85aa14366fb) to Async(default) with arguments: "7b9bedab-9598-4de7-a4f8-33ad7fa7fc2e"
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb] Performing ReleaseRemoveJob (Job ID: ca4c4b21-0488-4cd7-acb8-c85aa14366fb) from Async(default) with arguments: "7b9bedab-9598-4de7-a4f8-33ad7fa7fc2e"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 25ms (ActiveRecord: 1.0ms)
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "7b9bedab-9598-4de7-a4f8-33ad7fa7fc2e"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:23:35 -0700
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mRelease Load (0.8ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "dc6a3e1e-de28-4bdd-b95c-4460a67e3a57"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb] Executing command Releases::StatusCommand: {:release_uid=>"c57eef0b-b1fd-4124-ad5c-73c9eab4add1", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8b24cb57-91f2-43ec-9bb4-4b51d950eeaa"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: c57eef0b-b1fd-4124-ad5c-73c9eab4add1\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:23:35.972962"], ["updated_at", "2018-10-18 04:23:35.972962"]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "c57eef0b-b1fd-4124-ad5c-73c9eab4add1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:23:35.975964"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "86bb9078-8563-4732-a34a-7ac8f8fdcbe0"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: c57eef0b-b1fd-4124-ad5c-73c9eab4add1\ncluster_uid: d765c454-f666-4dc7-bede-8ce76cf99bd0\ndeploy_uid: dd9e780e-405d-4866-88d9-0a35feaa4543\n"], ["created_at", "2018-10-18 04:23:35.981002"], ["updated_at", "2018-10-18 04:23:35.981002"]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "c57eef0b-b1fd-4124-ad5c-73c9eab4add1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "d765c454-f666-4dc7-bede-8ce76cf99bd0"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190965], ["cluster_id", 980190963], ["uid", "dd9e780e-405d-4866-88d9-0a35feaa4543"], ["status", "PENDING"], ["created_at", "2018-10-18 04:23:35.983786"], ["updated_at", "2018-10-18 04:23:35.983786"]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb] Executing command Releases::StatusCommand: {:release_uid=>"c57eef0b-b1fd-4124-ad5c-73c9eab4add1", :cluster_uid=>"d765c454-f666-4dc7-bede-8ce76cf99bd0", :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "222992a7-a16b-4a65-8c4e-d9876675deb4"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: c57eef0b-b1fd-4124-ad5c-73c9eab4add1\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:23:35.986098"], ["updated_at", "2018-10-18 04:23:35.986098"]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "c57eef0b-b1fd-4124-ad5c-73c9eab4add1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "REMOVED"], ["updated_at", "2018-10-18 04:23:35.989316"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb] Executing command Releases::StatusCommand: {:release_uid=>"c57eef0b-b1fd-4124-ad5c-73c9eab4add1", :cluster_uid=>nil, :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "981c9079-0cca-4886-938e-8532437e115e"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: c57eef0b-b1fd-4124-ad5c-73c9eab4add1\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:23:35.992335"], ["updated_at", "2018-10-18 04:23:35.992335"]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "c57eef0b-b1fd-4124-ad5c-73c9eab4add1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [ca4c4b21-0488-4cd7-acb8-c85aa14366fb] Performed ReleaseRemoveJob (Job ID: ca4c4b21-0488-4cd7-acb8-c85aa14366fb) from Async(default) in 28.7ms
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 30ms (ActiveRecord: 1.2ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:23:36 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b602d4dd-a548-44a7-bc3f-4541edd8b8cf"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 7661dde4-8e32-4b04-b1ed-7422b4d6f080\n"], ["created_at", "2018-10-18 04:23:36.005466"], ["updated_at", "2018-10-18 04:23:36.005466"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "7661dde4-8e32-4b04-b1ed-7422b4d6f080"], ["name", "test"], ["created_at", "2018-10-18 04:23:36.007978"], ["updated_at", "2018-10-18 04:23:36.007978"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"7661dde4-8e32-4b04-b1ed-7422b4d6f080"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8c818aef-1a36-44eb-bd53-e4d897a938fb"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 360889c6-157a-4b46-bb76-0d59f50a7aba\napp_uid: 7661dde4-8e32-4b04-b1ed-7422b4d6f080\n"], ["created_at", "2018-10-18 04:23:36.009852"], ["updated_at", "2018-10-18 04:23:36.009852"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7661dde4-8e32-4b04-b1ed-7422b4d6f080"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "360889c6-157a-4b46-bb76-0d59f50a7aba"], ["name", "review"], ["created_at", "2018-10-18 04:23:36.012384"], ["updated_at", "2018-10-18 04:23:36.012384"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "360889c6-157a-4b46-bb76-0d59f50a7aba"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"360889c6-157a-4b46-bb76-0d59f50a7aba", "app_uid"=>"7661dde4-8e32-4b04-b1ed-7422b4d6f080"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9feac9d8-7152-4639-a725-438fd34c8537"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 5feb078b-47fa-4aae-ac3b-223d3a045fb7\nstage_uid: 360889c6-157a-4b46-bb76-0d59f50a7aba\napp_uid: 7661dde4-8e32-4b04-b1ed-7422b4d6f080\n"], ["created_at", "2018-10-18 04:23:36.015030"], ["updated_at", "2018-10-18 04:23:36.015030"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7661dde4-8e32-4b04-b1ed-7422b4d6f080"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "360889c6-157a-4b46-bb76-0d59f50a7aba"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "5feb078b-47fa-4aae-ac3b-223d3a045fb7"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:23:36.018418"], ["updated_at", "2018-10-18 04:23:36.018418"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"7661dde4-8e32-4b04-b1ed-7422b4d6f080"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "15d97f5e-42e0-4472-88b4-bd92605b8f0b"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 0636afa2-442f-40f8-bc9b-10a7ac0876d5\napp_uid: 7661dde4-8e32-4b04-b1ed-7422b4d6f080\n"], ["created_at", "2018-10-18 04:23:36.022000"], ["updated_at", "2018-10-18 04:23:36.022000"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7661dde4-8e32-4b04-b1ed-7422b4d6f080"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "0636afa2-442f-40f8-bc9b-10a7ac0876d5"], ["name", "staging"], ["created_at", "2018-10-18 04:23:36.025750"], ["updated_at", "2018-10-18 04:23:36.025750"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "0636afa2-442f-40f8-bc9b-10a7ac0876d5"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"0636afa2-442f-40f8-bc9b-10a7ac0876d5", "app_uid"=>"7661dde4-8e32-4b04-b1ed-7422b4d6f080"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b1f2dda0-8dc3-425c-9958-634eb33e50a9"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 1ccd635a-b82d-48a9-b24e-5f9c8a0947a4\nstage_uid: 0636afa2-442f-40f8-bc9b-10a7ac0876d5\napp_uid: 7661dde4-8e32-4b04-b1ed-7422b4d6f080\n"], ["created_at", "2018-10-18 04:23:36.029537"], ["updated_at", "2018-10-18 04:23:36.029537"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7661dde4-8e32-4b04-b1ed-7422b4d6f080"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "0636afa2-442f-40f8-bc9b-10a7ac0876d5"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "1ccd635a-b82d-48a9-b24e-5f9c8a0947a4"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:23:36.033273"], ["updated_at", "2018-10-18 04:23:36.033273"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 34ms (ActiveRecord: 3.6ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:23:36 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:23:36 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"7661dde4-8e32-4b04-b1ed-7422b4d6f080"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "caadb462-61d7-4a0d-8b8c-c72789231b16"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 7661dde4-8e32-4b04-b1ed-7422b4d6f080\n"], ["created_at", "2018-10-18 04:23:36.049142"], ["updated_at", "2018-10-18 04:23:36.049142"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "7661dde4-8e32-4b04-b1ed-7422b4d6f080"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3678e58c-872f-46b6-b084-33c4ee26f63f"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:23:36.053710"], ["updated_at", "2018-10-18 04:23:36.053710"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "be80fa7c-4c8a-4e97-8c38-3e0f42f5e8ac"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 523be97e-7dd8-46a7-a749-b2d27807f6da\n"], ["created_at", "2018-10-18 04:23:36.057184"], ["updated_at", "2018-10-18 04:23:36.057184"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "523be97e-7dd8-46a7-a749-b2d27807f6da"], ["name", "test"], ["created_at", "2018-10-18 04:23:36.059615"], ["updated_at", "2018-10-18 04:23:36.059615"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "42a75819-87c6-4fde-9f29-e9236153f673"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 3a051a95-2c7b-47b4-a37e-5e719382c8e6\n"], ["created_at", "2018-10-18 04:23:36.062396"], ["updated_at", "2018-10-18 04:23:36.062396"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "3a051a95-2c7b-47b4-a37e-5e719382c8e6"], ["name", "test2"], ["created_at", "2018-10-18 04:23:36.065430"], ["updated_at", "2018-10-18 04:23:36.065430"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fca40e2a-3517-4fe1-8758-a6115ca0b96d"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:23:36.067958"], ["updated_at", "2018-10-18 04:23:36.067958"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:23:36.070192"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3ce97b6b-24e1-4c57-970d-426c615e7f40"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:23:36.072234"], ["updated_at", "2018-10-18 04:23:36.072234"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "43b352b1-7ba2-4a50-9a1b-265388ee611c"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: ff7f81d5-5e43-4fd1-95bc-913be972fb4a\n"], ["created_at", "2018-10-18 04:23:36.076052"], ["updated_at", "2018-10-18 04:23:36.076052"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "ff7f81d5-5e43-4fd1-95bc-913be972fb4a"], ["name", "test"], ["created_at", "2018-10-18 04:23:36.078393"], ["updated_at", "2018-10-18 04:23:36.078393"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8ea8e239-a8f6-49d2-a9ec-cb347f05ed22"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 8ae0520f-d6cf-497a-b8cf-1339ded026d0\n"], ["created_at", "2018-10-18 04:23:36.081454"], ["updated_at", "2018-10-18 04:23:36.081454"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "8ae0520f-d6cf-497a-b8cf-1339ded026d0"], ["name", "test2"], ["created_at", "2018-10-18 04:23:36.084891"], ["updated_at", "2018-10-18 04:23:36.084891"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e6329a3a-f2f8-49bb-981e-813578185ca7"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:23:36.088007"], ["updated_at", "2018-10-18 04:23:36.088007"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:23:36.091338"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f6868811-7f52-4f39-9cec-f0fb992e3a37"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 64c3ba30-091b-4dbc-b701-e697e73b8dd4\n"], ["created_at", "2018-10-18 04:23:36.095430"], ["updated_at", "2018-10-18 04:23:36.095430"]]
  [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "64c3ba30-091b-4dbc-b701-e697e73b8dd4"], ["status", "PENDING"], ["created_at", "2018-10-18 04:23:36.098205"], ["updated_at", "2018-10-18 04:23:36.098205"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4590a48b-c4ec-4660-b53b-758afdf5fff4"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 4e93f47a-301e-489f-b5a0-ee2288e97c50\n"], ["created_at", "2018-10-18 04:23:36.101281"], ["updated_at", "2018-10-18 04:23:36.101281"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4e93f47a-301e-489f-b5a0-ee2288e97c50"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:23:36.103982"], ["updated_at", "2018-10-18 04:23:36.103982"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 4955f537-0ab5-4a73-a757-c81912edd025) to Async(default) with arguments: "4590a48b-c4ec-4660-b53b-758afdf5fff4"
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025] Performing ReleaseJob (Job ID: 4955f537-0ab5-4a73-a757-c81912edd025) from Async(default) with arguments: "4590a48b-c4ec-4660-b53b-758afdf5fff4"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[36mEvent Load (0.5ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "4590a48b-c4ec-4660-b53b-758afdf5fff4"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.3ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025] Executing command Releases::StatusCommand: {:release_uid=>"4e93f47a-301e-489f-b5a0-ee2288e97c50", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
BuildCommandsTest: test_create_a_build
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1b0487f3-8b3f-4b6e-bc89-f91f53c257f1"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 4e93f47a-301e-489f-b5a0-ee2288e97c50\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:23:36.110817"], ["updated_at", "2018-10-18 04:23:36.110817"]]
--------------------------------------
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[36mRelease Load (0.3ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "4e93f47a-301e-489f-b5a0-ee2288e97c50"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025] Executing command Releases::StatusCommand: {:release_uid=>"4e93f47a-301e-489f-b5a0-ee2288e97c50", :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Release>}
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "11f26491-31ff-4c55-9d1e-c480059a3753"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 4e93f47a-301e-489f-b5a0-ee2288e97c50\nstatus: ERRORED\n"], ["created_at", "2018-10-18 04:23:36.116665"], ["updated_at", "2018-10-18 04:23:36.116665"]]
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "4e93f47a-301e-489f-b5a0-ee2288e97c50"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025]   [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [4955f537-0ab5-4a73-a757-c81912edd025] Error performing ReleaseJob (Job ID: 4955f537-0ab5-4a73-a757-c81912edd025) from Async(default) in 13.32ms: ActiveRecord::RecordNotFound (Couldn't find Release):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/core.rb:228:in `find_by!'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/dynamic_matchers.rb:66:in `find_by_uid!'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/release.rb:22:in `block in <class:Release>'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:14:in `block (2 levels) in play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `each'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `block in play'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:235:in `block in transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/transaction.rb:194:in `block in within_new_transaction'
/usr/lib/ruby/2.3.0/monitor.rb:214:in `mon_synchronize'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/transaction.rb:191:in `within_new_transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:235:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/transactions.rb:210:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:10:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d4e90ce5-6071-43a9-8552-52701a7cd3f4"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: f1ba39bd-aa86-4f35-a112-f0dd64871ae6\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:23:36.119887"], ["updated_at", "2018-10-18 04:23:36.119887"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "f1ba39bd-aa86-4f35-a112-f0dd64871ae6"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:23:36.123563"], ["updated_at", "2018-10-18 04:23:36.123563"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [9a5a7f0b-99d6-4614-90df-b574cb44b2e8] Performed ReleaseJob (Job ID: 9a5a7f0b-99d6-4614-90df-b574cb44b2e8) from Async(default) in 185.98ms
[ActiveJob] [ReleaseJob] [9a7b8338-d8b6-455d-abcb-76b3ecaddc78] Performed ReleaseJob (Job ID: 9a7b8338-d8b6-455d-abcb-76b3ecaddc78) from Async(default) in 236.74ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:24:00.044257', '2018-10-18 04:24:00.044257')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:24:00.046786', '2018-10-18 04:24:00.046786')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:24:00.048730', '2018-10-18 04:24:00.048730', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:24:00.050154', '2018-10-18 04:24:00.050154')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:24:00.051609', '2018-10-18 04:24:00.051609', 980190962)[0m
  [1m[35m (4.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "adb19b8f-7833-4a8b-9644-a54396601a86"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 1a8ea5e4-69ff-4b42-89df-4f39571fdf78\n"], ["created_at", "2018-10-18 04:24:00.079482"], ["updated_at", "2018-10-18 04:24:00.079482"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "1a8ea5e4-69ff-4b42-89df-4f39571fdf78"], ["status", "PENDING"], ["created_at", "2018-10-18 04:24:00.088642"], ["updated_at", "2018-10-18 04:24:00.088642"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fd722976-be0e-46d1-80fb-0cb558f173fe"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: 5aa750ee-5596-43dc-a9f4-2398b2ae3b9e\n"], ["created_at", "2018-10-18 04:24:00.097229"], ["updated_at", "2018-10-18 04:24:00.097229"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5aa750ee-5596-43dc-a9f4-2398b2ae3b9e"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:24:00.100580"], ["updated_at", "2018-10-18 04:24:00.100580"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: ec408040-380b-4fb6-9588-04d3878aeef8) to Async(default) with arguments: "fd722976-be0e-46d1-80fb-0cb558f173fe"
[ActiveJob] [ReleaseJob] [ec408040-380b-4fb6-9588-04d3878aeef8] Performing ReleaseJob (Job ID: ec408040-380b-4fb6-9588-04d3878aeef8) from Async(default) with arguments: "fd722976-be0e-46d1-80fb-0cb558f173fe"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d0e7ce1-f603-4157-b1a7-5b75df8e816e"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 45d30b22-b09d-4d10-af41-11acd7437321\n"], ["created_at", "2018-10-18 04:24:00.120437"], ["updated_at", "2018-10-18 04:24:00.120437"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "45d30b22-b09d-4d10-af41-11acd7437321"], ["name", "test"], ["created_at", "2018-10-18 04:24:00.125667"], ["updated_at", "2018-10-18 04:24:00.125667"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ec408040-380b-4fb6-9588-04d3878aeef8]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "fd722976-be0e-46d1-80fb-0cb558f173fe"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ec408040-380b-4fb6-9588-04d3878aeef8] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ec408040-380b-4fb6-9588-04d3878aeef8] Error performing ReleaseJob (Job ID: ec408040-380b-4fb6-9588-04d3878aeef8) from Async(default) in 26.58ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"45d30b22-b09d-4d10-af41-11acd7437321"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d39668f9-5314-48d0-a08e-85f574451d02"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 02444857-fd19-4a1f-945e-2122ab2b2776\napp_uid: 45d30b22-b09d-4d10-af41-11acd7437321\n"], ["created_at", "2018-10-18 04:24:00.130789"], ["updated_at", "2018-10-18 04:24:00.130789"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "45d30b22-b09d-4d10-af41-11acd7437321"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "02444857-fd19-4a1f-945e-2122ab2b2776"], ["name", "review"], ["created_at", "2018-10-18 04:24:00.138301"], ["updated_at", "2018-10-18 04:24:00.138301"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "02444857-fd19-4a1f-945e-2122ab2b2776"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"02444857-fd19-4a1f-945e-2122ab2b2776", "app_uid"=>"45d30b22-b09d-4d10-af41-11acd7437321"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2f361fc3-94a6-4afb-aee5-f3c4d7da705f"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 4f3afdcd-cbc5-4331-bbef-3387963eb6bd\nstage_uid: 02444857-fd19-4a1f-945e-2122ab2b2776\napp_uid: 45d30b22-b09d-4d10-af41-11acd7437321\n"], ["created_at", "2018-10-18 04:24:00.142067"], ["updated_at", "2018-10-18 04:24:00.142067"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "45d30b22-b09d-4d10-af41-11acd7437321"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "02444857-fd19-4a1f-945e-2122ab2b2776"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "4f3afdcd-cbc5-4331-bbef-3387963eb6bd"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:24:00.145353"], ["updated_at", "2018-10-18 04:24:00.145353"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"45d30b22-b09d-4d10-af41-11acd7437321"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "eb822705-1e00-4923-918b-fd5c0b9d175c"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 2d63c6e2-16c4-4dde-a381-a47f2e4daf56\napp_uid: 45d30b22-b09d-4d10-af41-11acd7437321\n"], ["created_at", "2018-10-18 04:24:00.149374"], ["updated_at", "2018-10-18 04:24:00.149374"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "45d30b22-b09d-4d10-af41-11acd7437321"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "2d63c6e2-16c4-4dde-a381-a47f2e4daf56"], ["name", "staging"], ["created_at", "2018-10-18 04:24:00.151975"], ["updated_at", "2018-10-18 04:24:00.151975"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2d63c6e2-16c4-4dde-a381-a47f2e4daf56"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"2d63c6e2-16c4-4dde-a381-a47f2e4daf56", "app_uid"=>"45d30b22-b09d-4d10-af41-11acd7437321"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ed8d0a3d-4fa0-4be6-9ddc-d212619fd4bf"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 5d495915-afc5-4868-b3f2-dee6669ddc65\nstage_uid: 2d63c6e2-16c4-4dde-a381-a47f2e4daf56\napp_uid: 45d30b22-b09d-4d10-af41-11acd7437321\n"], ["created_at", "2018-10-18 04:24:00.155214"], ["updated_at", "2018-10-18 04:24:00.155214"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "45d30b22-b09d-4d10-af41-11acd7437321"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2d63c6e2-16c4-4dde-a381-a47f2e4daf56"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "5d495915-afc5-4868-b3f2-dee6669ddc65"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:24:00.158845"], ["updated_at", "2018-10-18 04:24:00.158845"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 53ms (ActiveRecord: 3.7ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"45d30b22-b09d-4d10-af41-11acd7437321"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "efba5047-5d85-40e9-bfae-12fe295701ea"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 45d30b22-b09d-4d10-af41-11acd7437321\n"], ["created_at", "2018-10-18 04:24:00.183535"], ["updated_at", "2018-10-18 04:24:00.183535"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "45d30b22-b09d-4d10-af41-11acd7437321"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e5b3498c-69d3-4355-979a-27cfc8585565"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 3d0c65a5-dde7-435b-9de7-dcc5b20e50e7\n"], ["created_at", "2018-10-18 04:24:00.189047"], ["updated_at", "2018-10-18 04:24:00.189047"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"], ["name", "test"], ["created_at", "2018-10-18 04:24:00.191525"], ["updated_at", "2018-10-18 04:24:00.191525"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b79fdbdd-0aaf-476d-8734-3872f4933584"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 242deb6f-e391-4f91-849c-7be79bf3b367\napp_uid: 3d0c65a5-dde7-435b-9de7-dcc5b20e50e7\n"], ["created_at", "2018-10-18 04:24:00.193339"], ["updated_at", "2018-10-18 04:24:00.193339"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "242deb6f-e391-4f91-849c-7be79bf3b367"], ["name", "review"], ["created_at", "2018-10-18 04:24:00.195773"], ["updated_at", "2018-10-18 04:24:00.195773"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "242deb6f-e391-4f91-849c-7be79bf3b367"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"242deb6f-e391-4f91-849c-7be79bf3b367", "app_uid"=>"3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9dc5b0a4-09db-4d4e-a585-c96ab7e1c09d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 77395399-6290-4641-a800-85f72850e5e3\nstage_uid: 242deb6f-e391-4f91-849c-7be79bf3b367\napp_uid: 3d0c65a5-dde7-435b-9de7-dcc5b20e50e7\n"], ["created_at", "2018-10-18 04:24:00.198322"], ["updated_at", "2018-10-18 04:24:00.198322"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "242deb6f-e391-4f91-849c-7be79bf3b367"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "77395399-6290-4641-a800-85f72850e5e3"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:24:00.201292"], ["updated_at", "2018-10-18 04:24:00.201292"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0d61e7b5-c0be-4d8b-b095-c5f4402d36b2"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 51556076-d734-4cdc-830a-46a0312716cb\napp_uid: 3d0c65a5-dde7-435b-9de7-dcc5b20e50e7\n"], ["created_at", "2018-10-18 04:24:00.204293"], ["updated_at", "2018-10-18 04:24:00.204293"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "51556076-d734-4cdc-830a-46a0312716cb"], ["name", "staging"], ["created_at", "2018-10-18 04:24:00.206767"], ["updated_at", "2018-10-18 04:24:00.206767"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "51556076-d734-4cdc-830a-46a0312716cb"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"51556076-d734-4cdc-830a-46a0312716cb", "app_uid"=>"3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ca119968-4418-4427-90ba-c8b61713f81b"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 774708f5-59ed-4d55-9340-b93df808bc00\nstage_uid: 51556076-d734-4cdc-830a-46a0312716cb\napp_uid: 3d0c65a5-dde7-435b-9de7-dcc5b20e50e7\n"], ["created_at", "2018-10-18 04:24:00.209447"], ["updated_at", "2018-10-18 04:24:00.209447"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "51556076-d734-4cdc-830a-46a0312716cb"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "774708f5-59ed-4d55-9340-b93df808bc00"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:24:00.212576"], ["updated_at", "2018-10-18 04:24:00.212576"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 28ms (ActiveRecord: 3.0ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"3d0c65a5-dde7-435b-9de7-dcc5b20e50e7", :stage_uid=>"242deb6f-e391-4f91-849c-7be79bf3b367"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5b37727b-e630-4a2e-b5d4-c821cdfc0876"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: 3d0c65a5-dde7-435b-9de7-dcc5b20e50e7\nstage_uid: 242deb6f-e391-4f91-849c-7be79bf3b367\nbuild_uid: d9d612cc-f869-4d6b-96c3-d913686b771d\n"], ["created_at", "2018-10-18 04:24:00.218355"], ["updated_at", "2018-10-18 04:24:00.218355"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "3d0c65a5-dde7-435b-9de7-dcc5b20e50e7"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "242deb6f-e391-4f91-849c-7be79bf3b367"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "d9d612cc-f869-4d6b-96c3-d913686b771d"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:24:00.222516"], ["updated_at", "2018-10-18 04:24:00.222516"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 7ms (ActiveRecord: 0.7ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"d9d612cc-f869-4d6b-96c3-d913686b771d"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4178da80-b297-435d-ad8d-88527a6e8a18"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: d9d612cc-f869-4d6b-96c3-d913686b771d\nrelease_uid: e014ddd7-5e85-49ff-8d9e-e846095bcbea\n"], ["created_at", "2018-10-18 04:24:00.226748"], ["updated_at", "2018-10-18 04:24:00.226748"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d9d612cc-f869-4d6b-96c3-d913686b771d"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e014ddd7-5e85-49ff-8d9e-e846095bcbea"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:24:00.228614"], ["updated_at", "2018-10-18 04:24:00.228614"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 9539b585-199b-44c8-834e-1c1419eea0ef) to Async(default) with arguments: "4178da80-b297-435d-ad8d-88527a6e8a18"
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef] Performing ReleaseJob (Job ID: 9539b585-199b-44c8-834e-1c1419eea0ef) from Async(default) with arguments: "4178da80-b297-435d-ad8d-88527a6e8a18"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "4178da80-b297-435d-ad8d-88527a6e8a18"], ["LIMIT", 1]]
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mBuild Load (0.7ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d9d612cc-f869-4d6b-96c3-d913686b771d"], ["LIMIT", 1]]
Processing by ReleasesController#promote as HTML
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef] Executing command Releases::StatusCommand: {:release_uid=>"e014ddd7-5e85-49ff-8d9e-e846095bcbea", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c0205bad-2b5c-4807-a513-7529b1ae414e"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: e014ddd7-5e85-49ff-8d9e-e846095bcbea\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:24:00.235391"], ["updated_at", "2018-10-18 04:24:00.235391"]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "e014ddd7-5e85-49ff-8d9e-e846095bcbea"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:24:00.238096"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "73799759-f298-4a29-bb69-5cd96e068473"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: e014ddd7-5e85-49ff-8d9e-e846095bcbea\ncluster_uid: 77395399-6290-4641-a800-85f72850e5e3\ndeploy_uid: 055ac6db-83a0-4dad-84c9-f21a40c8f8c2\n"], ["created_at", "2018-10-18 04:24:00.242251"], ["updated_at", "2018-10-18 04:24:00.242251"]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "e014ddd7-5e85-49ff-8d9e-e846095bcbea"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "77395399-6290-4641-a800-85f72850e5e3"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "055ac6db-83a0-4dad-84c9-f21a40c8f8c2"], ["status", "PENDING"], ["created_at", "2018-10-18 04:24:00.245223"], ["updated_at", "2018-10-18 04:24:00.245223"]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef] Executing command Releases::StatusCommand: {:release_uid=>"e014ddd7-5e85-49ff-8d9e-e846095bcbea", :cluster_uid=>"77395399-6290-4641-a800-85f72850e5e3", :status=>"PENDING", :error=>nil}
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"d9d612cc-f869-4d6b-96c3-d913686b771d", :target_stage_uid=>"51556076-d734-4cdc-830a-46a0312716cb"}
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dc5b1691-a950-49cf-9d19-25d64472775b"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: e014ddd7-5e85-49ff-8d9e-e846095bcbea\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:24:00.247233"], ["updated_at", "2018-10-18 04:24:00.247233"]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "e014ddd7-5e85-49ff-8d9e-e846095bcbea"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "492315a5-4a6a-412d-8d02-086915168147"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: d9d612cc-f869-4d6b-96c3-d913686b771d\ntarget_stage_uid: 51556076-d734-4cdc-830a-46a0312716cb\nbuild_uid: 2d7f9782-8b9f-4f71-920b-39f2ad2a8bd3\n"], ["created_at", "2018-10-18 04:24:00.250327"], ["updated_at", "2018-10-18 04:24:00.250327"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d9d612cc-f869-4d6b-96c3-d913686b771d"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "51556076-d734-4cdc-830a-46a0312716cb"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:24:00.255091"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "2d7f9782-8b9f-4f71-920b-39f2ad2a8bd3"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:24:00.256891"], ["updated_at", "2018-10-18 04:24:00.256891"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 24ms (ActiveRecord: 1.2ms)
Started POST "/api/v1/apps/test/staging/release?version=v1" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"staging"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 3 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"2d7f9782-8b9f-4f71-920b-39f2ad2a8bd3"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "11331021-9104-4386-a8f1-c3035973af20"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 2d7f9782-8b9f-4f71-920b-39f2ad2a8bd3\nrelease_uid: 42bd6fef-2f0e-4cf2-8a51-da9f23a11902\n"], ["created_at", "2018-10-18 04:24:00.261230"], ["updated_at", "2018-10-18 04:24:00.261230"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "2d7f9782-8b9f-4f71-920b-39f2ad2a8bd3"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "42bd6fef-2f0e-4cf2-8a51-da9f23a11902"], ["build_id", 3], ["status", "INITIAL"], ["created_at", "2018-10-18 04:24:00.263745"], ["updated_at", "2018-10-18 04:24:00.263745"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 24cd4ec4-55f7-48bd-8b5f-3a08f097455b) to Async(default) with arguments: "11331021-9104-4386-a8f1-c3035973af20"
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b] Performing ReleaseJob (Job ID: 24cd4ec4-55f7-48bd-8b5f-3a08f097455b) from Async(default) with arguments: "11331021-9104-4386-a8f1-c3035973af20"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "11331021-9104-4386-a8f1-c3035973af20"], ["LIMIT", 1]]
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mBuild Load (0.7ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "2d7f9782-8b9f-4f71-920b-39f2ad2a8bd3"], ["LIMIT", 1]]
Processing by ReleasesController#remove as HTML
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b] Executing command Releases::StatusCommand: {:release_uid=>"42bd6fef-2f0e-4cf2-8a51-da9f23a11902", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "347aa1f9-9b20-46f2-800f-7398171eb56a"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 42bd6fef-2f0e-4cf2-8a51-da9f23a11902\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:24:00.269413"], ["updated_at", "2018-10-18 04:24:00.269413"]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "42bd6fef-2f0e-4cf2-8a51-da9f23a11902"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:24:00.272295"], ["id", 980190964]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7be0a846-5c66-433d-b103-cc8bdd78beab"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 42bd6fef-2f0e-4cf2-8a51-da9f23a11902\ncluster_uid: 774708f5-59ed-4d55-9340-b93df808bc00\ndeploy_uid: 258a5ade-85d1-4e91-ae1e-9b6e9f85e386\n"], ["created_at", "2018-10-18 04:24:00.277059"], ["updated_at", "2018-10-18 04:24:00.277059"]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "42bd6fef-2f0e-4cf2-8a51-da9f23a11902"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "774708f5-59ed-4d55-9340-b93df808bc00"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190964], ["uid", "258a5ade-85d1-4e91-ae1e-9b6e9f85e386"], ["status", "PENDING"], ["created_at", "2018-10-18 04:24:00.280043"], ["updated_at", "2018-10-18 04:24:00.280043"]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b] Executing command Releases::StatusCommand: {:release_uid=>"42bd6fef-2f0e-4cf2-8a51-da9f23a11902", :cluster_uid=>"774708f5-59ed-4d55-9340-b93df808bc00", :status=>"PENDING", :error=>nil}
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d967bfc-ca1b-4457-84ed-35c9ed5100dd"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 42bd6fef-2f0e-4cf2-8a51-da9f23a11902\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:24:00.282374"], ["updated_at", "2018-10-18 04:24:00.282374"]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "42bd6fef-2f0e-4cf2-8a51-da9f23a11902"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"e014ddd7-5e85-49ff-8d9e-e846095bcbea"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "234c7be3-fe39-4d0d-83d3-39a0dbccc1ca"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: e014ddd7-5e85-49ff-8d9e-e846095bcbea\nrelease_uid: 8ebd49f4-768b-421f-b3ea-da7c9ffbf81a\n"], ["created_at", "2018-10-18 04:24:00.286428"], ["updated_at", "2018-10-18 04:24:00.286428"]]
  [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "e014ddd7-5e85-49ff-8d9e-e846095bcbea"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8ebd49f4-768b-421f-b3ea-da7c9ffbf81a"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:24:00.289002"], ["updated_at", "2018-10-18 04:24:00.289002"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: 14f866e1-bf4c-4842-b208-85c2610e0b63) to Async(default) with arguments: "234c7be3-fe39-4d0d-83d3-39a0dbccc1ca"
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63] Performing ReleaseRemoveJob (Job ID: 14f866e1-bf4c-4842-b208-85c2610e0b63) from Async(default) with arguments: "234c7be3-fe39-4d0d-83d3-39a0dbccc1ca"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 23ms (ActiveRecord: 1.0ms)
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "234c7be3-fe39-4d0d-83d3-39a0dbccc1ca"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:24:00 -0700
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mRelease Load (0.8ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "e014ddd7-5e85-49ff-8d9e-e846095bcbea"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63] Executing command Releases::StatusCommand: {:release_uid=>"8ebd49f4-768b-421f-b3ea-da7c9ffbf81a", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "de3c8713-3c68-4ba5-ab74-f86245f936a8"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 8ebd49f4-768b-421f-b3ea-da7c9ffbf81a\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:24:00.295510"], ["updated_at", "2018-10-18 04:24:00.295510"]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "8ebd49f4-768b-421f-b3ea-da7c9ffbf81a"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:24:00.298029"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "79c65d17-c39e-4e67-842f-ddd8a841ea25"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 8ebd49f4-768b-421f-b3ea-da7c9ffbf81a\ncluster_uid: 77395399-6290-4641-a800-85f72850e5e3\ndeploy_uid: 96f403e3-7f7e-4482-8999-845fb3ac90b6\n"], ["created_at", "2018-10-18 04:24:00.301928"], ["updated_at", "2018-10-18 04:24:00.301928"]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "8ebd49f4-768b-421f-b3ea-da7c9ffbf81a"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "77395399-6290-4641-a800-85f72850e5e3"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190965], ["cluster_id", 980190963], ["uid", "96f403e3-7f7e-4482-8999-845fb3ac90b6"], ["status", "PENDING"], ["created_at", "2018-10-18 04:24:00.304699"], ["updated_at", "2018-10-18 04:24:00.304699"]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63] Executing command Releases::StatusCommand: {:release_uid=>"8ebd49f4-768b-421f-b3ea-da7c9ffbf81a", :cluster_uid=>"77395399-6290-4641-a800-85f72850e5e3", :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6bf21dab-43d6-42a2-b47c-713b65387afb"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 8ebd49f4-768b-421f-b3ea-da7c9ffbf81a\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:24:00.306813"], ["updated_at", "2018-10-18 04:24:00.306813"]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "8ebd49f4-768b-421f-b3ea-da7c9ffbf81a"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "REMOVED"], ["updated_at", "2018-10-18 04:24:00.309206"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63] Executing command Releases::StatusCommand: {:release_uid=>"8ebd49f4-768b-421f-b3ea-da7c9ffbf81a", :cluster_uid=>nil, :status=>"REMOVED", :error=>nil}
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bbd30415-1d08-4a97-805d-8cfdd3bd12e7"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 8ebd49f4-768b-421f-b3ea-da7c9ffbf81a\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:24:00.311219"], ["updated_at", "2018-10-18 04:24:00.311219"]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "8ebd49f4-768b-421f-b3ea-da7c9ffbf81a"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [14f866e1-bf4c-4842-b208-85c2610e0b63] Performed ReleaseRemoveJob (Job ID: 14f866e1-bf4c-4842-b208-85c2610e0b63) from Async(default) in 23.68ms
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 3) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
Completed 200 OK in 39ms (Views: 0.5ms | ActiveRecord: 2.5ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f03a0e2c-2815-4fcc-8ebe-01ba9ab89799"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 173e063a-eeca-49f0-932c-bd1eb1643542\n"], ["created_at", "2018-10-18 04:24:00.335770"], ["updated_at", "2018-10-18 04:24:00.335770"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "173e063a-eeca-49f0-932c-bd1eb1643542"], ["name", "test"], ["created_at", "2018-10-18 04:24:00.338730"], ["updated_at", "2018-10-18 04:24:00.338730"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a0456410-715d-4dce-8e43-298ed3a44fed"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: b59b68ca-e64f-43d9-b9a6-56d6adfde911\n"], ["created_at", "2018-10-18 04:24:00.341467"], ["updated_at", "2018-10-18 04:24:00.341467"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "b59b68ca-e64f-43d9-b9a6-56d6adfde911"], ["name", "test"], ["created_at", "2018-10-18 04:24:00.344526"], ["updated_at", "2018-10-18 04:24:00.344526"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a9ad26ed-1455-49c7-b02a-051b905dc01e"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:24:00.347608"], ["updated_at", "2018-10-18 04:24:00.347608"]]
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "55b13a31-3c81-4080-87c3-5e19d3753207"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:24:00.353895"], ["updated_at", "2018-10-18 04:24:00.353895"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "65003878-ec8d-43ba-b381-11f4750e4bdf"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: cfc24abe-84a2-4380-8305-d950415668ee\n"], ["created_at", "2018-10-18 04:24:00.358553"], ["updated_at", "2018-10-18 04:24:00.358553"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "cfc24abe-84a2-4380-8305-d950415668ee"], ["name", "test2"], ["created_at", "2018-10-18 04:24:00.362409"], ["updated_at", "2018-10-18 04:24:00.362409"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9b18edf8-23c6-41bb-9cf8-fc808d33ad4d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 24192736-0aec-4de4-885a-f0cc74167be8\n"], ["created_at", "2018-10-18 04:24:00.366732"], ["updated_at", "2018-10-18 04:24:00.366732"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "24192736-0aec-4de4-885a-f0cc74167be8"], ["name", "test2"], ["created_at", "2018-10-18 04:24:00.370680"], ["updated_at", "2018-10-18 04:24:00.370680"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9afa32eb-f054-44a4-87cd-c94a77803084"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:24:00.375125"], ["updated_at", "2018-10-18 04:24:00.375125"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:24:00.378852"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "acab3ea6-4852-4df5-9f93-7961990dfa50"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:24:00.381644"], ["updated_at", "2018-10-18 04:24:00.381644"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:24:00.383689"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "00f69eb4-b143-4d5d-930f-3d007f31d193"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 0b6b794e-987b-437c-96ef-b647f1d36b44\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:24:00.387498"], ["updated_at", "2018-10-18 04:24:00.387498"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "0b6b794e-987b-437c-96ef-b647f1d36b44"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:24:00.392499"], ["updated_at", "2018-10-18 04:24:00.392499"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [9539b585-199b-44c8-834e-1c1419eea0ef] Performed ReleaseJob (Job ID: 9539b585-199b-44c8-834e-1c1419eea0ef) from Async(default) in 165.2ms
[ActiveJob] [ReleaseJob] [24cd4ec4-55f7-48bd-8b5f-3a08f097455b] Performed ReleaseJob (Job ID: 24cd4ec4-55f7-48bd-8b5f-3a08f097455b) from Async(default) in 130.47ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:28:06.749656', '2018-10-18 04:28:06.749656')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:28:06.751957', '2018-10-18 04:28:06.751957')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:28:06.753432', '2018-10-18 04:28:06.753432', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:28:06.754915', '2018-10-18 04:28:06.754915')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:28:06.756284', '2018-10-18 04:28:06.756284', 980190962)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4ba1aca9-1b39-448f-a6cf-d1048f7e78da"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 8485769a-cab9-411b-98a8-68d1f3f2eb1e\n"], ["created_at", "2018-10-18 04:28:06.766546"], ["updated_at", "2018-10-18 04:28:06.766546"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "8485769a-cab9-411b-98a8-68d1f3f2eb1e"], ["name", "test"], ["created_at", "2018-10-18 04:28:06.772133"], ["updated_at", "2018-10-18 04:28:06.772133"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "52e8f925-db09-426c-8716-eda0b55a55fc"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:28:06.775840"], ["updated_at", "2018-10-18 04:28:06.775840"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:28:06.779010"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7024e3d4-ccee-4579-bb9e-698c93e73cff"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 8a2dfb28-65bb-4768-8d36-a0ef59c787b8\n"], ["created_at", "2018-10-18 04:28:06.787067"], ["updated_at", "2018-10-18 04:28:06.787067"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "8a2dfb28-65bb-4768-8d36-a0ef59c787b8"], ["name", "test2"], ["created_at", "2018-10-18 04:28:06.795146"], ["updated_at", "2018-10-18 04:28:06.795146"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "32c1bbfa-d570-4751-a938-054acfd6f9f9"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:28:06.797300"], ["updated_at", "2018-10-18 04:28:06.797300"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "80ac99e6-b9f5-4eef-9226-8c2fa4e29193"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:28:06.800794"], ["updated_at", "2018-10-18 04:28:06.800794"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "19243adf-dded-4d47-83b0-f667ce806bf2"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: a5ca99a5-5c3a-4771-82d9-d26bae255180\n"], ["created_at", "2018-10-18 04:28:06.805565"], ["updated_at", "2018-10-18 04:28:06.805565"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a5ca99a5-5c3a-4771-82d9-d26bae255180"], ["name", "test2"], ["created_at", "2018-10-18 04:28:06.808234"], ["updated_at", "2018-10-18 04:28:06.808234"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "15ed7956-d929-4b8c-9e10-45a045a8c23c"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: a9034785-fb84-4ed7-acd8-bbbae46a42ad\n"], ["created_at", "2018-10-18 04:28:06.810514"], ["updated_at", "2018-10-18 04:28:06.810514"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "a9034785-fb84-4ed7-acd8-bbbae46a42ad"], ["name", "test"], ["created_at", "2018-10-18 04:28:06.813160"], ["updated_at", "2018-10-18 04:28:06.813160"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5d8e4714-02e6-4543-8190-49b0987ab093"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:28:06.816132"], ["updated_at", "2018-10-18 04:28:06.816132"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:28:06.819081"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bc1a4c3e-f224-4b50-ac2c-0f3910ed6164"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: e900340f-7cdd-4fcd-a1b5-e0c2d28d790a\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:28:06.828603"], ["updated_at", "2018-10-18 04:28:06.828603"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "e900340f-7cdd-4fcd-a1b5-e0c2d28d790a"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:28:06.833964"], ["updated_at", "2018-10-18 04:28:06.833964"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:28:06 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "053235a2-7555-4f41-98be-0b67e884c920"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 4375c015-14d1-4323-9d08-5c0ddf5d4723\n"], ["created_at", "2018-10-18 04:28:06.850701"], ["updated_at", "2018-10-18 04:28:06.850701"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "4375c015-14d1-4323-9d08-5c0ddf5d4723"], ["name", "test"], ["created_at", "2018-10-18 04:28:06.853207"], ["updated_at", "2018-10-18 04:28:06.853207"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"4375c015-14d1-4323-9d08-5c0ddf5d4723"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e0a31fbd-564c-4909-85f7-2179a8768be7"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 2551c870-1d95-4eed-9755-e63a4273b42c\napp_uid: 4375c015-14d1-4323-9d08-5c0ddf5d4723\n"], ["created_at", "2018-10-18 04:28:06.855810"], ["updated_at", "2018-10-18 04:28:06.855810"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4375c015-14d1-4323-9d08-5c0ddf5d4723"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "2551c870-1d95-4eed-9755-e63a4273b42c"], ["name", "review"], ["created_at", "2018-10-18 04:28:06.858392"], ["updated_at", "2018-10-18 04:28:06.858392"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2551c870-1d95-4eed-9755-e63a4273b42c"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"2551c870-1d95-4eed-9755-e63a4273b42c", "app_uid"=>"4375c015-14d1-4323-9d08-5c0ddf5d4723"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cd48bf92-1023-477e-bbf5-958f0950bfa4"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 145fe3d6-e166-42c1-9cca-d431133873eb\nstage_uid: 2551c870-1d95-4eed-9755-e63a4273b42c\napp_uid: 4375c015-14d1-4323-9d08-5c0ddf5d4723\n"], ["created_at", "2018-10-18 04:28:06.861172"], ["updated_at", "2018-10-18 04:28:06.861172"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4375c015-14d1-4323-9d08-5c0ddf5d4723"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "2551c870-1d95-4eed-9755-e63a4273b42c"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "145fe3d6-e166-42c1-9cca-d431133873eb"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:28:06.864675"], ["updated_at", "2018-10-18 04:28:06.864675"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"4375c015-14d1-4323-9d08-5c0ddf5d4723"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6f88f192-cd63-40a8-a61a-c6bde9096006"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: e141cf3e-8f15-4d21-a8c5-e530e2286788\napp_uid: 4375c015-14d1-4323-9d08-5c0ddf5d4723\n"], ["created_at", "2018-10-18 04:28:06.869043"], ["updated_at", "2018-10-18 04:28:06.869043"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4375c015-14d1-4323-9d08-5c0ddf5d4723"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "e141cf3e-8f15-4d21-a8c5-e530e2286788"], ["name", "staging"], ["created_at", "2018-10-18 04:28:06.871608"], ["updated_at", "2018-10-18 04:28:06.871608"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e141cf3e-8f15-4d21-a8c5-e530e2286788"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"e141cf3e-8f15-4d21-a8c5-e530e2286788", "app_uid"=>"4375c015-14d1-4323-9d08-5c0ddf5d4723"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c8a9a8f2-0a61-4fa5-964b-64694136f30d"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 1815235c-e683-4856-bedf-76c025a92861\nstage_uid: e141cf3e-8f15-4d21-a8c5-e530e2286788\napp_uid: 4375c015-14d1-4323-9d08-5c0ddf5d4723\n"], ["created_at", "2018-10-18 04:28:06.874539"], ["updated_at", "2018-10-18 04:28:06.874539"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4375c015-14d1-4323-9d08-5c0ddf5d4723"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e141cf3e-8f15-4d21-a8c5-e530e2286788"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "1815235c-e683-4856-bedf-76c025a92861"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:28:06.882595"], ["updated_at", "2018-10-18 04:28:06.882595"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 43ms (ActiveRecord: 3.5ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:28:06 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:28:06 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"4375c015-14d1-4323-9d08-5c0ddf5d4723"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a86fde3f-b295-4d41-b0fb-f94aa9336d4b"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 4375c015-14d1-4323-9d08-5c0ddf5d4723\n"], ["created_at", "2018-10-18 04:28:06.902375"], ["updated_at", "2018-10-18 04:28:06.902375"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "4375c015-14d1-4323-9d08-5c0ddf5d4723"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:28:06 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fda25919-fc75-4cba-b2cf-5e7922427e3f"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 8822da93-9785-4364-8f00-2153d7f34951\n"], ["created_at", "2018-10-18 04:28:06.908389"], ["updated_at", "2018-10-18 04:28:06.908389"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "8822da93-9785-4364-8f00-2153d7f34951"], ["name", "test"], ["created_at", "2018-10-18 04:28:06.910940"], ["updated_at", "2018-10-18 04:28:06.910940"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"8822da93-9785-4364-8f00-2153d7f34951"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0e5e2911-c2c1-40d0-b38d-6f8bb59f6760"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 00f31047-eb5a-4d76-8c86-0d0980b500c3\napp_uid: 8822da93-9785-4364-8f00-2153d7f34951\n"], ["created_at", "2018-10-18 04:28:06.912711"], ["updated_at", "2018-10-18 04:28:06.912711"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "8822da93-9785-4364-8f00-2153d7f34951"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "00f31047-eb5a-4d76-8c86-0d0980b500c3"], ["name", "review"], ["created_at", "2018-10-18 04:28:06.915131"], ["updated_at", "2018-10-18 04:28:06.915131"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "00f31047-eb5a-4d76-8c86-0d0980b500c3"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"00f31047-eb5a-4d76-8c86-0d0980b500c3", "app_uid"=>"8822da93-9785-4364-8f00-2153d7f34951"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cdb2a418-4d3e-4657-a521-f43c8e7bc140"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 87a18ef9-9a6b-4b46-89b7-9027166cb1f4\nstage_uid: 00f31047-eb5a-4d76-8c86-0d0980b500c3\napp_uid: 8822da93-9785-4364-8f00-2153d7f34951\n"], ["created_at", "2018-10-18 04:28:06.917722"], ["updated_at", "2018-10-18 04:28:06.917722"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "8822da93-9785-4364-8f00-2153d7f34951"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "00f31047-eb5a-4d76-8c86-0d0980b500c3"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "87a18ef9-9a6b-4b46-89b7-9027166cb1f4"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:28:06.920762"], ["updated_at", "2018-10-18 04:28:06.920762"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"8822da93-9785-4364-8f00-2153d7f34951"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "cfce2e60-3f34-46e9-86a8-6cf7faa5aef8"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 19678874-bfab-4520-a24d-f177c69a94f5\napp_uid: 8822da93-9785-4364-8f00-2153d7f34951\n"], ["created_at", "2018-10-18 04:28:06.923705"], ["updated_at", "2018-10-18 04:28:06.923705"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "8822da93-9785-4364-8f00-2153d7f34951"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "19678874-bfab-4520-a24d-f177c69a94f5"], ["name", "staging"], ["created_at", "2018-10-18 04:28:06.926062"], ["updated_at", "2018-10-18 04:28:06.926062"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "19678874-bfab-4520-a24d-f177c69a94f5"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"19678874-bfab-4520-a24d-f177c69a94f5", "app_uid"=>"8822da93-9785-4364-8f00-2153d7f34951"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f063c65e-b13b-43ed-8e53-d32c0f505f98"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 8ad74448-adee-4c7c-b732-142230a39b64\nstage_uid: 19678874-bfab-4520-a24d-f177c69a94f5\napp_uid: 8822da93-9785-4364-8f00-2153d7f34951\n"], ["created_at", "2018-10-18 04:28:06.928664"], ["updated_at", "2018-10-18 04:28:06.928664"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "8822da93-9785-4364-8f00-2153d7f34951"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "19678874-bfab-4520-a24d-f177c69a94f5"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "8ad74448-adee-4c7c-b732-142230a39b64"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:28:06.931649"], ["updated_at", "2018-10-18 04:28:06.931649"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 27ms (ActiveRecord: 3.0ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:28:06 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"8822da93-9785-4364-8f00-2153d7f34951", :stage_uid=>"00f31047-eb5a-4d76-8c86-0d0980b500c3"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1cd3dab5-a339-4c2c-8a14-69b754bd7442"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: 8822da93-9785-4364-8f00-2153d7f34951\nstage_uid: 00f31047-eb5a-4d76-8c86-0d0980b500c3\nbuild_uid: dc69d263-b0dc-4be5-a0fb-e826381bd60e\n"], ["created_at", "2018-10-18 04:28:06.937234"], ["updated_at", "2018-10-18 04:28:06.937234"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "8822da93-9785-4364-8f00-2153d7f34951"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "00f31047-eb5a-4d76-8c86-0d0980b500c3"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "dc69d263-b0dc-4be5-a0fb-e826381bd60e"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:28:06.940510"], ["updated_at", "2018-10-18 04:28:06.940510"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:28:06 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"dc69d263-b0dc-4be5-a0fb-e826381bd60e"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f72c8897-fdef-4b96-9d9e-af4f77d113bf"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: dc69d263-b0dc-4be5-a0fb-e826381bd60e\nrelease_uid: b98918ac-b661-4a04-acfb-f12fa9abc50e\n"], ["created_at", "2018-10-18 04:28:06.944584"], ["updated_at", "2018-10-18 04:28:06.944584"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "dc69d263-b0dc-4be5-a0fb-e826381bd60e"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b98918ac-b661-4a04-acfb-f12fa9abc50e"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:28:06.949928"], ["updated_at", "2018-10-18 04:28:06.949928"]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636] Performing ReleaseJob (Job ID: ae51727b-3e79-440c-8a12-04dd138eb636) from Async(default) with arguments: "f72c8897-fdef-4b96-9d9e-af4f77d113bf"
[ActiveJob] Enqueued ReleaseJob (Job ID: ae51727b-3e79-440c-8a12-04dd138eb636) to Async(default) with arguments: "f72c8897-fdef-4b96-9d9e-af4f77d113bf"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 11ms (ActiveRecord: 0.7ms)
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:28:06 -0700
Processing by ReleasesController#promote as HTML
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "f72c8897-fdef-4b96-9d9e-af4f77d113bf"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "dc69d263-b0dc-4be5-a0fb-e826381bd60e"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"dc69d263-b0dc-4be5-a0fb-e826381bd60e", :target_stage_uid=>"19678874-bfab-4520-a24d-f177c69a94f5"}
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636] Executing command Releases::StatusCommand: {:release_uid=>"b98918ac-b661-4a04-acfb-f12fa9abc50e", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "910f1f80-9863-4279-a48b-747938857c43"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: dc69d263-b0dc-4be5-a0fb-e826381bd60e\ntarget_stage_uid: 19678874-bfab-4520-a24d-f177c69a94f5\nbuild_uid: 00084944-7f6d-423a-b9c7-ec40d3ea9069\n"], ["created_at", "2018-10-18 04:28:06.963589"], ["updated_at", "2018-10-18 04:28:06.963589"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "dc69d263-b0dc-4be5-a0fb-e826381bd60e"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "19678874-bfab-4520-a24d-f177c69a94f5"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:28:06.968961"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "00084944-7f6d-423a-b9c7-ec40d3ea9069"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:28:06.971363"], ["updated_at", "2018-10-18 04:28:06.971363"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 16ms (ActiveRecord: 1.2ms)
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e774ab16-2578-4543-8666-659ca83b5096"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b98918ac-b661-4a04-acfb-f12fa9abc50e\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:28:06.973160"], ["updated_at", "2018-10-18 04:28:06.973160"]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b98918ac-b661-4a04-acfb-f12fa9abc50e"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:28:06.976401"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/api/v1/apps/test/staging/release?version=v1" for 127.0.0.1 at 2018-10-17 21:28:06 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"staging"}
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mCluster Load (1.2ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0634c0c1-bedd-4f3c-8280-25cfeb82c30b"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b98918ac-b661-4a04-acfb-f12fa9abc50e\ncluster_uid: 87a18ef9-9a6b-4b46-89b7-9027166cb1f4\ndeploy_uid: 4416d284-083c-4767-a80f-cda16971c58c\n"], ["created_at", "2018-10-18 04:28:06.980968"], ["updated_at", "2018-10-18 04:28:06.980968"]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b98918ac-b661-4a04-acfb-f12fa9abc50e"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "87a18ef9-9a6b-4b46-89b7-9027166cb1f4"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "4416d284-083c-4767-a80f-cda16971c58c"], ["status", "PENDING"], ["created_at", "2018-10-18 04:28:06.989099"], ["updated_at", "2018-10-18 04:28:06.989099"]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636] Executing command Releases::StatusCommand: {:release_uid=>"b98918ac-b661-4a04-acfb-f12fa9abc50e", :cluster_uid=>"87a18ef9-9a6b-4b46-89b7-9027166cb1f4", :status=>"PENDING", :error=>nil}
  [1m[36mStage Load (0.3ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7efdb028-ec9f-4220-9545-cf970bc913ee"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b98918ac-b661-4a04-acfb-f12fa9abc50e\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:28:06.992053"], ["updated_at", "2018-10-18 04:28:06.992053"]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b98918ac-b661-4a04-acfb-f12fa9abc50e"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 3 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"00084944-7f6d-423a-b9c7-ec40d3ea9069"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a799c2d0-6d11-4efe-99f7-2bc15f99dbea"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 00084944-7f6d-423a-b9c7-ec40d3ea9069\nrelease_uid: 5d9cbab4-49fd-4f67-b266-e763e8fa53fa\n"], ["created_at", "2018-10-18 04:28:06.995782"], ["updated_at", "2018-10-18 04:28:06.995782"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "00084944-7f6d-423a-b9c7-ec40d3ea9069"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5d9cbab4-49fd-4f67-b266-e763e8fa53fa"], ["build_id", 3], ["status", "INITIAL"], ["created_at", "2018-10-18 04:28:06.998549"], ["updated_at", "2018-10-18 04:28:06.998549"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 3631b04f-80aa-4b13-a8da-4add64f2b00e) to Async(default) with arguments: "a799c2d0-6d11-4efe-99f7-2bc15f99dbea"
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e] Performing ReleaseJob (Job ID: 3631b04f-80aa-4b13-a8da-4add64f2b00e) from Async(default) with arguments: "a799c2d0-6d11-4efe-99f7-2bc15f99dbea"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 22ms (ActiveRecord: 0.9ms)
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "a799c2d0-6d11-4efe-99f7-2bc15f99dbea"], ["LIMIT", 1]]
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:28:07 -0700
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mBuild Load (1.3ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "00084944-7f6d-423a-b9c7-ec40d3ea9069"], ["LIMIT", 1]]
Processing by ReleasesController#remove as HTML
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e] Executing command Releases::StatusCommand: {:release_uid=>"5d9cbab4-49fd-4f67-b266-e763e8fa53fa", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "da54cbb4-147f-4d6e-bdb1-09193665f09d"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 5d9cbab4-49fd-4f67-b266-e763e8fa53fa\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:28:07.007069"], ["updated_at", "2018-10-18 04:28:07.007069"]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "5d9cbab4-49fd-4f67-b266-e763e8fa53fa"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:28:07.009983"], ["id", 980190964]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "524ed22e-166f-41b7-b435-d5c42c27dbcc"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 5d9cbab4-49fd-4f67-b266-e763e8fa53fa\ncluster_uid: 8ad74448-adee-4c7c-b732-142230a39b64\ndeploy_uid: cf436ee3-acff-4245-b153-cffec45b24d5\n"], ["created_at", "2018-10-18 04:28:07.014772"], ["updated_at", "2018-10-18 04:28:07.014772"]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "5d9cbab4-49fd-4f67-b266-e763e8fa53fa"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "8ad74448-adee-4c7c-b732-142230a39b64"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190964], ["uid", "cf436ee3-acff-4245-b153-cffec45b24d5"], ["status", "PENDING"], ["created_at", "2018-10-18 04:28:07.018141"], ["updated_at", "2018-10-18 04:28:07.018141"]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e] Executing command Releases::StatusCommand: {:release_uid=>"5d9cbab4-49fd-4f67-b266-e763e8fa53fa", :cluster_uid=>"8ad74448-adee-4c7c-b732-142230a39b64", :status=>"PENDING", :error=>nil}
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1d224564-0fe3-4c3f-9c71-e61800f75fd5"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 5d9cbab4-49fd-4f67-b266-e763e8fa53fa\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:28:07.021013"], ["updated_at", "2018-10-18 04:28:07.021013"]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "5d9cbab4-49fd-4f67-b266-e763e8fa53fa"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"b98918ac-b661-4a04-acfb-f12fa9abc50e"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bf141a2a-ea98-4ded-9d38-931b7f42660a"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: b98918ac-b661-4a04-acfb-f12fa9abc50e\nrelease_uid: 1b7d428e-d2ee-4f8a-a326-0b81bd627501\n"], ["created_at", "2018-10-18 04:28:07.025790"], ["updated_at", "2018-10-18 04:28:07.025790"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b98918ac-b661-4a04-acfb-f12fa9abc50e"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1b7d428e-d2ee-4f8a-a326-0b81bd627501"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:28:07.028956"], ["updated_at", "2018-10-18 04:28:07.028956"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: acd74a73-ffa3-4e13-8a39-7737d4ed5e9c) to Async(default) with arguments: "bf141a2a-ea98-4ded-9d38-931b7f42660a"
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c] Performing ReleaseRemoveJob (Job ID: acd74a73-ffa3-4e13-8a39-7737d4ed5e9c) from Async(default) with arguments: "bf141a2a-ea98-4ded-9d38-931b7f42660a"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 25ms (ActiveRecord: 1.1ms)
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "bf141a2a-ea98-4ded-9d38-931b7f42660a"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:28:07 -0700
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mRelease Load (0.7ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b98918ac-b661-4a04-acfb-f12fa9abc50e"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c] Executing command Releases::StatusCommand: {:release_uid=>"1b7d428e-d2ee-4f8a-a326-0b81bd627501", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c9aa28df-5ba4-4159-9590-9049f1864a66"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 1b7d428e-d2ee-4f8a-a326-0b81bd627501\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:28:07.035438"], ["updated_at", "2018-10-18 04:28:07.035438"]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "1b7d428e-d2ee-4f8a-a326-0b81bd627501"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:28:07.038030"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ad2964c1-4ffd-49ec-9128-17ce97e91da8"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 1b7d428e-d2ee-4f8a-a326-0b81bd627501\ncluster_uid: 87a18ef9-9a6b-4b46-89b7-9027166cb1f4\ndeploy_uid: e45aec25-aa97-4021-9825-22f383429d4d\n"], ["created_at", "2018-10-18 04:28:07.041937"], ["updated_at", "2018-10-18 04:28:07.041937"]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "1b7d428e-d2ee-4f8a-a326-0b81bd627501"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "87a18ef9-9a6b-4b46-89b7-9027166cb1f4"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190965], ["cluster_id", 980190963], ["uid", "e45aec25-aa97-4021-9825-22f383429d4d"], ["status", "PENDING"], ["created_at", "2018-10-18 04:28:07.044961"], ["updated_at", "2018-10-18 04:28:07.044961"]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c] Executing command Releases::StatusCommand: {:release_uid=>"1b7d428e-d2ee-4f8a-a326-0b81bd627501", :cluster_uid=>"87a18ef9-9a6b-4b46-89b7-9027166cb1f4", :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fe8431dd-7fe6-4943-a542-09daa9ce4280"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 1b7d428e-d2ee-4f8a-a326-0b81bd627501\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:28:07.047884"], ["updated_at", "2018-10-18 04:28:07.047884"]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "1b7d428e-d2ee-4f8a-a326-0b81bd627501"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "REMOVED"], ["updated_at", "2018-10-18 04:28:07.050455"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c] Executing command Releases::StatusCommand: {:release_uid=>"1b7d428e-d2ee-4f8a-a326-0b81bd627501", :cluster_uid=>nil, :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "236987da-a6ce-4e59-868a-c69605d96c86"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 1b7d428e-d2ee-4f8a-a326-0b81bd627501\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:28:07.053195"], ["updated_at", "2018-10-18 04:28:07.053195"]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "1b7d428e-d2ee-4f8a-a326-0b81bd627501"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [acd74a73-ffa3-4e13-8a39-7737d4ed5e9c] Performed ReleaseRemoveJob (Job ID: acd74a73-ffa3-4e13-8a39-7737d4ed5e9c) from Async(default) in 25.42ms
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 3) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
Completed 200 OK in 46ms (Views: 0.7ms | ActiveRecord: 2.2ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af8192b1-bae8-4401-a0ff-72fe7cebd448"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: bb116b09-f47a-4026-a483-4182c7315c92\n"], ["created_at", "2018-10-18 04:28:07.082775"], ["updated_at", "2018-10-18 04:28:07.082775"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bb116b09-f47a-4026-a483-4182c7315c92"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:28:07.085293"], ["updated_at", "2018-10-18 04:28:07.085293"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 9ef099f9-e7ba-4355-8dfe-4d07ca1f780b) to Async(default) with arguments: "af8192b1-bae8-4401-a0ff-72fe7cebd448"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b] Performing ReleaseJob (Job ID: 9ef099f9-e7ba-4355-8dfe-4d07ca1f780b) from Async(default) with arguments: "af8192b1-bae8-4401-a0ff-72fe7cebd448"
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "af8192b1-bae8-4401-a0ff-72fe7cebd448"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b] Executing command Releases::StatusCommand: {:release_uid=>"bb116b09-f47a-4026-a483-4182c7315c92", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
------------------------------------------
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a0878a32-c430-4bd9-8b9e-606125bcb4f2"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: bb116b09-f47a-4026-a483-4182c7315c92\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:28:07.091588"], ["updated_at", "2018-10-18 04:28:07.091588"]]
------------------------------------------
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "bb116b09-f47a-4026-a483-4182c7315c92"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b] Executing command Releases::StatusCommand: {:release_uid=>"bb116b09-f47a-4026-a483-4182c7315c92", :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Release>}
  [1m[36mRelease Load (0.4ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7bf6a04d-b59a-4e8d-9232-eee36a9ecc01"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: bb116b09-f47a-4026-a483-4182c7315c92\nstatus: ERRORED\n"], ["created_at", "2018-10-18 04:28:07.095501"], ["updated_at", "2018-10-18 04:28:07.095501"]]
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "bb116b09-f47a-4026-a483-4182c7315c92"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b]   [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [9ef099f9-e7ba-4355-8dfe-4d07ca1f780b] Error performing ReleaseJob (Job ID: 9ef099f9-e7ba-4355-8dfe-4d07ca1f780b) from Async(default) in 9.48ms: ActiveRecord::RecordNotFound (Couldn't find Release):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/core.rb:228:in `find_by!'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/dynamic_matchers.rb:66:in `find_by_uid!'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/release.rb:22:in `block in <class:Release>'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:14:in `block (2 levels) in play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `each'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `block in play'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:235:in `block in transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/transaction.rb:194:in `block in within_new_transaction'
/usr/lib/ruby/2.3.0/monitor.rb:214:in `mon_synchronize'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/transaction.rb:191:in `within_new_transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:235:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/transactions.rb:210:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:10:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mCluster Load (2.5ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f9f2037c-7b66-4ed7-ae84-0239dd67c5b2"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 0aa1ab82-b4f3-4630-964d-48ab2ecc0bd2\n"], ["created_at", "2018-10-18 04:28:07.099013"], ["updated_at", "2018-10-18 04:28:07.099013"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "0aa1ab82-b4f3-4630-964d-48ab2ecc0bd2"], ["status", "PENDING"], ["created_at", "2018-10-18 04:28:07.103188"], ["updated_at", "2018-10-18 04:28:07.103188"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [3631b04f-80aa-4b13-a8da-4add64f2b00e] Performed ReleaseJob (Job ID: 3631b04f-80aa-4b13-a8da-4add64f2b00e) from Async(default) in 104.28ms
[ActiveJob] [ReleaseJob] [ae51727b-3e79-440c-8a12-04dd138eb636] Performed ReleaseJob (Job ID: ae51727b-3e79-440c-8a12-04dd138eb636) from Async(default) in 152.92ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:34:54.167545', '2018-10-18 04:34:54.167545')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:34:54.170156', '2018-10-18 04:34:54.170156')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:34:54.171651', '2018-10-18 04:34:54.171651', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:34:54.172983', '2018-10-18 04:34:54.172983')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:34:54.174459', '2018-10-18 04:34:54.174459', 980190962)[0m
  [1m[35m (3.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0bb9a27b-7c45-4e0b-8fbc-bcb7319f33f7"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: a8ecece6-d872-43fa-830e-6e4fc18e8f71\n"], ["created_at", "2018-10-18 04:34:54.194729"], ["updated_at", "2018-10-18 04:34:54.194729"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a8ecece6-d872-43fa-830e-6e4fc18e8f71"], ["name", "test2"], ["created_at", "2018-10-18 04:34:54.203637"], ["updated_at", "2018-10-18 04:34:54.203637"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e54349ca-4729-4d58-bcb0-de87d8ae3eb1"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:34:54.205732"], ["updated_at", "2018-10-18 04:34:54.205732"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "20441426-37cf-4d1b-b463-c1fca262ced2"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 2e0898fd-d38e-410f-ac49-d16d9f269bfd\n"], ["created_at", "2018-10-18 04:34:54.210524"], ["updated_at", "2018-10-18 04:34:54.210524"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "2e0898fd-d38e-410f-ac49-d16d9f269bfd"], ["name", "test2"], ["created_at", "2018-10-18 04:34:54.213462"], ["updated_at", "2018-10-18 04:34:54.213462"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aa195aff-d4e5-4ab4-bef6-d0dff6c2af60"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 0ae2c89e-a961-45dd-8a3e-887fc8b15300\n"], ["created_at", "2018-10-18 04:34:54.215504"], ["updated_at", "2018-10-18 04:34:54.215504"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "0ae2c89e-a961-45dd-8a3e-887fc8b15300"], ["name", "test"], ["created_at", "2018-10-18 04:34:54.217587"], ["updated_at", "2018-10-18 04:34:54.217587"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "de1dcc4e-8e39-4bd8-a51f-ae69dbdbe582"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:34:54.219706"], ["updated_at", "2018-10-18 04:34:54.219706"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "78570c5a-e921-44dd-a2fd-9ab46cfe7fd7"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:34:54.224881"], ["updated_at", "2018-10-18 04:34:54.224881"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:34:54.228315"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "05139d33-0e30-480d-9740-2458d7f718c4"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:34:54.231171"], ["updated_at", "2018-10-18 04:34:54.231171"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:34:54.233089"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2aab07c2-bf27-4634-b0c5-e71cb60e38b2"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 95b6179c-a83d-4364-bdce-fe56fee8b449\n"], ["created_at", "2018-10-18 04:34:54.235691"], ["updated_at", "2018-10-18 04:34:54.235691"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "95b6179c-a83d-4364-bdce-fe56fee8b449"], ["name", "test"], ["created_at", "2018-10-18 04:34:54.238345"], ["updated_at", "2018-10-18 04:34:54.238345"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "85251783-7650-4c25-9356-b1a50e806c5d"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 4549449e-623b-4352-9d3f-98e7d054d1c9\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:34:54.248605"], ["updated_at", "2018-10-18 04:34:54.248605"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "4549449e-623b-4352-9d3f-98e7d054d1c9"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:34:54.254312"], ["updated_at", "2018-10-18 04:34:54.254312"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e1041e27-f6a8-4468-a487-c52508a7aa51"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: ac2a64d5-229b-46dd-8d83-28e3d10adcb2\n"], ["created_at", "2018-10-18 04:34:54.258791"], ["updated_at", "2018-10-18 04:34:54.258791"]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ac2a64d5-229b-46dd-8d83-28e3d10adcb2"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:34:54.265596"], ["updated_at", "2018-10-18 04:34:54.265596"]]
[ActiveJob] [ReleaseJob] [5b4bb050-a256-4203-8782-3a18b4106cf7] Performing ReleaseJob (Job ID: 5b4bb050-a256-4203-8782-3a18b4106cf7) from Async(default) with arguments: "e1041e27-f6a8-4468-a487-c52508a7aa51"
[ActiveJob] Enqueued ReleaseJob (Job ID: 5b4bb050-a256-4203-8782-3a18b4106cf7) to Async(default) with arguments: "e1041e27-f6a8-4468-a487-c52508a7aa51"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_deploy_a_release
------------------------------------------
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af993eea-aa62-4af4-adf3-45f6ba899799"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 860cf646-971b-4be4-adbf-b50b348ef626\n"], ["created_at", "2018-10-18 04:34:54.273579"], ["updated_at", "2018-10-18 04:34:54.273579"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "860cf646-971b-4be4-adbf-b50b348ef626"], ["status", "PENDING"], ["created_at", "2018-10-18 04:34:54.287503"], ["updated_at", "2018-10-18 04:34:54.287503"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [5b4bb050-a256-4203-8782-3a18b4106cf7]   [1m[36mEvent Load (13.2ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "e1041e27-f6a8-4468-a487-c52508a7aa51"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5b4bb050-a256-4203-8782-3a18b4106cf7] Executing command Releases::StatusCommand: {:release_uid=>nil, :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Event>}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [5b4bb050-a256-4203-8782-3a18b4106cf7] Error performing ReleaseJob (Job ID: 5b4bb050-a256-4203-8782-3a18b4106cf7) from Async(default) in 22.73ms: ValidationError (release_uid: ["must be filled"],event: Releases::ReleaseStatusEvent):
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:37:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "389def3c-bd18-46c4-836b-aef2ed3dce2f"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 20e39a25-7d99-4957-bdba-682bc8689a4b\n"], ["created_at", "2018-10-18 04:34:54.304253"], ["updated_at", "2018-10-18 04:34:54.304253"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "20e39a25-7d99-4957-bdba-682bc8689a4b"], ["name", "test"], ["created_at", "2018-10-18 04:34:54.306860"], ["updated_at", "2018-10-18 04:34:54.306860"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"20e39a25-7d99-4957-bdba-682bc8689a4b"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "91495513-bf7a-40a1-ab07-c0adbf6ddb0c"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: f441da7b-b3cc-4fa2-9808-c9a16b512b0b\napp_uid: 20e39a25-7d99-4957-bdba-682bc8689a4b\n"], ["created_at", "2018-10-18 04:34:54.309195"], ["updated_at", "2018-10-18 04:34:54.309195"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "20e39a25-7d99-4957-bdba-682bc8689a4b"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "f441da7b-b3cc-4fa2-9808-c9a16b512b0b"], ["name", "review"], ["created_at", "2018-10-18 04:34:54.311297"], ["updated_at", "2018-10-18 04:34:54.311297"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "f441da7b-b3cc-4fa2-9808-c9a16b512b0b"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"f441da7b-b3cc-4fa2-9808-c9a16b512b0b", "app_uid"=>"20e39a25-7d99-4957-bdba-682bc8689a4b"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "eda65aa7-4a9e-405a-8a2c-3b505fca4ec5"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: b4b3e89b-d69c-4ad1-9538-4d797b8ef9c8\nstage_uid: f441da7b-b3cc-4fa2-9808-c9a16b512b0b\napp_uid: 20e39a25-7d99-4957-bdba-682bc8689a4b\n"], ["created_at", "2018-10-18 04:34:54.314241"], ["updated_at", "2018-10-18 04:34:54.314241"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "20e39a25-7d99-4957-bdba-682bc8689a4b"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "f441da7b-b3cc-4fa2-9808-c9a16b512b0b"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "b4b3e89b-d69c-4ad1-9538-4d797b8ef9c8"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:34:54.316921"], ["updated_at", "2018-10-18 04:34:54.316921"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"20e39a25-7d99-4957-bdba-682bc8689a4b"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9f4a5cef-105b-4ae0-8529-f29cbb07c981"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 1b4babc5-45c7-4142-b2c2-faf287074b30\napp_uid: 20e39a25-7d99-4957-bdba-682bc8689a4b\n"], ["created_at", "2018-10-18 04:34:54.320599"], ["updated_at", "2018-10-18 04:34:54.320599"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "20e39a25-7d99-4957-bdba-682bc8689a4b"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "1b4babc5-45c7-4142-b2c2-faf287074b30"], ["name", "staging"], ["created_at", "2018-10-18 04:34:54.323183"], ["updated_at", "2018-10-18 04:34:54.323183"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1b4babc5-45c7-4142-b2c2-faf287074b30"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"1b4babc5-45c7-4142-b2c2-faf287074b30", "app_uid"=>"20e39a25-7d99-4957-bdba-682bc8689a4b"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "185fe411-d1ca-4ed7-857c-94f3a7357819"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 29a973e0-2704-4d03-9125-0535f1583fde\nstage_uid: 1b4babc5-45c7-4142-b2c2-faf287074b30\napp_uid: 20e39a25-7d99-4957-bdba-682bc8689a4b\n"], ["created_at", "2018-10-18 04:34:54.325746"], ["updated_at", "2018-10-18 04:34:54.325746"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "20e39a25-7d99-4957-bdba-682bc8689a4b"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "1b4babc5-45c7-4142-b2c2-faf287074b30"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "29a973e0-2704-4d03-9125-0535f1583fde"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:34:54.328752"], ["updated_at", "2018-10-18 04:34:54.328752"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 35ms (ActiveRecord: 3.3ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 10ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"20e39a25-7d99-4957-bdba-682bc8689a4b"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7836d5d9-9ba1-4815-9a62-e93c27b320b3"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: 20e39a25-7d99-4957-bdba-682bc8689a4b\n"], ["created_at", "2018-10-18 04:34:54.347541"], ["updated_at", "2018-10-18 04:34:54.347541"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "20e39a25-7d99-4957-bdba-682bc8689a4b"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7f6d9821-8bda-4a04-a164-6059c9dcde92"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 84bc5f00-6f8f-4377-b96a-688493304979\n"], ["created_at", "2018-10-18 04:34:54.353217"], ["updated_at", "2018-10-18 04:34:54.353217"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "84bc5f00-6f8f-4377-b96a-688493304979"], ["name", "test"], ["created_at", "2018-10-18 04:34:54.356234"], ["updated_at", "2018-10-18 04:34:54.356234"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"84bc5f00-6f8f-4377-b96a-688493304979"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6d664dab-d531-45c6-bf5c-ddd795bf8f31"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: f3867d10-c8fd-4737-8f0b-76e23967ec4c\napp_uid: 84bc5f00-6f8f-4377-b96a-688493304979\n"], ["created_at", "2018-10-18 04:34:54.358291"], ["updated_at", "2018-10-18 04:34:54.358291"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "84bc5f00-6f8f-4377-b96a-688493304979"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "f3867d10-c8fd-4737-8f0b-76e23967ec4c"], ["name", "review"], ["created_at", "2018-10-18 04:34:54.360550"], ["updated_at", "2018-10-18 04:34:54.360550"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "f3867d10-c8fd-4737-8f0b-76e23967ec4c"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"f3867d10-c8fd-4737-8f0b-76e23967ec4c", "app_uid"=>"84bc5f00-6f8f-4377-b96a-688493304979"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d06f4c01-5e2e-46f2-9162-aa91ef448201"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 75fbd8d4-b3c0-4864-9a9e-3e5aaed456ca\nstage_uid: f3867d10-c8fd-4737-8f0b-76e23967ec4c\napp_uid: 84bc5f00-6f8f-4377-b96a-688493304979\n"], ["created_at", "2018-10-18 04:34:54.363447"], ["updated_at", "2018-10-18 04:34:54.363447"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "84bc5f00-6f8f-4377-b96a-688493304979"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "f3867d10-c8fd-4737-8f0b-76e23967ec4c"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "75fbd8d4-b3c0-4864-9a9e-3e5aaed456ca"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:34:54.366827"], ["updated_at", "2018-10-18 04:34:54.366827"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"84bc5f00-6f8f-4377-b96a-688493304979"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "731ba89e-44df-4c67-aca3-34b4360f576b"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: dbc8101c-040a-46e6-a7fe-4ccc0acb81e5\napp_uid: 84bc5f00-6f8f-4377-b96a-688493304979\n"], ["created_at", "2018-10-18 04:34:54.370560"], ["updated_at", "2018-10-18 04:34:54.370560"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "84bc5f00-6f8f-4377-b96a-688493304979"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "dbc8101c-040a-46e6-a7fe-4ccc0acb81e5"], ["name", "staging"], ["created_at", "2018-10-18 04:34:54.372958"], ["updated_at", "2018-10-18 04:34:54.372958"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dbc8101c-040a-46e6-a7fe-4ccc0acb81e5"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"dbc8101c-040a-46e6-a7fe-4ccc0acb81e5", "app_uid"=>"84bc5f00-6f8f-4377-b96a-688493304979"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5522c3f8-339e-49fa-ac1b-39d25c2a720b"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: bdfaeddc-a712-48ce-8ecf-a6c64bc19fcb\nstage_uid: dbc8101c-040a-46e6-a7fe-4ccc0acb81e5\napp_uid: 84bc5f00-6f8f-4377-b96a-688493304979\n"], ["created_at", "2018-10-18 04:34:54.375720"], ["updated_at", "2018-10-18 04:34:54.375720"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "84bc5f00-6f8f-4377-b96a-688493304979"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dbc8101c-040a-46e6-a7fe-4ccc0acb81e5"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "bdfaeddc-a712-48ce-8ecf-a6c64bc19fcb"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:34:54.378458"], ["updated_at", "2018-10-18 04:34:54.378458"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 30ms (ActiveRecord: 3.2ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"84bc5f00-6f8f-4377-b96a-688493304979", :stage_uid=>"f3867d10-c8fd-4737-8f0b-76e23967ec4c"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "437d62b0-ebe9-4504-9b75-88a7486e39b1"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: 84bc5f00-6f8f-4377-b96a-688493304979\nstage_uid: f3867d10-c8fd-4737-8f0b-76e23967ec4c\nbuild_uid: d48cee12-9ef1-4051-853f-19d04320c2e2\n"], ["created_at", "2018-10-18 04:34:54.385142"], ["updated_at", "2018-10-18 04:34:54.385142"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "84bc5f00-6f8f-4377-b96a-688493304979"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "f3867d10-c8fd-4737-8f0b-76e23967ec4c"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "d48cee12-9ef1-4051-853f-19d04320c2e2"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:34:54.388384"], ["updated_at", "2018-10-18 04:34:54.388384"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.7ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"d48cee12-9ef1-4051-853f-19d04320c2e2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0a537e00-7215-41c8-a221-55e139354995"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: d48cee12-9ef1-4051-853f-19d04320c2e2\nrelease_uid: 6faff9a7-b682-4248-b186-bbb951051c1f\n"], ["created_at", "2018-10-18 04:34:54.392575"], ["updated_at", "2018-10-18 04:34:54.392575"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d48cee12-9ef1-4051-853f-19d04320c2e2"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "6faff9a7-b682-4248-b186-bbb951051c1f"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:34:54.394747"], ["updated_at", "2018-10-18 04:34:54.394747"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 47d2ee8a-1f20-4821-86fd-f6622657d0aa) to Async(default) with arguments: "0a537e00-7215-41c8-a221-55e139354995"
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa] Performing ReleaseJob (Job ID: 47d2ee8a-1f20-4821-86fd-f6622657d0aa) from Async(default) with arguments: "0a537e00-7215-41c8-a221-55e139354995"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "0a537e00-7215-41c8-a221-55e139354995"], ["LIMIT", 1]]
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mBuild Load (0.8ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d48cee12-9ef1-4051-853f-19d04320c2e2"], ["LIMIT", 1]]
Processing by ReleasesController#promote as HTML
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa] Executing command Releases::StatusCommand: {:release_uid=>"6faff9a7-b682-4248-b186-bbb951051c1f", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c5454630-eb83-4b0b-8efc-4379b6dc4701"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 6faff9a7-b682-4248-b186-bbb951051c1f\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:34:54.401461"], ["updated_at", "2018-10-18 04:34:54.401461"]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "6faff9a7-b682-4248-b186-bbb951051c1f"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:34:54.404246"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3211497b-360a-4aa1-a567-9ad789a6e3a3"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 6faff9a7-b682-4248-b186-bbb951051c1f\ncluster_uid: 75fbd8d4-b3c0-4864-9a9e-3e5aaed456ca\ndeploy_uid: 59e270b6-e05c-46e1-b951-81b0b0075c74\n"], ["created_at", "2018-10-18 04:34:54.407815"], ["updated_at", "2018-10-18 04:34:54.407815"]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "6faff9a7-b682-4248-b186-bbb951051c1f"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "75fbd8d4-b3c0-4864-9a9e-3e5aaed456ca"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "59e270b6-e05c-46e1-b951-81b0b0075c74"], ["status", "PENDING"], ["created_at", "2018-10-18 04:34:54.410648"], ["updated_at", "2018-10-18 04:34:54.410648"]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa] Executing command Releases::StatusCommand: {:release_uid=>"6faff9a7-b682-4248-b186-bbb951051c1f", :cluster_uid=>"75fbd8d4-b3c0-4864-9a9e-3e5aaed456ca", :status=>"PENDING", :error=>nil}
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"d48cee12-9ef1-4051-853f-19d04320c2e2", :target_stage_uid=>"dbc8101c-040a-46e6-a7fe-4ccc0acb81e5"}
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9b1d4dfc-e3e3-4207-9904-7f4892ea35ce"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 6faff9a7-b682-4248-b186-bbb951051c1f\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:34:54.412650"], ["updated_at", "2018-10-18 04:34:54.412650"]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "6faff9a7-b682-4248-b186-bbb951051c1f"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3d5f3aa4-0af4-414c-808f-f8f854d9ca3d"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: d48cee12-9ef1-4051-853f-19d04320c2e2\ntarget_stage_uid: dbc8101c-040a-46e6-a7fe-4ccc0acb81e5\nbuild_uid: 9059d9d3-228f-4c15-bc88-83ef33f7c174\n"], ["created_at", "2018-10-18 04:34:54.416070"], ["updated_at", "2018-10-18 04:34:54.416070"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d48cee12-9ef1-4051-853f-19d04320c2e2"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "dbc8101c-040a-46e6-a7fe-4ccc0acb81e5"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:34:54.420513"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "9059d9d3-228f-4c15-bc88-83ef33f7c174"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:34:54.422227"], ["updated_at", "2018-10-18 04:34:54.422227"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 23ms (ActiveRecord: 1.2ms)
Started POST "/api/v1/apps/test/staging/release?version=v1" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"staging"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 3 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"9059d9d3-228f-4c15-bc88-83ef33f7c174"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d0417531-832e-4213-9957-f73a2d908acb"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: 9059d9d3-228f-4c15-bc88-83ef33f7c174\nrelease_uid: 5fcd8a3c-d384-4f2b-a276-999d6e385e44\n"], ["created_at", "2018-10-18 04:34:54.426095"], ["updated_at", "2018-10-18 04:34:54.426095"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "9059d9d3-228f-4c15-bc88-83ef33f7c174"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5fcd8a3c-d384-4f2b-a276-999d6e385e44"], ["build_id", 3], ["status", "INITIAL"], ["created_at", "2018-10-18 04:34:54.428337"], ["updated_at", "2018-10-18 04:34:54.428337"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: cbecfde2-fce6-415c-81e2-22ef64d5d0db) to Async(default) with arguments: "d0417531-832e-4213-9957-f73a2d908acb"
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db] Performing ReleaseJob (Job ID: cbecfde2-fce6-415c-81e2-22ef64d5d0db) from Async(default) with arguments: "d0417531-832e-4213-9957-f73a2d908acb"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (ActiveRecord: 0.6ms)
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "d0417531-832e-4213-9957-f73a2d908acb"], ["LIMIT", 1]]
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mBuild Load (0.8ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "9059d9d3-228f-4c15-bc88-83ef33f7c174"], ["LIMIT", 1]]
Processing by ReleasesController#remove as HTML
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db] Executing command Releases::StatusCommand: {:release_uid=>"5fcd8a3c-d384-4f2b-a276-999d6e385e44", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a2c1ec09-04a0-420b-8a9c-40f0f6fd9760"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 5fcd8a3c-d384-4f2b-a276-999d6e385e44\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:34:54.435443"], ["updated_at", "2018-10-18 04:34:54.435443"]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "5fcd8a3c-d384-4f2b-a276-999d6e385e44"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:34:54.438060"], ["id", 980190964]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d6016e6c-07d3-433c-806e-3a77e580b906"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 5fcd8a3c-d384-4f2b-a276-999d6e385e44\ncluster_uid: bdfaeddc-a712-48ce-8ecf-a6c64bc19fcb\ndeploy_uid: 2bd5dbcb-e130-47c9-9db6-f899668fefd8\n"], ["created_at", "2018-10-18 04:34:54.441885"], ["updated_at", "2018-10-18 04:34:54.441885"]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "5fcd8a3c-d384-4f2b-a276-999d6e385e44"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "bdfaeddc-a712-48ce-8ecf-a6c64bc19fcb"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190964], ["uid", "2bd5dbcb-e130-47c9-9db6-f899668fefd8"], ["status", "PENDING"], ["created_at", "2018-10-18 04:34:54.444648"], ["updated_at", "2018-10-18 04:34:54.444648"]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db] Executing command Releases::StatusCommand: {:release_uid=>"5fcd8a3c-d384-4f2b-a276-999d6e385e44", :cluster_uid=>"bdfaeddc-a712-48ce-8ecf-a6c64bc19fcb", :status=>"PENDING", :error=>nil}
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "67ca8c4b-c84f-4981-803a-6d1056f93a90"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 5fcd8a3c-d384-4f2b-a276-999d6e385e44\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:34:54.446818"], ["updated_at", "2018-10-18 04:34:54.446818"]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "5fcd8a3c-d384-4f2b-a276-999d6e385e44"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"6faff9a7-b682-4248-b186-bbb951051c1f"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "572c265d-72d4-45b4-aef5-89e83d697cc9"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: 6faff9a7-b682-4248-b186-bbb951051c1f\nrelease_uid: 7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d\n"], ["created_at", "2018-10-18 04:34:54.450495"], ["updated_at", "2018-10-18 04:34:54.450495"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "6faff9a7-b682-4248-b186-bbb951051c1f"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:34:54.453157"], ["updated_at", "2018-10-18 04:34:54.453157"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: 10372f36-3012-4eb2-846a-da71bf3a9751) to Async(default) with arguments: "572c265d-72d4-45b4-aef5-89e83d697cc9"
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751] Performing ReleaseRemoveJob (Job ID: 10372f36-3012-4eb2-846a-da71bf3a9751) from Async(default) with arguments: "572c265d-72d4-45b4-aef5-89e83d697cc9"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 21ms (ActiveRecord: 0.9ms)
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "572c265d-72d4-45b4-aef5-89e83d697cc9"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:34:54 -0700
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mRelease Load (0.7ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "6faff9a7-b682-4248-b186-bbb951051c1f"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751] Executing command Releases::StatusCommand: {:release_uid=>"7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "48967e32-f73f-425d-822a-00938509a8e6"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:34:54.459634"], ["updated_at", "2018-10-18 04:34:54.459634"]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:34:54.462106"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "745f8b99-50ba-4b5f-ae16-a3fb0ed56d57"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d\ncluster_uid: 75fbd8d4-b3c0-4864-9a9e-3e5aaed456ca\ndeploy_uid: 5adc9e83-ae84-404a-9031-8a7ec6517647\n"], ["created_at", "2018-10-18 04:34:54.466076"], ["updated_at", "2018-10-18 04:34:54.466076"]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "75fbd8d4-b3c0-4864-9a9e-3e5aaed456ca"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190965], ["cluster_id", 980190963], ["uid", "5adc9e83-ae84-404a-9031-8a7ec6517647"], ["status", "PENDING"], ["created_at", "2018-10-18 04:34:54.469031"], ["updated_at", "2018-10-18 04:34:54.469031"]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751] Executing command Releases::StatusCommand: {:release_uid=>"7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d", :cluster_uid=>"75fbd8d4-b3c0-4864-9a9e-3e5aaed456ca", :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "58bf41f4-b9ee-43c4-908c-32babbca477b"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:34:54.472235"], ["updated_at", "2018-10-18 04:34:54.472235"]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "REMOVED"], ["updated_at", "2018-10-18 04:34:54.474970"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751] Executing command Releases::StatusCommand: {:release_uid=>"7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d", :cluster_uid=>nil, :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4cee78a3-f86b-4ed2-8c81-7b13eaba435f"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:34:54.477157"], ["updated_at", "2018-10-18 04:34:54.477157"]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "7acf26f5-9d4c-4cce-afbe-fdf9e6e7781d"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [10372f36-3012-4eb2-846a-da71bf3a9751] Performed ReleaseRemoveJob (Job ID: 10372f36-3012-4eb2-846a-da71bf3a9751) from Async(default) in 25.28ms
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 3) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
Completed 200 OK in 41ms (Views: 0.7ms | ActiveRecord: 2.2ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [cbecfde2-fce6-415c-81e2-22ef64d5d0db] Performed ReleaseJob (Job ID: cbecfde2-fce6-415c-81e2-22ef64d5d0db) from Async(default) in 70.11ms
[ActiveJob] [ReleaseJob] [47d2ee8a-1f20-4821-86fd-f6622657d0aa] Performed ReleaseJob (Job ID: 47d2ee8a-1f20-4821-86fd-f6622657d0aa) from Async(default) in 103.9ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:36:19.786144', '2018-10-18 04:36:19.786144')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:36:19.788524', '2018-10-18 04:36:19.788524')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:36:19.790165', '2018-10-18 04:36:19.790165', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:36:19.791645', '2018-10-18 04:36:19.791645')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:36:19.793165', '2018-10-18 04:36:19.793165', 980190962)[0m
  [1m[35m (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:36:19 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0dd71d1d-e02d-41c1-b619-bae242c73b7a"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 6e8f7204-5103-4eb8-b539-3b36dbb04219\n"], ["created_at", "2018-10-18 04:36:19.816940"], ["updated_at", "2018-10-18 04:36:19.816940"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "6e8f7204-5103-4eb8-b539-3b36dbb04219"], ["name", "test"], ["created_at", "2018-10-18 04:36:19.822455"], ["updated_at", "2018-10-18 04:36:19.822455"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"6e8f7204-5103-4eb8-b539-3b36dbb04219"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c6ffbabb-76d8-4373-b451-162e3f4a4fd8"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 84e4e3c3-0877-42e0-b96d-20b40635905a\napp_uid: 6e8f7204-5103-4eb8-b539-3b36dbb04219\n"], ["created_at", "2018-10-18 04:36:19.825213"], ["updated_at", "2018-10-18 04:36:19.825213"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "6e8f7204-5103-4eb8-b539-3b36dbb04219"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "84e4e3c3-0877-42e0-b96d-20b40635905a"], ["name", "review"], ["created_at", "2018-10-18 04:36:19.832752"], ["updated_at", "2018-10-18 04:36:19.832752"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "84e4e3c3-0877-42e0-b96d-20b40635905a"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"84e4e3c3-0877-42e0-b96d-20b40635905a", "app_uid"=>"6e8f7204-5103-4eb8-b539-3b36dbb04219"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a0a7c91a-db26-46ae-aaa1-e482a2462ccd"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 80ff5703-b988-41c4-981d-dad3ada0d2df\nstage_uid: 84e4e3c3-0877-42e0-b96d-20b40635905a\napp_uid: 6e8f7204-5103-4eb8-b539-3b36dbb04219\n"], ["created_at", "2018-10-18 04:36:19.836366"], ["updated_at", "2018-10-18 04:36:19.836366"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "6e8f7204-5103-4eb8-b539-3b36dbb04219"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "84e4e3c3-0877-42e0-b96d-20b40635905a"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "80ff5703-b988-41c4-981d-dad3ada0d2df"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:36:19.843636"], ["updated_at", "2018-10-18 04:36:19.843636"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"6e8f7204-5103-4eb8-b539-3b36dbb04219"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "58378710-5cdf-4879-ac0b-b3670a59e137"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 761c45f5-faf6-4e65-9772-13a17d63dfff\napp_uid: 6e8f7204-5103-4eb8-b539-3b36dbb04219\n"], ["created_at", "2018-10-18 04:36:19.848343"], ["updated_at", "2018-10-18 04:36:19.848343"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "6e8f7204-5103-4eb8-b539-3b36dbb04219"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "761c45f5-faf6-4e65-9772-13a17d63dfff"], ["name", "staging"], ["created_at", "2018-10-18 04:36:19.851237"], ["updated_at", "2018-10-18 04:36:19.851237"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "761c45f5-faf6-4e65-9772-13a17d63dfff"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"761c45f5-faf6-4e65-9772-13a17d63dfff", "app_uid"=>"6e8f7204-5103-4eb8-b539-3b36dbb04219"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1954cc59-e275-4f17-9099-f19ad911f59c"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: c79a38b3-4a61-46f4-9452-9fdd990ea9eb\nstage_uid: 761c45f5-faf6-4e65-9772-13a17d63dfff\napp_uid: 6e8f7204-5103-4eb8-b539-3b36dbb04219\n"], ["created_at", "2018-10-18 04:36:19.854528"], ["updated_at", "2018-10-18 04:36:19.854528"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "6e8f7204-5103-4eb8-b539-3b36dbb04219"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "761c45f5-faf6-4e65-9772-13a17d63dfff"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "c79a38b3-4a61-46f4-9452-9fdd990ea9eb"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:36:19.857576"], ["updated_at", "2018-10-18 04:36:19.857576"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 56ms (ActiveRecord: 4.0ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:36:19 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"6e8f7204-5103-4eb8-b539-3b36dbb04219", :stage_uid=>"84e4e3c3-0877-42e0-b96d-20b40635905a"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8c616434-5bbe-4fbb-9875-faf6dc34d681"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: 6e8f7204-5103-4eb8-b539-3b36dbb04219\nstage_uid: 84e4e3c3-0877-42e0-b96d-20b40635905a\nbuild_uid: d0ebd184-d36c-4028-b4c8-88cd035fce99\n"], ["created_at", "2018-10-18 04:36:19.866081"], ["updated_at", "2018-10-18 04:36:19.866081"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "6e8f7204-5103-4eb8-b539-3b36dbb04219"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "84e4e3c3-0877-42e0-b96d-20b40635905a"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "d0ebd184-d36c-4028-b4c8-88cd035fce99"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:36:19.876093"], ["updated_at", "2018-10-18 04:36:19.876093"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 13ms (ActiveRecord: 0.9ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:36:19 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"d0ebd184-d36c-4028-b4c8-88cd035fce99"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3f5e9088-70f7-45a0-9d86-67dffac5adbb"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: d0ebd184-d36c-4028-b4c8-88cd035fce99\nrelease_uid: 7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e\n"], ["created_at", "2018-10-18 04:36:19.881967"], ["updated_at", "2018-10-18 04:36:19.881967"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d0ebd184-d36c-4028-b4c8-88cd035fce99"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:36:19.887919"], ["updated_at", "2018-10-18 04:36:19.887919"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 88bb5d4a-4dbe-4313-87cc-1f57fee080c4) to Async(default) with arguments: "3f5e9088-70f7-45a0-9d86-67dffac5adbb"
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4] Performing ReleaseJob (Job ID: 88bb5d4a-4dbe-4313-87cc-1f57fee080c4) from Async(default) with arguments: "3f5e9088-70f7-45a0-9d86-67dffac5adbb"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 12ms (ActiveRecord: 0.8ms)
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:36:19 -0700
Processing by ReleasesController#promote as HTML
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"d0ebd184-d36c-4028-b4c8-88cd035fce99", :target_stage_uid=>"761c45f5-faf6-4e65-9772-13a17d63dfff"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0ce47b64-a734-4b4e-bd19-2eb13e45776e"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: d0ebd184-d36c-4028-b4c8-88cd035fce99\ntarget_stage_uid: 761c45f5-faf6-4e65-9772-13a17d63dfff\nbuild_uid: aed495c0-4fed-488c-9623-fe1941caeccb\n"], ["created_at", "2018-10-18 04:36:19.898280"], ["updated_at", "2018-10-18 04:36:19.898280"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d0ebd184-d36c-4028-b4c8-88cd035fce99"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "761c45f5-faf6-4e65-9772-13a17d63dfff"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:36:19.908675"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "aed495c0-4fed-488c-9623-fe1941caeccb"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:36:19.911361"], ["updated_at", "2018-10-18 04:36:19.911361"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 18ms (ActiveRecord: 1.3ms)
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "3f5e9088-70f7-45a0-9d86-67dffac5adbb"], ["LIMIT", 1]]
Started POST "/api/v1/apps/test/staging/release?version=v1" for 127.0.0.1 at 2018-10-17 21:36:19 -0700
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mBuild Load (0.6ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d0ebd184-d36c-4028-b4c8-88cd035fce99"], ["LIMIT", 1]]
Processing by ReleasesController#release as HTML
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"staging"}
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4] Executing command Releases::StatusCommand: {:release_uid=>"7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "dafab31e-2d6e-4c89-9a2e-39a74f715b9a"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:19.917135"], ["updated_at", "2018-10-18 04:36:19.917135"]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:36:19.920542"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 3 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"aed495c0-4fed-488c-9623-fe1941caeccb"}
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a4713e5f-d5fb-4396-b68d-d5754c173ea1"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e\ncluster_uid: 80ff5703-b988-41c4-981d-dad3ada0d2df\ndeploy_uid: 235fe9e0-2b8e-4ad5-b939-fb3c9858f647\n"], ["created_at", "2018-10-18 04:36:19.924052"], ["updated_at", "2018-10-18 04:36:19.924052"]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "80ff5703-b988-41c4-981d-dad3ada0d2df"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "235fe9e0-2b8e-4ad5-b939-fb3c9858f647"], ["status", "PENDING"], ["created_at", "2018-10-18 04:36:19.932643"], ["updated_at", "2018-10-18 04:36:19.932643"]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4] Executing command Releases::StatusCommand: {:release_uid=>"7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e", :cluster_uid=>"80ff5703-b988-41c4-981d-dad3ada0d2df", :status=>"PENDING", :error=>nil}
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0cb5882f-e302-4062-b4ba-cabc49b589f7"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: aed495c0-4fed-488c-9623-fe1941caeccb\nrelease_uid: e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c\n"], ["created_at", "2018-10-18 04:36:19.934605"], ["updated_at", "2018-10-18 04:36:19.934605"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "aed495c0-4fed-488c-9623-fe1941caeccb"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c"], ["build_id", 3], ["status", "INITIAL"], ["created_at", "2018-10-18 04:36:19.936605"], ["updated_at", "2018-10-18 04:36:19.936605"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: ca43f69e-4e04-43e2-8487-b82da4878523) to Async(default) with arguments: "0cb5882f-e302-4062-b4ba-cabc49b589f7"
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523] Performing ReleaseJob (Job ID: ca43f69e-4e04-43e2-8487-b82da4878523) from Async(default) with arguments: "0cb5882f-e302-4062-b4ba-cabc49b589f7"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 23ms (ActiveRecord: 0.9ms)
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "34eacdfe-c3c8-4205-a177-8455337b0896"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:19.939220"], ["updated_at", "2018-10-18 04:36:19.939220"]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "0cb5882f-e302-4062-b4ba-cabc49b589f7"], ["LIMIT", 1]]
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:36:19 -0700
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mBuild Load (0.8ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "aed495c0-4fed-488c-9623-fe1941caeccb"], ["LIMIT", 1]]
Processing by ReleasesController#remove as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523] Executing command Releases::StatusCommand: {:release_uid=>"e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4e917d0b-efa5-4770-ad57-09cce8df24ad"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:19.946629"], ["updated_at", "2018-10-18 04:36:19.946629"]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:36:19.949026"], ["id", 980190964]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8a156911-3b71-4a79-90cc-e7bc89dee0b8"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c\ncluster_uid: c79a38b3-4a61-46f4-9452-9fdd990ea9eb\ndeploy_uid: ebc12152-09b5-4430-bf79-02520d68d983\n"], ["created_at", "2018-10-18 04:36:19.955276"], ["updated_at", "2018-10-18 04:36:19.955276"]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "c79a38b3-4a61-46f4-9452-9fdd990ea9eb"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190964], ["uid", "ebc12152-09b5-4430-bf79-02520d68d983"], ["status", "PENDING"], ["created_at", "2018-10-18 04:36:19.957727"], ["updated_at", "2018-10-18 04:36:19.957727"]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523] Executing command Releases::StatusCommand: {:release_uid=>"e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c", :cluster_uid=>"c79a38b3-4a61-46f4-9452-9fdd990ea9eb", :status=>"PENDING", :error=>nil}
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4d38d4e1-f8d6-408c-8c30-a6590dd438e5"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:19.959994"], ["updated_at", "2018-10-18 04:36:19.959994"]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "e30e6df0-df55-4c33-b0ad-0f7b60ba0f3c"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5d4765c0-56d4-4167-8db1-84122389a5b0"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: 7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e\nrelease_uid: f7a2fa72-374a-4c5d-9d79-bced82ebc7ba\n"], ["created_at", "2018-10-18 04:36:19.963622"], ["updated_at", "2018-10-18 04:36:19.963622"]]
  [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f7a2fa72-374a-4c5d-9d79-bced82ebc7ba"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:36:19.966084"], ["updated_at", "2018-10-18 04:36:19.966084"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: a0239ea5-8dc1-4cba-9710-e7d241555b08) to Async(default) with arguments: "5d4765c0-56d4-4167-8db1-84122389a5b0"
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08] Performing ReleaseRemoveJob (Job ID: a0239ea5-8dc1-4cba-9710-e7d241555b08) from Async(default) with arguments: "5d4765c0-56d4-4167-8db1-84122389a5b0"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 23ms (ActiveRecord: 0.9ms)
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "5d4765c0-56d4-4167-8db1-84122389a5b0"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:36:19 -0700
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mRelease Load (0.7ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "7ba5ce7e-b8a6-4142-b13a-e3e02cb1e03e"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08] Executing command Releases::StatusCommand: {:release_uid=>"f7a2fa72-374a-4c5d-9d79-bced82ebc7ba", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bed0ee85-7b7c-4aee-98ec-1b93f49de699"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: f7a2fa72-374a-4c5d-9d79-bced82ebc7ba\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:19.972738"], ["updated_at", "2018-10-18 04:36:19.972738"]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "f7a2fa72-374a-4c5d-9d79-bced82ebc7ba"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:36:19.975218"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 500 Internal Server Error in 7ms (ActiveRecord: 0.1ms)
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5d351661-f7ee-4e87-b097-1ceb64b09c81"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: f7a2fa72-374a-4c5d-9d79-bced82ebc7ba\ncluster_uid: 80ff5703-b988-41c4-981d-dad3ada0d2df\ndeploy_uid: aea9de05-5dc9-415b-8af1-9edda7cfc2f2\n"], ["created_at", "2018-10-18 04:36:19.979113"], ["updated_at", "2018-10-18 04:36:19.979113"]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "f7a2fa72-374a-4c5d-9d79-bced82ebc7ba"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "80ff5703-b988-41c4-981d-dad3ada0d2df"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190965], ["cluster_id", 980190963], ["uid", "aea9de05-5dc9-415b-8af1-9edda7cfc2f2"], ["status", "PENDING"], ["created_at", "2018-10-18 04:36:19.981557"], ["updated_at", "2018-10-18 04:36:19.981557"]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08] Executing command Releases::StatusCommand: {:release_uid=>"f7a2fa72-374a-4c5d-9d79-bced82ebc7ba", :cluster_uid=>"80ff5703-b988-41c4-981d-dad3ada0d2df", :status=>"REMOVED", :error=>nil}
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "036e820f-e428-4b1c-8639-eda5a3204333"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: f7a2fa72-374a-4c5d-9d79-bced82ebc7ba\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:36:19.983412"], ["updated_at", "2018-10-18 04:36:19.983412"]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "f7a2fa72-374a-4c5d-9d79-bced82ebc7ba"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08] Executing command Releases::StatusCommand: {:release_uid=>"f7a2fa72-374a-4c5d-9d79-bced82ebc7ba", :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Release>}
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "37c44c23-c4f7-4634-bd99-d0859edd9cab"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: f7a2fa72-374a-4c5d-9d79-bced82ebc7ba\nstatus: ERRORED\n"], ["created_at", "2018-10-18 04:36:19.987963"], ["updated_at", "2018-10-18 04:36:19.987963"]]
--------------------------
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "f7a2fa72-374a-4c5d-9d79-bced82ebc7ba"], ["LIMIT", 1]]
AppsTest: test_crud_an_app
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08]   [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
--------------------------
[ActiveJob] [ReleaseRemoveJob] [a0239ea5-8dc1-4cba-9710-e7d241555b08] Error performing ReleaseRemoveJob (Job ID: a0239ea5-8dc1-4cba-9710-e7d241555b08) from Async(default) in 22.81ms: ActiveRecord::RecordNotFound (Couldn't find Release):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/core.rb:228:in `find_by!'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/dynamic_matchers.rb:66:in `find_by_uid!'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/release.rb:22:in `block in <class:Release>'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:14:in `block (2 levels) in play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `each'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `block in play'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:235:in `block in transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/transaction.rb:194:in `block in within_new_transaction'
/usr/lib/ruby/2.3.0/monitor.rb:214:in `mon_synchronize'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/transaction.rb:191:in `within_new_transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:235:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/transactions.rb:210:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:10:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_remove_job.rb:37:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_remove_job.rb:22:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_remove_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:36:19 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "37ef422a-4b7b-493f-9afa-df644afbbd51"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 47f40864-bcfd-4824-9e24-986693a318e5\n"], ["created_at", "2018-10-18 04:36:19.993259"], ["updated_at", "2018-10-18 04:36:19.993259"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "47f40864-bcfd-4824-9e24-986693a318e5"], ["name", "test"], ["created_at", "2018-10-18 04:36:19.995522"], ["updated_at", "2018-10-18 04:36:19.995522"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"47f40864-bcfd-4824-9e24-986693a318e5"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af80c9be-18d2-4dfe-89d8-9111f5440296"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: e764b81a-d3b3-48c1-bd87-d24a043fe35c\napp_uid: 47f40864-bcfd-4824-9e24-986693a318e5\n"], ["created_at", "2018-10-18 04:36:19.997584"], ["updated_at", "2018-10-18 04:36:19.997584"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "47f40864-bcfd-4824-9e24-986693a318e5"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "e764b81a-d3b3-48c1-bd87-d24a043fe35c"], ["name", "review"], ["created_at", "2018-10-18 04:36:20.000368"], ["updated_at", "2018-10-18 04:36:20.000368"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e764b81a-d3b3-48c1-bd87-d24a043fe35c"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"e764b81a-d3b3-48c1-bd87-d24a043fe35c", "app_uid"=>"47f40864-bcfd-4824-9e24-986693a318e5"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fd92eba6-a2f7-4b67-9fbf-e982e9fdae79"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 07279671-3236-4286-bb0c-80f5a6adcc75\nstage_uid: e764b81a-d3b3-48c1-bd87-d24a043fe35c\napp_uid: 47f40864-bcfd-4824-9e24-986693a318e5\n"], ["created_at", "2018-10-18 04:36:20.005134"], ["updated_at", "2018-10-18 04:36:20.005134"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "47f40864-bcfd-4824-9e24-986693a318e5"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "e764b81a-d3b3-48c1-bd87-d24a043fe35c"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "07279671-3236-4286-bb0c-80f5a6adcc75"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:36:20.008980"], ["updated_at", "2018-10-18 04:36:20.008980"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"47f40864-bcfd-4824-9e24-986693a318e5"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "600ec019-5616-4316-961d-db93bfedc364"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: d169d238-6c99-45d2-97de-5579be2e85b7\napp_uid: 47f40864-bcfd-4824-9e24-986693a318e5\n"], ["created_at", "2018-10-18 04:36:20.012202"], ["updated_at", "2018-10-18 04:36:20.012202"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "47f40864-bcfd-4824-9e24-986693a318e5"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "d169d238-6c99-45d2-97de-5579be2e85b7"], ["name", "staging"], ["created_at", "2018-10-18 04:36:20.014323"], ["updated_at", "2018-10-18 04:36:20.014323"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d169d238-6c99-45d2-97de-5579be2e85b7"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"d169d238-6c99-45d2-97de-5579be2e85b7", "app_uid"=>"47f40864-bcfd-4824-9e24-986693a318e5"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "fa618529-cf65-43fa-ac66-669707357fc7"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 99da6ae7-4149-4ad8-bf87-4a37394ef858\nstage_uid: d169d238-6c99-45d2-97de-5579be2e85b7\napp_uid: 47f40864-bcfd-4824-9e24-986693a318e5\n"], ["created_at", "2018-10-18 04:36:20.017181"], ["updated_at", "2018-10-18 04:36:20.017181"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "47f40864-bcfd-4824-9e24-986693a318e5"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "d169d238-6c99-45d2-97de-5579be2e85b7"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "99da6ae7-4149-4ad8-bf87-4a37394ef858"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:36:20.020710"], ["updated_at", "2018-10-18 04:36:20.020710"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 33ms (ActiveRecord: 4.1ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:36:20 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.1ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:36:20.031012', '2018-10-18 04:36:20.031012')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:36:20.032233', '2018-10-18 04:36:20.032233')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:36:20.033297', '2018-10-18 04:36:20.033297', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:36:20.034263', '2018-10-18 04:36:20.034263')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:36:20.035271', '2018-10-18 04:36:20.035271', 980190962)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4625eb8c-15f1-4159-be0f-f898d402183b"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: a1fc7bcb-d319-438d-97c9-70a7c879738f\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:36:20.043178"], ["updated_at", "2018-10-18 04:36:20.043178"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "a1fc7bcb-d319-438d-97c9-70a7c879738f"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:36:20.047565"], ["updated_at", "2018-10-18 04:36:20.047565"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c8ce3d80-7b4b-48f4-bf22-fadacba7ba6b"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:36:20.051018"], ["updated_at", "2018-10-18 04:36:20.051018"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "9e9f9301-341c-4df2-ba36-bf5bfb26061c"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 6dea8786-7417-4af5-a9d6-fda16d9b1bd7\n"], ["created_at", "2018-10-18 04:36:20.055665"], ["updated_at", "2018-10-18 04:36:20.055665"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "6dea8786-7417-4af5-a9d6-fda16d9b1bd7"], ["name", "test2"], ["created_at", "2018-10-18 04:36:20.059612"], ["updated_at", "2018-10-18 04:36:20.059612"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "498dba25-1333-4591-87a6-1a0da4a72bf3"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:36:20.062613"], ["updated_at", "2018-10-18 04:36:20.062613"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:36:20.064702"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5b43dfe1-5ade-4436-87da-ce40eef99d13"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: 6774b62c-d0f5-4526-b8f1-98297b20424f\n"], ["created_at", "2018-10-18 04:36:20.067158"], ["updated_at", "2018-10-18 04:36:20.067158"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "6774b62c-d0f5-4526-b8f1-98297b20424f"], ["name", "test"], ["created_at", "2018-10-18 04:36:20.069777"], ["updated_at", "2018-10-18 04:36:20.069777"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "3d002d74-bd73-4339-ac79-c92da68fb8a6"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 71c6815c-fe6b-49ca-917f-0eb812d96c42\n"], ["created_at", "2018-10-18 04:36:20.072545"], ["updated_at", "2018-10-18 04:36:20.072545"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "71c6815c-fe6b-49ca-917f-0eb812d96c42"], ["name", "test2"], ["created_at", "2018-10-18 04:36:20.075562"], ["updated_at", "2018-10-18 04:36:20.075562"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1c0f0ae7-1e92-4e6a-88b7-95f45185df2d"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:36:20.078383"], ["updated_at", "2018-10-18 04:36:20.078383"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b92fb352-4678-4810-89ab-7f172b523ae1"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 4bd14769-9851-4514-b5aa-0a604235eaca\n"], ["created_at", "2018-10-18 04:36:20.081939"], ["updated_at", "2018-10-18 04:36:20.081939"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "4bd14769-9851-4514-b5aa-0a604235eaca"], ["name", "test"], ["created_at", "2018-10-18 04:36:20.084151"], ["updated_at", "2018-10-18 04:36:20.084151"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "590ad40a-1b79-4758-a2ab-2a2b8fb1f3be"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:36:20.087385"], ["updated_at", "2018-10-18 04:36:20.087385"]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:36:20.090573"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d276b849-662d-4169-af64-9f530bcf81f1"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: d9de65d0-5ab9-4eff-acc8-2812a0cefbd1\n"], ["created_at", "2018-10-18 04:36:20.093505"], ["updated_at", "2018-10-18 04:36:20.093505"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d9de65d0-5ab9-4eff-acc8-2812a0cefbd1"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:36:20.095898"], ["updated_at", "2018-10-18 04:36:20.095898"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 5581b49a-0a32-4212-aca1-3639577f53d6) to Async(default) with arguments: "d276b849-662d-4169-af64-9f530bcf81f1"
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6] Performing ReleaseJob (Job ID: 5581b49a-0a32-4212-aca1-3639577f53d6) from Async(default) with arguments: "d276b849-662d-4169-af64-9f530bcf81f1"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "d276b849-662d-4169-af64-9f530bcf81f1"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6] Executing command Releases::StatusCommand: {:release_uid=>"d9de65d0-5ab9-4eff-acc8-2812a0cefbd1", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "49a5169a-f5bd-4874-ad2b-ebec13e8ff4e"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: d9de65d0-5ab9-4eff-acc8-2812a0cefbd1\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:20.102078"], ["updated_at", "2018-10-18 04:36:20.102078"]]
------------------------------------------
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "d9de65d0-5ab9-4eff-acc8-2812a0cefbd1"], ["LIMIT", 1]]
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
------------------------------------------
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6] Executing command Releases::StatusCommand: {:release_uid=>"d9de65d0-5ab9-4eff-acc8-2812a0cefbd1", :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Release>}
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a8c421bc-9473-465f-84c1-2e83f3f1326f"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: d9de65d0-5ab9-4eff-acc8-2812a0cefbd1\nstatus: ERRORED\n"], ["created_at", "2018-10-18 04:36:20.106160"], ["updated_at", "2018-10-18 04:36:20.106160"]]
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "d9de65d0-5ab9-4eff-acc8-2812a0cefbd1"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6]   [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [5581b49a-0a32-4212-aca1-3639577f53d6] Error performing ReleaseJob (Job ID: 5581b49a-0a32-4212-aca1-3639577f53d6) from Async(default) in 10.12ms: ActiveRecord::RecordNotFound (Couldn't find Release):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/core.rb:228:in `find_by!'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/dynamic_matchers.rb:66:in `find_by_uid!'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/release.rb:22:in `block in <class:Release>'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:14:in `block (2 levels) in play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `each'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `block in play'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:235:in `block in transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/transaction.rb:194:in `block in within_new_transaction'
/usr/lib/ruby/2.3.0/monitor.rb:214:in `mon_synchronize'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/transaction.rb:191:in `within_new_transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:235:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/transactions.rb:210:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:10:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[36mCluster Load (2.4ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "af2064e6-8511-4291-beea-a11a0e82aa7d"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: 18c45968-9fc2-4367-9a88-c1576cd5e8f2\n"], ["created_at", "2018-10-18 04:36:20.109065"], ["updated_at", "2018-10-18 04:36:20.109065"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "18c45968-9fc2-4367-9a88-c1576cd5e8f2"], ["status", "PENDING"], ["created_at", "2018-10-18 04:36:20.111950"], ["updated_at", "2018-10-18 04:36:20.111950"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [88bb5d4a-4dbe-4313-87cc-1f57fee080c4] Performed ReleaseJob (Job ID: 88bb5d4a-4dbe-4313-87cc-1f57fee080c4) from Async(default) in 223.37ms
[ActiveJob] [ReleaseJob] [ca43f69e-4e04-43e2-8487-b82da4878523] Performed ReleaseJob (Job ID: ca43f69e-4e04-43e2-8487-b82da4878523) from Async(default) in 175.28ms
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixture Delete (0.2ms)[0m  [1m[31mDELETE FROM "apps"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("id", "uid", "name", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d238', 'one', '2018-10-18 04:36:41.196574', '2018-10-18 04:36:41.196574')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "stages"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("id", "uid", "name", "app_id", "review", "auto", "promotion", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d239', 'one', 1, 'f', 'f', 'f', '2018-10-18 04:36:41.198862', '2018-10-18 04:36:41.198862')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "clusters"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("uid", "name", "stage_id", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 'one', 1, '2018-10-18 04:36:41.200380', '2018-10-18 04:36:41.200380', 980190962)[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "builds"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("id", "uid", "app_id", "stage_id", "number", "version", "values", "created_at", "updated_at") VALUES (1, 'ba5155ed-2e21-4733-9ba0-87051cf4d232', 1, 1, 1, 'v1', '--- {}', '2018-10-18 04:36:41.201784', '2018-10-18 04:36:41.201784')[0m
  [1m[36mFixture Delete (0.1ms)[0m  [1m[31mDELETE FROM "releases"[0m
  [1m[36mFixture Insert (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at", "id") VALUES ('ba5155ed-2e21-4733-9ba0-87051cf4d236', 1, 'PENDING', '2018-10-18 04:36:41.203281', '2018-10-18 04:36:41.203281', 980190962)[0m
  [1m[35m (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------
AppsTest: test_crud_an_app
--------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "feb494ce-6f89-409f-ab8c-8e5c1e7d2c12"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: e53585cf-522a-46bd-9bd0-9e1c8253a696\n"], ["created_at", "2018-10-18 04:36:41.226781"], ["updated_at", "2018-10-18 04:36:41.226781"]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "e53585cf-522a-46bd-9bd0-9e1c8253a696"], ["name", "test"], ["created_at", "2018-10-18 04:36:41.231646"], ["updated_at", "2018-10-18 04:36:41.231646"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"e53585cf-522a-46bd-9bd0-9e1c8253a696"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "c29d64b6-f191-4302-a105-8f20726a0f9f"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 37b0cd3f-76ac-4bb4-a067-4f8f81edafc9\napp_uid: e53585cf-522a-46bd-9bd0-9e1c8253a696\n"], ["created_at", "2018-10-18 04:36:41.234120"], ["updated_at", "2018-10-18 04:36:41.234120"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e53585cf-522a-46bd-9bd0-9e1c8253a696"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "37b0cd3f-76ac-4bb4-a067-4f8f81edafc9"], ["name", "review"], ["created_at", "2018-10-18 04:36:41.241601"], ["updated_at", "2018-10-18 04:36:41.241601"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "37b0cd3f-76ac-4bb4-a067-4f8f81edafc9"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"37b0cd3f-76ac-4bb4-a067-4f8f81edafc9", "app_uid"=>"e53585cf-522a-46bd-9bd0-9e1c8253a696"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f4cf88f2-08d1-48b4-97ee-83012940d4f1"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 8c70a9da-3ac5-4463-8b8a-88fb201252cf\nstage_uid: 37b0cd3f-76ac-4bb4-a067-4f8f81edafc9\napp_uid: e53585cf-522a-46bd-9bd0-9e1c8253a696\n"], ["created_at", "2018-10-18 04:36:41.244898"], ["updated_at", "2018-10-18 04:36:41.244898"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e53585cf-522a-46bd-9bd0-9e1c8253a696"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "37b0cd3f-76ac-4bb4-a067-4f8f81edafc9"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "8c70a9da-3ac5-4463-8b8a-88fb201252cf"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:36:41.252758"], ["updated_at", "2018-10-18 04:36:41.252758"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"e53585cf-522a-46bd-9bd0-9e1c8253a696"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "92fca922-e4b1-40ff-abdf-e2d811bc33bc"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: 443abb10-923a-4521-bc8f-c6023f7c937d\napp_uid: e53585cf-522a-46bd-9bd0-9e1c8253a696\n"], ["created_at", "2018-10-18 04:36:41.257318"], ["updated_at", "2018-10-18 04:36:41.257318"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e53585cf-522a-46bd-9bd0-9e1c8253a696"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "443abb10-923a-4521-bc8f-c6023f7c937d"], ["name", "staging"], ["created_at", "2018-10-18 04:36:41.259700"], ["updated_at", "2018-10-18 04:36:41.259700"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "443abb10-923a-4521-bc8f-c6023f7c937d"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"443abb10-923a-4521-bc8f-c6023f7c937d", "app_uid"=>"e53585cf-522a-46bd-9bd0-9e1c8253a696"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bd0a615d-3e9d-4246-a9f3-de51822ede3a"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: 74a4dc8b-4708-485f-808f-c4cccb71d509\nstage_uid: 443abb10-923a-4521-bc8f-c6023f7c937d\napp_uid: e53585cf-522a-46bd-9bd0-9e1c8253a696\n"], ["created_at", "2018-10-18 04:36:41.262132"], ["updated_at", "2018-10-18 04:36:41.262132"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e53585cf-522a-46bd-9bd0-9e1c8253a696"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "443abb10-923a-4521-bc8f-c6023f7c937d"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "74a4dc8b-4708-485f-808f-c4cccb71d509"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:36:41.264995"], ["updated_at", "2018-10-18 04:36:41.264995"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 54ms (ActiveRecord: 3.9ms)
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
Processing by AppsController#show as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.9ms)
Started DELETE "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
Processing by AppsController#destroy as HTML
  Parameters: {"app"=>"test"}
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"e53585cf-522a-46bd-9bd0-9e1c8253a696"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ea437d67-5599-4d3b-9b28-a797ee2e3d52"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: e53585cf-522a-46bd-9bd0-9e1c8253a696\n"], ["created_at", "2018-10-18 04:36:41.283708"], ["updated_at", "2018-10-18 04:36:41.283708"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "e53585cf-522a-46bd-9bd0-9e1c8253a696"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------
AppsTest: test_release_a_build
------------------------------
Started POST "/api/v1/apps" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
Processing by AppsController#create as HTML
  Parameters: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}]}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
Executing command Apps::UpsertCommand: {"name"=>"test", "stages"=>[{"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}]}, {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}]}], "controller"=>"apps", "action"=>"create", "app_uid"=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "e872157e-b7b0-41fd-9b7a-aa940bfd19c5"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: b737a54d-4c20-4784-970f-0a54bf8c5560\n"], ["created_at", "2018-10-18 04:36:41.289203"], ["updated_at", "2018-10-18 04:36:41.289203"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "b737a54d-4c20-4784-970f-0a54bf8c5560"], ["name", "test"], ["created_at", "2018-10-18 04:36:41.291416"], ["updated_at", "2018-10-18 04:36:41.291416"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"review", "review"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"review"}}], "stage_uid"=>nil, "app_uid"=>"b737a54d-4c20-4784-970f-0a54bf8c5560"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "104e7b1a-70c8-4274-ac03-ebb38b202bb2"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: review\nstage_uid: 5d099b12-4f84-4648-bf63-9ff3a79bbf3f\napp_uid: b737a54d-4c20-4784-970f-0a54bf8c5560\n"], ["created_at", "2018-10-18 04:36:41.293258"], ["updated_at", "2018-10-18 04:36:41.293258"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b737a54d-4c20-4784-970f-0a54bf8c5560"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "5d099b12-4f84-4648-bf63-9ff3a79bbf3f"], ["name", "review"], ["created_at", "2018-10-18 04:36:41.295825"], ["updated_at", "2018-10-18 04:36:41.295825"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "5d099b12-4f84-4648-bf63-9ff3a79bbf3f"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 2 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"review"}, "cluster_uid"=>nil, "stage_uid"=>"5d099b12-4f84-4648-bf63-9ff3a79bbf3f", "app_uid"=>"b737a54d-4c20-4784-970f-0a54bf8c5560"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "bb3a2471-4dfe-485c-b966-5e51a16ffcdc"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: review\ncluster_uid: 857b1fd7-ff2f-4fe7-81e5-4224e533d019\nstage_uid: 5d099b12-4f84-4648-bf63-9ff3a79bbf3f\napp_uid: b737a54d-4c20-4784-970f-0a54bf8c5560\n"], ["created_at", "2018-10-18 04:36:41.298961"], ["updated_at", "2018-10-18 04:36:41.298961"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b737a54d-4c20-4784-970f-0a54bf8c5560"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "5d099b12-4f84-4648-bf63-9ff3a79bbf3f"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "857b1fd7-ff2f-4fe7-81e5-4224e533d019"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: review\n"], ["created_at", "2018-10-18 04:36:41.302913"], ["updated_at", "2018-10-18 04:36:41.302913"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {"name"=>"staging", "promote"=>"true", "clusters"=>[{"name"=>"staging", "values"=>{"prefix"=>"staging"}}], "stage_uid"=>nil, "app_uid"=>"b737a54d-4c20-4784-970f-0a54bf8c5560"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8f102d62-1e53-47b3-b005-e282ffc69ee6"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nstage_uid: b0b1ccc0-f8b9-4e4a-aa1c-0e9f883a987c\napp_uid: b737a54d-4c20-4784-970f-0a54bf8c5560\n"], ["created_at", "2018-10-18 04:36:41.307043"], ["updated_at", "2018-10-18 04:36:41.307043"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b737a54d-4c20-4784-970f-0a54bf8c5560"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 2], ["uid", "b0b1ccc0-f8b9-4e4a-aa1c-0e9f883a987c"], ["name", "staging"], ["created_at", "2018-10-18 04:36:41.309733"], ["updated_at", "2018-10-18 04:36:41.309733"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b0b1ccc0-f8b9-4e4a-aa1c-0e9f883a987c"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."name" = ? AND "clusters"."stage_id" = 3 LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {"name"=>"staging", "values"=>{"prefix"=>"staging"}, "cluster_uid"=>nil, "stage_uid"=>"b0b1ccc0-f8b9-4e4a-aa1c-0e9f883a987c", "app_uid"=>"b737a54d-4c20-4784-970f-0a54bf8c5560"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0e8e388a-b6c8-4288-b432-2480c757eaa0"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: staging\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  prefix: staging\ncluster_uid: f6e8c83f-4940-459c-8265-b7bd2a09fd3a\nstage_uid: b0b1ccc0-f8b9-4e4a-aa1c-0e9f883a987c\napp_uid: b737a54d-4c20-4784-970f-0a54bf8c5560\n"], ["created_at", "2018-10-18 04:36:41.313208"], ["updated_at", "2018-10-18 04:36:41.313208"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b737a54d-4c20-4784-970f-0a54bf8c5560"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b0b1ccc0-f8b9-4e4a-aa1c-0e9f883a987c"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "values", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "f6e8c83f-4940-459c-8265-b7bd2a09fd3a"], ["name", "staging"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nprefix: staging\n"], ["created_at", "2018-10-18 04:36:41.316556"], ["updated_at", "2018-10-18 04:36:41.316556"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."app_id" = 2 AND "clusters"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
Completed 201 Created in 33ms (ActiveRecord: 3.5ms)
Started POST "/api/v1/apps/test/review/builds" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
Processing by ReleasesController#build as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:version=>"v1", :values=>nil, :app_uid=>"b737a54d-4c20-4784-970f-0a54bf8c5560", :stage_uid=>"5d099b12-4f84-4648-bf63-9ff3a79bbf3f"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "aefa392e-f6ef-4c3f-b367-dc46e2a1e8d7"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nversion: v1\nvalues: \napp_uid: b737a54d-4c20-4784-970f-0a54bf8c5560\nstage_uid: 5d099b12-4f84-4648-bf63-9ff3a79bbf3f\nbuild_uid: e15f7cf7-fbbb-4ead-98cd-1a1cc835fdb8\n"], ["created_at", "2018-10-18 04:36:41.324792"], ["updated_at", "2018-10-18 04:36:41.324792"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "b737a54d-4c20-4784-970f-0a54bf8c5560"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "5d099b12-4f84-4648-bf63-9ff3a79bbf3f"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 2], ["uid", "e15f7cf7-fbbb-4ead-98cd-1a1cc835fdb8"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:36:41.338732"], ["updated_at", "2018-10-18 04:36:41.338732"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 18ms (ActiveRecord: 0.9ms)
Started POST "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
Processing by ReleasesController#release as HTML
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"e15f7cf7-fbbb-4ead-98cd-1a1cc835fdb8"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d9841754-6713-436d-91e7-e1f8c25f956c"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: e15f7cf7-fbbb-4ead-98cd-1a1cc835fdb8\nrelease_uid: b64f41b8-cd1a-4504-80bb-172b1d59ef80\n"], ["created_at", "2018-10-18 04:36:41.345926"], ["updated_at", "2018-10-18 04:36:41.345926"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "e15f7cf7-fbbb-4ead-98cd-1a1cc835fdb8"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b64f41b8-cd1a-4504-80bb-172b1d59ef80"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:36:41.352053"], ["updated_at", "2018-10-18 04:36:41.352053"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 5aca8127-b759-48ff-b75d-3a2b928f6616) to Async(default) with arguments: "d9841754-6713-436d-91e7-e1f8c25f956c"
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616] Performing ReleaseJob (Job ID: 5aca8127-b759-48ff-b75d-3a2b928f6616) from Async(default) with arguments: "d9841754-6713-436d-91e7-e1f8c25f956c"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 12ms (ActiveRecord: 0.8ms)
Started POST "/api/v1/apps/test/review/promote?version=v1&to=staging" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
Processing by ReleasesController#promote as HTML
  Parameters: {"version"=>"v1", "to"=>"staging", "app"=>"test", "stage"=>"review"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 2 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
Executing command Builds::PromoteCommand: {:source_build_uid=>"e15f7cf7-fbbb-4ead-98cd-1a1cc835fdb8", :target_stage_uid=>"b0b1ccc0-f8b9-4e4a-aa1c-0e9f883a987c"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0415ecef-11bd-4d64-85b1-1c61ee997875"], ["name", "Builds::PromotedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nsource_build_uid: e15f7cf7-fbbb-4ead-98cd-1a1cc835fdb8\ntarget_stage_uid: b0b1ccc0-f8b9-4e4a-aa1c-0e9f883a987c\nbuild_uid: d612f63f-1fc8-445b-92f7-390728cb942e\n"], ["created_at", "2018-10-18 04:36:41.361107"], ["updated_at", "2018-10-18 04:36:41.361107"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "e15f7cf7-fbbb-4ead-98cd-1a1cc835fdb8"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "b0b1ccc0-f8b9-4e4a-aa1c-0e9f883a987c"], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "builds" SET "promoted" = ?, "number" = ?, "updated_at" = ? WHERE "builds"."id" = ?[0m  [["promoted", "t"], ["number", 2], ["updated_at", "2018-10-18 04:36:41.368882"], ["id", 2]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 2], ["stage_id", 3], ["uid", "d612f63f-1fc8-445b-92f7-390728cb942e"], ["version", "v1"], ["number", 1], ["created_at", "2018-10-18 04:36:41.371849"], ["updated_at", "2018-10-18 04:36:41.371849"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 16ms (ActiveRecord: 1.2ms)
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mEvent Load (0.1ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "d9841754-6713-436d-91e7-e1f8c25f956c"], ["LIMIT", 1]]
Started POST "/api/v1/apps/test/staging/release?version=v1" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mBuild Load (0.5ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "e15f7cf7-fbbb-4ead-98cd-1a1cc835fdb8"], ["LIMIT", 1]]
Processing by ReleasesController#release as HTML
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"staging"}
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616] Executing command Releases::StatusCommand: {:release_uid=>"b64f41b8-cd1a-4504-80bb-172b1d59ef80", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "21484c63-f760-4786-b0fe-0f62c5a8c186"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b64f41b8-cd1a-4504-80bb-172b1d59ef80\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:41.377990"], ["updated_at", "2018-10-18 04:36:41.377990"]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b64f41b8-cd1a-4504-80bb-172b1d59ef80"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:36:41.381337"], ["id", 980190963]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "staging"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."version" = ? AND "builds"."app_id" = 2 AND "builds"."stage_id" = 3 LIMIT ?[0m  [["version", "v1"], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"d612f63f-1fc8-445b-92f7-390728cb942e"}
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "2e168498-7c1f-4b94-b964-d842149d9e26"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b64f41b8-cd1a-4504-80bb-172b1d59ef80\ncluster_uid: 857b1fd7-ff2f-4fe7-81e5-4224e533d019\ndeploy_uid: ec02018a-3784-403f-b83c-50e37f48f223\n"], ["created_at", "2018-10-18 04:36:41.384718"], ["updated_at", "2018-10-18 04:36:41.384718"]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b64f41b8-cd1a-4504-80bb-172b1d59ef80"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "857b1fd7-ff2f-4fe7-81e5-4224e533d019"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190963], ["cluster_id", 980190963], ["uid", "ec02018a-3784-403f-b83c-50e37f48f223"], ["status", "PENDING"], ["created_at", "2018-10-18 04:36:41.393090"], ["updated_at", "2018-10-18 04:36:41.393090"]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616] Executing command Releases::StatusCommand: {:release_uid=>"b64f41b8-cd1a-4504-80bb-172b1d59ef80", :cluster_uid=>"857b1fd7-ff2f-4fe7-81e5-4224e533d019", :status=>"PENDING", :error=>nil}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "85cb2155-8ccc-484c-a31d-02e6b218531d"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: d612f63f-1fc8-445b-92f7-390728cb942e\nrelease_uid: 00cf4550-efdb-4bc7-9a41-73abc4e67a67\n"], ["created_at", "2018-10-18 04:36:41.395170"], ["updated_at", "2018-10-18 04:36:41.395170"]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d612f63f-1fc8-445b-92f7-390728cb942e"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "00cf4550-efdb-4bc7-9a41-73abc4e67a67"], ["build_id", 3], ["status", "INITIAL"], ["created_at", "2018-10-18 04:36:41.397952"], ["updated_at", "2018-10-18 04:36:41.397952"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: 7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a) to Async(default) with arguments: "85cb2155-8ccc-484c-a31d-02e6b218531d"
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a] Performing ReleaseJob (Job ID: 7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a) from Async(default) with arguments: "85cb2155-8ccc-484c-a31d-02e6b218531d"
Completed 201 Created in 24ms (ActiveRecord: 0.7ms)
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "be7c132e-29ee-4ef3-9578-0e2906e9fb97"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: b64f41b8-cd1a-4504-80bb-172b1d59ef80\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:41.401151"], ["updated_at", "2018-10-18 04:36:41.401151"]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b64f41b8-cd1a-4504-80bb-172b1d59ef80"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "85cb2155-8ccc-484c-a31d-02e6b218531d"], ["LIMIT", 1]]
Started DELETE "/api/v1/apps/test/review/release?version=v1" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mBuild Load (0.8ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "d612f63f-1fc8-445b-92f7-390728cb942e"], ["LIMIT", 1]]
Processing by ReleasesController#remove as HTML
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  Parameters: {"version"=>"v1", "app"=>"test", "stage"=>"review"}
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a] Executing command Releases::StatusCommand: {:release_uid=>"00cf4550-efdb-4bc7-9a41-73abc4e67a67", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d22d9fe4-d93e-4e09-a4ac-cc0c67c0b5f9"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 00cf4550-efdb-4bc7-9a41-73abc4e67a67\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:41.408885"], ["updated_at", "2018-10-18 04:36:41.408885"]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "00cf4550-efdb-4bc7-9a41-73abc4e67a67"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:36:41.411421"], ["id", 980190964]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."app_id" = 2 AND "stages"."name" = ? LIMIT ?[0m  [["name", "review"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ae12200a-4145-4cfd-8385-9358ba6ce3f2"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 00cf4550-efdb-4bc7-9a41-73abc4e67a67\ncluster_uid: f6e8c83f-4940-459c-8265-b7bd2a09fd3a\ndeploy_uid: 6782d705-d166-4b0e-9cb2-59930869f10f\n"], ["created_at", "2018-10-18 04:36:41.415851"], ["updated_at", "2018-10-18 04:36:41.415851"]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "00cf4550-efdb-4bc7-9a41-73abc4e67a67"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "f6e8c83f-4940-459c-8265-b7bd2a09fd3a"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190964], ["cluster_id", 980190964], ["uid", "6782d705-d166-4b0e-9cb2-59930869f10f"], ["status", "PENDING"], ["created_at", "2018-10-18 04:36:41.418767"], ["updated_at", "2018-10-18 04:36:41.418767"]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a] Executing command Releases::StatusCommand: {:release_uid=>"00cf4550-efdb-4bc7-9a41-73abc4e67a67", :cluster_uid=>"f6e8c83f-4940-459c-8265-b7bd2a09fd3a", :status=>"PENDING", :error=>nil}
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d5aa0587-e73f-4e4a-abb5-df10905ae659"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: 00cf4550-efdb-4bc7-9a41-73abc4e67a67\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:41.421245"], ["updated_at", "2018-10-18 04:36:41.421245"]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "00cf4550-efdb-4bc7-9a41-73abc4e67a67"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
Executing command Releases::DeleteCommand: {:target_release_uid=>"b64f41b8-cd1a-4504-80bb-172b1d59ef80"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "0753ec65-6887-4452-8d7b-381a73f81bab"], ["name", "Releases::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\ntarget_release_uid: b64f41b8-cd1a-4504-80bb-172b1d59ef80\nrelease_uid: f992fd68-4e7f-41b4-a604-48bd15d6f518\n"], ["created_at", "2018-10-18 04:36:41.425378"], ["updated_at", "2018-10-18 04:36:41.425378"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b64f41b8-cd1a-4504-80bb-172b1d59ef80"], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f992fd68-4e7f-41b4-a604-48bd15d6f518"], ["build_id", 2], ["status", "INITIAL"], ["created_at", "2018-10-18 04:36:41.428493"], ["updated_at", "2018-10-18 04:36:41.428493"]]
[ActiveJob] Enqueued ReleaseRemoveJob (Job ID: 6036bd94-1717-4c81-b6cf-f0faea6fb1db) to Async(default) with arguments: "0753ec65-6887-4452-8d7b-381a73f81bab"
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db] Performing ReleaseRemoveJob (Job ID: 6036bd94-1717-4c81-b6cf-f0faea6fb1db) from Async(default) with arguments: "0753ec65-6887-4452-8d7b-381a73f81bab"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 24ms (ActiveRecord: 1.1ms)
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mEvent Load (0.0ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "0753ec65-6887-4452-8d7b-381a73f81bab"], ["LIMIT", 1]]
Started GET "/api/v1/apps/test" for 127.0.0.1 at 2018-10-17 21:36:41 -0700
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mRelease Load (0.7ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "b64f41b8-cd1a-4504-80bb-172b1d59ef80"], ["LIMIT", 1]]
Processing by AppsController#show as HTML
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  Parameters: {"app"=>"test"}
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db] Executing command Releases::StatusCommand: {:release_uid=>"f992fd68-4e7f-41b4-a604-48bd15d6f518", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."name" = ? LIMIT ?[0m  [["name", "test"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "5b2332b7-e938-48b4-8ccb-0e54e092bbb1"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: f992fd68-4e7f-41b4-a604-48bd15d6f518\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:41.436333"], ["updated_at", "2018-10-18 04:36:41.436333"]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "f992fd68-4e7f-41b4-a604-48bd15d6f518"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "PENDING"], ["updated_at", "2018-10-18 04:36:41.438714"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."app_id" = ?[0m  [["app_id", 2]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mCluster Load (0.0ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.2ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "b1a9f130-bcfc-4a3b-8632-9551df3f6c83"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: f992fd68-4e7f-41b4-a604-48bd15d6f518\ncluster_uid: 857b1fd7-ff2f-4fe7-81e5-4224e533d019\ndeploy_uid: 6624619b-94e8-46b8-9d91-54db55a9f301\n"], ["created_at", "2018-10-18 04:36:41.442981"], ["updated_at", "2018-10-18 04:36:41.442981"]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "f992fd68-4e7f-41b4-a604-48bd15d6f518"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "857b1fd7-ff2f-4fe7-81e5-4224e533d019"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190965], ["cluster_id", 980190963], ["uid", "6624619b-94e8-46b8-9d91-54db55a9f301"], ["status", "PENDING"], ["created_at", "2018-10-18 04:36:41.445944"], ["updated_at", "2018-10-18 04:36:41.445944"]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db] Executing command Releases::StatusCommand: {:release_uid=>"f992fd68-4e7f-41b4-a604-48bd15d6f518", :cluster_uid=>"857b1fd7-ff2f-4fe7-81e5-4224e533d019", :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "1db03dee-a181-43a8-a899-c53366e53a7d"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: f992fd68-4e7f-41b4-a604-48bd15d6f518\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:36:41.449269"], ["updated_at", "2018-10-18 04:36:41.449269"]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "f992fd68-4e7f-41b4-a604-48bd15d6f518"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "releases" SET "status" = ?, "updated_at" = ? WHERE "releases"."id" = ?[0m  [["status", "REMOVED"], ["updated_at", "2018-10-18 04:36:41.451650"], ["id", 980190965]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db] Executing command Releases::StatusCommand: {:release_uid=>"f992fd68-4e7f-41b4-a604-48bd15d6f518", :cluster_uid=>nil, :status=>"REMOVED", :error=>nil}
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "f719ebf1-dc8e-445f-a96a-4b543dc66e62"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: f992fd68-4e7f-41b4-a604-48bd15d6f518\nstatus: REMOVED\n"], ["created_at", "2018-10-18 04:36:41.453797"], ["updated_at", "2018-10-18 04:36:41.453797"]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mRelease Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "f992fd68-4e7f-41b4-a604-48bd15d6f518"], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
[ActiveJob] [ReleaseRemoveJob] [6036bd94-1717-4c81-b6cf-f0faea6fb1db] Performed ReleaseRemoveJob (Job ID: 6036bd94-1717-4c81-b6cf-f0faea6fb1db) from Async(default) in 25.94ms
  [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 2) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 2]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 2], ["LIMIT", 50]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 2], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" INNER JOIN "builds" ON "releases"."build_id" = "builds"."id" WHERE "builds"."stage_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Build Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? AND (id < 3) ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT "clusters".* FROM "clusters" WHERE "clusters"."stage_id" = ?[0m  [["stage_id", 3]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."stage_id" = ? ORDER BY "builds"."id" DESC LIMIT ?[0m  [["stage_id", 3], ["LIMIT", 50]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
  [1m[36mCACHE Release Load (0.0ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? ORDER BY "releases"."id" DESC LIMIT ?[0m  [["build_id", 3], ["LIMIT", 1]]
Completed 200 OK in 45ms (Views: 0.9ms | ActiveRecord: 2.2ms)
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
ReleaseCommandsTest: test_create_a_release
------------------------------------------
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Releases::CreateCommand: {:build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "59b9bad5-f088-40ad-a898-09b7924f6af0"], ["name", "Releases::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nbuild_uid: ba5155ed-2e21-4733-9ba0-87051cf4d232\nrelease_uid: ea3dc546-9363-45de-b576-23958bdcf341\n"], ["created_at", "2018-10-18 04:36:41.482902"], ["updated_at", "2018-10-18 04:36:41.482902"]]
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "releases" ("uid", "build_id", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ea3dc546-9363-45de-b576-23958bdcf341"], ["build_id", 1], ["status", "INITIAL"], ["created_at", "2018-10-18 04:36:41.485417"], ["updated_at", "2018-10-18 04:36:41.485417"]]
[ActiveJob] Enqueued ReleaseJob (Job ID: bb128181-856d-42ba-a120-cd812be6587b) to Async(default) with arguments: "59b9bad5-f088-40ad-a898-09b7924f6af0"
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b] Performing ReleaseJob (Job ID: bb128181-856d-42ba-a120-cd812be6587b) from Async(default) with arguments: "59b9bad5-f088-40ad-a898-09b7924f6af0"
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[36mEvent Load (0.6ms)[0m  [1m[34mSELECT  "events".* FROM "events" WHERE "events"."uid" = ? LIMIT ?[0m  [["uid", "59b9bad5-f088-40ad-a898-09b7924f6af0"], ["LIMIT", 1]]
  [1m[36mRelease Load (0.3ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."build_id" = ? LIMIT ?[0m  [["build_id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d232"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[36mStage Load (0.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b] Executing command Releases::StatusCommand: {:release_uid=>"ea3dc546-9363-45de-b576-23958bdcf341", :cluster_uid=>nil, :status=>"PENDING", :error=>nil}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
ReleaseCommandsTest: test_deploy_a_release
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8fcc4b9c-7ba0-4035-8d8d-e313be5e7b71"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ea3dc546-9363-45de-b576-23958bdcf341\nstatus: PENDING\n"], ["created_at", "2018-10-18 04:36:41.492116"], ["updated_at", "2018-10-18 04:36:41.492116"]]
------------------------------------------
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mRelease Load (0.6ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[36mRelease Load (0.4ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ea3dc546-9363-45de-b576-23958bdcf341"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.2ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."id" = ? LIMIT ?[0m  [["id", 980190962], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b] Executing command Releases::StatusCommand: {:release_uid=>"ea3dc546-9363-45de-b576-23958bdcf341", :cluster_uid=>nil, :status=>"ERRORED", :error=>#<ActiveRecord::RecordNotFound: Couldn't find Release>}
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4a018846-b26c-415c-9e33-6542e6e62a47"], ["name", "Releases::DeployEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ncluster_uid: ba5155ed-2e21-4733-9ba0-87051cf4d236\ndeploy_uid: f4dcff1b-f95f-4f74-9c59-95860fd41887\n"], ["created_at", "2018-10-18 04:36:41.497580"], ["updated_at", "2018-10-18 04:36:41.497580"]]
  [1m[36mRelease Load (0.1ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[36mCluster Load (0.1ms)[0m  [1m[34mSELECT  "clusters".* FROM "clusters" WHERE "clusters"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d236"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "deploys" ("release_id", "cluster_id", "uid", "status", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["release_id", 980190962], ["cluster_id", 980190962], ["uid", "f4dcff1b-f95f-4f74-9c59-95860fd41887"], ["status", "PENDING"], ["created_at", "2018-10-18 04:36:41.502588"], ["updated_at", "2018-10-18 04:36:41.502588"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[35mSQL (3.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "8052d83d-acb0-475c-a1e1-42b47300a6ed"], ["name", "Releases::ReleaseStatusEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nrelease_uid: ea3dc546-9363-45de-b576-23958bdcf341\nstatus: ERRORED\n"], ["created_at", "2018-10-18 04:36:41.499645"], ["updated_at", "2018-10-18 04:36:41.499645"]]
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b]   [1m[36mRelease Load (0.2ms)[0m  [1m[34mSELECT  "releases".* FROM "releases" WHERE "releases"."uid" = ? LIMIT ?[0m  [["uid", "ea3dc546-9363-45de-b576-23958bdcf341"], ["LIMIT", 1]]
[ActiveJob] [ReleaseJob] [bb128181-856d-42ba-a120-cd812be6587b] Error performing ReleaseJob (Job ID: bb128181-856d-42ba-a120-cd812be6587b) from Async(default) in 17.78ms: ActiveRecord::RecordNotFound (Couldn't find Release):
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/core.rb:228:in `find_by!'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/dynamic_matchers.rb:66:in `find_by_uid!'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/release.rb:22:in `block in <class:Release>'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:14:in `block (2 levels) in play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `each'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:13:in `block in play'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/connection_adapters/abstract/database_statements.rb:233:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activerecord-5.1.6/lib/active_record/transactions.rb:210:in `transaction'
/home/colin/Workspace/src/github.com/coldog/navigator/app/models/event.rb:10:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:38:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/events/application_event.rb:26:in `play'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/releases/status_command.rb:8:in `command'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:16:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/commands/application_command.rb:10:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:38:in `set_status'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:21:in `rescue in perform'
/home/colin/Workspace/src/github.com/coldog/navigator/app/jobs/release_job.rb:12:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:37:in `block in perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/i18n-1.1.0/lib/i18n.rb:284:in `with_locale'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/translation.rb:7:in `block (2 levels) in <module:Translation>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:24:in `block (4 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `block in instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/notifications.rb:166:in `instrument'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:23:in `block (3 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `block in tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:44:in `tag_logger'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/logging.rb:20:in `block (2 levels) in <module:Logging>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:33:in `perform_now'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:22:in `block in execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:108:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:26:in `block (4 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:68:in `block in wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/execution_wrapper.rb:85:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/reloader.rb:67:in `wrap'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/railtie.rb:25:in `block (3 levels) in <class:Railtie>'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `instance_exec'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:117:in `block in run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activesupport-5.1.6/lib/active_support/callbacks.rb:135:in `run_callbacks'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/execution.rb:20:in `execute'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/activejob-5.1.6/lib/active_job/queue_adapters/async_adapter.rb:68:in `perform'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:348:in `run_task'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:337:in `block (3 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `loop'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:320:in `block (2 levels) in create_worker'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `catch'
/home/colin/Workspace/src/github.com/coldog/navigator/.bundle/bundle/ruby/2.3.0/gems/concurrent-ruby-1.0.5/lib/concurrent/executor/ruby_thread_pool_executor.rb:319:in `block in create_worker'
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_add_a_cluster
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "84f65576-91c4-4248-ab31-0e0e5e7838af"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: 483e96d9-8aec-4bf9-abe4-0815c452b076\n"], ["created_at", "2018-10-18 04:36:41.508281"], ["updated_at", "2018-10-18 04:36:41.508281"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "483e96d9-8aec-4bf9-abe4-0815c452b076"], ["name", "test2"], ["created_at", "2018-10-18 04:36:41.512160"], ["updated_at", "2018-10-18 04:36:41.512160"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
---------------------------------
AppCommandsTest: test_add_a_stage
---------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "a14bdcd9-492d-4bc9-ba55-243ffeae4585"], ["name", "Apps::StageCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test\nstage_uid: df186e1d-9800-41db-853e-d769cc1cca12\n"], ["created_at", "2018-10-18 04:36:41.514646"], ["updated_at", "2018-10-18 04:36:41.514646"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "stages" ("app_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["app_id", 1], ["uid", "df186e1d-9800-41db-853e-d769cc1cca12"], ["name", "test"], ["created_at", "2018-10-18 04:36:41.516970"], ["updated_at", "2018-10-18 04:36:41.516970"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------
AppCommandsTest: test_delete_a_(non_existent)_app
-------------------------------------------------
Executing command Apps::DeleteCommand: {:app_uid=>"asdf"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "d8a0d03c-2551-4019-9297-19413895a808"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: asdf\n"], ["created_at", "2018-10-18 04:36:41.518878"], ["updated_at", "2018-10-18 04:36:41.518878"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "asdf"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_create_an_app
-----------------------------------
Executing command Apps::CreateCommand: {:name=>"test"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "ef88e350-90b9-422e-a1e3-9d9705eef3b2"], ["name", "Apps::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nname: test\napp_uid: 0783e2d7-5e94-43f0-bafe-e91501d3ca3c\n"], ["created_at", "2018-10-18 04:36:41.522158"], ["updated_at", "2018-10-18 04:36:41.522158"]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "apps" ("uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["uid", "0783e2d7-5e94-43f0-bafe-e91501d3ca3c"], ["name", "test"], ["created_at", "2018-10-18 04:36:41.524422"], ["updated_at", "2018-10-18 04:36:41.524422"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_delete_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::DeleteCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "824f003d-c0e4-4f7f-8484-0ce154376577"], ["name", "Apps::DeletedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\n"], ["created_at", "2018-10-18 04:36:41.526598"], ["updated_at", "2018-10-18 04:36:41.526598"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[31mDELETE FROM "apps" WHERE "apps"."id" = ?[0m  [["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------
AppCommandsTest: test_update_a_stage
------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertStageCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "53745cb5-c08a-46aa-b067-d520ab2df34d"], ["name", "Apps::StageUpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\n"], ["created_at", "2018-10-18 04:36:41.531595"], ["updated_at", "2018-10-18 04:36:41.531595"]]
  [1m[36mStage Load (0.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "stages" SET "name" = ?, "updated_at" = ? WHERE "stages"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:36:41.534770"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
AppCommandsTest: test_update_a_cluster
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpsertClusterCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :name=>"test2"}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "92f70137-8181-4ce4-88c1-704b7309d2f6"], ["name", "Apps::ClusterCreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nname: test2\ncluster_uid: ecb3fbb3-1339-4012-902f-f975395efaea\n"], ["created_at", "2018-10-18 04:36:41.537799"], ["updated_at", "2018-10-18 04:36:41.537799"]]
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "clusters" ("app_id", "stage_id", "uid", "name", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "ecb3fbb3-1339-4012-902f-f975395efaea"], ["name", "test2"], ["created_at", "2018-10-18 04:36:41.541287"], ["updated_at", "2018-10-18 04:36:41.541287"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
-----------------------------------
AppCommandsTest: test_update_an_app
-----------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Apps::UpdateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :name=>"test2"}
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "23868818-5367-4d9f-b75a-d0137929fec6"], ["name", "Apps::UpdatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nname: test2\n"], ["created_at", "2018-10-18 04:36:41.544142"], ["updated_at", "2018-10-18 04:36:41.544142"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "apps" SET "name" = ?, "updated_at" = ? WHERE "apps"."id" = ?[0m  [["name", "test2"], ["updated_at", "2018-10-18 04:36:41.546105"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
--------------------------------------
BuildCommandsTest: test_create_a_build
--------------------------------------
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mBuild Load (0.0ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Executing command Builds::CreateCommand: {:app_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d238", :build_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d232", :stage_uid=>"ba5155ed-2e21-4733-9ba0-87051cf4d239", :version=>"v1", :values=>{:image=>{:repository=>"nginx", :tag=>"asdfasdf"}}}
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "events" ("uid", "name", "params", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["uid", "4074c59f-0d7f-4a5e-929b-b6c9ebfd7c7d"], ["name", "Builds::CreatedEvent"], ["params", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\napp_uid: ba5155ed-2e21-4733-9ba0-87051cf4d238\nbuild_uid: 5e86a0da-0eae-4d7c-ac5d-5587d9bb798b\nstage_uid: ba5155ed-2e21-4733-9ba0-87051cf4d239\nversion: v1\nvalues: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  image: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n    repository: nginx\n    tag: asdfasdf\n"], ["created_at", "2018-10-18 04:36:41.550741"], ["updated_at", "2018-10-18 04:36:41.550741"]]
  [1m[36mApp Load (0.0ms)[0m  [1m[34mSELECT  "apps".* FROM "apps" WHERE "apps"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d238"], ["LIMIT", 1]]
  [1m[36mStage Load (0.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."uid" = ? LIMIT ?[0m  [["uid", "ba5155ed-2e21-4733-9ba0-87051cf4d239"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT MAX("builds"."number") FROM "builds" WHERE "builds"."stage_id" = ?[0m  [["stage_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "builds" ("app_id", "stage_id", "uid", "version", "values", "number", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["app_id", 1], ["stage_id", 1], ["uid", "5e86a0da-0eae-4d7c-ac5d-5587d9bb798b"], ["version", "v1"], ["values", "--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nimage: !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  repository: nginx\n  tag: asdfasdf\n"], ["number", 2], ["created_at", "2018-10-18 04:36:41.554937"], ["updated_at", "2018-10-18 04:36:41.554937"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mBuild Load (0.1ms)[0m  [1m[34mSELECT  "builds".* FROM "builds" WHERE "builds"."app_id" = ? LIMIT ?[0m  [["app_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
[ActiveJob] [ReleaseJob] [5aca8127-b759-48ff-b75d-3a2b928f6616] Performed ReleaseJob (Job ID: 5aca8127-b759-48ff-b75d-3a2b928f6616) from Async(default) in 203.73ms
[ActiveJob] [ReleaseJob] [7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a] Performed ReleaseJob (Job ID: 7b5580eb-60c9-4af3-bbf1-7b98f50b5b9a) from Async(default) in 157.77ms
